<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from dox.sfr-fresh.com/fltk-1.3.0rc3-source/jdmarker_8c_source.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 16 Feb 2011 23:39:06 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SfR Fresh Dox - fltk: fltk-1.3.0rc3/jpeg/jdmarker.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">fltk&#160;<span id="projectnumber">1.3.0rc3</span></div>
   <div id="projectbrief">About: <A HREF= http://www.fltk.org/>FLTK</A> (Fast Light Tool Kit) is a cross-platform C++ GUI toolkit for UNIX/Linux (X11), Microsoft Windows, and MacOS X. Release candidate.<BR><IMG SRC="../warix/forest1.gif" ALT="">&nbsp;&nbsp;<A HREF="http://www.sfr-fresh.com/" TITLE="SfR Fresh Home">SfR Fresh</A> <A HREF="http://www.sfr-fresh.com/warix/features.html#doxygen" TITLE="SfR Fresh Doxygen Support Info">Dox</A>: <A HREF="../fresh/unix/misc/fltk-1.3.0rc3-source.tar.gz/index.html" TITLE="SfR Fresh: fltk-1.3.0rc3-source.tar.gz Contents &amp; Download Page">fltk-1.3.0rc3-source.tar.gz</A> ("inofficial" and yet experimental doxygen-generated source code documentation)&nbsp;&nbsp;<IMG SRC="../warix/forest2.gif" ALT=""><P></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index-2.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('jdmarker_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>jdmarker.c</h1>  </div>
</div>
<div class="contents">
<a href="jdmarker_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * jdmarker.c</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 1991-1998, Thomas G. Lane.</span>
<a name="l00005"></a>00005 <span class="comment"> * This file is part of the Independent JPEG Group&#39;s software.</span>
<a name="l00006"></a>00006 <span class="comment"> * For conditions of distribution and use, see the accompanying README file.</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * This file contains routines to decode JPEG datastream markers.</span>
<a name="l00009"></a>00009 <span class="comment"> * Most of the complexity arises from our desire to support input</span>
<a name="l00010"></a>00010 <span class="comment"> * suspension: if not all of the data for a marker is available,</span>
<a name="l00011"></a>00011 <span class="comment"> * we must exit back to the application.  On resumption, we reprocess</span>
<a name="l00012"></a>00012 <span class="comment"> * the marker.</span>
<a name="l00013"></a>00013 <span class="comment"> */</span>
<a name="l00014"></a>00014 
<a name="l00015"></a><a class="code" href="jdmarker_8c.html#ad5c3cdfae3019b8223973041a2a1304b">00015</a> <span class="preprocessor">#define JPEG_INTERNALS</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="jinclude_8h.html">jinclude.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="jpeglib_8h.html">jpeglib.h</a>&quot;</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758e">00020</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> {                  <span class="comment">/* JPEG marker codes */</span>
<a name="l00021"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eae378ea5accc324b1971661045a4310b6">00021</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eae378ea5accc324b1971661045a4310b6">M_SOF0</a>  = 0xc0,
<a name="l00022"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eadce732cdecfcc87caa8131dcbd1ce8f2">00022</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eadce732cdecfcc87caa8131dcbd1ce8f2">M_SOF1</a>  = 0xc1,
<a name="l00023"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea596fcf9241af0520cd9320e26500967f">00023</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea596fcf9241af0520cd9320e26500967f">M_SOF2</a>  = 0xc2,
<a name="l00024"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5788f5676ea22070ce8b0a4d347bdf3d">00024</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5788f5676ea22070ce8b0a4d347bdf3d">M_SOF3</a>  = 0xc3,
<a name="l00025"></a>00025   
<a name="l00026"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf58aa5a7c0fc59e3924b1ddcbbbc8cf9">00026</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf58aa5a7c0fc59e3924b1ddcbbbc8cf9">M_SOF5</a>  = 0xc5,
<a name="l00027"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea62db0a63d44ddd02930c5940bc875ea8">00027</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea62db0a63d44ddd02930c5940bc875ea8">M_SOF6</a>  = 0xc6,
<a name="l00028"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea133a046cfa34c60d7404af2d5cf7cf89">00028</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea133a046cfa34c60d7404af2d5cf7cf89">M_SOF7</a>  = 0xc7,
<a name="l00029"></a>00029   
<a name="l00030"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea7831272d3f1adf39cc435b929f4356c9">00030</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea7831272d3f1adf39cc435b929f4356c9">M_JPG</a>   = 0xc8,
<a name="l00031"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea76298c41c8b7ca8a78f2d8fe9b4142c2">00031</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea76298c41c8b7ca8a78f2d8fe9b4142c2">M_SOF9</a>  = 0xc9,
<a name="l00032"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea9e5c338b4fd5511088fa86bb20e64f3a">00032</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea9e5c338b4fd5511088fa86bb20e64f3a">M_SOF10</a> = 0xca,
<a name="l00033"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea9ec3e5a2e5e70c7709e34f4bd326beb4">00033</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea9ec3e5a2e5e70c7709e34f4bd326beb4">M_SOF11</a> = 0xcb,
<a name="l00034"></a>00034   
<a name="l00035"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eab6ab62ee271a4e525d18ac4dcaecc650">00035</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eab6ab62ee271a4e525d18ac4dcaecc650">M_SOF13</a> = 0xcd,
<a name="l00036"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea0e88fd11779e652bdcf14283fd66e147">00036</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea0e88fd11779e652bdcf14283fd66e147">M_SOF14</a> = 0xce,
<a name="l00037"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6e80f3fe9060cc5edffcb05f3ed87519">00037</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6e80f3fe9060cc5edffcb05f3ed87519">M_SOF15</a> = 0xcf,
<a name="l00038"></a>00038   
<a name="l00039"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea4d8c861e2af15fd3788eca8d9d6658ee">00039</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea4d8c861e2af15fd3788eca8d9d6658ee">M_DHT</a>   = 0xc4,
<a name="l00040"></a>00040   
<a name="l00041"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5c8f3cf42e49f762cd03593677b99ef5">00041</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5c8f3cf42e49f762cd03593677b99ef5">M_DAC</a>   = 0xcc,
<a name="l00042"></a>00042   
<a name="l00043"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6738992105ae7dcdbd213fc29bb999e6">00043</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6738992105ae7dcdbd213fc29bb999e6">M_RST0</a>  = 0xd0,
<a name="l00044"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf7926723c3ebd7589e6c1843b22d1397">00044</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf7926723c3ebd7589e6c1843b22d1397">M_RST1</a>  = 0xd1,
<a name="l00045"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf579fb1733121b059b53c5f97fae1354">00045</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf579fb1733121b059b53c5f97fae1354">M_RST2</a>  = 0xd2,
<a name="l00046"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea3fefaaf0b42355ed215b21aa873ba7d1">00046</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea3fefaaf0b42355ed215b21aa873ba7d1">M_RST3</a>  = 0xd3,
<a name="l00047"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea05200469090691bf26b5f14012b89dbd">00047</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea05200469090691bf26b5f14012b89dbd">M_RST4</a>  = 0xd4,
<a name="l00048"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea09e61cc3f4bdc5d2396b8c7c47a51d6c">00048</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea09e61cc3f4bdc5d2396b8c7c47a51d6c">M_RST5</a>  = 0xd5,
<a name="l00049"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eac46c1f3019d56391f103924232c32ef6">00049</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eac46c1f3019d56391f103924232c32ef6">M_RST6</a>  = 0xd6,
<a name="l00050"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea74e769cba5338cc23330b0e33dfd0953">00050</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea74e769cba5338cc23330b0e33dfd0953">M_RST7</a>  = 0xd7,
<a name="l00051"></a>00051   
<a name="l00052"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea71e9d6e2c20cb73325471cc87de62c2c">00052</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea71e9d6e2c20cb73325471cc87de62c2c">M_SOI</a>   = 0xd8,
<a name="l00053"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea18a46268847e1e9821cffd21a43c89b2">00053</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea18a46268847e1e9821cffd21a43c89b2">M_EOI</a>   = 0xd9,
<a name="l00054"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaddd23503953e352503564f0114539a7d">00054</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaddd23503953e352503564f0114539a7d">M_SOS</a>   = 0xda,
<a name="l00055"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea472e58da7490c1ba6a0513da4075b2fa">00055</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea472e58da7490c1ba6a0513da4075b2fa">M_DQT</a>   = 0xdb,
<a name="l00056"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea0bcbe4809c59685e3b73afa8d251b203">00056</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea0bcbe4809c59685e3b73afa8d251b203">M_DNL</a>   = 0xdc,
<a name="l00057"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea7509a5fd2ccebcb19d9cb3f94ba3fdb7">00057</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea7509a5fd2ccebcb19d9cb3f94ba3fdb7">M_DRI</a>   = 0xdd,
<a name="l00058"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaff74511621baa1a87f6865d5606d29df">00058</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaff74511621baa1a87f6865d5606d29df">M_DHP</a>   = 0xde,
<a name="l00059"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaaec89324e4df4ef51e8b19fee9e58c1c">00059</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaaec89324e4df4ef51e8b19fee9e58c1c">M_EXP</a>   = 0xdf,
<a name="l00060"></a>00060   
<a name="l00061"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">00061</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a>  = 0xe0,
<a name="l00062"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea253489a90d92cae281bc03692010cdec">00062</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea253489a90d92cae281bc03692010cdec">M_APP1</a>  = 0xe1,
<a name="l00063"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea353dd92719799115f3549070ebca08b8">00063</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea353dd92719799115f3549070ebca08b8">M_APP2</a>  = 0xe2,
<a name="l00064"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea1189a3e703577a8bebfa5ef7cac7f0ed">00064</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea1189a3e703577a8bebfa5ef7cac7f0ed">M_APP3</a>  = 0xe3,
<a name="l00065"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaca4f5b634273f13f183d43d686d0c977">00065</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaca4f5b634273f13f183d43d686d0c977">M_APP4</a>  = 0xe4,
<a name="l00066"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ead26d76b05df1877e1282b9888d58ca65">00066</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ead26d76b05df1877e1282b9888d58ca65">M_APP5</a>  = 0xe5,
<a name="l00067"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea630e5d313e9d121f392a08b112ff911a">00067</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea630e5d313e9d121f392a08b112ff911a">M_APP6</a>  = 0xe6,
<a name="l00068"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eae0c1d764a503bda79303fd354d3e0687">00068</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eae0c1d764a503bda79303fd354d3e0687">M_APP7</a>  = 0xe7,
<a name="l00069"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6976be93d708d35e4c15902251cfe9a3">00069</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6976be93d708d35e4c15902251cfe9a3">M_APP8</a>  = 0xe8,
<a name="l00070"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea407252f5a0ebd992929a30c53f2eaeb4">00070</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea407252f5a0ebd992929a30c53f2eaeb4">M_APP9</a>  = 0xe9,
<a name="l00071"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea94d76f68b62989522f5abd6ec8dbb637">00071</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea94d76f68b62989522f5abd6ec8dbb637">M_APP10</a> = 0xea,
<a name="l00072"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea191faf6bcfd41ec8cb09e9d906c3454b">00072</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea191faf6bcfd41ec8cb09e9d906c3454b">M_APP11</a> = 0xeb,
<a name="l00073"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea2d1429ea7bc7101f5db1b763a8002bcc">00073</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea2d1429ea7bc7101f5db1b763a8002bcc">M_APP12</a> = 0xec,
<a name="l00074"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea388b96c4e201109bfeaf766da8e71348">00074</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea388b96c4e201109bfeaf766da8e71348">M_APP13</a> = 0xed,
<a name="l00075"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5a37889b83b67a6e8d21e0091dfee430">00075</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5a37889b83b67a6e8d21e0091dfee430">M_APP14</a> = 0xee,
<a name="l00076"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf352dfefbde3708396055c619ab890ee">00076</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf352dfefbde3708396055c619ab890ee">M_APP15</a> = 0xef,
<a name="l00077"></a>00077   
<a name="l00078"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eac432b338a2bf281c5ac02637c421ce4a">00078</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eac432b338a2bf281c5ac02637c421ce4a">M_JPG0</a>  = 0xf0,
<a name="l00079"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf8f7b277c7acaf5f9fe36268916be7b9">00079</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf8f7b277c7acaf5f9fe36268916be7b9">M_JPG13</a> = 0xfd,
<a name="l00080"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea09270895cfe821542b21666dc22034c8">00080</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea09270895cfe821542b21666dc22034c8">M_COM</a>   = 0xfe,
<a name="l00081"></a>00081   
<a name="l00082"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaa759203dfe581c36f2c860b8b9d3a50a">00082</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaa759203dfe581c36f2c860b8b9d3a50a">M_TEM</a>   = 0x01,
<a name="l00083"></a>00083   
<a name="l00084"></a><a class="code" href="jdmarker_8c.html#af8679a604c2f6538ef502df1dafb758eafa0d07653af7b463ed1a339193cb12b7">00084</a>   <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eafa0d07653af7b463ed1a339193cb12b7">M_ERROR</a> = 0x100
<a name="l00085"></a>00085 } <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758e">JPEG_MARKER</a>;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">/* Private state */</span>
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="structmy__marker__reader.html">00090</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00091"></a><a class="code" href="structmy__marker__reader.html#ac0d8a24c85575d304ef4383e8f6ca5fc">00091</a>   <span class="keyword">struct </span><a class="code" href="structjpeg__marker__reader.html">jpeg_marker_reader</a> pub; <span class="comment">/* public fields */</span>
<a name="l00092"></a>00092 
<a name="l00093"></a>00093   <span class="comment">/* Application-overridable marker processing methods */</span>
<a name="l00094"></a><a class="code" href="structmy__marker__reader.html#a5e10e69e117d23840f04d54e7a3cdde5">00094</a>   jpeg_marker_parser_method <a class="code" href="structmy__marker__reader.html#a5e10e69e117d23840f04d54e7a3cdde5">process_COM</a>;
<a name="l00095"></a><a class="code" href="structmy__marker__reader.html#a3a466da71db30199ab019a03960013cc">00095</a>   jpeg_marker_parser_method process_APPn[16];
<a name="l00096"></a>00096 
<a name="l00097"></a>00097   <span class="comment">/* Limit on marker data length to save for each marker type */</span>
<a name="l00098"></a><a class="code" href="structmy__marker__reader.html#aa17938db027aceb539d880b78841826e">00098</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structmy__marker__reader.html#aa17938db027aceb539d880b78841826e">length_limit_COM</a>;
<a name="l00099"></a><a class="code" href="structmy__marker__reader.html#a029e9f21bc02a21c1a26d3c0d7158098">00099</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> length_limit_APPn[16];
<a name="l00100"></a>00100 
<a name="l00101"></a>00101   <span class="comment">/* Status of COM/APPn marker saving */</span>
<a name="l00102"></a><a class="code" href="structmy__marker__reader.html#a861ef3029e1690b4345a8ceb3975e8df">00102</a>   <a class="code" href="jpeglib_8h.html#a2efb5205b3e81589f2dc133f1a412bb0">jpeg_saved_marker_ptr</a> <a class="code" href="structmy__marker__reader.html#a861ef3029e1690b4345a8ceb3975e8df">cur_marker</a>;     <span class="comment">/* NULL if not processing a marker */</span>
<a name="l00103"></a><a class="code" href="structmy__marker__reader.html#ada1054ee3408bbfcacdddb27af8d9754">00103</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structmy__marker__reader.html#ada1054ee3408bbfcacdddb27af8d9754">bytes_read</a>;              <span class="comment">/* data bytes read so far in marker */</span>
<a name="l00104"></a>00104   <span class="comment">/* Note: cur_marker is not linked into marker_list until it&#39;s all read. */</span>
<a name="l00105"></a>00105 } <a class="code" href="structmy__marker__reader.html">my_marker_reader</a>;
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="jdmarker_8c.html#a7c8170841a144001b1dadfc8894e34e2">00107</a> <span class="keyword">typedef</span> <a class="code" href="structmy__marker__reader.html">my_marker_reader</a> * <a class="code" href="jcmarker_8c.html#a10592246118021c933dac745fe4344c5">my_marker_ptr</a>;
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="comment">/*</span>
<a name="l00111"></a>00111 <span class="comment"> * Macros for fetching data from the data source module.</span>
<a name="l00112"></a>00112 <span class="comment"> *</span>
<a name="l00113"></a>00113 <span class="comment"> * At all times, cinfo-&gt;src-&gt;next_input_byte and -&gt;bytes_in_buffer reflect</span>
<a name="l00114"></a>00114 <span class="comment"> * the current restart point; we update them only when we have reached a</span>
<a name="l00115"></a>00115 <span class="comment"> * suitable place to restart if a suspension occurs.</span>
<a name="l00116"></a>00116 <span class="comment"> */</span>
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="comment">/* Declare and initialize local copies of input pointer/count */</span>
<a name="l00119"></a><a class="code" href="jdmarker_8c.html#a7228ca7f1eedc647929a660a84ab6f33">00119</a> <span class="preprocessor">#define INPUT_VARS(cinfo)  \</span>
<a name="l00120"></a>00120 <span class="preprocessor">        struct jpeg_source_mgr * datasrc = (cinfo)-&gt;src;  \</span>
<a name="l00121"></a>00121 <span class="preprocessor">        const JOCTET * next_input_byte = datasrc-&gt;next_input_byte;  \</span>
<a name="l00122"></a>00122 <span class="preprocessor">        size_t bytes_in_buffer = datasrc-&gt;bytes_in_buffer</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span>
<a name="l00124"></a>00124 <span class="comment">/* Unload the local copies --- do this only at a restart boundary */</span>
<a name="l00125"></a><a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">00125</a> <span class="preprocessor">#define INPUT_SYNC(cinfo)  \</span>
<a name="l00126"></a>00126 <span class="preprocessor">        ( datasrc-&gt;next_input_byte = next_input_byte,  \</span>
<a name="l00127"></a>00127 <span class="preprocessor">          datasrc-&gt;bytes_in_buffer = bytes_in_buffer )</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span>
<a name="l00129"></a>00129 <span class="comment">/* Reload the local copies --- used only in MAKE_BYTE_AVAIL */</span>
<a name="l00130"></a><a class="code" href="jdmarker_8c.html#ac61ffb88e11785e64e8462b75bcdee20">00130</a> <span class="preprocessor">#define INPUT_RELOAD(cinfo)  \</span>
<a name="l00131"></a>00131 <span class="preprocessor">        ( next_input_byte = datasrc-&gt;next_input_byte,  \</span>
<a name="l00132"></a>00132 <span class="preprocessor">          bytes_in_buffer = datasrc-&gt;bytes_in_buffer )</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>
<a name="l00134"></a>00134 <span class="comment">/* Internal macro for INPUT_BYTE and INPUT_2BYTES: make a byte available.</span>
<a name="l00135"></a>00135 <span class="comment"> * Note we do *not* do INPUT_SYNC before calling fill_input_buffer,</span>
<a name="l00136"></a>00136 <span class="comment"> * but we must reload the local copies after a successful fill.</span>
<a name="l00137"></a>00137 <span class="comment"> */</span>
<a name="l00138"></a><a class="code" href="jdmarker_8c.html#af8a96f9aeb7d05ccfea64e3212ce4624">00138</a> <span class="preprocessor">#define MAKE_BYTE_AVAIL(cinfo,action)  \</span>
<a name="l00139"></a>00139 <span class="preprocessor">        if (bytes_in_buffer == 0) {  \</span>
<a name="l00140"></a>00140 <span class="preprocessor">          if (! (*datasrc-&gt;fill_input_buffer) (cinfo))  \</span>
<a name="l00141"></a>00141 <span class="preprocessor">            { action; }  \</span>
<a name="l00142"></a>00142 <span class="preprocessor">          INPUT_RELOAD(cinfo);  \</span>
<a name="l00143"></a>00143 <span class="preprocessor">        }</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>
<a name="l00145"></a>00145 <span class="comment">/* Read a byte into variable V.</span>
<a name="l00146"></a>00146 <span class="comment"> * If must suspend, take the specified action (typically &quot;return FALSE&quot;).</span>
<a name="l00147"></a>00147 <span class="comment"> */</span>
<a name="l00148"></a><a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">00148</a> <span class="preprocessor">#define INPUT_BYTE(cinfo,V,action)  \</span>
<a name="l00149"></a>00149 <span class="preprocessor">        MAKESTMT( MAKE_BYTE_AVAIL(cinfo,action); \</span>
<a name="l00150"></a>00150 <span class="preprocessor">                  bytes_in_buffer--; \</span>
<a name="l00151"></a>00151 <span class="preprocessor">                  V = GETJOCTET(*next_input_byte++); )</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span>
<a name="l00153"></a>00153 <span class="comment">/* As above, but read two bytes interpreted as an unsigned 16-bit integer.</span>
<a name="l00154"></a>00154 <span class="comment"> * V should be declared unsigned int or perhaps INT32.</span>
<a name="l00155"></a>00155 <span class="comment"> */</span>
<a name="l00156"></a><a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">00156</a> <span class="preprocessor">#define INPUT_2BYTES(cinfo,V,action)  \</span>
<a name="l00157"></a>00157 <span class="preprocessor">        MAKESTMT( MAKE_BYTE_AVAIL(cinfo,action); \</span>
<a name="l00158"></a>00158 <span class="preprocessor">                  bytes_in_buffer--; \</span>
<a name="l00159"></a>00159 <span class="preprocessor">                  V = ((unsigned int) GETJOCTET(*next_input_byte++)) &lt;&lt; 8; \</span>
<a name="l00160"></a>00160 <span class="preprocessor">                  MAKE_BYTE_AVAIL(cinfo,action); \</span>
<a name="l00161"></a>00161 <span class="preprocessor">                  bytes_in_buffer--; \</span>
<a name="l00162"></a>00162 <span class="preprocessor">                  V += GETJOCTET(*next_input_byte++); )</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="comment">/*</span>
<a name="l00166"></a>00166 <span class="comment"> * Routines to process JPEG markers.</span>
<a name="l00167"></a>00167 <span class="comment"> *</span>
<a name="l00168"></a>00168 <span class="comment"> * Entry condition: JPEG marker itself has been read and its code saved</span>
<a name="l00169"></a>00169 <span class="comment"> *   in cinfo-&gt;unread_marker; input restart point is just after the marker.</span>
<a name="l00170"></a>00170 <span class="comment"> *</span>
<a name="l00171"></a>00171 <span class="comment"> * Exit: if return TRUE, have read and processed any parameters, and have</span>
<a name="l00172"></a>00172 <span class="comment"> *   updated the restart point to point after the parameters.</span>
<a name="l00173"></a>00173 <span class="comment"> *   If return FALSE, was forced to suspend before reaching end of</span>
<a name="l00174"></a>00174 <span class="comment"> *   marker parameters; restart point has not been moved.  Same routine</span>
<a name="l00175"></a>00175 <span class="comment"> *   will be called again after application supplies more input data.</span>
<a name="l00176"></a>00176 <span class="comment"> *</span>
<a name="l00177"></a>00177 <span class="comment"> * This approach to suspension assumes that all of a marker&#39;s parameters</span>
<a name="l00178"></a>00178 <span class="comment"> * can fit into a single input bufferload.  This should hold for &quot;normal&quot;</span>
<a name="l00179"></a>00179 <span class="comment"> * markers.  Some COM/APPn markers might have large parameter segments</span>
<a name="l00180"></a>00180 <span class="comment"> * that might not fit.  If we are simply dropping such a marker, we use</span>
<a name="l00181"></a>00181 <span class="comment"> * skip_input_data to get past it, and thereby put the problem on the</span>
<a name="l00182"></a>00182 <span class="comment"> * source manager&#39;s shoulders.  If we are saving the marker&#39;s contents</span>
<a name="l00183"></a>00183 <span class="comment"> * into memory, we use a slightly different convention: when forced to</span>
<a name="l00184"></a>00184 <span class="comment"> * suspend, the marker processor updates the restart point to the end of</span>
<a name="l00185"></a>00185 <span class="comment"> * what it&#39;s consumed (ie, the end of the buffer) before returning FALSE.</span>
<a name="l00186"></a>00186 <span class="comment"> * On resumption, cinfo-&gt;unread_marker still contains the marker code,</span>
<a name="l00187"></a>00187 <span class="comment"> * but the data source will point to the next chunk of marker data.</span>
<a name="l00188"></a>00188 <span class="comment"> * The marker processor must retain internal state to deal with this.</span>
<a name="l00189"></a>00189 <span class="comment"> *</span>
<a name="l00190"></a>00190 <span class="comment"> * Note that we don&#39;t bother to avoid duplicate trace messages if a</span>
<a name="l00191"></a>00191 <span class="comment"> * suspension occurs within marker parameters.  Other side effects</span>
<a name="l00192"></a>00192 <span class="comment"> * require more care.</span>
<a name="l00193"></a>00193 <span class="comment"> */</span>
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 <a class="code" href="jmorecfg_8h.html#a9abdf12131b53b658a268f508ae2ad16">LOCAL</a>(<span class="keywordtype">boolean</span>)
<a name="l00197"></a><a class="code" href="jdmarker_8c.html#afdd1d684e02317cbcd4034508275a0df">00197</a> <a class="code" href="jdmarker_8c.html#afdd1d684e02317cbcd4034508275a0df">get_soi</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l00198"></a>00198 <span class="comment">/* Process an SOI marker */</span>
<a name="l00199"></a>00199 {
<a name="l00200"></a>00200   <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;
<a name="l00201"></a>00201   
<a name="l00202"></a>00202   <a class="code" href="jerror_8h.html#a233f31300ee28ddfc0d5ce402e2c4780">TRACEMS</a>(cinfo, 1, JTRC_SOI);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204   <span class="keywordflow">if</span> (cinfo-&gt;marker-&gt;saw_SOI)
<a name="l00205"></a>00205     <a class="code" href="jerror_8h.html#a18e2d55c8c82e47bff002a7ef9a90f03">ERREXIT</a>(cinfo, JERR_SOI_DUPLICATE);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="comment">/* Reset all parameters that are defined to be reset by SOI */</span>
<a name="l00208"></a>00208 
<a name="l00209"></a>00209   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="jpeglib_8h.html#a4efb0fccc8d9db72ca18f32a26fad6ab">NUM_ARITH_TBLS</a>; i++) {
<a name="l00210"></a>00210     cinfo-&gt;arith_dc_L[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = 0;
<a name="l00211"></a>00211     cinfo-&gt;arith_dc_U[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = 1;
<a name="l00212"></a>00212     cinfo-&gt;arith_ac_K[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = 5;
<a name="l00213"></a>00213   }
<a name="l00214"></a>00214   cinfo-&gt;restart_interval = 0;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216   <span class="comment">/* Set initial assumptions for colorspace etc */</span>
<a name="l00217"></a>00217 
<a name="l00218"></a>00218   cinfo-&gt;jpeg_color_space = <a class="code" href="jpeglib_8h.html#a6ea40239360b06efe6377f125f1134f3a90154e80d8f678d56c5de1e5dd70b8a9">JCS_UNKNOWN</a>;
<a name="l00219"></a>00219   cinfo-&gt;CCIR601_sampling = <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">/* Assume non-CCIR sampling??? */</span>
<a name="l00220"></a>00220 
<a name="l00221"></a>00221   cinfo-&gt;saw_JFIF_marker = <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00222"></a>00222   cinfo-&gt;JFIF_major_version = 1; <span class="comment">/* set default JFIF APP0 values */</span>
<a name="l00223"></a>00223   cinfo-&gt;JFIF_minor_version = 1;
<a name="l00224"></a>00224   cinfo-&gt;density_unit = 0;
<a name="l00225"></a>00225   cinfo-&gt;X_density = 1;
<a name="l00226"></a>00226   cinfo-&gt;Y_density = 1;
<a name="l00227"></a>00227   cinfo-&gt;saw_Adobe_marker = <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00228"></a>00228   cinfo-&gt;Adobe_transform = 0;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230   cinfo-&gt;marker-&gt;saw_SOI = <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 <a class="code" href="jmorecfg_8h.html#a9abdf12131b53b658a268f508ae2ad16">LOCAL</a>(<span class="keywordtype">boolean</span>)
<a name="l00237"></a><a class="code" href="jdmarker_8c.html#ae65878b0abe7d30519773aacfeb998b7">00237</a> <a class="code" href="jdmarker_8c.html#ae65878b0abe7d30519773aacfeb998b7">get_sof</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo, <span class="keywordtype">boolean</span> is_prog, <span class="keywordtype">boolean</span> is_arith)
<a name="l00238"></a>00238 <span class="comment">/* Process a SOFn marker */</span>
<a name="l00239"></a>00239 {
<a name="l00240"></a>00240   <a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a> <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>;
<a name="l00241"></a>00241   <span class="keywordtype">int</span> c, ci;
<a name="l00242"></a>00242   <a class="code" href="structjpeg__component__info.html">jpeg_component_info</a> * <a class="code" href="jdct_8h.html#ab5cf547b55e97e8dd207d5dad37cb9fc">compptr</a>;
<a name="l00243"></a>00243   <a class="code" href="jdmarker_8c.html#a7228ca7f1eedc647929a660a84ab6f33">INPUT_VARS</a>(cinfo);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245   cinfo-&gt;progressive_mode = is_prog;
<a name="l00246"></a>00246   cinfo-&gt;arith_code = is_arith;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248   <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, length, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00249"></a>00249 
<a name="l00250"></a>00250   <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, cinfo-&gt;data_precision, <span class="keywordflow">return</span> FALSE);
<a name="l00251"></a>00251   <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, cinfo-&gt;image_height, <span class="keywordflow">return</span> FALSE);
<a name="l00252"></a>00252   <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, cinfo-&gt;image_width, <span class="keywordflow">return</span> FALSE);
<a name="l00253"></a>00253   <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, cinfo-&gt;num_components, <span class="keywordflow">return</span> FALSE);
<a name="l00254"></a>00254 
<a name="l00255"></a>00255   length -= 8;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257   <a class="code" href="jerror_8h.html#a84d1194b81df5a061b594fb457b71ed5">TRACEMS4</a>(cinfo, 1, JTRC_SOF, cinfo-&gt;unread_marker,
<a name="l00258"></a>00258            (<span class="keywordtype">int</span>) cinfo-&gt;image_width, (<span class="keywordtype">int</span>) cinfo-&gt;image_height,
<a name="l00259"></a>00259            cinfo-&gt;num_components);
<a name="l00260"></a>00260 
<a name="l00261"></a>00261   <span class="keywordflow">if</span> (cinfo-&gt;marker-&gt;saw_SOF)
<a name="l00262"></a>00262     <a class="code" href="jerror_8h.html#a18e2d55c8c82e47bff002a7ef9a90f03">ERREXIT</a>(cinfo, JERR_SOF_DUPLICATE);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264   <span class="comment">/* We don&#39;t support files in which the image height is initially specified */</span>
<a name="l00265"></a>00265   <span class="comment">/* as 0 and is later redefined by DNL.  As long as we have to check that,  */</span>
<a name="l00266"></a>00266   <span class="comment">/* might as well have a general sanity check. */</span>
<a name="l00267"></a>00267   <span class="keywordflow">if</span> (cinfo-&gt;image_height &lt;= 0 || cinfo-&gt;image_width &lt;= 0
<a name="l00268"></a>00268       || cinfo-&gt;num_components &lt;= 0)
<a name="l00269"></a>00269     <a class="code" href="jerror_8h.html#a18e2d55c8c82e47bff002a7ef9a90f03">ERREXIT</a>(cinfo, JERR_EMPTY_IMAGE);
<a name="l00270"></a>00270 
<a name="l00271"></a>00271   <span class="keywordflow">if</span> (length != (cinfo-&gt;num_components * 3))
<a name="l00272"></a>00272     <a class="code" href="jerror_8h.html#a18e2d55c8c82e47bff002a7ef9a90f03">ERREXIT</a>(cinfo, JERR_BAD_LENGTH);
<a name="l00273"></a>00273 
<a name="l00274"></a>00274   <span class="keywordflow">if</span> (cinfo-&gt;comp_info == <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) <span class="comment">/* do only once, even if suspend */</span>
<a name="l00275"></a>00275     cinfo-&gt;comp_info = (<a class="code" href="structjpeg__component__info.html">jpeg_component_info</a> *) (*cinfo-&gt;mem-&gt;alloc_small)
<a name="l00276"></a>00276                         ((<a class="code" href="jpeglib_8h.html#a1a177ab705cefea8f30ec31a48e62650">j_common_ptr</a>) cinfo, <a class="code" href="jpeglib_8h.html#ad57a4dbdaa8ea14b89a03ea2a7a46710">JPOOL_IMAGE</a>,
<a name="l00277"></a>00277                          cinfo-&gt;num_components * <a class="code" href="jinclude_8h.html#ab4e7a10b0e2cf79aa0978d3bbe1e1268">SIZEOF</a>(<a class="code" href="structjpeg__component__info.html">jpeg_component_info</a>));
<a name="l00278"></a>00278   
<a name="l00279"></a>00279   <span class="keywordflow">for</span> (ci = 0, compptr = cinfo-&gt;comp_info; ci &lt; cinfo-&gt;num_components;
<a name="l00280"></a>00280        ci++, compptr++) {
<a name="l00281"></a>00281     compptr-&gt;<a class="code" href="structjpeg__component__info.html#aa29b9e1c664a9b0b8a1c3069ad167817">component_index</a> = ci;
<a name="l00282"></a>00282     <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, compptr-&gt;<a class="code" href="structjpeg__component__info.html#a205782ff7ec47c58cb470f121247ea8d">component_id</a>, <span class="keywordflow">return</span> FALSE);
<a name="l00283"></a>00283     <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, c, <span class="keywordflow">return</span> FALSE);
<a name="l00284"></a>00284     compptr-&gt;<a class="code" href="structjpeg__component__info.html#a3a8e122fa2eee3c7bede586d371fe202">h_samp_factor</a> = (c &gt;&gt; 4) &amp; 15;
<a name="l00285"></a>00285     compptr-&gt;<a class="code" href="structjpeg__component__info.html#a83b263da2a749a8fe96be728889af0df">v_samp_factor</a> = (c     ) &amp; 15;
<a name="l00286"></a>00286     <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, compptr-&gt;<a class="code" href="structjpeg__component__info.html#a0a9d70b6a95d3ca58a34a7ea8bfefbf8">quant_tbl_no</a>, <span class="keywordflow">return</span> FALSE);
<a name="l00287"></a>00287 
<a name="l00288"></a>00288     <a class="code" href="jerror_8h.html#a84d1194b81df5a061b594fb457b71ed5">TRACEMS4</a>(cinfo, 1, JTRC_SOF_COMPONENT,
<a name="l00289"></a>00289              compptr-&gt;<a class="code" href="structjpeg__component__info.html#a205782ff7ec47c58cb470f121247ea8d">component_id</a>, compptr-&gt;<a class="code" href="structjpeg__component__info.html#a3a8e122fa2eee3c7bede586d371fe202">h_samp_factor</a>,
<a name="l00290"></a>00290              compptr-&gt;<a class="code" href="structjpeg__component__info.html#a83b263da2a749a8fe96be728889af0df">v_samp_factor</a>, compptr-&gt;<a class="code" href="structjpeg__component__info.html#a0a9d70b6a95d3ca58a34a7ea8bfefbf8">quant_tbl_no</a>);
<a name="l00291"></a>00291   }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293   cinfo-&gt;marker-&gt;saw_SOF = <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295   <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);
<a name="l00296"></a>00296   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <a class="code" href="jmorecfg_8h.html#a9abdf12131b53b658a268f508ae2ad16">LOCAL</a>(<span class="keywordtype">boolean</span>)
<a name="l00301"></a><a class="code" href="jdmarker_8c.html#aec23916e5e625b771e766d41f457bb18">00301</a> <a class="code" href="jdmarker_8c.html#aec23916e5e625b771e766d41f457bb18">get_sos</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l00302"></a>00302 <span class="comment">/* Process a SOS marker */</span>
<a name="l00303"></a>00303 {
<a name="l00304"></a>00304   <a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a> <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>;
<a name="l00305"></a>00305   <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, ci, n, c, cc;
<a name="l00306"></a>00306   <a class="code" href="structjpeg__component__info.html">jpeg_component_info</a> * <a class="code" href="jdct_8h.html#ab5cf547b55e97e8dd207d5dad37cb9fc">compptr</a>;
<a name="l00307"></a>00307   <a class="code" href="jdmarker_8c.html#a7228ca7f1eedc647929a660a84ab6f33">INPUT_VARS</a>(cinfo);
<a name="l00308"></a>00308 
<a name="l00309"></a>00309   <span class="keywordflow">if</span> (! cinfo-&gt;marker-&gt;saw_SOF)
<a name="l00310"></a>00310     <a class="code" href="jerror_8h.html#a18e2d55c8c82e47bff002a7ef9a90f03">ERREXIT</a>(cinfo, JERR_SOS_NO_SOF);
<a name="l00311"></a>00311 
<a name="l00312"></a>00312   <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, length, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314   <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, n, <span class="keywordflow">return</span> FALSE); <span class="comment">/* Number of components */</span>
<a name="l00315"></a>00315 
<a name="l00316"></a>00316   <a class="code" href="jerror_8h.html#a21a4007edf703b49ac9cdbf92076572b">TRACEMS1</a>(cinfo, 1, JTRC_SOS, n);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318   <span class="keywordflow">if</span> (length != (n * 2 + 6) || n &lt; 1 || n &gt; <a class="code" href="jpeglib_8h.html#adc7013da016c19051dc623fb3d8b35b4">MAX_COMPS_IN_SCAN</a>)
<a name="l00319"></a>00319     <a class="code" href="jerror_8h.html#a18e2d55c8c82e47bff002a7ef9a90f03">ERREXIT</a>(cinfo, JERR_BAD_LENGTH);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321   cinfo-&gt;comps_in_scan = n;
<a name="l00322"></a>00322 
<a name="l00323"></a>00323   <span class="comment">/* Collect the component-spec parameters */</span>
<a name="l00324"></a>00324 
<a name="l00325"></a>00325   <span class="keywordflow">for</span> (i = 0; i &lt; n; i++) {
<a name="l00326"></a>00326     <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, cc, <span class="keywordflow">return</span> FALSE);
<a name="l00327"></a>00327     <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, c, <span class="keywordflow">return</span> FALSE);
<a name="l00328"></a>00328     
<a name="l00329"></a>00329     <span class="keywordflow">for</span> (ci = 0, compptr = cinfo-&gt;comp_info; ci &lt; cinfo-&gt;num_components;
<a name="l00330"></a>00330          ci++, compptr++) {
<a name="l00331"></a>00331       <span class="keywordflow">if</span> (cc == compptr-&gt;<a class="code" href="structjpeg__component__info.html#a205782ff7ec47c58cb470f121247ea8d">component_id</a>)
<a name="l00332"></a>00332         <span class="keywordflow">goto</span> id_found;
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335     <a class="code" href="jerror_8h.html#ae28b1b285273b3410284a8e86a7f9499">ERREXIT1</a>(cinfo, JERR_BAD_COMPONENT_ID, cc);
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   id_found:
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     cinfo-&gt;cur_comp_info[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="jdct_8h.html#ab5cf547b55e97e8dd207d5dad37cb9fc">compptr</a>;
<a name="l00340"></a>00340     compptr-&gt;<a class="code" href="structjpeg__component__info.html#a304fa583caa0601abc7077a218988854">dc_tbl_no</a> = (c &gt;&gt; 4) &amp; 15;
<a name="l00341"></a>00341     compptr-&gt;<a class="code" href="structjpeg__component__info.html#adfea67573a39b232c3d82ac808539a83">ac_tbl_no</a> = (c     ) &amp; 15;
<a name="l00342"></a>00342     
<a name="l00343"></a>00343     <a class="code" href="jerror_8h.html#af6dfee8157be4cfa6ec09f3088246213">TRACEMS3</a>(cinfo, 1, JTRC_SOS_COMPONENT, cc,
<a name="l00344"></a>00344              compptr-&gt;<a class="code" href="structjpeg__component__info.html#a304fa583caa0601abc7077a218988854">dc_tbl_no</a>, compptr-&gt;<a class="code" href="structjpeg__component__info.html#adfea67573a39b232c3d82ac808539a83">ac_tbl_no</a>);
<a name="l00345"></a>00345   }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347   <span class="comment">/* Collect the additional scan parameters Ss, Se, Ah/Al. */</span>
<a name="l00348"></a>00348   <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, c, <span class="keywordflow">return</span> FALSE);
<a name="l00349"></a>00349   cinfo-&gt;Ss = c;
<a name="l00350"></a>00350   <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, c, <span class="keywordflow">return</span> FALSE);
<a name="l00351"></a>00351   cinfo-&gt;Se = c;
<a name="l00352"></a>00352   <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, c, <span class="keywordflow">return</span> FALSE);
<a name="l00353"></a>00353   cinfo-&gt;Ah = (c &gt;&gt; 4) &amp; 15;
<a name="l00354"></a>00354   cinfo-&gt;Al = (c     ) &amp; 15;
<a name="l00355"></a>00355 
<a name="l00356"></a>00356   <a class="code" href="jerror_8h.html#a84d1194b81df5a061b594fb457b71ed5">TRACEMS4</a>(cinfo, 1, JTRC_SOS_PARAMS, cinfo-&gt;Ss, cinfo-&gt;Se,
<a name="l00357"></a>00357            cinfo-&gt;Ah, cinfo-&gt;Al);
<a name="l00358"></a>00358 
<a name="l00359"></a>00359   <span class="comment">/* Prepare to scan data &amp; restart markers */</span>
<a name="l00360"></a>00360   cinfo-&gt;marker-&gt;next_restart_num = 0;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362   <span class="comment">/* Count another SOS marker */</span>
<a name="l00363"></a>00363   cinfo-&gt;input_scan_number++;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);
<a name="l00366"></a>00366   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00367"></a>00367 }
<a name="l00368"></a>00368 
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 <span class="preprocessor">#ifdef D_ARITH_CODING_SUPPORTED</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span>
<a name="l00372"></a>00372 <a class="code" href="jmorecfg_8h.html#a9abdf12131b53b658a268f508ae2ad16">LOCAL</a>(<span class="keywordtype">boolean</span>)
<a name="l00373"></a>00373 <a class="code" href="jdmarker_8c.html#af90794434db6d4c233a10b95e5141b4e">get_dac</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l00374"></a>00374 <span class="comment">/* Process a DAC marker */</span>
<a name="l00375"></a>00375 {
<a name="l00376"></a>00376   <a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a> <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>;
<a name="l00377"></a>00377   <span class="keywordtype">int</span> index, <a class="code" href="jpeglib_8h.html#aa0ccb5ee6d882ee3605ff47745c6467b">val</a>;
<a name="l00378"></a>00378   <a class="code" href="jdmarker_8c.html#a7228ca7f1eedc647929a660a84ab6f33">INPUT_VARS</a>(cinfo);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380   <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, length, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00381"></a>00381   length -= 2;
<a name="l00382"></a>00382   
<a name="l00383"></a>00383   <span class="keywordflow">while</span> (length &gt; 0) {
<a name="l00384"></a>00384     <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, index, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00385"></a>00385     <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, val, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387     length -= 2;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389     <a class="code" href="jerror_8h.html#a648bfbe13dbcedae2df9e65f16680780">TRACEMS2</a>(cinfo, 1, JTRC_DAC, index, val);
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     <span class="keywordflow">if</span> (index &lt; 0 || index &gt;= (2*<a class="code" href="jpeglib_8h.html#a4efb0fccc8d9db72ca18f32a26fad6ab">NUM_ARITH_TBLS</a>))
<a name="l00392"></a>00392       <a class="code" href="jerror_8h.html#ae28b1b285273b3410284a8e86a7f9499">ERREXIT1</a>(cinfo, JERR_DAC_INDEX, index);
<a name="l00393"></a>00393 
<a name="l00394"></a>00394     <span class="keywordflow">if</span> (index &gt;= <a class="code" href="jpeglib_8h.html#a4efb0fccc8d9db72ca18f32a26fad6ab">NUM_ARITH_TBLS</a>) { <span class="comment">/* define AC table */</span>
<a name="l00395"></a>00395       cinfo-&gt;arith_ac_K[index-<a class="code" href="jpeglib_8h.html#a4efb0fccc8d9db72ca18f32a26fad6ab">NUM_ARITH_TBLS</a>] = (<a class="code" href="jmorecfg_8h.html#ab27e9918b538ce9d8ca692479b375b6a">UINT8</a>) val;
<a name="l00396"></a>00396     } <span class="keywordflow">else</span> {                    <span class="comment">/* define DC table */</span>
<a name="l00397"></a>00397       cinfo-&gt;arith_dc_L[index] = (<a class="code" href="jmorecfg_8h.html#ab27e9918b538ce9d8ca692479b375b6a">UINT8</a>) (val &amp; 0x0F);
<a name="l00398"></a>00398       cinfo-&gt;arith_dc_U[index] = (<a class="code" href="jmorecfg_8h.html#ab27e9918b538ce9d8ca692479b375b6a">UINT8</a>) (val &gt;&gt; 4);
<a name="l00399"></a>00399       <span class="keywordflow">if</span> (cinfo-&gt;arith_dc_L[index] &gt; cinfo-&gt;arith_dc_U[index])
<a name="l00400"></a>00400         <a class="code" href="jerror_8h.html#ae28b1b285273b3410284a8e86a7f9499">ERREXIT1</a>(cinfo, JERR_DAC_VALUE, val);
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402   }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404   <span class="keywordflow">if</span> (length != 0)
<a name="l00405"></a>00405     <a class="code" href="jerror_8h.html#a18e2d55c8c82e47bff002a7ef9a90f03">ERREXIT</a>(cinfo, JERR_BAD_LENGTH);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407   <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);
<a name="l00408"></a>00408   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="preprocessor">#else </span><span class="comment">/* ! D_ARITH_CODING_SUPPORTED */</span>
<a name="l00412"></a>00412 
<a name="l00413"></a><a class="code" href="jdmarker_8c.html#af90794434db6d4c233a10b95e5141b4e">00413</a> <span class="preprocessor">#define get_dac(cinfo)  skip_variable(cinfo)</span>
<a name="l00414"></a>00414 <span class="preprocessor"></span>
<a name="l00415"></a>00415 <span class="preprocessor">#endif </span><span class="comment">/* D_ARITH_CODING_SUPPORTED */</span>
<a name="l00416"></a>00416 
<a name="l00417"></a>00417 
<a name="l00418"></a>00418 <a class="code" href="jmorecfg_8h.html#a9abdf12131b53b658a268f508ae2ad16">LOCAL</a>(<span class="keywordtype">boolean</span>)
<a name="l00419"></a><a class="code" href="jdmarker_8c.html#ad09ef619b094cb03fb9c10df65c6ccd2">00419</a> <a class="code" href="jdmarker_8c.html#ad09ef619b094cb03fb9c10df65c6ccd2">get_dht</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l00420"></a>00420 <span class="comment">/* Process a DHT marker */</span>
<a name="l00421"></a>00421 {
<a name="l00422"></a>00422   <a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a> <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>;
<a name="l00423"></a>00423   <a class="code" href="jmorecfg_8h.html#ab27e9918b538ce9d8ca692479b375b6a">UINT8</a> bits[17];
<a name="l00424"></a>00424   <a class="code" href="jmorecfg_8h.html#ab27e9918b538ce9d8ca692479b375b6a">UINT8</a> huffval[256];
<a name="l00425"></a>00425   <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, index, count;
<a name="l00426"></a>00426   <a class="code" href="structJHUFF__TBL.html">JHUFF_TBL</a> **htblptr;
<a name="l00427"></a>00427   <a class="code" href="jdmarker_8c.html#a7228ca7f1eedc647929a660a84ab6f33">INPUT_VARS</a>(cinfo);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429   <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, length, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00430"></a>00430   length -= 2;
<a name="l00431"></a>00431   
<a name="l00432"></a>00432   <span class="keywordflow">while</span> (length &gt; 16) {
<a name="l00433"></a>00433     <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, index, <span class="keywordflow">return</span> FALSE);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <a class="code" href="jerror_8h.html#a21a4007edf703b49ac9cdbf92076572b">TRACEMS1</a>(cinfo, 1, JTRC_DHT, index);
<a name="l00436"></a>00436       
<a name="l00437"></a>00437     bits[0] = 0;
<a name="l00438"></a>00438     count = 0;
<a name="l00439"></a>00439     <span class="keywordflow">for</span> (i = 1; i &lt;= 16; i++) {
<a name="l00440"></a>00440       <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, bits[i], <span class="keywordflow">return</span> FALSE);
<a name="l00441"></a>00441       count += bits[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];
<a name="l00442"></a>00442     }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444     length -= 1 + 16;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446     <a class="code" href="jerror_8h.html#a004be6edef0f895080d6c17e456154c3">TRACEMS8</a>(cinfo, 2, JTRC_HUFFBITS,
<a name="l00447"></a>00447              bits[1], bits[2], bits[3], bits[4],
<a name="l00448"></a>00448              bits[5], bits[6], bits[7], bits[8]);
<a name="l00449"></a>00449     <a class="code" href="jerror_8h.html#a004be6edef0f895080d6c17e456154c3">TRACEMS8</a>(cinfo, 2, JTRC_HUFFBITS,
<a name="l00450"></a>00450              bits[9], bits[10], bits[11], bits[12],
<a name="l00451"></a>00451              bits[13], bits[14], bits[15], bits[16]);
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <span class="comment">/* Here we just do minimal validation of the counts to avoid walking</span>
<a name="l00454"></a>00454 <span class="comment">     * off the end of our table space.  jdhuff.c will check more carefully.</span>
<a name="l00455"></a>00455 <span class="comment">     */</span>
<a name="l00456"></a>00456     <span class="keywordflow">if</span> (count &gt; 256 || ((<a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a>) count) &gt; length)
<a name="l00457"></a>00457       <a class="code" href="jerror_8h.html#a18e2d55c8c82e47bff002a7ef9a90f03">ERREXIT</a>(cinfo, JERR_BAD_HUFF_TABLE);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)
<a name="l00460"></a>00460       <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, huffval[i], <span class="keywordflow">return</span> FALSE);
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     length -= count;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464     <span class="keywordflow">if</span> (index &amp; 0x10) {         <span class="comment">/* AC table definition */</span>
<a name="l00465"></a>00465       index -= 0x10;
<a name="l00466"></a>00466       htblptr = &amp;cinfo-&gt;ac_huff_tbl_ptrs[index];
<a name="l00467"></a>00467     } <span class="keywordflow">else</span> {                    <span class="comment">/* DC table definition */</span>
<a name="l00468"></a>00468       htblptr = &amp;cinfo-&gt;dc_huff_tbl_ptrs[index];
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="keywordflow">if</span> (index &lt; 0 || index &gt;= <a class="code" href="jpeglib_8h.html#a6b12985705944e0623b671f29dc5722e">NUM_HUFF_TBLS</a>)
<a name="l00472"></a>00472       <a class="code" href="jerror_8h.html#ae28b1b285273b3410284a8e86a7f9499">ERREXIT1</a>(cinfo, JERR_DHT_INDEX, index);
<a name="l00473"></a>00473 
<a name="l00474"></a>00474     <span class="keywordflow">if</span> (*htblptr == <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00475"></a>00475       *htblptr = <a class="code" href="jcomapi_8c.html#af6d023a98d48599258237efa5cc82abf">jpeg_alloc_huff_table</a>((<a class="code" href="structjpeg__common__struct.html">j_common_ptr</a>) cinfo);
<a name="l00476"></a>00476   
<a name="l00477"></a>00477     <a class="code" href="jinclude_8h.html#a7667d1f5e2470cb2a98c26e1d61cf35a">MEMCOPY</a>((*htblptr)-&gt;bits, bits, <a class="code" href="jinclude_8h.html#ab4e7a10b0e2cf79aa0978d3bbe1e1268">SIZEOF</a>((*htblptr)-&gt;bits));
<a name="l00478"></a>00478     <a class="code" href="jinclude_8h.html#a7667d1f5e2470cb2a98c26e1d61cf35a">MEMCOPY</a>((*htblptr)-&gt;huffval, huffval, <a class="code" href="jinclude_8h.html#ab4e7a10b0e2cf79aa0978d3bbe1e1268">SIZEOF</a>((*htblptr)-&gt;huffval));
<a name="l00479"></a>00479   }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481   <span class="keywordflow">if</span> (length != 0)
<a name="l00482"></a>00482     <a class="code" href="jerror_8h.html#a18e2d55c8c82e47bff002a7ef9a90f03">ERREXIT</a>(cinfo, JERR_BAD_LENGTH);
<a name="l00483"></a>00483 
<a name="l00484"></a>00484   <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);
<a name="l00485"></a>00485   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00486"></a>00486 }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 
<a name="l00489"></a>00489 <a class="code" href="jmorecfg_8h.html#a9abdf12131b53b658a268f508ae2ad16">LOCAL</a>(<span class="keywordtype">boolean</span>)
<a name="l00490"></a><a class="code" href="jdmarker_8c.html#ae8cd99feb65fb3bf3e1aca7ea5aa1087">00490</a> <a class="code" href="jdmarker_8c.html#ae8cd99feb65fb3bf3e1aca7ea5aa1087">get_dqt</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l00491"></a>00491 <span class="comment">/* Process a DQT marker */</span>
<a name="l00492"></a>00492 {
<a name="l00493"></a>00493   <a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a> <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>;
<a name="l00494"></a>00494   <span class="keywordtype">int</span> n, <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, prec;
<a name="l00495"></a>00495   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tmp;
<a name="l00496"></a>00496   <a class="code" href="structJQUANT__TBL.html">JQUANT_TBL</a> *quant_ptr;
<a name="l00497"></a>00497   <a class="code" href="jdmarker_8c.html#a7228ca7f1eedc647929a660a84ab6f33">INPUT_VARS</a>(cinfo);
<a name="l00498"></a>00498 
<a name="l00499"></a>00499   <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, length, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00500"></a>00500   length -= 2;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   <span class="keywordflow">while</span> (length &gt; 0) {
<a name="l00503"></a>00503     <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, n, <span class="keywordflow">return</span> FALSE);
<a name="l00504"></a>00504     prec = n &gt;&gt; 4;
<a name="l00505"></a>00505     n &amp;= 0x0F;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507     <a class="code" href="jerror_8h.html#a648bfbe13dbcedae2df9e65f16680780">TRACEMS2</a>(cinfo, 1, JTRC_DQT, n, prec);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509     <span class="keywordflow">if</span> (n &gt;= <a class="code" href="jpeglib_8h.html#ab3254a23612ea48615001fffc0c9f691">NUM_QUANT_TBLS</a>)
<a name="l00510"></a>00510       <a class="code" href="jerror_8h.html#ae28b1b285273b3410284a8e86a7f9499">ERREXIT1</a>(cinfo, JERR_DQT_INDEX, n);
<a name="l00511"></a>00511       
<a name="l00512"></a>00512     <span class="keywordflow">if</span> (cinfo-&gt;quant_tbl_ptrs[n] == <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00513"></a>00513       cinfo-&gt;quant_tbl_ptrs[n] = <a class="code" href="jcomapi_8c.html#a35ec363fdb52d55181a8d786944b5cb4">jpeg_alloc_quant_table</a>((<a class="code" href="structjpeg__common__struct.html">j_common_ptr</a>) cinfo);
<a name="l00514"></a>00514     quant_ptr = cinfo-&gt;quant_tbl_ptrs[n];
<a name="l00515"></a>00515 
<a name="l00516"></a>00516     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="jpeglib_8h.html#af89dff4200396563157d4a1e59da3bdf">DCTSIZE2</a>; i++) {
<a name="l00517"></a>00517       <span class="keywordflow">if</span> (prec)
<a name="l00518"></a>00518         <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, tmp, <span class="keywordflow">return</span> FALSE);
<a name="l00519"></a>00519       <span class="keywordflow">else</span>
<a name="l00520"></a>00520         <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, tmp, <span class="keywordflow">return</span> FALSE);
<a name="l00521"></a>00521       <span class="comment">/* We convert the zigzag-order table to natural array order. */</span>
<a name="l00522"></a>00522       quant_ptr-&gt;<a class="code" href="structJQUANT__TBL.html#ab5b5150e73282a62ca7dc0f7e2fac944">quantval</a>[<a class="code" href="jpegint_8h.html#a5f4ff2462a5937bfd72aba8bc680ece5">jpeg_natural_order</a>[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]] = (<a class="code" href="jmorecfg_8h.html#a09f1a1fb2293e33483cc8d44aefb1eb1">UINT16</a>) tmp;
<a name="l00523"></a>00523     }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525     <span class="keywordflow">if</span> (cinfo-&gt;err-&gt;trace_level &gt;= 2) {
<a name="l00526"></a>00526       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="jpeglib_8h.html#af89dff4200396563157d4a1e59da3bdf">DCTSIZE2</a>; i += 8) {
<a name="l00527"></a>00527         <a class="code" href="jerror_8h.html#a004be6edef0f895080d6c17e456154c3">TRACEMS8</a>(cinfo, 2, JTRC_QUANTVALS,
<a name="l00528"></a>00528                  quant_ptr-&gt;<a class="code" href="structJQUANT__TBL.html#ab5b5150e73282a62ca7dc0f7e2fac944">quantval</a>[i],   quant_ptr-&gt;<a class="code" href="structJQUANT__TBL.html#ab5b5150e73282a62ca7dc0f7e2fac944">quantval</a>[i+1],
<a name="l00529"></a>00529                  quant_ptr-&gt;<a class="code" href="structJQUANT__TBL.html#ab5b5150e73282a62ca7dc0f7e2fac944">quantval</a>[i+2], quant_ptr-&gt;<a class="code" href="structJQUANT__TBL.html#ab5b5150e73282a62ca7dc0f7e2fac944">quantval</a>[i+3],
<a name="l00530"></a>00530                  quant_ptr-&gt;<a class="code" href="structJQUANT__TBL.html#ab5b5150e73282a62ca7dc0f7e2fac944">quantval</a>[i+4], quant_ptr-&gt;<a class="code" href="structJQUANT__TBL.html#ab5b5150e73282a62ca7dc0f7e2fac944">quantval</a>[i+5],
<a name="l00531"></a>00531                  quant_ptr-&gt;<a class="code" href="structJQUANT__TBL.html#ab5b5150e73282a62ca7dc0f7e2fac944">quantval</a>[i+6], quant_ptr-&gt;<a class="code" href="structJQUANT__TBL.html#ab5b5150e73282a62ca7dc0f7e2fac944">quantval</a>[i+7]);
<a name="l00532"></a>00532       }
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     length -= DCTSIZE2+1;
<a name="l00536"></a>00536     <span class="keywordflow">if</span> (prec) length -= <a class="code" href="jpeglib_8h.html#af89dff4200396563157d4a1e59da3bdf">DCTSIZE2</a>;
<a name="l00537"></a>00537   }
<a name="l00538"></a>00538 
<a name="l00539"></a>00539   <span class="keywordflow">if</span> (length != 0)
<a name="l00540"></a>00540     <a class="code" href="jerror_8h.html#a18e2d55c8c82e47bff002a7ef9a90f03">ERREXIT</a>(cinfo, JERR_BAD_LENGTH);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542   <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);
<a name="l00543"></a>00543   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00544"></a>00544 }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <a class="code" href="jmorecfg_8h.html#a9abdf12131b53b658a268f508ae2ad16">LOCAL</a>(<span class="keywordtype">boolean</span>)
<a name="l00548"></a><a class="code" href="jdmarker_8c.html#aa9a14e7eb5b230749c084f655693a114">00548</a> <a class="code" href="jdmarker_8c.html#aa9a14e7eb5b230749c084f655693a114">get_dri</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l00549"></a>00549 <span class="comment">/* Process a DRI marker */</span>
<a name="l00550"></a>00550 {
<a name="l00551"></a>00551   <a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a> <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>;
<a name="l00552"></a>00552   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tmp;
<a name="l00553"></a>00553   <a class="code" href="jdmarker_8c.html#a7228ca7f1eedc647929a660a84ab6f33">INPUT_VARS</a>(cinfo);
<a name="l00554"></a>00554 
<a name="l00555"></a>00555   <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, length, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00556"></a>00556   
<a name="l00557"></a>00557   <span class="keywordflow">if</span> (length != 4)
<a name="l00558"></a>00558     <a class="code" href="jerror_8h.html#a18e2d55c8c82e47bff002a7ef9a90f03">ERREXIT</a>(cinfo, JERR_BAD_LENGTH);
<a name="l00559"></a>00559 
<a name="l00560"></a>00560   <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, tmp, <span class="keywordflow">return</span> FALSE);
<a name="l00561"></a>00561 
<a name="l00562"></a>00562   <a class="code" href="jerror_8h.html#a21a4007edf703b49ac9cdbf92076572b">TRACEMS1</a>(cinfo, 1, JTRC_DRI, tmp);
<a name="l00563"></a>00563 
<a name="l00564"></a>00564   cinfo-&gt;restart_interval = tmp;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566   <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);
<a name="l00567"></a>00567   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00568"></a>00568 }
<a name="l00569"></a>00569 
<a name="l00570"></a>00570 
<a name="l00571"></a>00571 <span class="comment">/*</span>
<a name="l00572"></a>00572 <span class="comment"> * Routines for processing APPn and COM markers.</span>
<a name="l00573"></a>00573 <span class="comment"> * These are either saved in memory or discarded, per application request.</span>
<a name="l00574"></a>00574 <span class="comment"> * APP0 and APP14 are specially checked to see if they are</span>
<a name="l00575"></a>00575 <span class="comment"> * JFIF and Adobe markers, respectively.</span>
<a name="l00576"></a>00576 <span class="comment"> */</span>
<a name="l00577"></a>00577 
<a name="l00578"></a><a class="code" href="jdmarker_8c.html#a057ff05e93a2de52ac7a09328201a9b4">00578</a> <span class="preprocessor">#define APP0_DATA_LEN   14      </span><span class="comment">/* Length of interesting data in APP0 */</span>
<a name="l00579"></a><a class="code" href="jdmarker_8c.html#ad1da2c3492da196965c8665710a82557">00579</a> <span class="preprocessor">#define APP14_DATA_LEN  12      </span><span class="comment">/* Length of interesting data in APP14 */</span>
<a name="l00580"></a><a class="code" href="jdmarker_8c.html#ad7fa496a90483fe179ef2466b056a63a">00580</a> <span class="preprocessor">#define APPN_DATA_LEN   14      </span><span class="comment">/* Must be the largest of the above!! */</span>
<a name="l00581"></a>00581 
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 <a class="code" href="jmorecfg_8h.html#a9abdf12131b53b658a268f508ae2ad16">LOCAL</a>(<span class="keywordtype">void</span>)
<a name="l00584"></a><a class="code" href="jdmarker_8c.html#a95585da4af8c67557d1b243176a1cc2f">00584</a> <a class="code" href="jdmarker_8c.html#a95585da4af8c67557d1b243176a1cc2f">examine_app0</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo, <a class="code" href="jmorecfg_8h.html#a23e8f5ed4cc9f9741793019217c74fdd">JOCTET</a> <a class="code" href="jmorecfg_8h.html#aef060b3456fdcc093a7210a762d5f2ed">FAR</a> * <a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a>,
<a name="l00585"></a>00585               <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="jpeglib_8h.html#a37893c863bbe3ef78feca71570de3017">datalen</a>, <a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a> remaining)
<a name="l00586"></a>00586 <span class="comment">/* Examine first few bytes from an APP0.</span>
<a name="l00587"></a>00587 <span class="comment"> * Take appropriate action if it is a JFIF marker.</span>
<a name="l00588"></a>00588 <span class="comment"> * datalen is # of bytes at data[], remaining is length of rest of marker data.</span>
<a name="l00589"></a>00589 <span class="comment"> */</span>
<a name="l00590"></a>00590 {
<a name="l00591"></a>00591   <a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a> totallen = (<a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a>) datalen + remaining;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593   <span class="keywordflow">if</span> (datalen &gt;= <a class="code" href="jdmarker_8c.html#a057ff05e93a2de52ac7a09328201a9b4">APP0_DATA_LEN</a> &amp;&amp;
<a name="l00594"></a>00594       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[0]) == 0x4A &amp;&amp;
<a name="l00595"></a>00595       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[1]) == 0x46 &amp;&amp;
<a name="l00596"></a>00596       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[2]) == 0x49 &amp;&amp;
<a name="l00597"></a>00597       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[3]) == 0x46 &amp;&amp;
<a name="l00598"></a>00598       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[4]) == 0) {
<a name="l00599"></a>00599     <span class="comment">/* Found JFIF APP0 marker: save info */</span>
<a name="l00600"></a>00600     cinfo-&gt;saw_JFIF_marker = <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00601"></a>00601     cinfo-&gt;JFIF_major_version = <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[5]);
<a name="l00602"></a>00602     cinfo-&gt;JFIF_minor_version = <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[6]);
<a name="l00603"></a>00603     cinfo-&gt;density_unit = <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[7]);
<a name="l00604"></a>00604     cinfo-&gt;X_density = (<a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[8]) &lt;&lt; 8) + <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[9]);
<a name="l00605"></a>00605     cinfo-&gt;Y_density = (<a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[10]) &lt;&lt; 8) + <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[11]);
<a name="l00606"></a>00606     <span class="comment">/* Check version.</span>
<a name="l00607"></a>00607 <span class="comment">     * Major version must be 1, anything else signals an incompatible change.</span>
<a name="l00608"></a>00608 <span class="comment">     * (We used to treat this as an error, but now it&#39;s a nonfatal warning,</span>
<a name="l00609"></a>00609 <span class="comment">     * because some bozo at Hijaak couldn&#39;t read the spec.)</span>
<a name="l00610"></a>00610 <span class="comment">     * Minor version should be 0..2, but process anyway if newer.</span>
<a name="l00611"></a>00611 <span class="comment">     */</span>
<a name="l00612"></a>00612     <span class="keywordflow">if</span> (cinfo-&gt;JFIF_major_version != 1)
<a name="l00613"></a>00613       <a class="code" href="jerror_8h.html#a0afd40f657d38b1c4281979769ab23ed">WARNMS2</a>(cinfo, JWRN_JFIF_MAJOR,
<a name="l00614"></a>00614               cinfo-&gt;JFIF_major_version, cinfo-&gt;JFIF_minor_version);
<a name="l00615"></a>00615     <span class="comment">/* Generate trace messages */</span>
<a name="l00616"></a>00616     <a class="code" href="jerror_8h.html#a452c05e2ac78b5817bbf3830d9130875">TRACEMS5</a>(cinfo, 1, JTRC_JFIF,
<a name="l00617"></a>00617              cinfo-&gt;JFIF_major_version, cinfo-&gt;JFIF_minor_version,
<a name="l00618"></a>00618              cinfo-&gt;X_density, cinfo-&gt;Y_density, cinfo-&gt;density_unit);
<a name="l00619"></a>00619     <span class="comment">/* Validate thumbnail dimensions and issue appropriate messages */</span>
<a name="l00620"></a>00620     <span class="keywordflow">if</span> (<a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[12]) | <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[13]))
<a name="l00621"></a>00621       <a class="code" href="jerror_8h.html#a648bfbe13dbcedae2df9e65f16680780">TRACEMS2</a>(cinfo, 1, JTRC_JFIF_THUMBNAIL,
<a name="l00622"></a>00622                <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[12]), <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[13]));
<a name="l00623"></a>00623     totallen -= <a class="code" href="jdmarker_8c.html#a057ff05e93a2de52ac7a09328201a9b4">APP0_DATA_LEN</a>;
<a name="l00624"></a>00624     <span class="keywordflow">if</span> (totallen !=
<a name="l00625"></a>00625         ((<a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a>)<a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[12]) * (<a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a>)<a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[13]) * (<a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a>) 3))
<a name="l00626"></a>00626       <a class="code" href="jerror_8h.html#a21a4007edf703b49ac9cdbf92076572b">TRACEMS1</a>(cinfo, 1, JTRC_JFIF_BADTHUMBNAILSIZE, (<span class="keywordtype">int</span>) totallen);
<a name="l00627"></a>00627   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (datalen &gt;= 6 &amp;&amp;
<a name="l00628"></a>00628       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[0]) == 0x4A &amp;&amp;
<a name="l00629"></a>00629       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[1]) == 0x46 &amp;&amp;
<a name="l00630"></a>00630       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[2]) == 0x58 &amp;&amp;
<a name="l00631"></a>00631       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[3]) == 0x58 &amp;&amp;
<a name="l00632"></a>00632       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[4]) == 0) {
<a name="l00633"></a>00633     <span class="comment">/* Found JFIF &quot;JFXX&quot; extension APP0 marker */</span>
<a name="l00634"></a>00634     <span class="comment">/* The library doesn&#39;t actually do anything with these,</span>
<a name="l00635"></a>00635 <span class="comment">     * but we try to produce a helpful trace message.</span>
<a name="l00636"></a>00636 <span class="comment">     */</span>
<a name="l00637"></a>00637     <span class="keywordflow">switch</span> (<a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[5])) {
<a name="l00638"></a>00638     <span class="keywordflow">case</span> 0x10:
<a name="l00639"></a>00639       <a class="code" href="jerror_8h.html#a21a4007edf703b49ac9cdbf92076572b">TRACEMS1</a>(cinfo, 1, JTRC_THUMB_JPEG, (<span class="keywordtype">int</span>) totallen);
<a name="l00640"></a>00640       <span class="keywordflow">break</span>;
<a name="l00641"></a>00641     <span class="keywordflow">case</span> 0x11:
<a name="l00642"></a>00642       <a class="code" href="jerror_8h.html#a21a4007edf703b49ac9cdbf92076572b">TRACEMS1</a>(cinfo, 1, JTRC_THUMB_PALETTE, (<span class="keywordtype">int</span>) totallen);
<a name="l00643"></a>00643       <span class="keywordflow">break</span>;
<a name="l00644"></a>00644     <span class="keywordflow">case</span> 0x13:
<a name="l00645"></a>00645       <a class="code" href="jerror_8h.html#a21a4007edf703b49ac9cdbf92076572b">TRACEMS1</a>(cinfo, 1, JTRC_THUMB_RGB, (<span class="keywordtype">int</span>) totallen);
<a name="l00646"></a>00646       <span class="keywordflow">break</span>;
<a name="l00647"></a>00647     <span class="keywordflow">default</span>:
<a name="l00648"></a>00648       <a class="code" href="jerror_8h.html#a648bfbe13dbcedae2df9e65f16680780">TRACEMS2</a>(cinfo, 1, JTRC_JFIF_EXTENSION,
<a name="l00649"></a>00649                <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[5]), (<span class="keywordtype">int</span>) totallen);
<a name="l00650"></a>00650       <span class="keywordflow">break</span>;
<a name="l00651"></a>00651     }
<a name="l00652"></a>00652   } <span class="keywordflow">else</span> {
<a name="l00653"></a>00653     <span class="comment">/* Start of APP0 does not match &quot;JFIF&quot; or &quot;JFXX&quot;, or too short */</span>
<a name="l00654"></a>00654     <a class="code" href="jerror_8h.html#a21a4007edf703b49ac9cdbf92076572b">TRACEMS1</a>(cinfo, 1, JTRC_APP0, (<span class="keywordtype">int</span>) totallen);
<a name="l00655"></a>00655   }
<a name="l00656"></a>00656 }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658 
<a name="l00659"></a>00659 <a class="code" href="jmorecfg_8h.html#a9abdf12131b53b658a268f508ae2ad16">LOCAL</a>(<span class="keywordtype">void</span>)
<a name="l00660"></a><a class="code" href="jdmarker_8c.html#ad97698848844246d3361765025172931">00660</a> <a class="code" href="jdmarker_8c.html#ad97698848844246d3361765025172931">examine_app14</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo, <a class="code" href="jmorecfg_8h.html#a23e8f5ed4cc9f9741793019217c74fdd">JOCTET</a> <a class="code" href="jmorecfg_8h.html#aef060b3456fdcc093a7210a762d5f2ed">FAR</a> * <a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a>,
<a name="l00661"></a>00661                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="jpeglib_8h.html#a37893c863bbe3ef78feca71570de3017">datalen</a>, <a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a> remaining)
<a name="l00662"></a>00662 <span class="comment">/* Examine first few bytes from an APP14.</span>
<a name="l00663"></a>00663 <span class="comment"> * Take appropriate action if it is an Adobe marker.</span>
<a name="l00664"></a>00664 <span class="comment"> * datalen is # of bytes at data[], remaining is length of rest of marker data.</span>
<a name="l00665"></a>00665 <span class="comment"> */</span>
<a name="l00666"></a>00666 {
<a name="l00667"></a>00667   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="jpeglib_8h.html#aad880fc4455c253781e8968f2239d56f">version</a>, flags0, flags1, transform;
<a name="l00668"></a>00668 
<a name="l00669"></a>00669   <span class="keywordflow">if</span> (datalen &gt;= <a class="code" href="jdmarker_8c.html#ad1da2c3492da196965c8665710a82557">APP14_DATA_LEN</a> &amp;&amp;
<a name="l00670"></a>00670       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[0]) == 0x41 &amp;&amp;
<a name="l00671"></a>00671       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[1]) == 0x64 &amp;&amp;
<a name="l00672"></a>00672       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[2]) == 0x6F &amp;&amp;
<a name="l00673"></a>00673       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[3]) == 0x62 &amp;&amp;
<a name="l00674"></a>00674       <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[4]) == 0x65) {
<a name="l00675"></a>00675     <span class="comment">/* Found Adobe APP14 marker */</span>
<a name="l00676"></a>00676     version = (<a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[5]) &lt;&lt; 8) + <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[6]);
<a name="l00677"></a>00677     flags0 = (<a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[7]) &lt;&lt; 8) + <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[8]);
<a name="l00678"></a>00678     flags1 = (<a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[9]) &lt;&lt; 8) + <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[10]);
<a name="l00679"></a>00679     transform = <a class="code" href="jmorecfg_8h.html#ac8c0d5e71e91d75fa14a8bf073f17cb3">GETJOCTET</a>(data[11]);
<a name="l00680"></a>00680     <a class="code" href="jerror_8h.html#a84d1194b81df5a061b594fb457b71ed5">TRACEMS4</a>(cinfo, 1, JTRC_ADOBE, version, flags0, flags1, transform);
<a name="l00681"></a>00681     cinfo-&gt;saw_Adobe_marker = <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00682"></a>00682     cinfo-&gt;Adobe_transform = (<a class="code" href="jmorecfg_8h.html#ab27e9918b538ce9d8ca692479b375b6a">UINT8</a>) transform;
<a name="l00683"></a>00683   } <span class="keywordflow">else</span> {
<a name="l00684"></a>00684     <span class="comment">/* Start of APP14 does not match &quot;Adobe&quot;, or too short */</span>
<a name="l00685"></a>00685     <a class="code" href="jerror_8h.html#a21a4007edf703b49ac9cdbf92076572b">TRACEMS1</a>(cinfo, 1, JTRC_APP14, (<span class="keywordtype">int</span>) (datalen + remaining));
<a name="l00686"></a>00686   }
<a name="l00687"></a>00687 }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689 
<a name="l00690"></a>00690 <a class="code" href="jmorecfg_8h.html#aae05a300dc5b2dd4305cde6cc63b6d6a">METHODDEF</a>(<span class="keywordtype">boolean</span>)
<a name="l00691"></a><a class="code" href="jdmarker_8c.html#ad82019ab15e06b65c6119bbbce254b8f">00691</a> <a class="code" href="jdmarker_8c.html#ad82019ab15e06b65c6119bbbce254b8f">get_interesting_appn</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l00692"></a>00692 <span class="comment">/* Process an APP0 or APP14 marker without saving it */</span>
<a name="l00693"></a>00693 {
<a name="l00694"></a>00694   <a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a> <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>;
<a name="l00695"></a>00695   <a class="code" href="jmorecfg_8h.html#a23e8f5ed4cc9f9741793019217c74fdd">JOCTET</a> <a class="code" href="jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a>[<a class="code" href="jdmarker_8c.html#ad7fa496a90483fe179ef2466b056a63a">APPN_DATA_LEN</a>];
<a name="l00696"></a>00696   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, numtoread;
<a name="l00697"></a>00697   <a class="code" href="jdmarker_8c.html#a7228ca7f1eedc647929a660a84ab6f33">INPUT_VARS</a>(cinfo);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699   <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, length, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00700"></a>00700   length -= 2;
<a name="l00701"></a>00701 
<a name="l00702"></a>00702   <span class="comment">/* get the interesting part of the marker data */</span>
<a name="l00703"></a>00703   <span class="keywordflow">if</span> (length &gt;= <a class="code" href="jdmarker_8c.html#ad7fa496a90483fe179ef2466b056a63a">APPN_DATA_LEN</a>)
<a name="l00704"></a>00704     numtoread = <a class="code" href="jdmarker_8c.html#ad7fa496a90483fe179ef2466b056a63a">APPN_DATA_LEN</a>;
<a name="l00705"></a>00705   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (length &gt; 0)
<a name="l00706"></a>00706     numtoread = (<span class="keywordtype">unsigned</span> <a class="code" href="png_8h.html#ab832c174e145540d491b0830fc05dbb1">int</a>) length;
<a name="l00707"></a>00707   <span class="keywordflow">else</span>
<a name="l00708"></a>00708     numtoread = 0;
<a name="l00709"></a>00709   <span class="keywordflow">for</span> (i = 0; i &lt; numtoread; i++)
<a name="l00710"></a>00710     <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, b[i], <span class="keywordflow">return</span> FALSE);
<a name="l00711"></a>00711   length -= numtoread;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713   <span class="comment">/* process it */</span>
<a name="l00714"></a>00714   <span class="keywordflow">switch</span> (cinfo-&gt;unread_marker) {
<a name="l00715"></a>00715   <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a>:
<a name="l00716"></a>00716     <a class="code" href="jdmarker_8c.html#a95585da4af8c67557d1b243176a1cc2f">examine_app0</a>(cinfo, (<a class="code" href="jmorecfg_8h.html#a23e8f5ed4cc9f9741793019217c74fdd">JOCTET</a> <a class="code" href="jmorecfg_8h.html#aef060b3456fdcc093a7210a762d5f2ed">FAR</a> *) b, numtoread, length);
<a name="l00717"></a>00717     <span class="keywordflow">break</span>;
<a name="l00718"></a>00718   <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5a37889b83b67a6e8d21e0091dfee430">M_APP14</a>:
<a name="l00719"></a>00719     <a class="code" href="jdmarker_8c.html#ad97698848844246d3361765025172931">examine_app14</a>(cinfo, (<a class="code" href="jmorecfg_8h.html#a23e8f5ed4cc9f9741793019217c74fdd">JOCTET</a> FAR *) b, numtoread, length);
<a name="l00720"></a>00720     <span class="keywordflow">break</span>;
<a name="l00721"></a>00721   <span class="keywordflow">default</span>:
<a name="l00722"></a>00722     <span class="comment">/* can&#39;t get here unless jpeg_save_markers chooses wrong processor */</span>
<a name="l00723"></a>00723     <a class="code" href="jerror_8h.html#ae28b1b285273b3410284a8e86a7f9499">ERREXIT1</a>(cinfo, JERR_UNKNOWN_MARKER, cinfo-&gt;unread_marker);
<a name="l00724"></a>00724     <span class="keywordflow">break</span>;
<a name="l00725"></a>00725   }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727   <span class="comment">/* skip any remaining data -- could be lots */</span>
<a name="l00728"></a>00728   <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);
<a name="l00729"></a>00729   <span class="keywordflow">if</span> (length &gt; 0)
<a name="l00730"></a>00730     (*cinfo-&gt;src-&gt;skip_input_data) (cinfo, (<span class="keywordtype">long</span>) <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>);
<a name="l00731"></a>00731 
<a name="l00732"></a>00732   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00733"></a>00733 }
<a name="l00734"></a>00734 
<a name="l00735"></a>00735 
<a name="l00736"></a>00736 <span class="preprocessor">#ifdef SAVE_MARKERS_SUPPORTED</span>
<a name="l00737"></a>00737 <span class="preprocessor"></span>
<a name="l00738"></a>00738 <a class="code" href="jmorecfg_8h.html#aae05a300dc5b2dd4305cde6cc63b6d6a">METHODDEF</a>(<span class="keywordtype">boolean</span>)
<a name="l00739"></a><a class="code" href="jdmarker_8c.html#acba4eaea087c7946c5d51b3f15eb72a2">00739</a> <a class="code" href="jdmarker_8c.html#acba4eaea087c7946c5d51b3f15eb72a2">save_marker</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l00740"></a>00740 <span class="comment">/* Save an APPn or COM marker into the marker list */</span>
<a name="l00741"></a>00741 {
<a name="l00742"></a>00742   <a class="code" href="structmy__marker__writer.html">my_marker_ptr</a> <a class="code" href="jpeglib_8h.html#a55fc502015142062735ebfd18c825354">marker</a> = (<a class="code" href="jcmarker_8c.html#a10592246118021c933dac745fe4344c5">my_marker_ptr</a>) cinfo-&gt;marker;
<a name="l00743"></a>00743   <a class="code" href="jpeglib_8h.html#a2efb5205b3e81589f2dc133f1a412bb0">jpeg_saved_marker_ptr</a> cur_marker = marker-&gt;cur_marker;
<a name="l00744"></a>00744   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bytes_read, data_length;
<a name="l00745"></a>00745   <a class="code" href="jmorecfg_8h.html#a23e8f5ed4cc9f9741793019217c74fdd">JOCTET</a> <a class="code" href="jmorecfg_8h.html#aef060b3456fdcc093a7210a762d5f2ed">FAR</a> * <a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a>;
<a name="l00746"></a>00746   <a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a> length = 0;
<a name="l00747"></a>00747   <a class="code" href="jdmarker_8c.html#a7228ca7f1eedc647929a660a84ab6f33">INPUT_VARS</a>(cinfo);
<a name="l00748"></a>00748 
<a name="l00749"></a>00749   <span class="keywordflow">if</span> (cur_marker == <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00750"></a>00750     <span class="comment">/* begin reading a marker */</span>
<a name="l00751"></a>00751     <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, length, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00752"></a>00752     length -= 2;
<a name="l00753"></a>00753     <span class="keywordflow">if</span> (length &gt;= 0) {          <span class="comment">/* watch out for bogus length word */</span>
<a name="l00754"></a>00754       <span class="comment">/* figure out how much we want to save */</span>
<a name="l00755"></a>00755       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> limit;
<a name="l00756"></a>00756       <span class="keywordflow">if</span> (cinfo-&gt;unread_marker == (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea09270895cfe821542b21666dc22034c8">M_COM</a>)
<a name="l00757"></a>00757         limit = marker-&gt;length_limit_COM;
<a name="l00758"></a>00758       <span class="keywordflow">else</span>
<a name="l00759"></a>00759         limit = marker-&gt;length_limit_APPn[cinfo-&gt;unread_marker - (<a class="code" href="png_8h.html#ab832c174e145540d491b0830fc05dbb1">int</a>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a>];
<a name="l00760"></a>00760       <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) length &lt; limit)
<a name="l00761"></a>00761         limit = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>;
<a name="l00762"></a>00762       <span class="comment">/* allocate and initialize the marker item */</span>
<a name="l00763"></a>00763       cur_marker = (<a class="code" href="jpeglib_8h.html#a2efb5205b3e81589f2dc133f1a412bb0">jpeg_saved_marker_ptr</a>)
<a name="l00764"></a>00764         (*cinfo-&gt;mem-&gt;alloc_large) ((<a class="code" href="jpeglib_8h.html#a1a177ab705cefea8f30ec31a48e62650">j_common_ptr</a>) cinfo, <a class="code" href="jpeglib_8h.html#ad57a4dbdaa8ea14b89a03ea2a7a46710">JPOOL_IMAGE</a>,
<a name="l00765"></a>00765                                     <a class="code" href="jinclude_8h.html#ab4e7a10b0e2cf79aa0978d3bbe1e1268">SIZEOF</a>(<span class="keyword">struct</span> <a class="code" href="structjpeg__marker__struct.html">jpeg_marker_struct</a>) + limit);
<a name="l00766"></a>00766       cur_marker-&gt;next = <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00767"></a>00767       cur_marker-&gt;marker = (<a class="code" href="jmorecfg_8h.html#ab27e9918b538ce9d8ca692479b375b6a">UINT8</a>) cinfo-&gt;unread_marker;
<a name="l00768"></a>00768       cur_marker-&gt;original_length = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>;
<a name="l00769"></a>00769       cur_marker-&gt;data_length = limit;
<a name="l00770"></a>00770       <span class="comment">/* data area is just beyond the jpeg_marker_struct */</span>
<a name="l00771"></a>00771       <a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a> = cur_marker-&gt;data = (<a class="code" href="jmorecfg_8h.html#a23e8f5ed4cc9f9741793019217c74fdd">JOCTET</a> <a class="code" href="jmorecfg_8h.html#aef060b3456fdcc093a7210a762d5f2ed">FAR</a> *) (cur_marker + 1);
<a name="l00772"></a>00772       marker-&gt;cur_marker = cur_marker;
<a name="l00773"></a>00773       marker-&gt;bytes_read = 0;
<a name="l00774"></a>00774       bytes_read = 0;
<a name="l00775"></a>00775       data_length = limit;
<a name="l00776"></a>00776     } <span class="keywordflow">else</span> {
<a name="l00777"></a>00777       <span class="comment">/* deal with bogus length word */</span>
<a name="l00778"></a>00778       bytes_read = data_length = 0;
<a name="l00779"></a>00779       <a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a> = <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00780"></a>00780     }
<a name="l00781"></a>00781   } <span class="keywordflow">else</span> {
<a name="l00782"></a>00782     <span class="comment">/* resume reading a marker */</span>
<a name="l00783"></a>00783     bytes_read = marker-&gt;bytes_read;
<a name="l00784"></a>00784     data_length = cur_marker-&gt;data_length;
<a name="l00785"></a>00785     <a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a> = cur_marker-&gt;data + bytes_read;
<a name="l00786"></a>00786   }
<a name="l00787"></a>00787 
<a name="l00788"></a>00788   <span class="keywordflow">while</span> (bytes_read &lt; data_length) {
<a name="l00789"></a>00789     <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);          <span class="comment">/* move the restart point to here */</span>
<a name="l00790"></a>00790     marker-&gt;bytes_read = bytes_read;
<a name="l00791"></a>00791     <span class="comment">/* If there&#39;s not at least one byte in buffer, suspend */</span>
<a name="l00792"></a>00792     <a class="code" href="jdmarker_8c.html#af8a96f9aeb7d05ccfea64e3212ce4624">MAKE_BYTE_AVAIL</a>(cinfo, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00793"></a>00793     <span class="comment">/* Copy bytes with reasonable rapidity */</span>
<a name="l00794"></a>00794     <span class="keywordflow">while</span> (bytes_read &lt; data_length &amp;&amp; bytes_in_buffer &gt; 0) {
<a name="l00795"></a>00795       *<a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a>++ = *next_input_byte++;
<a name="l00796"></a>00796       bytes_in_buffer--;
<a name="l00797"></a>00797       bytes_read++;
<a name="l00798"></a>00798     }
<a name="l00799"></a>00799   }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801   <span class="comment">/* Done reading what we want to read */</span>
<a name="l00802"></a>00802   <span class="keywordflow">if</span> (cur_marker != <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {     <span class="comment">/* will be NULL if bogus length word */</span>
<a name="l00803"></a>00803     <span class="comment">/* Add new marker to end of list */</span>
<a name="l00804"></a>00804     <span class="keywordflow">if</span> (cinfo-&gt;marker_list == <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00805"></a>00805       cinfo-&gt;marker_list = cur_marker;
<a name="l00806"></a>00806     } <span class="keywordflow">else</span> {
<a name="l00807"></a>00807       <a class="code" href="jpeglib_8h.html#a2efb5205b3e81589f2dc133f1a412bb0">jpeg_saved_marker_ptr</a> prev = cinfo-&gt;marker_list;
<a name="l00808"></a>00808       <span class="keywordflow">while</span> (prev-&gt;next != <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00809"></a>00809         prev = prev-&gt;next;
<a name="l00810"></a>00810       prev-&gt;next = cur_marker;
<a name="l00811"></a>00811     }
<a name="l00812"></a>00812     <span class="comment">/* Reset pointer &amp; calc remaining data length */</span>
<a name="l00813"></a>00813     <a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a> = cur_marker-&gt;data;
<a name="l00814"></a>00814     length = cur_marker-&gt;original_length - data_length;
<a name="l00815"></a>00815   }
<a name="l00816"></a>00816   <span class="comment">/* Reset to initial state for next marker */</span>
<a name="l00817"></a>00817   marker-&gt;cur_marker = <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00818"></a>00818 
<a name="l00819"></a>00819   <span class="comment">/* Process the marker if interesting; else just make a generic trace msg */</span>
<a name="l00820"></a>00820   <span class="keywordflow">switch</span> (cinfo-&gt;unread_marker) {
<a name="l00821"></a>00821   <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a>:
<a name="l00822"></a>00822     <a class="code" href="jdmarker_8c.html#a95585da4af8c67557d1b243176a1cc2f">examine_app0</a>(cinfo, <a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a>, data_length, length);
<a name="l00823"></a>00823     <span class="keywordflow">break</span>;
<a name="l00824"></a>00824   <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5a37889b83b67a6e8d21e0091dfee430">M_APP14</a>:
<a name="l00825"></a>00825     <a class="code" href="jdmarker_8c.html#ad97698848844246d3361765025172931">examine_app14</a>(cinfo, <a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a>, data_length, length);
<a name="l00826"></a>00826     <span class="keywordflow">break</span>;
<a name="l00827"></a>00827   <span class="keywordflow">default</span>:
<a name="l00828"></a>00828     <a class="code" href="jerror_8h.html#a648bfbe13dbcedae2df9e65f16680780">TRACEMS2</a>(cinfo, 1, JTRC_MISC_MARKER, cinfo-&gt;unread_marker,
<a name="l00829"></a>00829              (<span class="keywordtype">int</span>) (data_length + length));
<a name="l00830"></a>00830     <span class="keywordflow">break</span>;
<a name="l00831"></a>00831   }
<a name="l00832"></a>00832 
<a name="l00833"></a>00833   <span class="comment">/* skip any remaining data -- could be lots */</span>
<a name="l00834"></a>00834   <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);            <span class="comment">/* do before skip_input_data */</span>
<a name="l00835"></a>00835   <span class="keywordflow">if</span> (length &gt; 0)
<a name="l00836"></a>00836     (*cinfo-&gt;src-&gt;skip_input_data) (cinfo, (<span class="keywordtype">long</span>) <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>);
<a name="l00837"></a>00837 
<a name="l00838"></a>00838   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00839"></a>00839 }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841 <span class="preprocessor">#endif </span><span class="comment">/* SAVE_MARKERS_SUPPORTED */</span>
<a name="l00842"></a>00842 
<a name="l00843"></a>00843 
<a name="l00844"></a>00844 <a class="code" href="jmorecfg_8h.html#aae05a300dc5b2dd4305cde6cc63b6d6a">METHODDEF</a>(<span class="keywordtype">boolean</span>)
<a name="l00845"></a><a class="code" href="jdmarker_8c.html#a3e27a348c35d6008c19ace382ec756d0">00845</a> <a class="code" href="jdmarker_8c.html#a3e27a348c35d6008c19ace382ec756d0">skip_variable</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l00846"></a>00846 <span class="comment">/* Skip over an unknown or uninteresting variable-length marker */</span>
<a name="l00847"></a>00847 {
<a name="l00848"></a>00848   <a class="code" href="jmorecfg_8h.html#a63021d67d54286c2163bcdb43a6f2569">INT32</a> <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>;
<a name="l00849"></a>00849   <a class="code" href="jdmarker_8c.html#a7228ca7f1eedc647929a660a84ab6f33">INPUT_VARS</a>(cinfo);
<a name="l00850"></a>00850 
<a name="l00851"></a>00851   <a class="code" href="jdmarker_8c.html#a6f19e95415e04b3d449a551482dc91f4">INPUT_2BYTES</a>(cinfo, length, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00852"></a>00852   length -= 2;
<a name="l00853"></a>00853   
<a name="l00854"></a>00854   <a class="code" href="jerror_8h.html#a648bfbe13dbcedae2df9e65f16680780">TRACEMS2</a>(cinfo, 1, JTRC_MISC_MARKER, cinfo-&gt;unread_marker, (<span class="keywordtype">int</span>) length);
<a name="l00855"></a>00855 
<a name="l00856"></a>00856   <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);            <span class="comment">/* do before skip_input_data */</span>
<a name="l00857"></a>00857   <span class="keywordflow">if</span> (length &gt; 0)
<a name="l00858"></a>00858     (*cinfo-&gt;src-&gt;skip_input_data) (cinfo, (<span class="keywordtype">long</span>) <a class="code" href="png_8h.html#ae403475fe6a2c471cf8dd689e3049953">length</a>);
<a name="l00859"></a>00859 
<a name="l00860"></a>00860   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00861"></a>00861 }
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 
<a name="l00864"></a>00864 <span class="comment">/*</span>
<a name="l00865"></a>00865 <span class="comment"> * Find the next JPEG marker, save it in cinfo-&gt;unread_marker.</span>
<a name="l00866"></a>00866 <span class="comment"> * Returns FALSE if had to suspend before reaching a marker;</span>
<a name="l00867"></a>00867 <span class="comment"> * in that case cinfo-&gt;unread_marker is unchanged.</span>
<a name="l00868"></a>00868 <span class="comment"> *</span>
<a name="l00869"></a>00869 <span class="comment"> * Note that the result might not be a valid marker code,</span>
<a name="l00870"></a>00870 <span class="comment"> * but it will never be 0 or FF.</span>
<a name="l00871"></a>00871 <span class="comment"> */</span>
<a name="l00872"></a>00872 
<a name="l00873"></a>00873 <a class="code" href="jmorecfg_8h.html#a9abdf12131b53b658a268f508ae2ad16">LOCAL</a>(<span class="keywordtype">boolean</span>)
<a name="l00874"></a><a class="code" href="jdmarker_8c.html#ac22171f29bb541cfcb932f0903102c45">00874</a> <a class="code" href="jdmarker_8c.html#ac22171f29bb541cfcb932f0903102c45">next_marker</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l00875"></a>00875 {
<a name="l00876"></a>00876   <span class="keywordtype">int</span> c;
<a name="l00877"></a>00877   <a class="code" href="jdmarker_8c.html#a7228ca7f1eedc647929a660a84ab6f33">INPUT_VARS</a>(cinfo);
<a name="l00878"></a>00878 
<a name="l00879"></a>00879   <span class="keywordflow">for</span> (;;) {
<a name="l00880"></a>00880     <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, c, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00881"></a>00881     <span class="comment">/* Skip any non-FF bytes.</span>
<a name="l00882"></a>00882 <span class="comment">     * This may look a bit inefficient, but it will not occur in a valid file.</span>
<a name="l00883"></a>00883 <span class="comment">     * We sync after each discarded byte so that a suspending data source</span>
<a name="l00884"></a>00884 <span class="comment">     * can discard the byte from its buffer.</span>
<a name="l00885"></a>00885 <span class="comment">     */</span>
<a name="l00886"></a>00886     <span class="keywordflow">while</span> (c != 0xFF) {
<a name="l00887"></a>00887       cinfo-&gt;marker-&gt;discarded_bytes++;
<a name="l00888"></a>00888       <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);
<a name="l00889"></a>00889       <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, c, <span class="keywordflow">return</span> FALSE);
<a name="l00890"></a>00890     }
<a name="l00891"></a>00891     <span class="comment">/* This loop swallows any duplicate FF bytes.  Extra FFs are legal as</span>
<a name="l00892"></a>00892 <span class="comment">     * pad bytes, so don&#39;t count them in discarded_bytes.  We assume there</span>
<a name="l00893"></a>00893 <span class="comment">     * will not be so many consecutive FF bytes as to overflow a suspending</span>
<a name="l00894"></a>00894 <span class="comment">     * data source&#39;s input buffer.</span>
<a name="l00895"></a>00895 <span class="comment">     */</span>
<a name="l00896"></a>00896     <span class="keywordflow">do</span> {
<a name="l00897"></a>00897       <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, c, <span class="keywordflow">return</span> FALSE);
<a name="l00898"></a>00898     } <span class="keywordflow">while</span> (c == 0xFF);
<a name="l00899"></a>00899     <span class="keywordflow">if</span> (c != 0)
<a name="l00900"></a>00900       <span class="keywordflow">break</span>;                    <span class="comment">/* found a valid marker, exit loop */</span>
<a name="l00901"></a>00901     <span class="comment">/* Reach here if we found a stuffed-zero data sequence (FF/00).</span>
<a name="l00902"></a>00902 <span class="comment">     * Discard it and loop back to try again.</span>
<a name="l00903"></a>00903 <span class="comment">     */</span>
<a name="l00904"></a>00904     cinfo-&gt;marker-&gt;discarded_bytes += 2;
<a name="l00905"></a>00905     <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);
<a name="l00906"></a>00906   }
<a name="l00907"></a>00907 
<a name="l00908"></a>00908   <span class="keywordflow">if</span> (cinfo-&gt;marker-&gt;discarded_bytes != 0) {
<a name="l00909"></a>00909     <a class="code" href="jerror_8h.html#a0afd40f657d38b1c4281979769ab23ed">WARNMS2</a>(cinfo, JWRN_EXTRANEOUS_DATA, cinfo-&gt;marker-&gt;discarded_bytes, c);
<a name="l00910"></a>00910     cinfo-&gt;marker-&gt;discarded_bytes = 0;
<a name="l00911"></a>00911   }
<a name="l00912"></a>00912 
<a name="l00913"></a>00913   cinfo-&gt;unread_marker = c;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915   <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);
<a name="l00916"></a>00916   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00917"></a>00917 }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919 
<a name="l00920"></a>00920 <a class="code" href="jmorecfg_8h.html#a9abdf12131b53b658a268f508ae2ad16">LOCAL</a>(<span class="keywordtype">boolean</span>)
<a name="l00921"></a><a class="code" href="jdmarker_8c.html#a19b70465fd94f29d414d4ce11d2656ee">00921</a> <a class="code" href="jdmarker_8c.html#a19b70465fd94f29d414d4ce11d2656ee">first_marker</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l00922"></a>00922 <span class="comment">/* Like next_marker, but used to obtain the initial SOI marker. */</span>
<a name="l00923"></a>00923 <span class="comment">/* For this marker, we do not allow preceding garbage or fill; otherwise,</span>
<a name="l00924"></a>00924 <span class="comment"> * we might well scan an entire input file before realizing it ain&#39;t JPEG.</span>
<a name="l00925"></a>00925 <span class="comment"> * If an application wants to process non-JFIF files, it must seek to the</span>
<a name="l00926"></a>00926 <span class="comment"> * SOI before calling the JPEG library.</span>
<a name="l00927"></a>00927 <span class="comment"> */</span>
<a name="l00928"></a>00928 {
<a name="l00929"></a>00929   <span class="keywordtype">int</span> c, c2;
<a name="l00930"></a>00930   <a class="code" href="jdmarker_8c.html#a7228ca7f1eedc647929a660a84ab6f33">INPUT_VARS</a>(cinfo);
<a name="l00931"></a>00931 
<a name="l00932"></a>00932   <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, c, <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00933"></a>00933   <a class="code" href="jdmarker_8c.html#a0649a313fee23b70a6917f5d5b7c2a31">INPUT_BYTE</a>(cinfo, c2, <span class="keywordflow">return</span> FALSE);
<a name="l00934"></a>00934   <span class="keywordflow">if</span> (c != 0xFF || c2 != (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea71e9d6e2c20cb73325471cc87de62c2c">M_SOI</a>)
<a name="l00935"></a>00935     <a class="code" href="jerror_8h.html#af5a40432fe59039f7fcd7dc8f0c19041">ERREXIT2</a>(cinfo, JERR_NO_SOI, c, c2);
<a name="l00936"></a>00936 
<a name="l00937"></a>00937   cinfo-&gt;unread_marker = c2;
<a name="l00938"></a>00938 
<a name="l00939"></a>00939   <a class="code" href="jdmarker_8c.html#aa5b8cf133c3c91aef3be0b43bcea6d99">INPUT_SYNC</a>(cinfo);
<a name="l00940"></a>00940   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00941"></a>00941 }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943 
<a name="l00944"></a>00944 <span class="comment">/*</span>
<a name="l00945"></a>00945 <span class="comment"> * Read markers until SOS or EOI.</span>
<a name="l00946"></a>00946 <span class="comment"> *</span>
<a name="l00947"></a>00947 <span class="comment"> * Returns same codes as are defined for jpeg_consume_input:</span>
<a name="l00948"></a>00948 <span class="comment"> * JPEG_SUSPENDED, JPEG_REACHED_SOS, or JPEG_REACHED_EOI.</span>
<a name="l00949"></a>00949 <span class="comment"> */</span>
<a name="l00950"></a>00950 
<a name="l00951"></a>00951 <a class="code" href="jmorecfg_8h.html#aae05a300dc5b2dd4305cde6cc63b6d6a">METHODDEF</a>(<span class="keywordtype">int</span>)
<a name="l00952"></a><a class="code" href="jdmarker_8c.html#a8ff81a078a99e98efe6051366512c5f6">00952</a> <a class="code" href="jdmarker_8c.html#a8ff81a078a99e98efe6051366512c5f6">read_markers</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l00953"></a>00953 {
<a name="l00954"></a>00954   <span class="comment">/* Outer loop repeats once for each marker. */</span>
<a name="l00955"></a>00955   <span class="keywordflow">for</span> (;;) {
<a name="l00956"></a>00956     <span class="comment">/* Collect the marker proper, unless we already did. */</span>
<a name="l00957"></a>00957     <span class="comment">/* NB: first_marker() enforces the requirement that SOI appear first. */</span>
<a name="l00958"></a>00958     <span class="keywordflow">if</span> (cinfo-&gt;unread_marker == 0) {
<a name="l00959"></a>00959       <span class="keywordflow">if</span> (! cinfo-&gt;marker-&gt;saw_SOI) {
<a name="l00960"></a>00960         <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#a19b70465fd94f29d414d4ce11d2656ee">first_marker</a>(cinfo))
<a name="l00961"></a>00961           <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l00962"></a>00962       } <span class="keywordflow">else</span> {
<a name="l00963"></a>00963         <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#ac22171f29bb541cfcb932f0903102c45">next_marker</a>(cinfo))
<a name="l00964"></a>00964           <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l00965"></a>00965       }
<a name="l00966"></a>00966     }
<a name="l00967"></a>00967     <span class="comment">/* At this point cinfo-&gt;unread_marker contains the marker code and the</span>
<a name="l00968"></a>00968 <span class="comment">     * input point is just past the marker proper, but before any parameters.</span>
<a name="l00969"></a>00969 <span class="comment">     * A suspension will cause us to return with this state still true.</span>
<a name="l00970"></a>00970 <span class="comment">     */</span>
<a name="l00971"></a>00971     <span class="keywordflow">switch</span> (cinfo-&gt;unread_marker) {
<a name="l00972"></a>00972     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea71e9d6e2c20cb73325471cc87de62c2c">M_SOI</a>:
<a name="l00973"></a>00973       <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#afdd1d684e02317cbcd4034508275a0df">get_soi</a>(cinfo))
<a name="l00974"></a>00974         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l00975"></a>00975       <span class="keywordflow">break</span>;
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eae378ea5accc324b1971661045a4310b6">M_SOF0</a>:                <span class="comment">/* Baseline */</span>
<a name="l00978"></a>00978     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eadce732cdecfcc87caa8131dcbd1ce8f2">M_SOF1</a>:                <span class="comment">/* Extended sequential, Huffman */</span>
<a name="l00979"></a>00979       <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#ae65878b0abe7d30519773aacfeb998b7">get_sof</a>(cinfo, <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>))
<a name="l00980"></a>00980         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l00981"></a>00981       <span class="keywordflow">break</span>;
<a name="l00982"></a>00982 
<a name="l00983"></a>00983     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea596fcf9241af0520cd9320e26500967f">M_SOF2</a>:                <span class="comment">/* Progressive, Huffman */</span>
<a name="l00984"></a>00984       <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#ae65878b0abe7d30519773aacfeb998b7">get_sof</a>(cinfo, <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>))
<a name="l00985"></a>00985         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l00986"></a>00986       <span class="keywordflow">break</span>;
<a name="l00987"></a>00987 
<a name="l00988"></a>00988     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea76298c41c8b7ca8a78f2d8fe9b4142c2">M_SOF9</a>:                <span class="comment">/* Extended sequential, arithmetic */</span>
<a name="l00989"></a>00989       <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#ae65878b0abe7d30519773aacfeb998b7">get_sof</a>(cinfo, <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>))
<a name="l00990"></a>00990         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l00991"></a>00991       <span class="keywordflow">break</span>;
<a name="l00992"></a>00992 
<a name="l00993"></a>00993     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea9e5c338b4fd5511088fa86bb20e64f3a">M_SOF10</a>:               <span class="comment">/* Progressive, arithmetic */</span>
<a name="l00994"></a>00994       <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#ae65878b0abe7d30519773aacfeb998b7">get_sof</a>(cinfo, <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>))
<a name="l00995"></a>00995         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l00996"></a>00996       <span class="keywordflow">break</span>;
<a name="l00997"></a>00997 
<a name="l00998"></a>00998     <span class="comment">/* Currently unsupported SOFn types */</span>
<a name="l00999"></a>00999     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5788f5676ea22070ce8b0a4d347bdf3d">M_SOF3</a>:                <span class="comment">/* Lossless, Huffman */</span>
<a name="l01000"></a>01000     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf58aa5a7c0fc59e3924b1ddcbbbc8cf9">M_SOF5</a>:                <span class="comment">/* Differential sequential, Huffman */</span>
<a name="l01001"></a>01001     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea62db0a63d44ddd02930c5940bc875ea8">M_SOF6</a>:                <span class="comment">/* Differential progressive, Huffman */</span>
<a name="l01002"></a>01002     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea133a046cfa34c60d7404af2d5cf7cf89">M_SOF7</a>:                <span class="comment">/* Differential lossless, Huffman */</span>
<a name="l01003"></a>01003     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea7831272d3f1adf39cc435b929f4356c9">M_JPG</a>:                 <span class="comment">/* Reserved for JPEG extensions */</span>
<a name="l01004"></a>01004     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea9ec3e5a2e5e70c7709e34f4bd326beb4">M_SOF11</a>:               <span class="comment">/* Lossless, arithmetic */</span>
<a name="l01005"></a>01005     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eab6ab62ee271a4e525d18ac4dcaecc650">M_SOF13</a>:               <span class="comment">/* Differential sequential, arithmetic */</span>
<a name="l01006"></a>01006     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea0e88fd11779e652bdcf14283fd66e147">M_SOF14</a>:               <span class="comment">/* Differential progressive, arithmetic */</span>
<a name="l01007"></a>01007     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6e80f3fe9060cc5edffcb05f3ed87519">M_SOF15</a>:               <span class="comment">/* Differential lossless, arithmetic */</span>
<a name="l01008"></a>01008       <a class="code" href="jerror_8h.html#ae28b1b285273b3410284a8e86a7f9499">ERREXIT1</a>(cinfo, JERR_SOF_UNSUPPORTED, cinfo-&gt;unread_marker);
<a name="l01009"></a>01009       <span class="keywordflow">break</span>;
<a name="l01010"></a>01010 
<a name="l01011"></a>01011     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaddd23503953e352503564f0114539a7d">M_SOS</a>:
<a name="l01012"></a>01012       <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#aec23916e5e625b771e766d41f457bb18">get_sos</a>(cinfo))
<a name="l01013"></a>01013         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l01014"></a>01014       cinfo-&gt;unread_marker = 0; <span class="comment">/* processed the marker */</span>
<a name="l01015"></a>01015       <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#a63284fb83470a666525a87c40e659e2d">JPEG_REACHED_SOS</a>;
<a name="l01016"></a>01016     
<a name="l01017"></a>01017     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea18a46268847e1e9821cffd21a43c89b2">M_EOI</a>:
<a name="l01018"></a>01018       <a class="code" href="jerror_8h.html#a233f31300ee28ddfc0d5ce402e2c4780">TRACEMS</a>(cinfo, 1, JTRC_EOI);
<a name="l01019"></a>01019       cinfo-&gt;unread_marker = 0; <span class="comment">/* processed the marker */</span>
<a name="l01020"></a>01020       <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#aa679d2793b592507d34446e87d247936">JPEG_REACHED_EOI</a>;
<a name="l01021"></a>01021       
<a name="l01022"></a>01022     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5c8f3cf42e49f762cd03593677b99ef5">M_DAC</a>:
<a name="l01023"></a>01023       <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#af90794434db6d4c233a10b95e5141b4e">get_dac</a>(cinfo))
<a name="l01024"></a>01024         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l01025"></a>01025       <span class="keywordflow">break</span>;
<a name="l01026"></a>01026       
<a name="l01027"></a>01027     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea4d8c861e2af15fd3788eca8d9d6658ee">M_DHT</a>:
<a name="l01028"></a>01028       <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#ad09ef619b094cb03fb9c10df65c6ccd2">get_dht</a>(cinfo))
<a name="l01029"></a>01029         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l01030"></a>01030       <span class="keywordflow">break</span>;
<a name="l01031"></a>01031       
<a name="l01032"></a>01032     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea472e58da7490c1ba6a0513da4075b2fa">M_DQT</a>:
<a name="l01033"></a>01033       <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#ae8cd99feb65fb3bf3e1aca7ea5aa1087">get_dqt</a>(cinfo))
<a name="l01034"></a>01034         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l01035"></a>01035       <span class="keywordflow">break</span>;
<a name="l01036"></a>01036       
<a name="l01037"></a>01037     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea7509a5fd2ccebcb19d9cb3f94ba3fdb7">M_DRI</a>:
<a name="l01038"></a>01038       <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#aa9a14e7eb5b230749c084f655693a114">get_dri</a>(cinfo))
<a name="l01039"></a>01039         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l01040"></a>01040       <span class="keywordflow">break</span>;
<a name="l01041"></a>01041       
<a name="l01042"></a>01042     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a>:
<a name="l01043"></a>01043     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea253489a90d92cae281bc03692010cdec">M_APP1</a>:
<a name="l01044"></a>01044     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea353dd92719799115f3549070ebca08b8">M_APP2</a>:
<a name="l01045"></a>01045     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea1189a3e703577a8bebfa5ef7cac7f0ed">M_APP3</a>:
<a name="l01046"></a>01046     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaca4f5b634273f13f183d43d686d0c977">M_APP4</a>:
<a name="l01047"></a>01047     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ead26d76b05df1877e1282b9888d58ca65">M_APP5</a>:
<a name="l01048"></a>01048     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea630e5d313e9d121f392a08b112ff911a">M_APP6</a>:
<a name="l01049"></a>01049     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eae0c1d764a503bda79303fd354d3e0687">M_APP7</a>:
<a name="l01050"></a>01050     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6976be93d708d35e4c15902251cfe9a3">M_APP8</a>:
<a name="l01051"></a>01051     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea407252f5a0ebd992929a30c53f2eaeb4">M_APP9</a>:
<a name="l01052"></a>01052     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea94d76f68b62989522f5abd6ec8dbb637">M_APP10</a>:
<a name="l01053"></a>01053     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea191faf6bcfd41ec8cb09e9d906c3454b">M_APP11</a>:
<a name="l01054"></a>01054     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea2d1429ea7bc7101f5db1b763a8002bcc">M_APP12</a>:
<a name="l01055"></a>01055     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea388b96c4e201109bfeaf766da8e71348">M_APP13</a>:
<a name="l01056"></a>01056     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5a37889b83b67a6e8d21e0091dfee430">M_APP14</a>:
<a name="l01057"></a>01057     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf352dfefbde3708396055c619ab890ee">M_APP15</a>:
<a name="l01058"></a>01058       <span class="keywordflow">if</span> (! (*((<a class="code" href="structmy__marker__writer.html">my_marker_ptr</a>) cinfo-&gt;marker)-&gt;process_APPn[
<a name="l01059"></a>01059                 cinfo-&gt;unread_marker - (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a>]) (cinfo))
<a name="l01060"></a>01060         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l01061"></a>01061       <span class="keywordflow">break</span>;
<a name="l01062"></a>01062       
<a name="l01063"></a>01063     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea09270895cfe821542b21666dc22034c8">M_COM</a>:
<a name="l01064"></a>01064       <span class="keywordflow">if</span> (! (*((<a class="code" href="structmy__marker__writer.html">my_marker_ptr</a>) cinfo-&gt;marker)-&gt;process_COM) (cinfo))
<a name="l01065"></a>01065         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l01066"></a>01066       <span class="keywordflow">break</span>;
<a name="l01067"></a>01067 
<a name="l01068"></a>01068     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6738992105ae7dcdbd213fc29bb999e6">M_RST0</a>:                <span class="comment">/* these are all parameterless */</span>
<a name="l01069"></a>01069     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf7926723c3ebd7589e6c1843b22d1397">M_RST1</a>:
<a name="l01070"></a>01070     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf579fb1733121b059b53c5f97fae1354">M_RST2</a>:
<a name="l01071"></a>01071     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea3fefaaf0b42355ed215b21aa873ba7d1">M_RST3</a>:
<a name="l01072"></a>01072     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea05200469090691bf26b5f14012b89dbd">M_RST4</a>:
<a name="l01073"></a>01073     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea09e61cc3f4bdc5d2396b8c7c47a51d6c">M_RST5</a>:
<a name="l01074"></a>01074     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eac46c1f3019d56391f103924232c32ef6">M_RST6</a>:
<a name="l01075"></a>01075     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea74e769cba5338cc23330b0e33dfd0953">M_RST7</a>:
<a name="l01076"></a>01076     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaa759203dfe581c36f2c860b8b9d3a50a">M_TEM</a>:
<a name="l01077"></a>01077       <a class="code" href="jerror_8h.html#a21a4007edf703b49ac9cdbf92076572b">TRACEMS1</a>(cinfo, 1, JTRC_PARMLESS_MARKER, cinfo-&gt;unread_marker);
<a name="l01078"></a>01078       <span class="keywordflow">break</span>;
<a name="l01079"></a>01079 
<a name="l01080"></a>01080     <span class="keywordflow">case</span> <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea0bcbe4809c59685e3b73afa8d251b203">M_DNL</a>:                 <span class="comment">/* Ignore DNL ... perhaps the wrong thing */</span>
<a name="l01081"></a>01081       <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#a3e27a348c35d6008c19ace382ec756d0">skip_variable</a>(cinfo))
<a name="l01082"></a>01082         <span class="keywordflow">return</span> <a class="code" href="jpeglib_8h.html#af6138b97be145eb9342207da80fd16b8">JPEG_SUSPENDED</a>;
<a name="l01083"></a>01083       <span class="keywordflow">break</span>;
<a name="l01084"></a>01084 
<a name="l01085"></a>01085     <span class="keywordflow">default</span>:                    <span class="comment">/* must be DHP, EXP, JPGn, or RESn */</span>
<a name="l01086"></a>01086       <span class="comment">/* For now, we treat the reserved markers as fatal errors since they are</span>
<a name="l01087"></a>01087 <span class="comment">       * likely to be used to signal incompatible JPEG Part 3 extensions.</span>
<a name="l01088"></a>01088 <span class="comment">       * Once the JPEG 3 version-number marker is well defined, this code</span>
<a name="l01089"></a>01089 <span class="comment">       * ought to change!</span>
<a name="l01090"></a>01090 <span class="comment">       */</span>
<a name="l01091"></a>01091       <a class="code" href="jerror_8h.html#ae28b1b285273b3410284a8e86a7f9499">ERREXIT1</a>(cinfo, JERR_UNKNOWN_MARKER, cinfo-&gt;unread_marker);
<a name="l01092"></a>01092       <span class="keywordflow">break</span>;
<a name="l01093"></a>01093     }
<a name="l01094"></a>01094     <span class="comment">/* Successfully processed marker, so reset state variable */</span>
<a name="l01095"></a>01095     cinfo-&gt;unread_marker = 0;
<a name="l01096"></a>01096   } <span class="comment">/* end loop */</span>
<a name="l01097"></a>01097 }
<a name="l01098"></a>01098 
<a name="l01099"></a>01099 
<a name="l01100"></a>01100 <span class="comment">/*</span>
<a name="l01101"></a>01101 <span class="comment"> * Read a restart marker, which is expected to appear next in the datastream;</span>
<a name="l01102"></a>01102 <span class="comment"> * if the marker is not there, take appropriate recovery action.</span>
<a name="l01103"></a>01103 <span class="comment"> * Returns FALSE if suspension is required.</span>
<a name="l01104"></a>01104 <span class="comment"> *</span>
<a name="l01105"></a>01105 <span class="comment"> * This is called by the entropy decoder after it has read an appropriate</span>
<a name="l01106"></a>01106 <span class="comment"> * number of MCUs.  cinfo-&gt;unread_marker may be nonzero if the entropy decoder</span>
<a name="l01107"></a>01107 <span class="comment"> * has already read a marker from the data source.  Under normal conditions</span>
<a name="l01108"></a>01108 <span class="comment"> * cinfo-&gt;unread_marker will be reset to 0 before returning; if not reset,</span>
<a name="l01109"></a>01109 <span class="comment"> * it holds a marker which the decoder will be unable to read past.</span>
<a name="l01110"></a>01110 <span class="comment"> */</span>
<a name="l01111"></a>01111 
<a name="l01112"></a>01112 <a class="code" href="jmorecfg_8h.html#aae05a300dc5b2dd4305cde6cc63b6d6a">METHODDEF</a>(<span class="keywordtype">boolean</span>)
<a name="l01113"></a><a class="code" href="jdmarker_8c.html#a44129320cf7ea5968113cdbd07bdd992">01113</a> <a class="code" href="jdmarker_8c.html#a44129320cf7ea5968113cdbd07bdd992">read_restart_marker</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l01114"></a>01114 {
<a name="l01115"></a>01115   <span class="comment">/* Obtain a marker unless we already did. */</span>
<a name="l01116"></a>01116   <span class="comment">/* Note that next_marker will complain if it skips any data. */</span>
<a name="l01117"></a>01117   <span class="keywordflow">if</span> (cinfo-&gt;unread_marker == 0) {
<a name="l01118"></a>01118     <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#ac22171f29bb541cfcb932f0903102c45">next_marker</a>(cinfo))
<a name="l01119"></a>01119       <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01120"></a>01120   }
<a name="l01121"></a>01121 
<a name="l01122"></a>01122   <span class="keywordflow">if</span> (cinfo-&gt;unread_marker ==
<a name="l01123"></a>01123       ((<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6738992105ae7dcdbd213fc29bb999e6">M_RST0</a> + cinfo-&gt;marker-&gt;next_restart_num)) {
<a name="l01124"></a>01124     <span class="comment">/* Normal case --- swallow the marker and let entropy decoder continue */</span>
<a name="l01125"></a>01125     <a class="code" href="jerror_8h.html#a21a4007edf703b49ac9cdbf92076572b">TRACEMS1</a>(cinfo, 3, JTRC_RST, cinfo-&gt;marker-&gt;next_restart_num);
<a name="l01126"></a>01126     cinfo-&gt;unread_marker = 0;
<a name="l01127"></a>01127   } <span class="keywordflow">else</span> {
<a name="l01128"></a>01128     <span class="comment">/* Uh-oh, the restart markers have been messed up. */</span>
<a name="l01129"></a>01129     <span class="comment">/* Let the data source manager determine how to resync. */</span>
<a name="l01130"></a>01130     <span class="keywordflow">if</span> (! (*cinfo-&gt;src-&gt;resync_to_restart) (cinfo,
<a name="l01131"></a>01131                                             cinfo-&gt;marker-&gt;next_restart_num))
<a name="l01132"></a>01132       <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01133"></a>01133   }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135   <span class="comment">/* Update next-restart state */</span>
<a name="l01136"></a>01136   cinfo-&gt;marker-&gt;next_restart_num = (cinfo-&gt;marker-&gt;next_restart_num + 1) &amp; 7;
<a name="l01137"></a>01137 
<a name="l01138"></a>01138   <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01139"></a>01139 }
<a name="l01140"></a>01140 
<a name="l01141"></a>01141 
<a name="l01142"></a>01142 <span class="comment">/*</span>
<a name="l01143"></a>01143 <span class="comment"> * This is the default resync_to_restart method for data source managers</span>
<a name="l01144"></a>01144 <span class="comment"> * to use if they don&#39;t have any better approach.  Some data source managers</span>
<a name="l01145"></a>01145 <span class="comment"> * may be able to back up, or may have additional knowledge about the data</span>
<a name="l01146"></a>01146 <span class="comment"> * which permits a more intelligent recovery strategy; such managers would</span>
<a name="l01147"></a>01147 <span class="comment"> * presumably supply their own resync method.</span>
<a name="l01148"></a>01148 <span class="comment"> *</span>
<a name="l01149"></a>01149 <span class="comment"> * read_restart_marker calls resync_to_restart if it finds a marker other than</span>
<a name="l01150"></a>01150 <span class="comment"> * the restart marker it was expecting.  (This code is *not* used unless</span>
<a name="l01151"></a>01151 <span class="comment"> * a nonzero restart interval has been declared.)  cinfo-&gt;unread_marker is</span>
<a name="l01152"></a>01152 <span class="comment"> * the marker code actually found (might be anything, except 0 or FF).</span>
<a name="l01153"></a>01153 <span class="comment"> * The desired restart marker number (0..7) is passed as a parameter.</span>
<a name="l01154"></a>01154 <span class="comment"> * This routine is supposed to apply whatever error recovery strategy seems</span>
<a name="l01155"></a>01155 <span class="comment"> * appropriate in order to position the input stream to the next data segment.</span>
<a name="l01156"></a>01156 <span class="comment"> * Note that cinfo-&gt;unread_marker is treated as a marker appearing before</span>
<a name="l01157"></a>01157 <span class="comment"> * the current data-source input point; usually it should be reset to zero</span>
<a name="l01158"></a>01158 <span class="comment"> * before returning.</span>
<a name="l01159"></a>01159 <span class="comment"> * Returns FALSE if suspension is required.</span>
<a name="l01160"></a>01160 <span class="comment"> *</span>
<a name="l01161"></a>01161 <span class="comment"> * This implementation is substantially constrained by wanting to treat the</span>
<a name="l01162"></a>01162 <span class="comment"> * input as a data stream; this means we can&#39;t back up.  Therefore, we have</span>
<a name="l01163"></a>01163 <span class="comment"> * only the following actions to work with:</span>
<a name="l01164"></a>01164 <span class="comment"> *   1. Simply discard the marker and let the entropy decoder resume at next</span>
<a name="l01165"></a>01165 <span class="comment"> *      byte of file.</span>
<a name="l01166"></a>01166 <span class="comment"> *   2. Read forward until we find another marker, discarding intervening</span>
<a name="l01167"></a>01167 <span class="comment"> *      data.  (In theory we could look ahead within the current bufferload,</span>
<a name="l01168"></a>01168 <span class="comment"> *      without having to discard data if we don&#39;t find the desired marker.</span>
<a name="l01169"></a>01169 <span class="comment"> *      This idea is not implemented here, in part because it makes behavior</span>
<a name="l01170"></a>01170 <span class="comment"> *      dependent on buffer size and chance buffer-boundary positions.)</span>
<a name="l01171"></a>01171 <span class="comment"> *   3. Leave the marker unread (by failing to zero cinfo-&gt;unread_marker).</span>
<a name="l01172"></a>01172 <span class="comment"> *      This will cause the entropy decoder to process an empty data segment,</span>
<a name="l01173"></a>01173 <span class="comment"> *      inserting dummy zeroes, and then we will reprocess the marker.</span>
<a name="l01174"></a>01174 <span class="comment"> *</span>
<a name="l01175"></a>01175 <span class="comment"> * #2 is appropriate if we think the desired marker lies ahead, while #3 is</span>
<a name="l01176"></a>01176 <span class="comment"> * appropriate if the found marker is a future restart marker (indicating</span>
<a name="l01177"></a>01177 <span class="comment"> * that we have missed the desired restart marker, probably because it got</span>
<a name="l01178"></a>01178 <span class="comment"> * corrupted).</span>
<a name="l01179"></a>01179 <span class="comment"> * We apply #2 or #3 if the found marker is a restart marker no more than</span>
<a name="l01180"></a>01180 <span class="comment"> * two counts behind or ahead of the expected one.  We also apply #2 if the</span>
<a name="l01181"></a>01181 <span class="comment"> * found marker is not a legal JPEG marker code (it&#39;s certainly bogus data).</span>
<a name="l01182"></a>01182 <span class="comment"> * If the found marker is a restart marker more than 2 counts away, we do #1</span>
<a name="l01183"></a>01183 <span class="comment"> * (too much risk that the marker is erroneous; with luck we will be able to</span>
<a name="l01184"></a>01184 <span class="comment"> * resync at some future point).</span>
<a name="l01185"></a>01185 <span class="comment"> * For any valid non-restart JPEG marker, we apply #3.  This keeps us from</span>
<a name="l01186"></a>01186 <span class="comment"> * overrunning the end of a scan.  An implementation limited to single-scan</span>
<a name="l01187"></a>01187 <span class="comment"> * files might find it better to apply #2 for markers other than EOI, since</span>
<a name="l01188"></a>01188 <span class="comment"> * any other marker would have to be bogus data in that case.</span>
<a name="l01189"></a>01189 <span class="comment"> */</span>
<a name="l01190"></a>01190 
<a name="l01191"></a>01191 <a class="code" href="jmorecfg_8h.html#af0db23466f820c6d00a3c3a80918eadc">GLOBAL</a>(<span class="keywordtype">boolean</span>)
<a name="l01192"></a><a class="code" href="jdmarker_8c.html#a037c6ada9f7d2310ca67765c98c86995">01192</a> <a class="code" href="jdmarker_8c.html#a037c6ada9f7d2310ca67765c98c86995">jpeg_resync_to_restart</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo, <span class="keywordtype">int</span> <a class="code" href="jpeglib_8h.html#a3450f7500f843178b4517d0e7ef2b537">desired</a>)
<a name="l01193"></a>01193 {
<a name="l01194"></a>01194   <span class="keywordtype">int</span> <a class="code" href="jpeglib_8h.html#a55fc502015142062735ebfd18c825354">marker</a> = cinfo-&gt;unread_marker;
<a name="l01195"></a>01195   <span class="keywordtype">int</span> action = 1;
<a name="l01196"></a>01196   
<a name="l01197"></a>01197   <span class="comment">/* Always put up a warning. */</span>
<a name="l01198"></a>01198   <a class="code" href="jerror_8h.html#a0afd40f657d38b1c4281979769ab23ed">WARNMS2</a>(cinfo, JWRN_MUST_RESYNC, marker, desired);
<a name="l01199"></a>01199   
<a name="l01200"></a>01200   <span class="comment">/* Outer loop handles repeated decision after scanning forward. */</span>
<a name="l01201"></a>01201   <span class="keywordflow">for</span> (;;) {
<a name="l01202"></a>01202     <span class="keywordflow">if</span> (marker &lt; (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eae378ea5accc324b1971661045a4310b6">M_SOF0</a>)
<a name="l01203"></a>01203       action = 2;               <span class="comment">/* invalid marker */</span>
<a name="l01204"></a>01204     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (marker &lt; (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6738992105ae7dcdbd213fc29bb999e6">M_RST0</a> || marker &gt; (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea74e769cba5338cc23330b0e33dfd0953">M_RST7</a>)
<a name="l01205"></a>01205       action = 3;               <span class="comment">/* valid non-restart marker */</span>
<a name="l01206"></a>01206     <span class="keywordflow">else</span> {
<a name="l01207"></a>01207       <span class="keywordflow">if</span> (marker == ((<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6738992105ae7dcdbd213fc29bb999e6">M_RST0</a> + ((desired+1) &amp; 7)) ||
<a name="l01208"></a>01208           marker == ((<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6738992105ae7dcdbd213fc29bb999e6">M_RST0</a> + ((desired+2) &amp; 7)))
<a name="l01209"></a>01209         action = 3;             <span class="comment">/* one of the next two expected restarts */</span>
<a name="l01210"></a>01210       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (marker == ((<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6738992105ae7dcdbd213fc29bb999e6">M_RST0</a> + ((desired-1) &amp; 7)) ||
<a name="l01211"></a>01211                marker == ((<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea6738992105ae7dcdbd213fc29bb999e6">M_RST0</a> + ((desired-2) &amp; 7)))
<a name="l01212"></a>01212         action = 2;             <span class="comment">/* a prior restart, so advance */</span>
<a name="l01213"></a>01213       <span class="keywordflow">else</span>
<a name="l01214"></a>01214         action = 1;             <span class="comment">/* desired restart or too far away */</span>
<a name="l01215"></a>01215     }
<a name="l01216"></a>01216     <a class="code" href="jerror_8h.html#a648bfbe13dbcedae2df9e65f16680780">TRACEMS2</a>(cinfo, 4, JTRC_RECOVERY_ACTION, marker, action);
<a name="l01217"></a>01217     <span class="keywordflow">switch</span> (action) {
<a name="l01218"></a>01218     <span class="keywordflow">case</span> 1:
<a name="l01219"></a>01219       <span class="comment">/* Discard marker and let entropy decoder resume processing. */</span>
<a name="l01220"></a>01220       cinfo-&gt;unread_marker = 0;
<a name="l01221"></a>01221       <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01222"></a>01222     <span class="keywordflow">case</span> 2:
<a name="l01223"></a>01223       <span class="comment">/* Scan to the next marker, and repeat the decision loop. */</span>
<a name="l01224"></a>01224       <span class="keywordflow">if</span> (! <a class="code" href="jdmarker_8c.html#ac22171f29bb541cfcb932f0903102c45">next_marker</a>(cinfo))
<a name="l01225"></a>01225         <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01226"></a>01226       marker = cinfo-&gt;unread_marker;
<a name="l01227"></a>01227       <span class="keywordflow">break</span>;
<a name="l01228"></a>01228     <span class="keywordflow">case</span> 3:
<a name="l01229"></a>01229       <span class="comment">/* Return without advancing past this marker. */</span>
<a name="l01230"></a>01230       <span class="comment">/* Entropy decoder will be forced to process an empty segment. */</span>
<a name="l01231"></a>01231       <span class="keywordflow">return</span> <a class="code" href="forms_8H-2.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01232"></a>01232     }
<a name="l01233"></a>01233   } <span class="comment">/* end loop */</span>
<a name="l01234"></a>01234 }
<a name="l01235"></a>01235 
<a name="l01236"></a>01236 
<a name="l01237"></a>01237 <span class="comment">/*</span>
<a name="l01238"></a>01238 <span class="comment"> * Reset marker processing state to begin a fresh datastream.</span>
<a name="l01239"></a>01239 <span class="comment"> */</span>
<a name="l01240"></a>01240 
<a name="l01241"></a>01241 <a class="code" href="jmorecfg_8h.html#aae05a300dc5b2dd4305cde6cc63b6d6a">METHODDEF</a>(<span class="keywordtype">void</span>)
<a name="l01242"></a><a class="code" href="jdmarker_8c.html#a1c08f1ba460e1a19d2dbc877b47c8b5f">01242</a> <a class="code" href="jdmarker_8c.html#a1c08f1ba460e1a19d2dbc877b47c8b5f">reset_marker_reader</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l01243"></a>01243 {
<a name="l01244"></a>01244   <a class="code" href="structmy__marker__writer.html">my_marker_ptr</a> <a class="code" href="jpeglib_8h.html#a55fc502015142062735ebfd18c825354">marker</a> = (<a class="code" href="jcmarker_8c.html#a10592246118021c933dac745fe4344c5">my_marker_ptr</a>) cinfo-&gt;marker;
<a name="l01245"></a>01245 
<a name="l01246"></a>01246   cinfo-&gt;comp_info = <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;              <span class="comment">/* until allocated by get_sof */</span>
<a name="l01247"></a>01247   cinfo-&gt;input_scan_number = 0;         <span class="comment">/* no SOS seen yet */</span>
<a name="l01248"></a>01248   cinfo-&gt;unread_marker = 0;             <span class="comment">/* no pending marker */</span>
<a name="l01249"></a>01249   marker-&gt;<a class="code" href="structmy__marker__writer.html#a4b02f71e32586520f4498e51a79b1fca">pub</a>.saw_SOI = <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;          <span class="comment">/* set internal state too */</span>
<a name="l01250"></a>01250   marker-&gt;<a class="code" href="structmy__marker__writer.html#a4b02f71e32586520f4498e51a79b1fca">pub</a>.saw_SOF = <a class="code" href="forms_8H-2.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01251"></a>01251   marker-&gt;<a class="code" href="structmy__marker__writer.html#a4b02f71e32586520f4498e51a79b1fca">pub</a>.discarded_bytes = 0;
<a name="l01252"></a>01252   marker-&gt;cur_marker = <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01253"></a>01253 }
<a name="l01254"></a>01254 
<a name="l01255"></a>01255 
<a name="l01256"></a>01256 <span class="comment">/*</span>
<a name="l01257"></a>01257 <span class="comment"> * Initialize the marker reader module.</span>
<a name="l01258"></a>01258 <span class="comment"> * This is called only once, when the decompression object is created.</span>
<a name="l01259"></a>01259 <span class="comment"> */</span>
<a name="l01260"></a>01260 
<a name="l01261"></a>01261 <a class="code" href="jmorecfg_8h.html#af0db23466f820c6d00a3c3a80918eadc">GLOBAL</a>(<span class="keywordtype">void</span>)
<a name="l01262"></a><a class="code" href="jdmarker_8c.html#a8fa54cb03525a09cd2a6121496895072">01262</a> <a class="code" href="jdmarker_8c.html#a8fa54cb03525a09cd2a6121496895072">jinit_marker_reader</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo)
<a name="l01263"></a>01263 {
<a name="l01264"></a>01264   <a class="code" href="structmy__marker__writer.html">my_marker_ptr</a> <a class="code" href="jpeglib_8h.html#a55fc502015142062735ebfd18c825354">marker</a>;
<a name="l01265"></a>01265   <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;
<a name="l01266"></a>01266 
<a name="l01267"></a>01267   <span class="comment">/* Create subobject in permanent pool */</span>
<a name="l01268"></a>01268   marker = (<a class="code" href="jcmarker_8c.html#a10592246118021c933dac745fe4344c5">my_marker_ptr</a>)
<a name="l01269"></a>01269     (*cinfo-&gt;mem-&gt;alloc_small) ((<a class="code" href="jpeglib_8h.html#a1a177ab705cefea8f30ec31a48e62650">j_common_ptr</a>) cinfo, <a class="code" href="jpeglib_8h.html#acb32741198f9e19a6f8b0ee17483f4d0">JPOOL_PERMANENT</a>,
<a name="l01270"></a>01270                                 <a class="code" href="jinclude_8h.html#ab4e7a10b0e2cf79aa0978d3bbe1e1268">SIZEOF</a>(<a class="code" href="structmy__marker__reader.html">my_marker_reader</a>));
<a name="l01271"></a>01271   cinfo-&gt;marker = (<span class="keyword">struct </span><a class="code" href="structjpeg__marker__reader.html">jpeg_marker_reader</a> *) marker;
<a name="l01272"></a>01272   <span class="comment">/* Initialize public method pointers */</span>
<a name="l01273"></a>01273   marker-&gt;<a class="code" href="structmy__marker__writer.html#a4b02f71e32586520f4498e51a79b1fca">pub</a>.reset_marker_reader = <a class="code" href="jdmarker_8c.html#a1c08f1ba460e1a19d2dbc877b47c8b5f">reset_marker_reader</a>;
<a name="l01274"></a>01274   marker-&gt;<a class="code" href="structmy__marker__writer.html#a4b02f71e32586520f4498e51a79b1fca">pub</a>.read_markers = <a class="code" href="jdmarker_8c.html#a8ff81a078a99e98efe6051366512c5f6">read_markers</a>;
<a name="l01275"></a>01275   marker-&gt;<a class="code" href="structmy__marker__writer.html#a4b02f71e32586520f4498e51a79b1fca">pub</a>.read_restart_marker = <a class="code" href="jdmarker_8c.html#a44129320cf7ea5968113cdbd07bdd992">read_restart_marker</a>;
<a name="l01276"></a>01276   <span class="comment">/* Initialize COM/APPn processing.</span>
<a name="l01277"></a>01277 <span class="comment">   * By default, we examine and then discard APP0 and APP14,</span>
<a name="l01278"></a>01278 <span class="comment">   * but simply discard COM and all other APPn.</span>
<a name="l01279"></a>01279 <span class="comment">   */</span>
<a name="l01280"></a>01280   marker-&gt;process_COM = <a class="code" href="jdmarker_8c.html#a3e27a348c35d6008c19ace382ec756d0">skip_variable</a>;
<a name="l01281"></a>01281   marker-&gt;length_limit_COM = 0;
<a name="l01282"></a>01282   <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++) {
<a name="l01283"></a>01283     marker-&gt;process_APPn[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = <a class="code" href="jdmarker_8c.html#a3e27a348c35d6008c19ace382ec756d0">skip_variable</a>;
<a name="l01284"></a>01284     marker-&gt;length_limit_APPn[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = 0;
<a name="l01285"></a>01285   }
<a name="l01286"></a>01286   marker-&gt;process_APPn[0] = <a class="code" href="jdmarker_8c.html#ad82019ab15e06b65c6119bbbce254b8f">get_interesting_appn</a>;
<a name="l01287"></a>01287   marker-&gt;process_APPn[14] = <a class="code" href="jdmarker_8c.html#ad82019ab15e06b65c6119bbbce254b8f">get_interesting_appn</a>;
<a name="l01288"></a>01288   <span class="comment">/* Reset marker processing state */</span>
<a name="l01289"></a>01289   <a class="code" href="jdmarker_8c.html#a1c08f1ba460e1a19d2dbc877b47c8b5f">reset_marker_reader</a>(cinfo);
<a name="l01290"></a>01290 }
<a name="l01291"></a>01291 
<a name="l01292"></a>01292 
<a name="l01293"></a>01293 <span class="comment">/*</span>
<a name="l01294"></a>01294 <span class="comment"> * Control saving of COM and APPn markers into marker_list.</span>
<a name="l01295"></a>01295 <span class="comment"> */</span>
<a name="l01296"></a>01296 
<a name="l01297"></a>01297 <span class="preprocessor">#ifdef SAVE_MARKERS_SUPPORTED</span>
<a name="l01298"></a>01298 <span class="preprocessor"></span>
<a name="l01299"></a>01299 <a class="code" href="jmorecfg_8h.html#af0db23466f820c6d00a3c3a80918eadc">GLOBAL</a>(<span class="keywordtype">void</span>)
<a name="l01300"></a><a class="code" href="jdmarker_8c.html#a5bb5f27bfd0bab5538de0aec18d2273a">01300</a> <a class="code" href="jdmarker_8c.html#a5bb5f27bfd0bab5538de0aec18d2273a">jpeg_save_markers</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo, <span class="keywordtype">int</span> <a class="code" href="jpeglib_8h.html#a4385fc8b02cb43f7ef69c950465bab51">marker_code</a>,
<a name="l01301"></a>01301                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="jpeglib_8h.html#a55915d96c9b813f512b251db6be18089">length_limit</a>)
<a name="l01302"></a>01302 {
<a name="l01303"></a>01303   <a class="code" href="structmy__marker__writer.html">my_marker_ptr</a> <a class="code" href="jpeglib_8h.html#a55fc502015142062735ebfd18c825354">marker</a> = (<a class="code" href="jcmarker_8c.html#a10592246118021c933dac745fe4344c5">my_marker_ptr</a>) cinfo-&gt;marker;
<a name="l01304"></a>01304   <span class="keywordtype">long</span> maxlength;
<a name="l01305"></a>01305   jpeg_marker_parser_method processor;
<a name="l01306"></a>01306 
<a name="l01307"></a>01307   <span class="comment">/* Length limit mustn&#39;t be larger than what we can allocate</span>
<a name="l01308"></a>01308 <span class="comment">   * (should only be a concern in a 16-bit environment).</span>
<a name="l01309"></a>01309 <span class="comment">   */</span>
<a name="l01310"></a>01310   maxlength = cinfo-&gt;mem-&gt;max_alloc_chunk - <a class="code" href="jinclude_8h.html#ab4e7a10b0e2cf79aa0978d3bbe1e1268">SIZEOF</a>(<span class="keyword">struct</span> <a class="code" href="structjpeg__marker__struct.html">jpeg_marker_struct</a>);
<a name="l01311"></a>01311   <span class="keywordflow">if</span> (((<span class="keywordtype">long</span>) length_limit) &gt; maxlength)
<a name="l01312"></a>01312     length_limit = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) maxlength;
<a name="l01313"></a>01313 
<a name="l01314"></a>01314   <span class="comment">/* Choose processor routine to use.</span>
<a name="l01315"></a>01315 <span class="comment">   * APP0/APP14 have special requirements.</span>
<a name="l01316"></a>01316 <span class="comment">   */</span>
<a name="l01317"></a>01317   <span class="keywordflow">if</span> (length_limit) {
<a name="l01318"></a>01318     processor = <a class="code" href="jdmarker_8c.html#acba4eaea087c7946c5d51b3f15eb72a2">save_marker</a>;
<a name="l01319"></a>01319     <span class="comment">/* If saving APP0/APP14, save at least enough for our internal use. */</span>
<a name="l01320"></a>01320     <span class="keywordflow">if</span> (marker_code == (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a> &amp;&amp; length_limit &lt; <a class="code" href="jdmarker_8c.html#a057ff05e93a2de52ac7a09328201a9b4">APP0_DATA_LEN</a>)
<a name="l01321"></a>01321       length_limit = <a class="code" href="jdmarker_8c.html#a057ff05e93a2de52ac7a09328201a9b4">APP0_DATA_LEN</a>;
<a name="l01322"></a>01322     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (marker_code == (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5a37889b83b67a6e8d21e0091dfee430">M_APP14</a> &amp;&amp; length_limit &lt; <a class="code" href="jdmarker_8c.html#ad1da2c3492da196965c8665710a82557">APP14_DATA_LEN</a>)
<a name="l01323"></a>01323       length_limit = <a class="code" href="jdmarker_8c.html#ad1da2c3492da196965c8665710a82557">APP14_DATA_LEN</a>;
<a name="l01324"></a>01324   } <span class="keywordflow">else</span> {
<a name="l01325"></a>01325     processor = <a class="code" href="jdmarker_8c.html#a3e27a348c35d6008c19ace382ec756d0">skip_variable</a>;
<a name="l01326"></a>01326     <span class="comment">/* If discarding APP0/APP14, use our regular on-the-fly processor. */</span>
<a name="l01327"></a>01327     <span class="keywordflow">if</span> (marker_code == (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a> || marker_code == (<a class="code" href="png_8h.html#ab832c174e145540d491b0830fc05dbb1">int</a>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea5a37889b83b67a6e8d21e0091dfee430">M_APP14</a>)
<a name="l01328"></a>01328       processor = <a class="code" href="jdmarker_8c.html#ad82019ab15e06b65c6119bbbce254b8f">get_interesting_appn</a>;
<a name="l01329"></a>01329   }
<a name="l01330"></a>01330 
<a name="l01331"></a>01331   <span class="keywordflow">if</span> (marker_code == (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea09270895cfe821542b21666dc22034c8">M_COM</a>) {
<a name="l01332"></a>01332     marker-&gt;process_COM = processor;
<a name="l01333"></a>01333     marker-&gt;length_limit_COM = <a class="code" href="jpeglib_8h.html#a55915d96c9b813f512b251db6be18089">length_limit</a>;
<a name="l01334"></a>01334   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (marker_code &gt;= (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a> &amp;&amp; marker_code &lt;= (<a class="code" href="png_8h.html#ab832c174e145540d491b0830fc05dbb1">int</a>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf352dfefbde3708396055c619ab890ee">M_APP15</a>) {
<a name="l01335"></a>01335     marker-&gt;process_APPn[marker_code - (<a class="code" href="png_8h.html#ab832c174e145540d491b0830fc05dbb1">int</a>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a>] = processor;
<a name="l01336"></a>01336     marker-&gt;length_limit_APPn[marker_code - (<a class="code" href="png_8h.html#ab832c174e145540d491b0830fc05dbb1">int</a>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a>] = length_limit;
<a name="l01337"></a>01337   } <span class="keywordflow">else</span>
<a name="l01338"></a>01338     <a class="code" href="jerror_8h.html#ae28b1b285273b3410284a8e86a7f9499">ERREXIT1</a>(cinfo, JERR_UNKNOWN_MARKER, marker_code);
<a name="l01339"></a>01339 }
<a name="l01340"></a>01340 
<a name="l01341"></a>01341 <span class="preprocessor">#endif </span><span class="comment">/* SAVE_MARKERS_SUPPORTED */</span>
<a name="l01342"></a>01342 
<a name="l01343"></a>01343 
<a name="l01344"></a>01344 <span class="comment">/*</span>
<a name="l01345"></a>01345 <span class="comment"> * Install a special processing method for COM or APPn markers.</span>
<a name="l01346"></a>01346 <span class="comment"> */</span>
<a name="l01347"></a>01347 
<a name="l01348"></a>01348 <a class="code" href="jmorecfg_8h.html#af0db23466f820c6d00a3c3a80918eadc">GLOBAL</a>(<span class="keywordtype">void</span>)
<a name="l01349"></a><a class="code" href="jdmarker_8c.html#a9612d9c5268a42e596a2bd8acdafd156">01349</a> <a class="code" href="jdmarker_8c.html#a9612d9c5268a42e596a2bd8acdafd156">jpeg_set_marker_processor</a> (<a class="code" href="structjpeg__decompress__struct.html">j_decompress_ptr</a> cinfo, <span class="keywordtype">int</span> <a class="code" href="jpeglib_8h.html#a4385fc8b02cb43f7ef69c950465bab51">marker_code</a>,
<a name="l01350"></a>01350                            jpeg_marker_parser_method <a class="code" href="jpeglib_8h.html#a93cb4f27f735546be9aa745e14ed9050">routine</a>)
<a name="l01351"></a>01351 {
<a name="l01352"></a>01352   <a class="code" href="structmy__marker__writer.html">my_marker_ptr</a> <a class="code" href="jpeglib_8h.html#a55fc502015142062735ebfd18c825354">marker</a> = (<a class="code" href="jcmarker_8c.html#a10592246118021c933dac745fe4344c5">my_marker_ptr</a>) cinfo-&gt;marker;
<a name="l01353"></a>01353 
<a name="l01354"></a>01354   if (marker_code == (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758ea09270895cfe821542b21666dc22034c8">M_COM</a>)
<a name="l01355"></a>01355     marker-&gt;process_COM = routine;
<a name="l01356"></a>01356   <span class="keywordflow">else</span> if (marker_code &gt;= (<span class="keywordtype">int</span>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a> &amp;&amp; marker_code &lt;= (<a class="code" href="png_8h.html#ab832c174e145540d491b0830fc05dbb1">int</a>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaf352dfefbde3708396055c619ab890ee">M_APP15</a>)
<a name="l01357"></a>01357     marker-&gt;process_APPn[marker_code - (<a class="code" href="png_8h.html#ab832c174e145540d491b0830fc05dbb1">int</a>) <a class="code" href="jcmarker_8c.html#af8679a604c2f6538ef502df1dafb758eaea560025fd60b4714deb1f4808383bc9">M_APP0</a>] = routine;
<a name="l01358"></a>01358   <span class="keywordflow">else</span>
<a name="l01359"></a>01359     <a class="code" href="jerror_8h.html#ae28b1b285273b3410284a8e86a7f9499">ERREXIT1</a>(cinfo, JERR_UNKNOWN_MARKER, marker_code);
<a name="l01360"></a>01360 }
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="jdmarker_8c.html">jdmarker.c</a>      </li>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="#" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3</small></address>
</body>

<!-- Mirrored from dox.sfr-fresh.com/fltk-1.3.0rc3-source/jdmarker_8c_source.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 16 Feb 2011 23:39:06 GMT -->
</html>
