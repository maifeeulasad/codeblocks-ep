<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from dox.sfr-fresh.com/fltk-1.3.0rc3-source/Fl__Preferences_8cxx_source.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 16 Feb 2011 23:42:01 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SfR Fresh Dox - fltk: fltk-1.3.0rc3/src/Fl_Preferences.cxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">fltk&#160;<span id="projectnumber">1.3.0rc3</span></div>
   <div id="projectbrief">About: <A HREF= http://www.fltk.org/>FLTK</A> (Fast Light Tool Kit) is a cross-platform C++ GUI toolkit for UNIX/Linux (X11), Microsoft Windows, and MacOS X. Release candidate.<BR><IMG SRC="../warix/forest1.gif" ALT="">&nbsp;&nbsp;<A HREF="http://www.sfr-fresh.com/" TITLE="SfR Fresh Home">SfR Fresh</A> <A HREF="http://www.sfr-fresh.com/warix/features.html#doxygen" TITLE="SfR Fresh Doxygen Support Info">Dox</A>: <A HREF="../fresh/unix/misc/fltk-1.3.0rc3-source.tar.gz/index.html" TITLE="SfR Fresh: fltk-1.3.0rc3-source.tar.gz Contents &amp; Download Page">fltk-1.3.0rc3-source.tar.gz</A> ("inofficial" and yet experimental doxygen-generated source code documentation)&nbsp;&nbsp;<IMG SRC="../warix/forest2.gif" ALT=""><P></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index-2.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('Fl__Preferences_8cxx.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>Fl_Preferences.cxx</h1>  </div>
</div>
<div class="contents">
<a href="Fl__Preferences_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//</span>
<a name="l00002"></a>00002 <span class="comment">// &quot;$Id: Fl_Preferences.cxx 8173 2011-01-03 16:50:34Z manolo $&quot;</span>
<a name="l00003"></a>00003 <span class="comment">//</span>
<a name="l00004"></a>00004 <span class="comment">// Preferences methods for the Fast Light Tool Kit (FLTK).</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// Copyright 2002-2010 by Matthias Melcher.</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// This library is free software; you can redistribute it and/or</span>
<a name="l00009"></a>00009 <span class="comment">// modify it under the terms of the GNU Library General Public</span>
<a name="l00010"></a>00010 <span class="comment">// License as published by the Free Software Foundation; either</span>
<a name="l00011"></a>00011 <span class="comment">// version 2 of the License, or (at your option) any later version.</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">// This library is distributed in the hope that it will be useful,</span>
<a name="l00014"></a>00014 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00015"></a>00015 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00016"></a>00016 <span class="comment">// Library General Public License for more details.</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00018"></a>00018 <span class="comment">// You should have received a copy of the GNU Library General Public</span>
<a name="l00019"></a>00019 <span class="comment">// License along with this library; if not, write to the Free Software</span>
<a name="l00020"></a>00020 <span class="comment">// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307</span>
<a name="l00021"></a>00021 <span class="comment">// USA.</span>
<a name="l00022"></a>00022 <span class="comment">//</span>
<a name="l00023"></a>00023 <span class="comment">// Please report all bugs and problems on the following page:</span>
<a name="l00024"></a>00024 <span class="comment">//</span>
<a name="l00025"></a>00025 <span class="comment">//     http://www.fltk.org/str.php</span>
<a name="l00026"></a>00026 <span class="comment">//</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;FL/Fl.H&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;FL/Fl_Preferences.H&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;FL/Fl_Plugin.H&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;FL/filename.H&gt;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;FL/fl_utf8.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="flstring_8h.html">flstring.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#if defined(WIN32) &amp;&amp; !defined(__CYGWIN__)</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;windows.h&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#  include &lt;direct.h&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#  include &lt;io.h&gt;</span>
<a name="l00045"></a>00045 <span class="comment">// Visual C++ 2005 incorrectly displays a warning about the use of POSIX APIs</span>
<a name="l00046"></a>00046 <span class="comment">// on Windows, which is supposed to be POSIX compliant...</span>
<a name="l00047"></a>00047 <span class="preprocessor">#  define access _access</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#  define mkdir _mkdir</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="preprocessor">#elif defined (__APPLE__)</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;ApplicationServices/ApplicationServices.h&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#  include &lt;unistd.h&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#  include &lt;dlfcn.h&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#else</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;unistd.h&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#  include &lt;dlfcn.h&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#endif</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>
<a name="l00058"></a>00058 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;windows.h&gt;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#  include &lt;rpc.h&gt;</span>
<a name="l00061"></a>00061 <span class="comment">// function pointer for the UuidCreate Function</span>
<a name="l00062"></a>00062 <span class="comment">// RPC_STATUS RPC_ENTRY UuidCreate(UUID __RPC_FAR *Uuid);</span>
<a name="l00063"></a>00063 <span class="keyword">typedef</span> RPC_STATUS (WINAPI* uuid_func)(UUID __RPC_FAR *Uuid);
<a name="l00064"></a>00064 <span class="preprocessor">#else</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;sys/time.h&gt;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#endif // WIN32</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span>
<a name="l00068"></a>00068 <span class="preprocessor">#ifdef __CYGWIN__</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;wchar.h&gt;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#endif</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>
<a name="l00072"></a>00072 <span class="keywordtype">char</span> Fl_Preferences::nameBuffer[128];
<a name="l00073"></a>00073 <span class="keywordtype">char</span> Fl_Preferences::uuidBuffer[40];
<a name="l00074"></a>00074 <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> *Fl_Preferences::runtimePrefs = 0;
<a name="l00075"></a>00075 
<a name="l00087"></a><a class="code" href="classFl__Preferences.html#ae357c2136fce436e367b92c0337a4778">00087</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classFl__Preferences.html#ae357c2136fce436e367b92c0337a4778">Fl_Preferences::newUUID</a>() {
<a name="l00088"></a>00088 <span class="preprocessor">#ifdef __APPLE__</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>  CFUUIDRef theUUID = CFUUIDCreate(<a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00090"></a>00090   CFUUIDBytes <a class="code" href="jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a> = CFUUIDGetUUIDBytes(theUUID);
<a name="l00091"></a>00091   sprintf(uuidBuffer, <span class="stringliteral">&quot;%02X%02X%02X%02X-%02X%02X-%02X%02X-%02X%02X-%02X%02X%02X%02X%02X%02X&quot;</span>,
<a name="l00092"></a>00092           b.byte0, b.byte1, b.byte2, b.byte3, b.byte4, b.byte5, b.byte6, b.byte7,
<a name="l00093"></a>00093           b.byte8, b.byte9, b.byte10, b.byte11, b.byte12, b.byte13, b.byte14, b.byte15);
<a name="l00094"></a>00094   CFRelease(theUUID);
<a name="l00095"></a>00095 <span class="preprocessor">#elif defined (WIN32)</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>  <span class="comment">// First try and use the win API function UuidCreate(), but if that is not</span>
<a name="l00097"></a>00097   <span class="comment">// available, fall back to making something up from scratch.</span>
<a name="l00098"></a>00098   <span class="comment">// We do not want to link against the Rpcrt4.dll, as we will rarely use it,</span>
<a name="l00099"></a>00099   <span class="comment">// so we load the DLL dynamically, if it is available, and work from there.</span>
<a name="l00100"></a>00100   <span class="keyword">static</span> HMODULE hMod = <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00101"></a>00101   UUID ud;
<a name="l00102"></a>00102   UUID *pu = &amp;ud;
<a name="l00103"></a>00103   <span class="keywordtype">int</span> got_uuid = 0;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105   <span class="keywordflow">if</span> (!hMod) {          <span class="comment">// first time in?</span>
<a name="l00106"></a>00106     hMod = LoadLibrary(<span class="stringliteral">&quot;Rpcrt4.dll&quot;</span>);
<a name="l00107"></a>00107   }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109   <span class="keywordflow">if</span> (hMod) {           <span class="comment">// do we have a usable handle to Rpcrt4.dll?</span>
<a name="l00110"></a>00110     uuid_func uuid_crt = (uuid_func)GetProcAddress(hMod, <span class="stringliteral">&quot;UuidCreate&quot;</span>);
<a name="l00111"></a>00111     <span class="keywordflow">if</span> (uuid_crt != <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l00112"></a>00112       RPC_STATUS rpc_res = uuid_crt(pu);
<a name="l00113"></a>00113       <span class="keywordflow">if</span> ( <span class="comment">// is the return status OK for our needs?</span>
<a name="l00114"></a>00114           (rpc_res == RPC_S_OK) ||              <span class="comment">// all is well</span>
<a name="l00115"></a>00115           (rpc_res == RPC_S_UUID_LOCAL_ONLY) || <span class="comment">// only unique to this machine</span>
<a name="l00116"></a>00116           (rpc_res == RPC_S_UUID_NO_ADDRESS)    <span class="comment">// probably only locally unique</span>
<a name="l00117"></a>00117         ) {
<a name="l00118"></a>00118         got_uuid = -1;
<a name="l00119"></a>00119         sprintf(uuidBuffer, <span class="stringliteral">&quot;%08lX-%04X-%04X-%02X%02X-%02X%02X%02X%02X%02X%02X&quot;</span>,
<a name="l00120"></a>00120             pu-&gt;Data1, pu-&gt;Data2, pu-&gt;Data3, pu-&gt;Data4[0], pu-&gt;Data4[1],
<a name="l00121"></a>00121             pu-&gt;Data4[2], pu-&gt;Data4[3], pu-&gt;Data4[4],
<a name="l00122"></a>00122             pu-&gt;Data4[5], pu-&gt;Data4[6], pu-&gt;Data4[7]);
<a name="l00123"></a>00123       }
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125   }
<a name="l00126"></a>00126   <span class="keywordflow">if</span> (got_uuid == 0) {          <span class="comment">// did not make a UUID - use fallback logic</span>
<a name="l00127"></a>00127     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> b[16];
<a name="l00128"></a>00128     time_t t = time(0);         <span class="comment">// first 4 byte</span>
<a name="l00129"></a>00129     b[0] = (<span class="keywordtype">unsigned</span> char)t;
<a name="l00130"></a>00130     b[1] = (<span class="keywordtype">unsigned</span> char)(t&gt;&gt;8);
<a name="l00131"></a>00131     b[2] = (<span class="keywordtype">unsigned</span> char)(t&gt;&gt;16);
<a name="l00132"></a>00132     b[3] = (<span class="keywordtype">unsigned</span> char)(t&gt;&gt;24);
<a name="l00133"></a>00133     <span class="keywordtype">int</span> r = rand();             <span class="comment">// four more bytes</span>
<a name="l00134"></a>00134     b[4] = (<span class="keywordtype">unsigned</span> char)r;
<a name="l00135"></a>00135     b[5] = (<span class="keywordtype">unsigned</span> char)(r&gt;&gt;8);
<a name="l00136"></a>00136     b[6] = (<span class="keywordtype">unsigned</span> char)(r&gt;&gt;16);
<a name="l00137"></a>00137     b[7] = (<span class="keywordtype">unsigned</span> char)(r&gt;&gt;24);
<a name="l00138"></a>00138     <span class="comment">// Now we try to find 4 more &quot;random&quot; bytes. We extract the</span>
<a name="l00139"></a>00139     <span class="comment">// lower 4 bytes from the address of t - it is created on the</span>
<a name="l00140"></a>00140     <span class="comment">// stack so *might* be in a different place each time...</span>
<a name="l00141"></a>00141     <span class="comment">// This is now done via a union to make it compile OK on 64-bit systems.</span>
<a name="l00142"></a>00142     <span class="keyword">union </span>{ <span class="keywordtype">void</span> *pv; <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> a[<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*)]; } v;
<a name="l00143"></a>00143     v.pv = (<span class="keywordtype">void</span> *)(&amp;t);
<a name="l00144"></a>00144     <span class="comment">// NOTE: This assume that all WinXX systems are little-endian</span>
<a name="l00145"></a>00145     b[8] = v.a[0];
<a name="l00146"></a>00146     b[9] = v.a[1];
<a name="l00147"></a>00147     b[10] = v.a[2];
<a name="l00148"></a>00148     b[11] = v.a[3];
<a name="l00149"></a>00149     TCHAR <a class="code" href="classFl__Preferences.html#a6ff11b679bec179ebb211c31f8e46f2e">name</a>[MAX_COMPUTERNAME_LENGTH + 1]; <span class="comment">// only used to make last four bytes</span>
<a name="l00150"></a>00150     DWORD nSize = MAX_COMPUTERNAME_LENGTH + 1;
<a name="l00151"></a>00151     <span class="comment">// GetComputerName() does not depend on any extra libs, and returns something</span>
<a name="l00152"></a>00152     <span class="comment">// analogous to gethostname()</span>
<a name="l00153"></a>00153     GetComputerName(name, &amp;nSize);
<a name="l00154"></a>00154     <span class="comment">//  use the first 4 TCHAR&#39;s of the name to create the last 4 bytes of our UUID</span>
<a name="l00155"></a>00155     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii = 0; ii &lt; 4; ii++) {
<a name="l00156"></a>00156       b[12 + ii] = (<span class="keywordtype">unsigned</span> char)name[ii];
<a name="l00157"></a>00157     }
<a name="l00158"></a>00158     sprintf(uuidBuffer, <span class="stringliteral">&quot;%02X%02X%02X%02X-%02X%02X-%02X%02X-%02X%02X-%02X%02X%02X%02X%02X%02X&quot;</span>,
<a name="l00159"></a>00159             b[0], b[1], b[2], b[3], b[4], b[5], b[6], b[7],
<a name="l00160"></a>00160             b[8], b[9], b[10], b[11], b[12], b[13], b[14], b[15]);
<a name="l00161"></a>00161   }
<a name="l00162"></a>00162 <span class="preprocessor">#else</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>  <span class="comment">// warning Unix implementation of Fl_Preferences::newUUID() incomplete!</span>
<a name="l00164"></a>00164   <span class="comment">// #include &lt;uuid/uuid.h&gt;</span>
<a name="l00165"></a>00165   <span class="comment">// void uuid_generate(uuid_t out);</span>
<a name="l00166"></a>00166   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> b[16];
<a name="l00167"></a>00167   time_t t = time(0);                   <span class="comment">// first 4 byte</span>
<a name="l00168"></a>00168   b[0] = (<span class="keywordtype">unsigned</span> char)t;
<a name="l00169"></a>00169   b[1] = (<span class="keywordtype">unsigned</span> char)(t&gt;&gt;8);
<a name="l00170"></a>00170   b[2] = (<span class="keywordtype">unsigned</span> char)(t&gt;&gt;16);
<a name="l00171"></a>00171   b[3] = (<span class="keywordtype">unsigned</span> char)(t&gt;&gt;24);
<a name="l00172"></a>00172   <span class="keywordtype">int</span> r = rand();                       <span class="comment">// four more bytes</span>
<a name="l00173"></a>00173   b[4] = (<span class="keywordtype">unsigned</span> char)r;
<a name="l00174"></a>00174   b[5] = (<span class="keywordtype">unsigned</span> char)(r&gt;&gt;8);
<a name="l00175"></a>00175   b[6] = (<span class="keywordtype">unsigned</span> char)(r&gt;&gt;16);
<a name="l00176"></a>00176   b[7] = (<span class="keywordtype">unsigned</span> char)(r&gt;&gt;24);
<a name="l00177"></a>00177   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> a = (<span class="keywordtype">unsigned</span> long)&amp;t;  <span class="comment">// four more bytes</span>
<a name="l00178"></a>00178   b[8] = (<span class="keywordtype">unsigned</span> char)a;
<a name="l00179"></a>00179   b[9] = (<span class="keywordtype">unsigned</span> char)(a&gt;&gt;8);
<a name="l00180"></a>00180   b[10] = (<span class="keywordtype">unsigned</span> char)(a&gt;&gt;16);
<a name="l00181"></a>00181   b[11] = (<span class="keywordtype">unsigned</span> char)(a&gt;&gt;24);
<a name="l00182"></a>00182   <span class="comment">// Now we try to find 4 more &quot;random&quot; bytes. We extract the</span>
<a name="l00183"></a>00183   <span class="comment">// lower 4 bytes from the address of t - it is created on the</span>
<a name="l00184"></a>00184   <span class="comment">// stack so *might* be in a different place each time...</span>
<a name="l00185"></a>00185   <span class="comment">// This is now done via a union to make it compile OK on 64-bit systems.</span>
<a name="l00186"></a>00186   <span class="keyword">union </span>{ <span class="keywordtype">void</span> *pv; <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> a[<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*)]; } v;
<a name="l00187"></a>00187   v.pv = (<span class="keywordtype">void</span> *)(&amp;t);
<a name="l00188"></a>00188   <span class="comment">// NOTE: May need to handle big- or little-endian systems here</span>
<a name="l00189"></a>00189 <span class="preprocessor"># if WORDS_BIGENDIAN</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>  b[8] = v.a[<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*) - 1];
<a name="l00191"></a>00191   b[9] = v.a[<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*) - 2];
<a name="l00192"></a>00192   b[10] = v.a[<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*) - 3];
<a name="l00193"></a>00193   b[11] = v.a[<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*) - 4];
<a name="l00194"></a>00194 <span class="preprocessor"># else </span><span class="comment">/* data ordered for a little-endian system */</span>
<a name="l00195"></a>00195   b[8] = v.a[0];
<a name="l00196"></a>00196   b[9] = v.a[1];
<a name="l00197"></a>00197   b[10] = v.a[2];
<a name="l00198"></a>00198   b[11] = v.a[3];
<a name="l00199"></a>00199 <span class="preprocessor"># endif</span>
<a name="l00200"></a>00200 <span class="preprocessor"></span>  <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a6ff11b679bec179ebb211c31f8e46f2e">name</a>[80];                        <span class="comment">// last four bytes</span>
<a name="l00201"></a>00201   gethostname(name, 79);
<a name="l00202"></a>00202   memcpy(b+12, name, 4);
<a name="l00203"></a>00203   sprintf(uuidBuffer, <span class="stringliteral">&quot;%02X%02X%02X%02X-%02X%02X-%02X%02X-%02X%02X-%02X%02X%02X%02X%02X%02X&quot;</span>,
<a name="l00204"></a>00204           b[0], b[1], b[2], b[3], b[4], b[5], b[6], b[7],
<a name="l00205"></a>00205           b[8], b[9], b[10], b[11], b[12], b[13], b[14], b[15]);
<a name="l00206"></a>00206 <span class="preprocessor">#endif</span>
<a name="l00207"></a>00207 <span class="preprocessor"></span>
<a name="l00208"></a>00208   <span class="keywordflow">return</span> uuidBuffer;
<a name="l00209"></a>00209 }
<a name="l00210"></a>00210 
<a name="l00237"></a><a class="code" href="classFl__Preferences.html#af8418ff8af933d22dbb70a082525a74e">00237</a> <a class="code" href="classFl__Preferences.html#af8418ff8af933d22dbb70a082525a74e">Fl_Preferences::Fl_Preferences</a>( <a class="code" href="classFl__Preferences.html#a0947b73d778ca66b9fbb97b75bbbd7cb">Root</a> root, <span class="keyword">const</span> <span class="keywordtype">char</span> *vendor, <span class="keyword">const</span> <span class="keywordtype">char</span> *application ) {
<a name="l00238"></a>00238   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> = <span class="keyword">new</span> <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a>( <span class="stringliteral">&quot;.&quot;</span> );
<a name="l00239"></a>00239   <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a> = <span class="keyword">new</span> <a class="code" href="classFl__Preferences.html#a3bb397989a4485545d4d65709ce3c863">RootNode</a>( <span class="keyword">this</span>, root, vendor, application );
<a name="l00240"></a>00240   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;setRoot(<a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a>);
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 
<a name="l00255"></a><a class="code" href="classFl__Preferences.html#a7e2ec1496b7eb3cc5b2b9e8f6584c979">00255</a> <a class="code" href="classFl__Preferences.html#af8418ff8af933d22dbb70a082525a74e">Fl_Preferences::Fl_Preferences</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keyword">const</span> <span class="keywordtype">char</span> *vendor, <span class="keyword">const</span> <span class="keywordtype">char</span> *application ) {
<a name="l00256"></a>00256   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> = <span class="keyword">new</span> <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a>( <span class="stringliteral">&quot;.&quot;</span> );
<a name="l00257"></a>00257   <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a> = <span class="keyword">new</span> <a class="code" href="classFl__Preferences.html#a3bb397989a4485545d4d65709ce3c863">RootNode</a>( <span class="keyword">this</span>, path, vendor, application );
<a name="l00258"></a>00258   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;setRoot(<a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a>);
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00271"></a><a class="code" href="classFl__Preferences.html#a44b60d610214f1ff60e9603babdea664">00271</a> <a class="code" href="classFl__Preferences.html#af8418ff8af933d22dbb70a082525a74e">Fl_Preferences::Fl_Preferences</a>( <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> &amp;parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *group ) {
<a name="l00272"></a>00272   <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a> = parent.<a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a>;
<a name="l00273"></a>00273   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> = parent.<a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;addChild( group );
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00286"></a><a class="code" href="classFl__Preferences.html#a402ba68241bfefeabcd3665613d81607">00286</a> <a class="code" href="classFl__Preferences.html#af8418ff8af933d22dbb70a082525a74e">Fl_Preferences::Fl_Preferences</a>( <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> *parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *group ) {
<a name="l00287"></a>00287   <span class="keywordflow">if</span> (parent==0) {
<a name="l00288"></a>00288     <span class="keywordflow">if</span> (!runtimePrefs) {
<a name="l00289"></a>00289       runtimePrefs = <span class="keyword">new</span> <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a>();
<a name="l00290"></a>00290       runtimePrefs-&gt;<a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> = <span class="keyword">new</span> <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a>( <span class="stringliteral">&quot;.&quot;</span> );
<a name="l00291"></a>00291       runtimePrefs-&gt;<a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a> = <span class="keyword">new</span> <a class="code" href="classFl__Preferences.html#a3bb397989a4485545d4d65709ce3c863">RootNode</a>( runtimePrefs );
<a name="l00292"></a>00292       runtimePrefs-&gt;<a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;setRoot(<a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a>);
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294     parent = runtimePrefs;
<a name="l00295"></a>00295   }
<a name="l00296"></a>00296   <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a> = parent-&gt;<a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a>;
<a name="l00297"></a>00297   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> = parent-&gt;<a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;addChild( group );
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 
<a name="l00313"></a><a class="code" href="classFl__Preferences.html#ac87308454632a4c0a9feb040f42a1a39">00313</a> <a class="code" href="classFl__Preferences.html#af8418ff8af933d22dbb70a082525a74e">Fl_Preferences::Fl_Preferences</a>( <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> &amp;parent, <span class="keywordtype">int</span> groupIndex ) {
<a name="l00314"></a>00314   <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a> = parent.<a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a>;
<a name="l00315"></a>00315   <span class="keywordflow">if</span> (groupIndex&lt;0 || groupIndex&gt;=parent.<a class="code" href="classFl__Preferences.html#a70cfbe5245270b772806e085603a7ab8">groups</a>()) {
<a name="l00316"></a>00316     <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> = parent.<a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;addChild( <a class="code" href="classFl__Preferences.html#ae357c2136fce436e367b92c0337a4778">newUUID</a>() );
<a name="l00317"></a>00317   } <span class="keywordflow">else</span> {
<a name="l00318"></a>00318     <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> = parent.<a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;childNode( groupIndex );
<a name="l00319"></a>00319   }
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00325"></a><a class="code" href="classFl__Preferences.html#a20b8a66cd9fda6f727e391847653c4df">00325</a> <a class="code" href="classFl__Preferences.html#af8418ff8af933d22dbb70a082525a74e">Fl_Preferences::Fl_Preferences</a>( <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> *parent, <span class="keywordtype">int</span> groupIndex ) {
<a name="l00326"></a>00326   <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a> = parent-&gt;<a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a>;
<a name="l00327"></a>00327   <span class="keywordflow">if</span> (groupIndex&lt;0 || groupIndex&gt;=parent-&gt;<a class="code" href="classFl__Preferences.html#a70cfbe5245270b772806e085603a7ab8">groups</a>()) {
<a name="l00328"></a>00328     <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> = parent-&gt;<a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;addChild( <a class="code" href="classFl__Preferences.html#ae357c2136fce436e367b92c0337a4778">newUUID</a>() );
<a name="l00329"></a>00329   } <span class="keywordflow">else</span> {
<a name="l00330"></a>00330     <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> = parent-&gt;<a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;childNode( groupIndex );
<a name="l00331"></a>00331   }
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00345"></a><a class="code" href="classFl__Preferences.html#ae2811816dd028d35d8b6b1cafd4f2e44">00345</a> <a class="code" href="classFl__Preferences.html#af8418ff8af933d22dbb70a082525a74e">Fl_Preferences::Fl_Preferences</a>( <a class="code" href="classFl__Preferences.html#a7050f8b1c0cbb70693e61bcfbf4f5853">Fl_Preferences::ID</a> <span class="keywordtype">id</span> ) {
<a name="l00346"></a>00346   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> = (<a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a>*)<span class="keywordtype">id</span>;
<a name="l00347"></a>00347   <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a> = <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;findRoot();
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00353"></a><a class="code" href="classFl__Preferences.html#a49a5569fb0b4f270ff8b343f34d11eac">00353</a> <a class="code" href="classFl__Preferences.html#af8418ff8af933d22dbb70a082525a74e">Fl_Preferences::Fl_Preferences</a>(<span class="keyword">const</span> <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> &amp;rhs)
<a name="l00354"></a>00354 : node(rhs.node),
<a name="l00355"></a>00355   rootNode(rhs.rootNode)
<a name="l00356"></a>00356 { }
<a name="l00357"></a>00357 
<a name="l00361"></a>00361 <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> &amp;Fl_Preferences::operator=(<span class="keyword">const</span> <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> &amp;rhs) {
<a name="l00362"></a>00362   <span class="keywordflow">if</span> (&amp;rhs != <span class="keyword">this</span>) {
<a name="l00363"></a>00363     <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> = rhs.<a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>;
<a name="l00364"></a>00364     <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a> = rhs.<a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a>;
<a name="l00365"></a>00365   }
<a name="l00366"></a>00366   <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00367"></a>00367 }
<a name="l00368"></a>00368 
<a name="l00378"></a><a class="code" href="classFl__Preferences.html#a0eb024a8350c344303755fedb1582185">00378</a> <a class="code" href="classFl__Preferences.html#a0eb024a8350c344303755fedb1582185">Fl_Preferences::~Fl_Preferences</a>() {
<a name="l00379"></a>00379   <span class="keywordflow">if</span> (<a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> &amp;&amp; !<a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;parent()) <span class="keyword">delete</span> <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a>;
<a name="l00380"></a>00380   <span class="comment">// DO NOT delete nodes! The root node will do that after writing the preferences</span>
<a name="l00381"></a>00381   <span class="comment">// zero all pointer to avoid memory errors, even though</span>
<a name="l00382"></a>00382   <span class="comment">// Valgrind does not complain (Cygwind does though)</span>
<a name="l00383"></a>00383   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a> = 0L;
<a name="l00384"></a>00384   <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a> = 0L;
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 
<a name="l00392"></a><a class="code" href="classFl__Preferences.html#a70cfbe5245270b772806e085603a7ab8">00392</a> <span class="keywordtype">int</span> <a class="code" href="classFl__Preferences.html#a70cfbe5245270b772806e085603a7ab8">Fl_Preferences::groups</a>() {
<a name="l00393"></a>00393   <span class="keywordflow">return</span> <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;nChildren();
<a name="l00394"></a>00394 }
<a name="l00395"></a>00395 
<a name="l00404"></a><a class="code" href="classFl__Preferences.html#a8aeb2bab88aea893c700533c5dea3d41">00404</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classFl__Preferences.html#a8aeb2bab88aea893c700533c5dea3d41">Fl_Preferences::group</a>( <span class="keywordtype">int</span> num_group ) {
<a name="l00405"></a>00405   <span class="keywordflow">return</span> <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;child( num_group );
<a name="l00406"></a>00406 }
<a name="l00407"></a>00407 
<a name="l00417"></a><a class="code" href="classFl__Preferences.html#a4009efec7d5505a8060ca7a95c1bee2e">00417</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a4009efec7d5505a8060ca7a95c1bee2e">Fl_Preferences::groupExists</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a> ) {
<a name="l00418"></a>00418   <span class="keywordflow">return</span> <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;search( key ) ? 1 : 0 ;
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 
<a name="l00430"></a><a class="code" href="classFl__Preferences.html#a6602c3104b2c5259160cb7e0fe5dd335">00430</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a6602c3104b2c5259160cb7e0fe5dd335">Fl_Preferences::deleteGroup</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *group ) {
<a name="l00431"></a>00431   <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nd = <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;search( group );
<a name="l00432"></a>00432   <span class="keywordflow">if</span> ( nd ) <span class="keywordflow">return</span> nd-&gt;remove();
<a name="l00433"></a>00433   <span class="keywordflow">return</span> 0;
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00439"></a><a class="code" href="classFl__Preferences.html#a9d7563cd64c29348cd5c4d4c14e97614">00439</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a9d7563cd64c29348cd5c4d4c14e97614">Fl_Preferences::deleteAllGroups</a>() {
<a name="l00440"></a>00440   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;deleteAllChildren();
<a name="l00441"></a>00441   <span class="keywordflow">return</span> 1;
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00449"></a><a class="code" href="classFl__Preferences.html#a9004c55f8c0c9515943b96853ea17940">00449</a> <span class="keywordtype">int</span> <a class="code" href="classFl__Preferences.html#a9004c55f8c0c9515943b96853ea17940">Fl_Preferences::entries</a>() {
<a name="l00450"></a>00450   <span class="keywordflow">return</span> <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;nEntry();
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00461"></a><a class="code" href="classFl__Preferences.html#a61bd91e8c3ee2a3f8bccd00ee2a65b8d">00461</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classFl__Preferences.html#a61bd91e8c3ee2a3f8bccd00ee2a65b8d">Fl_Preferences::entry</a>( <span class="keywordtype">int</span> index ) {
<a name="l00462"></a>00462   <span class="keywordflow">return</span> <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;entry(index).name;
<a name="l00463"></a>00463 }
<a name="l00464"></a>00464 
<a name="l00471"></a><a class="code" href="classFl__Preferences.html#a05c3d7cbf364d5d1ed350ef33850f702">00471</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a05c3d7cbf364d5d1ed350ef33850f702">Fl_Preferences::entryExists</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a> ) {
<a name="l00472"></a>00472   <span class="keywordflow">return</span> <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;getEntry( key )&gt;=0 ? 1 : 0 ;
<a name="l00473"></a>00473 }
<a name="l00474"></a>00474 
<a name="l00483"></a><a class="code" href="classFl__Preferences.html#a3a1710633307e8e79ba8fd89a803042e">00483</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a3a1710633307e8e79ba8fd89a803042e">Fl_Preferences::deleteEntry</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a> ) {
<a name="l00484"></a>00484   <span class="keywordflow">return</span> <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;deleteEntry( key );
<a name="l00485"></a>00485 }
<a name="l00486"></a>00486 
<a name="l00490"></a><a class="code" href="classFl__Preferences.html#af73078b80334cc3f43542f4862de402b">00490</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#af73078b80334cc3f43542f4862de402b">Fl_Preferences::deleteAllEntries</a>() {
<a name="l00491"></a>00491   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;deleteAllEntries();
<a name="l00492"></a>00492   <span class="keywordflow">return</span> 1;
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494 
<a name="l00498"></a><a class="code" href="classFl__Preferences.html#ae0fc8533d4cfb2d8c7e67b71b7080129">00498</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#ae0fc8533d4cfb2d8c7e67b71b7080129">Fl_Preferences::clear</a>() {
<a name="l00499"></a>00499   <span class="keywordtype">char</span> ret1 = <a class="code" href="classFl__Preferences.html#a9d7563cd64c29348cd5c4d4c14e97614">deleteAllGroups</a>();
<a name="l00500"></a>00500   <span class="keywordtype">char</span> ret2 = <a class="code" href="classFl__Preferences.html#af73078b80334cc3f43542f4862de402b">deleteAllEntries</a>();
<a name="l00501"></a>00501   <span class="keywordflow">return</span> ret1 &amp; ret2;
<a name="l00502"></a>00502 }
<a name="l00503"></a>00503 
<a name="l00514"></a><a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">00514</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">Fl_Preferences::get</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">int</span> &amp;<a class="code" href="png_8h.html#a58342413057d091672287c7522a6137f">value</a>, <span class="keywordtype">int</span> defaultValue ) {
<a name="l00515"></a>00515   <span class="keyword">const</span> <span class="keywordtype">char</span> *v = <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;get( key );
<a name="l00516"></a>00516   value = v ? atoi( v ) : defaultValue;
<a name="l00517"></a>00517   <span class="keywordflow">return</span> ( v != 0 );
<a name="l00518"></a>00518 }
<a name="l00519"></a>00519 
<a name="l00530"></a><a class="code" href="classFl__Preferences.html#a1928e8ca3f21f66304951b757f24d70a">00530</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a1928e8ca3f21f66304951b757f24d70a">Fl_Preferences::set</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">int</span> <a class="code" href="png_8h.html#a58342413057d091672287c7522a6137f">value</a> ) {
<a name="l00531"></a>00531   sprintf( nameBuffer, <span class="stringliteral">&quot;%d&quot;</span>, value );
<a name="l00532"></a>00532   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;set( key, nameBuffer );
<a name="l00533"></a>00533   <span class="keywordflow">return</span> 1;
<a name="l00534"></a>00534 }
<a name="l00535"></a>00535 
<a name="l00546"></a><a class="code" href="classFl__Preferences.html#a128339abc1a1ff6bca073de3a62b2cb3">00546</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">Fl_Preferences::get</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">float</span> &amp;<a class="code" href="png_8h.html#a58342413057d091672287c7522a6137f">value</a>, <span class="keywordtype">float</span> defaultValue ) {
<a name="l00547"></a>00547   <span class="keyword">const</span> <span class="keywordtype">char</span> *v = <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;get( key );
<a name="l00548"></a>00548   value = v ? (float)atof( v ) : defaultValue;
<a name="l00549"></a>00549   <span class="keywordflow">return</span> ( v != 0 );
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00562"></a><a class="code" href="classFl__Preferences.html#a3d06e7b756a9c87acc508b835286d569">00562</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a1928e8ca3f21f66304951b757f24d70a">Fl_Preferences::set</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">float</span> <a class="code" href="png_8h.html#a58342413057d091672287c7522a6137f">value</a> ) {
<a name="l00563"></a>00563   sprintf( nameBuffer, <span class="stringliteral">&quot;%g&quot;</span>, value );
<a name="l00564"></a>00564   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;set( key, nameBuffer );
<a name="l00565"></a>00565   <span class="keywordflow">return</span> 1;
<a name="l00566"></a>00566 }
<a name="l00567"></a>00567 
<a name="l00579"></a><a class="code" href="classFl__Preferences.html#a8bd606d0dd993488d149204ee0841925">00579</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a1928e8ca3f21f66304951b757f24d70a">Fl_Preferences::set</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">float</span> <a class="code" href="png_8h.html#a58342413057d091672287c7522a6137f">value</a>, <span class="keywordtype">int</span> precision ) {
<a name="l00580"></a>00580   sprintf( nameBuffer, <span class="stringliteral">&quot;%.*g&quot;</span>, precision, value );
<a name="l00581"></a>00581   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;set( key, nameBuffer );
<a name="l00582"></a>00582   <span class="keywordflow">return</span> 1;
<a name="l00583"></a>00583 }
<a name="l00584"></a>00584 
<a name="l00595"></a><a class="code" href="classFl__Preferences.html#a0d71373c6af5199bc1bb1fb955cb3a64">00595</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">Fl_Preferences::get</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">double</span> &amp;<a class="code" href="png_8h.html#a58342413057d091672287c7522a6137f">value</a>, <span class="keywordtype">double</span> defaultValue ) {
<a name="l00596"></a>00596   <span class="keyword">const</span> <span class="keywordtype">char</span> *v = <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;get( key );
<a name="l00597"></a>00597   value = v ? atof( v ) : defaultValue;
<a name="l00598"></a>00598   <span class="keywordflow">return</span> ( v != 0 );
<a name="l00599"></a>00599 }
<a name="l00600"></a>00600 
<a name="l00611"></a><a class="code" href="classFl__Preferences.html#a929db63f2f0d24d11c64ee929688b39e">00611</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a1928e8ca3f21f66304951b757f24d70a">Fl_Preferences::set</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">double</span> <a class="code" href="png_8h.html#a58342413057d091672287c7522a6137f">value</a> ) {
<a name="l00612"></a>00612   sprintf( nameBuffer, <span class="stringliteral">&quot;%g&quot;</span>, value );
<a name="l00613"></a>00613   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;set( key, nameBuffer );
<a name="l00614"></a>00614   <span class="keywordflow">return</span> 1;
<a name="l00615"></a>00615 }
<a name="l00616"></a>00616 
<a name="l00628"></a><a class="code" href="classFl__Preferences.html#a0b2d3935a8ba462d27d0e3c2c9e33841">00628</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a1928e8ca3f21f66304951b757f24d70a">Fl_Preferences::set</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">double</span> <a class="code" href="png_8h.html#a58342413057d091672287c7522a6137f">value</a>, <span class="keywordtype">int</span> precision ) {
<a name="l00629"></a>00629   sprintf( nameBuffer, <span class="stringliteral">&quot;%.*g&quot;</span>, precision, value );
<a name="l00630"></a>00630   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;set( key, nameBuffer );
<a name="l00631"></a>00631   <span class="keywordflow">return</span> 1;
<a name="l00632"></a>00632 }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634 <span class="comment">// remove control sequences from a string</span>
<a name="l00635"></a>00635 <span class="keyword">static</span> <span class="keywordtype">char</span> *decodeText( <span class="keyword">const</span> <span class="keywordtype">char</span> *src ) {
<a name="l00636"></a>00636   <span class="keywordtype">int</span> len = 0;
<a name="l00637"></a>00637   <span class="keyword">const</span> <span class="keywordtype">char</span> *s = src;
<a name="l00638"></a>00638   <span class="keywordflow">for</span> ( ; *s; s++, len++ ) {
<a name="l00639"></a>00639     <span class="keywordflow">if</span> ( *s == <span class="charliteral">&#39;\\&#39;</span> ) {
<a name="l00640"></a>00640       <span class="keywordflow">if</span> ( isdigit( s[1] ) ) {
<a name="l00641"></a>00641         s+=3; 
<a name="l00642"></a>00642       } <span class="keywordflow">else</span> { 
<a name="l00643"></a>00643         s+=1;
<a name="l00644"></a>00644       }
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646   }
<a name="l00647"></a>00647   <span class="keywordtype">char</span> *dst = (<span class="keywordtype">char</span>*)malloc( len+1 ), *d = dst;
<a name="l00648"></a>00648   <span class="keywordflow">for</span> ( s = src; *s; s++ ) {
<a name="l00649"></a>00649     <span class="keywordtype">char</span> c = *s;
<a name="l00650"></a>00650     <span class="keywordflow">if</span> ( c == <span class="charliteral">&#39;\\&#39;</span> ) {
<a name="l00651"></a>00651       <span class="keywordflow">if</span> ( s[1] == <span class="charliteral">&#39;\\&#39;</span> ) { *d++ = c; s++; }
<a name="l00652"></a>00652       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( s[1] == <span class="charliteral">&#39;n&#39;</span> ) { *d++ = <span class="charliteral">&#39;\n&#39;</span>; s++; }
<a name="l00653"></a>00653       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( s[1] == <span class="charliteral">&#39;r&#39;</span> ) { *d++ = <span class="charliteral">&#39;\r&#39;</span>; s++; }
<a name="l00654"></a>00654       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isdigit( s[1] ) ) { *d++ = ((s[1]-<span class="charliteral">&#39;0&#39;</span>)&lt;&lt;6) + ((s[2]-<span class="charliteral">&#39;0&#39;</span>)&lt;&lt;3) + (s[3]-<span class="charliteral">&#39;0&#39;</span>); s+=3; }
<a name="l00655"></a>00655       <span class="keywordflow">else</span> s++; <span class="comment">// error</span>
<a name="l00656"></a>00656     }
<a name="l00657"></a>00657     <span class="keywordflow">else</span>
<a name="l00658"></a>00658       *d++ = c;
<a name="l00659"></a>00659   }
<a name="l00660"></a>00660   *d = 0;
<a name="l00661"></a>00661   <span class="keywordflow">return</span> dst;
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00677"></a><a class="code" href="classFl__Preferences.html#a1074a165aa35687955568c7a13ba1462">00677</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">Fl_Preferences::get</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">char</span> *text, <span class="keyword">const</span> <span class="keywordtype">char</span> *defaultValue, <span class="keywordtype">int</span> maxSize ) {
<a name="l00678"></a>00678   <span class="keyword">const</span> <span class="keywordtype">char</span> *v = <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;get( key );
<a name="l00679"></a>00679   <span class="keywordflow">if</span> ( v &amp;&amp; strchr( v, <span class="charliteral">&#39;\\&#39;</span> ) ) {
<a name="l00680"></a>00680     <span class="keywordtype">char</span> *<a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a> = decodeText( v );
<a name="l00681"></a>00681     <a class="code" href="flstring_8h.html#a61ae5a0c7536d81d0fb52661f75254cb">strlcpy</a>(text, w, maxSize);
<a name="l00682"></a>00682     free( w );
<a name="l00683"></a>00683     <span class="keywordflow">return</span> 1;
<a name="l00684"></a>00684   }
<a name="l00685"></a>00685   <span class="keywordflow">if</span> ( !v ) v = defaultValue;
<a name="l00686"></a>00686   <span class="keywordflow">if</span> ( v ) <a class="code" href="flstring_8h.html#a61ae5a0c7536d81d0fb52661f75254cb">strlcpy</a>(text, v, maxSize);
<a name="l00687"></a>00687   <span class="keywordflow">else</span> text = 0;
<a name="l00688"></a>00688   <span class="keywordflow">return</span> ( v != defaultValue );
<a name="l00689"></a>00689 }
<a name="l00690"></a>00690 
<a name="l00703"></a><a class="code" href="classFl__Preferences.html#a30e9d1ae031b06f501779c8937533740">00703</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">Fl_Preferences::get</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">char</span> *&amp;text, <span class="keyword">const</span> <span class="keywordtype">char</span> *defaultValue ) {
<a name="l00704"></a>00704   <span class="keyword">const</span> <span class="keywordtype">char</span> *v = <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;get( key );
<a name="l00705"></a>00705   <span class="keywordflow">if</span> ( v &amp;&amp; strchr( v, <span class="charliteral">&#39;\\&#39;</span> ) ) {
<a name="l00706"></a>00706     text = decodeText( v );
<a name="l00707"></a>00707     <span class="keywordflow">return</span> 1;
<a name="l00708"></a>00708   }
<a name="l00709"></a>00709   <span class="keywordflow">if</span> ( !v ) v = defaultValue;
<a name="l00710"></a>00710   <span class="keywordflow">if</span> ( v )
<a name="l00711"></a>00711     text = strdup( v );
<a name="l00712"></a>00712   <span class="keywordflow">else</span>
<a name="l00713"></a>00713     text = 0;
<a name="l00714"></a>00714   <span class="keywordflow">return</span> ( v != defaultValue );
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00727"></a><a class="code" href="classFl__Preferences.html#a1bbc84064bf5f2675b10724567505fd5">00727</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a1928e8ca3f21f66304951b757f24d70a">Fl_Preferences::set</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *text ) {
<a name="l00728"></a>00728   <span class="keyword">const</span> <span class="keywordtype">char</span> *s = text ? text : <span class="stringliteral">&quot;&quot;</span>;
<a name="l00729"></a>00729   <span class="keywordtype">int</span> n=0, ns=0;
<a name="l00730"></a>00730   <span class="keywordflow">for</span> ( ; *s; s++ ) { n++; <span class="keywordflow">if</span> ( *s&lt;32 || *s==<span class="charliteral">&#39;\\&#39;</span> || *s==0x7f ) ns+=4; }
<a name="l00731"></a>00731   <span class="keywordflow">if</span> ( ns ) {
<a name="l00732"></a>00732     <span class="keywordtype">char</span> *<a class="code" href="png_8h.html#ae666dd7e2f504034709280abeac7616e">buffer</a> = (<span class="keywordtype">char</span>*)malloc( n+ns+1 ), *d = buffer;
<a name="l00733"></a>00733     <span class="keywordflow">for</span> ( s=text; *s; ) {
<a name="l00734"></a>00734       <span class="keywordtype">char</span> c = *s;
<a name="l00735"></a>00735       <span class="keywordflow">if</span> ( c==<span class="charliteral">&#39;\\&#39;</span> ) { *d++ = <span class="charliteral">&#39;\\&#39;</span>; *d++ = <span class="charliteral">&#39;\\&#39;</span>; s++; }
<a name="l00736"></a>00736       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( c==<span class="charliteral">&#39;\n&#39;</span> ) { *d++ = <span class="charliteral">&#39;\\&#39;</span>; *d++ = <span class="charliteral">&#39;n&#39;</span>; s++; }
<a name="l00737"></a>00737       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( c==<span class="charliteral">&#39;\r&#39;</span> ) { *d++ = <span class="charliteral">&#39;\\&#39;</span>; *d++ = <span class="charliteral">&#39;r&#39;</span>; s++; }
<a name="l00738"></a>00738       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( c&lt;32 || c==0x7f )
<a name="l00739"></a>00739         { *d++ = <span class="charliteral">&#39;\\&#39;</span>; *d++ = <span class="charliteral">&#39;0&#39;</span>+((c&gt;&gt;6)&amp;3); *d++ = <span class="charliteral">&#39;0&#39;</span>+((c&gt;&gt;3)&amp;7); *d++ = <span class="charliteral">&#39;0&#39;</span>+(c&amp;7);  s++; }
<a name="l00740"></a>00740       <span class="keywordflow">else</span> *d++ = *s++;
<a name="l00741"></a>00741     }
<a name="l00742"></a>00742     *d = 0;
<a name="l00743"></a>00743     <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;set( key, buffer );
<a name="l00744"></a>00744     free( buffer );
<a name="l00745"></a>00745   }
<a name="l00746"></a>00746   <span class="keywordflow">else</span>
<a name="l00747"></a>00747     <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;set( key, text );
<a name="l00748"></a>00748   <span class="keywordflow">return</span> 1;
<a name="l00749"></a>00749 }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751 <span class="comment">// convert a hex string to binary data</span>
<a name="l00752"></a>00752 <span class="keyword">static</span> <span class="keywordtype">void</span> *decodeHex( <span class="keyword">const</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">int</span> &amp;<a class="code" href="png_8h.html#a43291b8493b637821dec145c4bb1503d">size</a> ) {
<a name="l00753"></a>00753   size = strlen( src )/2;
<a name="l00754"></a>00754   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)malloc( size ), *d = <a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a>;
<a name="l00755"></a>00755   <span class="keyword">const</span> <span class="keywordtype">char</span> *s = src;
<a name="l00756"></a>00756   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>=size; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>&gt;0; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>-- ) {
<a name="l00757"></a>00757     <span class="keywordtype">int</span> v;
<a name="l00758"></a>00758     <span class="keywordtype">char</span> <a class="code" href="test_8c.html#a6150e0515f7202e2fb518f7206ed97dc">x</a> = tolower(*s++);
<a name="l00759"></a>00759     <span class="keywordflow">if</span> ( x &gt;= <span class="charliteral">&#39;a&#39;</span> ) v = x-<span class="charliteral">&#39;a&#39;</span>+10; <span class="keywordflow">else</span> v = x-<span class="charliteral">&#39;0&#39;</span>;
<a name="l00760"></a>00760     v = v&lt;&lt;4;
<a name="l00761"></a>00761     x = tolower(*s++);
<a name="l00762"></a>00762     <span class="keywordflow">if</span> ( x &gt;= <span class="charliteral">&#39;a&#39;</span> ) v += x-<span class="charliteral">&#39;a&#39;</span>+10; <span class="keywordflow">else</span> v += x-<span class="charliteral">&#39;0&#39;</span>;
<a name="l00763"></a>00763     *d++ = (<a class="code" href="fl__types_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a>)v;
<a name="l00764"></a>00764   }
<a name="l00765"></a>00765   <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*)<a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a>;
<a name="l00766"></a>00766 }
<a name="l00767"></a>00767 
<a name="l00783"></a><a class="code" href="classFl__Preferences.html#ae909187975eefda3c8bbef494296bc9f">00783</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">Fl_Preferences::get</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keywordtype">void</span> *defaultValue, <span class="keywordtype">int</span> defaultSize, <span class="keywordtype">int</span> maxSize ) {
<a name="l00784"></a>00784   <span class="keyword">const</span> <span class="keywordtype">char</span> *v = <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;get( key );
<a name="l00785"></a>00785   <span class="keywordflow">if</span> ( v ) {
<a name="l00786"></a>00786     <span class="keywordtype">int</span> dsize;
<a name="l00787"></a>00787     <span class="keywordtype">void</span> *<a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a> = decodeHex( v, dsize );
<a name="l00788"></a>00788     memmove( data, w, dsize&gt;maxSize?maxSize:dsize );
<a name="l00789"></a>00789     free( w );
<a name="l00790"></a>00790     <span class="keywordflow">return</span> 1;
<a name="l00791"></a>00791   }
<a name="l00792"></a>00792   <span class="keywordflow">if</span> ( defaultValue )
<a name="l00793"></a>00793     memmove( data, defaultValue, defaultSize&gt;maxSize?maxSize:defaultSize );
<a name="l00794"></a>00794   <span class="keywordflow">return</span> 0;
<a name="l00795"></a>00795 }
<a name="l00796"></a>00796 
<a name="l00810"></a><a class="code" href="classFl__Preferences.html#a4b0188c9976139103b5c49761c8b765a">00810</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">Fl_Preferences::get</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keywordtype">void</span> *&amp;data, <span class="keyword">const</span> <span class="keywordtype">void</span> *defaultValue, <span class="keywordtype">int</span> defaultSize ) {
<a name="l00811"></a>00811   <span class="keyword">const</span> <span class="keywordtype">char</span> *v = <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;get( key );
<a name="l00812"></a>00812   <span class="keywordflow">if</span> ( v ) {
<a name="l00813"></a>00813     <span class="keywordtype">int</span> dsize;
<a name="l00814"></a>00814     data = decodeHex( v, dsize );
<a name="l00815"></a>00815     <span class="keywordflow">return</span> 1;
<a name="l00816"></a>00816   }
<a name="l00817"></a>00817   <span class="keywordflow">if</span> ( defaultValue ) {
<a name="l00818"></a>00818     data = (<span class="keywordtype">void</span>*)malloc( defaultSize );
<a name="l00819"></a>00819     memmove( data, defaultValue, defaultSize );
<a name="l00820"></a>00820   }
<a name="l00821"></a>00821   <span class="keywordflow">else</span>
<a name="l00822"></a>00822     data = 0;
<a name="l00823"></a>00823   <span class="keywordflow">return</span> 0;
<a name="l00824"></a>00824 }
<a name="l00825"></a>00825 
<a name="l00837"></a><a class="code" href="classFl__Preferences.html#acc689e9cdf957f7636992d275498d72b">00837</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a1928e8ca3f21f66304951b757f24d70a">Fl_Preferences::set</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> dsize ) {
<a name="l00838"></a>00838   <span class="keywordtype">char</span> *<a class="code" href="png_8h.html#ae666dd7e2f504034709280abeac7616e">buffer</a> = (<span class="keywordtype">char</span>*)malloc( dsize*2+1 ), *d = buffer;;
<a name="l00839"></a>00839   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *s = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)data;
<a name="l00840"></a>00840   <span class="keywordflow">for</span> ( ; dsize&gt;0; dsize-- ) {
<a name="l00841"></a>00841     <span class="keyword">static</span> <span class="keywordtype">char</span> lu[] = <span class="stringliteral">&quot;0123456789abcdef&quot;</span>;
<a name="l00842"></a>00842     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> v = *s++;
<a name="l00843"></a>00843     *d++ = lu[v&gt;&gt;4];
<a name="l00844"></a>00844     *d++ = lu[v&amp;0xf];
<a name="l00845"></a>00845   }
<a name="l00846"></a>00846   *d = 0;
<a name="l00847"></a>00847   <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;set( key, buffer );
<a name="l00848"></a>00848   free( buffer );
<a name="l00849"></a>00849   <span class="keywordflow">return</span> 1;
<a name="l00850"></a>00850 }
<a name="l00851"></a>00851 
<a name="l00858"></a><a class="code" href="classFl__Preferences.html#aca6793ffe782ad4a55c604caed794ea9">00858</a> <span class="keywordtype">int</span> <a class="code" href="classFl__Preferences.html#aca6793ffe782ad4a55c604caed794ea9">Fl_Preferences::size</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a> ) {
<a name="l00859"></a>00859   <span class="keyword">const</span> <span class="keywordtype">char</span> *v = <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;get( key );
<a name="l00860"></a>00860   <span class="keywordflow">return</span> v ? strlen( v ) : 0 ;
<a name="l00861"></a>00861 }
<a name="l00862"></a>00862 
<a name="l00890"></a><a class="code" href="classFl__Preferences.html#acf3c545a4006ef50b091ed45b6f7ce2a">00890</a> <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#acf3c545a4006ef50b091ed45b6f7ce2a" title="Creates a path that is related to the preferences file and that is usable for additional application ...">Fl_Preferences::getUserdataPath</a>( <span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> pathlen ) {
<a name="l00891"></a>00891   <span class="keywordflow">if</span> ( <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a> )
<a name="l00892"></a>00892     <span class="keywordflow">return</span> <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a>-&gt;getPath( path, pathlen );
<a name="l00893"></a>00893   <span class="keywordflow">return</span> 0;
<a name="l00894"></a>00894 }
<a name="l00895"></a>00895 
<a name="l00901"></a><a class="code" href="classFl__Preferences.html#a4d49e9959bc26fdc20641534497f3792">00901</a> <span class="keywordtype">void</span> <a class="code" href="classFl__Preferences.html#a4d49e9959bc26fdc20641534497f3792">Fl_Preferences::flush</a>() {
<a name="l00902"></a>00902   <span class="keywordflow">if</span> ( <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a> &amp;&amp; <a class="code" href="classFl__Preferences.html#ae5633500be10cea17e2ffb2791f05b6c">node</a>-&gt;dirty() )
<a name="l00903"></a>00903     <a class="code" href="classFl__Preferences.html#a1d05b8bf3baf9255771e7c57aa8620cc">rootNode</a>-&gt;write();
<a name="l00904"></a>00904 }
<a name="l00905"></a>00905 
<a name="l00906"></a>00906 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00907"></a>00907 <span class="comment">// helper class to create dynamic group and entry names on the fly</span>
<a name="l00908"></a>00908 <span class="comment">//</span>
<a name="l00909"></a>00909 
<a name="l00923"></a><a class="code" href="classFl__Preferences_1_1Name.html#a52058bb2af3eadcbb1a95e4fc01e315d">00923</a> <a class="code" href="classFl__Preferences_1_1Name.html#a52058bb2af3eadcbb1a95e4fc01e315d">Fl_Preferences::Name::Name</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n ) {
<a name="l00924"></a>00924   data_ = (<span class="keywordtype">char</span>*)malloc(20);
<a name="l00925"></a>00925   sprintf(data_, <span class="stringliteral">&quot;%u&quot;</span>, n);
<a name="l00926"></a>00926 }
<a name="l00927"></a>00927 
<a name="l00941"></a><a class="code" href="classFl__Preferences_1_1Name.html#a492e9f40be730c22a457ed2e71138211">00941</a> <a class="code" href="classFl__Preferences_1_1Name.html#a52058bb2af3eadcbb1a95e4fc01e315d">Fl_Preferences::Name::Name</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ... ) {
<a name="l00942"></a>00942   data_ = (<span class="keywordtype">char</span>*)malloc(1024);
<a name="l00943"></a>00943   va_list args;
<a name="l00944"></a>00944   va_start(args, format);
<a name="l00945"></a>00945   <a class="code" href="flstring_8h.html#a00ba2ca988495904efc418acbf0627d7">vsnprintf</a>(data_, 1024, format, args);
<a name="l00946"></a>00946   va_end(args);
<a name="l00947"></a>00947 }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949 <span class="comment">// delete the name</span>
<a name="l00950"></a><a class="code" href="classFl__Preferences_1_1Name.html#af0a490fc2ea82403a3bc9d57b5407ffd">00950</a> <a class="code" href="classFl__Preferences_1_1Name.html#af0a490fc2ea82403a3bc9d57b5407ffd">Fl_Preferences::Name::~Name</a>() {
<a name="l00951"></a>00951   <span class="keywordflow">if</span> (data_) {
<a name="l00952"></a>00952     free(data_);
<a name="l00953"></a>00953     data_ = 0L;
<a name="l00954"></a>00954   }
<a name="l00955"></a>00955 }
<a name="l00956"></a>00956 
<a name="l00957"></a>00957 <span class="comment">//-----------------------------------------------------------------------------</span>
<a name="l00958"></a>00958 <span class="comment">// internal methods, do not modify or use as they will change without notice</span>
<a name="l00959"></a>00959 <span class="comment">//</span>
<a name="l00960"></a>00960 
<a name="l00961"></a>00961 <span class="keywordtype">int</span> Fl_Preferences::Node::lastEntrySet = -1;
<a name="l00962"></a>00962 
<a name="l00963"></a>00963 <span class="comment">// recursively create a path in the file system</span>
<a name="l00964"></a>00964 <span class="keyword">static</span> <span class="keywordtype">char</span> makePath( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classFl__Preferences.html#aaf2e1a8f1904abb41f3cfa195ae9df41">path</a> ) {
<a name="l00965"></a>00965   <span class="keywordflow">if</span> (access(path, 0)) {
<a name="l00966"></a>00966     <span class="keyword">const</span> <span class="keywordtype">char</span> *s = strrchr( path, <span class="charliteral">&#39;/&#39;</span> );
<a name="l00967"></a>00967     <span class="keywordflow">if</span> ( !s ) <span class="keywordflow">return</span> 0;
<a name="l00968"></a>00968     <span class="keywordtype">int</span> len = s-<a class="code" href="classFl__Preferences.html#aaf2e1a8f1904abb41f3cfa195ae9df41">path</a>;
<a name="l00969"></a>00969     <span class="keywordtype">char</span> *p = (<span class="keywordtype">char</span>*)malloc( len+1 );
<a name="l00970"></a>00970     memcpy( p, path, len );
<a name="l00971"></a>00971     p[len] = 0;
<a name="l00972"></a>00972     makePath( p );
<a name="l00973"></a>00973     free( p );
<a name="l00974"></a>00974 <span class="preprocessor">#if defined(WIN32) &amp;&amp; !defined(__CYGWIN__)</span>
<a name="l00975"></a>00975 <span class="preprocessor"></span>    <span class="keywordflow">return</span> ( mkdir( path ) == 0 );
<a name="l00976"></a>00976 <span class="preprocessor">#else</span>
<a name="l00977"></a>00977 <span class="preprocessor"></span>    <span class="keywordflow">return</span> ( mkdir( path, 0777 ) == 0 );
<a name="l00978"></a>00978 <span class="preprocessor">#endif // WIN32 &amp;&amp; !__CYGWIN__</span>
<a name="l00979"></a>00979 <span class="preprocessor"></span>  }
<a name="l00980"></a>00980   <span class="keywordflow">return</span> 1;
<a name="l00981"></a>00981 }
<a name="l00982"></a>00982 
<a name="l00983"></a>00983 <span class="preprocessor">#if 0</span>
<a name="l00984"></a>00984 <span class="preprocessor"></span><span class="comment">// strip the filename and create a path</span>
<a name="l00985"></a>00985 <span class="keyword">static</span> <span class="keywordtype">void</span> makePathForFile( <span class="keyword">const</span> <span class="keywordtype">char</span> *path ) {
<a name="l00986"></a>00986   <span class="keyword">const</span> <span class="keywordtype">char</span> *s = strrchr( path, <span class="charliteral">&#39;/&#39;</span> );
<a name="l00987"></a>00987   <span class="keywordflow">if</span> ( !s ) <span class="keywordflow">return</span>;
<a name="l00988"></a>00988   <span class="keywordtype">int</span> len = s-<a class="code" href="classFl__Preferences.html#aaf2e1a8f1904abb41f3cfa195ae9df41">path</a>;
<a name="l00989"></a>00989   <span class="keywordtype">char</span> *p = (<span class="keywordtype">char</span>*)malloc( len+1 );
<a name="l00990"></a>00990   memcpy( p, path, len );
<a name="l00991"></a>00991   p[len] = 0;
<a name="l00992"></a>00992   makePath( p );
<a name="l00993"></a>00993   free( p );
<a name="l00994"></a>00994 }
<a name="l00995"></a>00995 <span class="preprocessor">#endif</span>
<a name="l00996"></a>00996 <span class="preprocessor"></span>
<a name="l00997"></a>00997 <span class="comment">// create the root node</span>
<a name="l00998"></a>00998 <span class="comment">// - construct the name of the file that will hold our preferences</span>
<a name="l00999"></a>00999 <a class="code" href="classFl__Preferences.html#a3bb397989a4485545d4d65709ce3c863">Fl_Preferences::RootNode::RootNode</a>( <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> *prefs, <a class="code" href="classFl__Preferences.html#a0947b73d778ca66b9fbb97b75bbbd7cb">Root</a> root, <span class="keyword">const</span> <span class="keywordtype">char</span> *vendor, <span class="keyword">const</span> <span class="keywordtype">char</span> *application )
<a name="l01000"></a>01000 : prefs_(prefs),
<a name="l01001"></a>01001   filename_(0L),
<a name="l01002"></a>01002   vendor_(0L),
<a name="l01003"></a>01003   application_(0L) {
<a name="l01004"></a>01004 
<a name="l01005"></a>01005   <span class="keywordtype">char</span> filename[ <a class="code" href="group__filenames.html#ga29253083ed9918c2f9d532bd5ed89cc3">FL_PATH_MAX</a> ]; filename[0] = 0;
<a name="l01006"></a>01006 <span class="preprocessor">#ifdef WIN32</span>
<a name="l01007"></a>01007 <span class="preprocessor"></span><span class="preprocessor">#  define FLPREFS_RESOURCE      &quot;Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders&quot;</span>
<a name="l01008"></a>01008 <span class="preprocessor"></span><span class="preprocessor">#  define FLPREFS_RESOURCEW     L&quot;Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders&quot;</span>
<a name="l01009"></a>01009 <span class="preprocessor"></span>  <span class="keywordtype">int</span> appDataLen = strlen(vendor) + strlen(application) + 8;
<a name="l01010"></a>01010   DWORD <a class="code" href="png_8h.html#a31c258c425e1346a1cd21ffd48f58ace">type</a>, nn;
<a name="l01011"></a>01011   LONG err;
<a name="l01012"></a>01012   HKEY <a class="code" href="Fl__Text__Editor_8cxx.html#a35af0be900467fedbb610bd6ea65ed78">key</a>;
<a name="l01013"></a>01013 
<a name="l01014"></a>01014   <span class="keywordflow">switch</span> (root) {
<a name="l01015"></a>01015     <span class="keywordflow">case</span> <a class="code" href="classFl__Preferences.html#a0947b73d778ca66b9fbb97b75bbbd7cba057fd9ac75376136f30efb0d700e8db4" title="Preferences are used system-wide.">SYSTEM</a>:
<a name="l01016"></a>01016       err = RegOpenKeyW( HKEY_LOCAL_MACHINE, FLPREFS_RESOURCEW, &amp;key );
<a name="l01017"></a>01017       <span class="keywordflow">if</span> (err == ERROR_SUCCESS) {
<a name="l01018"></a>01018         nn = <a class="code" href="group__filenames.html#ga29253083ed9918c2f9d532bd5ed89cc3">FL_PATH_MAX</a> - appDataLen; 
<a name="l01019"></a>01019         err = RegQueryValueExW( key, L<span class="stringliteral">&quot;Common AppData&quot;</span>, 0L, &amp;type,
<a name="l01020"></a>01020                                 (BYTE*)filename, &amp;nn ); 
<a name="l01021"></a>01021         <span class="keywordflow">if</span> ( ( err != ERROR_SUCCESS ) &amp;&amp; ( type == REG_SZ ) ) {
<a name="l01022"></a>01022           filename[0] = 0;
<a name="l01023"></a>01023           filename[1] = 0;
<a name="l01024"></a>01024         }
<a name="l01025"></a>01025         RegCloseKey(key);
<a name="l01026"></a>01026       }
<a name="l01027"></a>01027       <span class="keywordflow">break</span>;
<a name="l01028"></a>01028     <span class="keywordflow">case</span> <a class="code" href="classFl__Preferences.html#a0947b73d778ca66b9fbb97b75bbbd7cbaaf4354ca5ac4df110c2fd1fc36c61053" title="Preferences apply only to the current user.">USER</a>:
<a name="l01029"></a>01029       err = RegOpenKeyW( HKEY_CURRENT_USER, FLPREFS_RESOURCEW, &amp;key );
<a name="l01030"></a>01030       <span class="keywordflow">if</span> (err == ERROR_SUCCESS) {
<a name="l01031"></a>01031         nn = <a class="code" href="group__filenames.html#ga29253083ed9918c2f9d532bd5ed89cc3">FL_PATH_MAX</a> - appDataLen;
<a name="l01032"></a>01032         err = RegQueryValueExW( key, L<span class="stringliteral">&quot;AppData&quot;</span>, 0L, &amp;type,
<a name="l01033"></a>01033                                 (BYTE*)filename, &amp;nn ); 
<a name="l01034"></a>01034         <span class="keywordflow">if</span> ( ( err != ERROR_SUCCESS ) &amp;&amp; ( type == REG_SZ ) ) {
<a name="l01035"></a>01035           filename[0] = 0;
<a name="l01036"></a>01036           filename[1] = 0;
<a name="l01037"></a>01037         }
<a name="l01038"></a>01038         RegCloseKey(key);
<a name="l01039"></a>01039       }
<a name="l01040"></a>01040       <span class="keywordflow">break</span>;
<a name="l01041"></a>01041   } 
<a name="l01042"></a>01042   <span class="keywordflow">if</span> (!filename[1] &amp;&amp; !filename[0]) {
<a name="l01043"></a>01043     strcpy(filename, <span class="stringliteral">&quot;C:\\FLTK&quot;</span>);
<a name="l01044"></a>01044   } <span class="keywordflow">else</span> {
<a name="l01045"></a>01045 <span class="preprocessor">#if 0</span>
<a name="l01046"></a>01046 <span class="preprocessor"></span>    <a class="code" href="fl__utf8_8h.html#a234f7ec71c9c19ed532c4bf11a9b9b8e">xchar</a> *<a class="code" href="jpegint_8h.html#af320905358fa78701e4cc60b6135601f">b</a> = (<a class="code" href="fl__utf8_8h.html#a234f7ec71c9c19ed532c4bf11a9b9b8e">xchar</a>*)_wcsdup((<a class="code" href="fl__utf8_8h.html#a234f7ec71c9c19ed532c4bf11a9b9b8e">xchar</a> *)filename);
<a name="l01047"></a>01047 <span class="preprocessor">#else</span>
<a name="l01048"></a>01048 <span class="preprocessor"></span>    <span class="comment">// cygwin does not come with _wcsdup. Use malloc +  wcscpy.</span>
<a name="l01049"></a>01049     <span class="comment">// For implementation of wcsdup functionality See</span>
<a name="l01050"></a>01050     <span class="comment">// - http://linenum.info/p/glibc/2.7/wcsmbs/wcsdup.c</span>
<a name="l01051"></a>01051     <a class="code" href="fl__utf8_8h.html#a234f7ec71c9c19ed532c4bf11a9b9b8e">xchar</a> *b = (<a class="code" href="fl__utf8_8h.html#a234f7ec71c9c19ed532c4bf11a9b9b8e">xchar</a>*) malloc((wcslen((<a class="code" href="fl__utf8_8h.html#a234f7ec71c9c19ed532c4bf11a9b9b8e">xchar</a> *) filename) + 1) * <span class="keyword">sizeof</span>(<a class="code" href="fl__utf8_8h.html#a234f7ec71c9c19ed532c4bf11a9b9b8e">xchar</a>));
<a name="l01052"></a>01052     wcscpy(b, (<a class="code" href="fl__utf8_8h.html#a234f7ec71c9c19ed532c4bf11a9b9b8e">xchar</a> *) filename);
<a name="l01053"></a>01053 <span class="preprocessor">#endif</span>
<a name="l01054"></a>01054 <span class="preprocessor"></span>    <span class="comment">//  filename[fl_unicode2utf(b, wcslen((xchar*)b), filename)] = 0;</span>
<a name="l01055"></a>01055     <span class="keywordtype">unsigned</span> len = <a class="code" href="group__fl__unicode.html#ga56a6296024debb49690b81addda7589b">fl_utf8fromwc</a>(filename, (<a class="code" href="group__filenames.html#ga29253083ed9918c2f9d532bd5ed89cc3">FL_PATH_MAX</a>-1), b, wcslen(b));
<a name="l01056"></a>01056     filename[len] = 0;
<a name="l01057"></a>01057     free(b);
<a name="l01058"></a>01058   }
<a name="l01059"></a>01059   <a class="code" href="flstring_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(filename + strlen(filename), <span class="keyword">sizeof</span>(filename) - strlen(filename),
<a name="l01060"></a>01060            <span class="stringliteral">&quot;/%s/%s.prefs&quot;</span>, vendor, application);
<a name="l01061"></a>01061   <span class="keywordflow">for</span> (<span class="keywordtype">char</span> *s = filename; *s; s++) <span class="keywordflow">if</span> (*s == <span class="charliteral">&#39;\\&#39;</span>) *s = <span class="charliteral">&#39;/&#39;</span>;
<a name="l01062"></a>01062 <span class="preprocessor">#elif defined ( __APPLE__ )</span>
<a name="l01063"></a>01063 <span class="preprocessor"></span>  <span class="comment">// TODO: verify that this is the Apple sanctioned way of finding these folders</span>
<a name="l01064"></a>01064   <span class="comment">// (On MSWindows, this frequently leads to issues with internationalized systems)</span>
<a name="l01065"></a>01065   <span class="comment">// Carbon: err = FindFolder( kLocalDomain, kPreferencesFolderType, 1, &amp;spec.vRefNum, &amp;spec.parID );</span>
<a name="l01066"></a>01066   <span class="keywordflow">switch</span> (root) {
<a name="l01067"></a>01067     <span class="keywordflow">case</span> <a class="code" href="classFl__Preferences.html#a0947b73d778ca66b9fbb97b75bbbd7cba057fd9ac75376136f30efb0d700e8db4" title="Preferences are used system-wide.">SYSTEM</a>:
<a name="l01068"></a>01068       strcpy(filename, <span class="stringliteral">&quot;/Library/Preferences&quot;</span>);
<a name="l01069"></a>01069       <span class="keywordflow">break</span>;
<a name="l01070"></a>01070     <span class="keywordflow">case</span> <a class="code" href="classFl__Preferences.html#a0947b73d778ca66b9fbb97b75bbbd7cbaaf4354ca5ac4df110c2fd1fc36c61053" title="Preferences apply only to the current user.">USER</a>:
<a name="l01071"></a>01071       sprintf(filename, <span class="stringliteral">&quot;%s/Library/Preferences&quot;</span>, <a class="code" href="group__fl__unicode.html#ga3396a1bbcf14adc06066d791791464da">fl_getenv</a>(<span class="stringliteral">&quot;HOME&quot;</span>));
<a name="l01072"></a>01072       <span class="keywordflow">break</span>;
<a name="l01073"></a>01073   }
<a name="l01074"></a>01074   <a class="code" href="flstring_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(filename + strlen(filename), <span class="keyword">sizeof</span>(filename) - strlen(filename),
<a name="l01075"></a>01075            <span class="stringliteral">&quot;/%s/%s.prefs&quot;</span>, vendor, application );
<a name="l01076"></a>01076 <span class="preprocessor">#else</span>
<a name="l01077"></a>01077 <span class="preprocessor"></span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *e;
<a name="l01078"></a>01078   <span class="keywordflow">switch</span> (root) {
<a name="l01079"></a>01079     <span class="keywordflow">case</span> <a class="code" href="classFl__Preferences.html#a0947b73d778ca66b9fbb97b75bbbd7cbaaf4354ca5ac4df110c2fd1fc36c61053" title="Preferences apply only to the current user.">USER</a>:
<a name="l01080"></a>01080       <span class="keywordflow">if</span> ((e = <a class="code" href="group__fl__unicode.html#ga3396a1bbcf14adc06066d791791464da">fl_getenv</a>(<span class="stringliteral">&quot;HOME&quot;</span>)) != <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01081"></a>01081         <a class="code" href="flstring_8h.html#a61ae5a0c7536d81d0fb52661f75254cb">strlcpy</a>(filename, e, <span class="keyword">sizeof</span>(filename));
<a name="l01082"></a>01082 
<a name="l01083"></a>01083         <span class="keywordflow">if</span> (filename[strlen(filename)-1] != <span class="charliteral">&#39;/&#39;</span>) {
<a name="l01084"></a>01084           <a class="code" href="flstring_8h.html#a86dd23d247c7f6620c8a769bc202c71c">strlcat</a>(filename, <span class="stringliteral">&quot;/.fltk/&quot;</span>, <span class="keyword">sizeof</span>(filename));
<a name="l01085"></a>01085         } <span class="keywordflow">else</span> {
<a name="l01086"></a>01086           <a class="code" href="flstring_8h.html#a86dd23d247c7f6620c8a769bc202c71c">strlcat</a>(filename, <span class="stringliteral">&quot;.fltk/&quot;</span>, <span class="keyword">sizeof</span>(filename));
<a name="l01087"></a>01087         }
<a name="l01088"></a>01088         <span class="keywordflow">break</span>;
<a name="l01089"></a>01089       } 
<a name="l01090"></a>01090     <span class="keywordflow">case</span> <a class="code" href="classFl__Preferences.html#a0947b73d778ca66b9fbb97b75bbbd7cba057fd9ac75376136f30efb0d700e8db4" title="Preferences are used system-wide.">SYSTEM</a>:
<a name="l01091"></a>01091       strcpy(filename, <span class="stringliteral">&quot;/etc/fltk/&quot;</span>);
<a name="l01092"></a>01092       <span class="keywordflow">break</span>;
<a name="l01093"></a>01093   } 
<a name="l01094"></a>01094   <a class="code" href="flstring_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(filename + strlen(filename), <span class="keyword">sizeof</span>(filename) - strlen(filename),
<a name="l01095"></a>01095            <span class="stringliteral">&quot;%s/%s.prefs&quot;</span>, vendor, application);
<a name="l01096"></a>01096 <span class="preprocessor">#endif </span>
<a name="l01097"></a>01097 <span class="preprocessor"></span>  filename_    = strdup(filename);
<a name="l01098"></a>01098   vendor_      = strdup(vendor);
<a name="l01099"></a>01099   application_ = strdup(application); 
<a name="l01100"></a>01100   read();
<a name="l01101"></a>01101 }
<a name="l01102"></a>01102 
<a name="l01103"></a>01103 <span class="comment">// create the root node</span>
<a name="l01104"></a>01104 <span class="comment">// - construct the name of the file that will hold our preferences</span>
<a name="l01105"></a>01105 <a class="code" href="classFl__Preferences.html#a3bb397989a4485545d4d65709ce3c863">Fl_Preferences::RootNode::RootNode</a>( <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> *prefs, <span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keyword">const</span> <span class="keywordtype">char</span> *vendor, <span class="keyword">const</span> <span class="keywordtype">char</span> *application )
<a name="l01106"></a>01106 : prefs_(prefs),
<a name="l01107"></a>01107   filename_(0L),
<a name="l01108"></a>01108   vendor_(0L),
<a name="l01109"></a>01109   application_(0L) {
<a name="l01110"></a>01110 
<a name="l01111"></a>01111   <span class="keywordflow">if</span> (!vendor)
<a name="l01112"></a>01112     vendor = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l01113"></a>01113   <span class="keywordflow">if</span> (!application) {
<a name="l01114"></a>01114     application = <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l01115"></a>01115     filename_ = strdup(path);
<a name="l01116"></a>01116   } <span class="keywordflow">else</span> {
<a name="l01117"></a>01117     <span class="keywordtype">char</span> filename[ <a class="code" href="group__filenames.html#ga29253083ed9918c2f9d532bd5ed89cc3">FL_PATH_MAX</a> ]; filename[0] = 0;
<a name="l01118"></a>01118     <a class="code" href="flstring_8h.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(filename, <span class="keyword">sizeof</span>(filename), <span class="stringliteral">&quot;%s/%s.prefs&quot;</span>, path, application);
<a name="l01119"></a>01119     filename_  = strdup(filename);
<a name="l01120"></a>01120   }
<a name="l01121"></a>01121   vendor_      = strdup(vendor);
<a name="l01122"></a>01122   application_ = strdup(application); 
<a name="l01123"></a>01123   read();
<a name="l01124"></a>01124 }
<a name="l01125"></a>01125 
<a name="l01126"></a>01126 <span class="comment">// create a root node that exists only on RAM and can not be read or written to</span>
<a name="l01127"></a>01127 <span class="comment">// a file</span>
<a name="l01128"></a>01128 <a class="code" href="classFl__Preferences.html#a3bb397989a4485545d4d65709ce3c863">Fl_Preferences::RootNode::RootNode</a>( <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> *prefs )
<a name="l01129"></a>01129 : prefs_(prefs),
<a name="l01130"></a>01130   filename_(0L),
<a name="l01131"></a>01131   vendor_(0L),
<a name="l01132"></a>01132   application_(0L) {
<a name="l01133"></a>01133 }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135 <span class="comment">// destroy the root node and all depending nodes</span>
<a name="l01136"></a>01136 Fl_Preferences::RootNode::~RootNode() {
<a name="l01137"></a>01137   <span class="keywordflow">if</span> ( prefs_-&gt;node-&gt;dirty() )
<a name="l01138"></a>01138     write();
<a name="l01139"></a>01139   <span class="keywordflow">if</span> ( filename_ ) {
<a name="l01140"></a>01140     free( filename_ );
<a name="l01141"></a>01141     filename_ = 0L;
<a name="l01142"></a>01142   }
<a name="l01143"></a>01143   <span class="keywordflow">if</span> ( vendor_ ) {
<a name="l01144"></a>01144     free( vendor_ );
<a name="l01145"></a>01145     vendor_ = 0L;
<a name="l01146"></a>01146   }
<a name="l01147"></a>01147   <span class="keywordflow">if</span> ( application_ ) {
<a name="l01148"></a>01148     free( application_ );
<a name="l01149"></a>01149     application_ = 0L;
<a name="l01150"></a>01150   }
<a name="l01151"></a>01151   <span class="keyword">delete</span> prefs_-&gt;node;
<a name="l01152"></a>01152   prefs_-&gt;node = 0L;
<a name="l01153"></a>01153 }
<a name="l01154"></a>01154 
<a name="l01155"></a>01155 <span class="comment">// read a preferences file and construct the group tree and with all entry leafs</span>
<a name="l01156"></a>01156 <span class="keywordtype">int</span> Fl_Preferences::RootNode::read() {
<a name="l01157"></a>01157   <span class="keywordflow">if</span> (!filename_)   <span class="comment">// RUNTIME preferences</span>
<a name="l01158"></a>01158     <span class="keywordflow">return</span> -1; 
<a name="l01159"></a>01159   <span class="keywordtype">char</span> <a class="code" href="png_8h.html#a9843c7a2b7309da8f96021b45fec0d70">buf</a>[1024];
<a name="l01160"></a>01160   FILE *<a class="code" href="fl__boxtype_8cxx.html#ac406db58651c10e8f67ed432c66db0d6">f</a> = <a class="code" href="group__fl__unicode.html#ga8a457e9f251d83d565a62fb3c88cf32e">fl_fopen</a>( filename_, <span class="stringliteral">&quot;rb&quot;</span> );
<a name="l01161"></a>01161   <span class="keywordflow">if</span> ( !f )
<a name="l01162"></a>01162     <span class="keywordflow">return</span> -1; 
<a name="l01163"></a>01163   <span class="keywordflow">if</span> (fgets( buf, 1024, f )==0) { <span class="comment">/* ignore */</span> }
<a name="l01164"></a>01164   <span class="keywordflow">if</span> (fgets( buf, 1024, f )==0) { <span class="comment">/* ignore */</span> }
<a name="l01165"></a>01165   <span class="keywordflow">if</span> (fgets( buf, 1024, f )==0) { <span class="comment">/* ignore */</span> }
<a name="l01166"></a>01166   <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nd = prefs_-&gt;node;
<a name="l01167"></a>01167   <span class="keywordflow">for</span> (;;) {
<a name="l01168"></a>01168     <span class="keywordflow">if</span> ( !fgets( buf, 1024, f ) ) <span class="keywordflow">break</span>;        <span class="comment">// EOF or Error</span>
<a name="l01169"></a>01169     <span class="keywordflow">if</span> ( buf[0]==<span class="charliteral">&#39;[&#39;</span> ) {                        <span class="comment">// read a new group</span>
<a name="l01170"></a>01170       <span class="keywordtype">int</span> end = strcspn( buf+1, <span class="stringliteral">&quot;]\n\r&quot;</span> );
<a name="l01171"></a>01171       buf[ end+1 ] = 0;
<a name="l01172"></a>01172       nd = prefs_-&gt;node-&gt;find( buf+1 );
<a name="l01173"></a>01173     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( buf[0]==<span class="charliteral">&#39;+&#39;</span> ) {                 <span class="comment">// value of previous name/value pair spans multiple lines</span>
<a name="l01174"></a>01174       <span class="keywordtype">int</span> end = strcspn( buf+1, <span class="stringliteral">&quot;\n\r&quot;</span> );
<a name="l01175"></a>01175       <span class="keywordflow">if</span> ( end != 0 ) {                         <span class="comment">// if entry is not empty</span>
<a name="l01176"></a>01176         buf[ end+1 ] = 0;
<a name="l01177"></a>01177         nd-&gt;add( buf+1 );
<a name="l01178"></a>01178       }
<a name="l01179"></a>01179     } <span class="keywordflow">else</span> {                                     <span class="comment">// read a name/value pair</span>
<a name="l01180"></a>01180       <span class="keywordtype">int</span> end = strcspn( buf, <span class="stringliteral">&quot;\n\r&quot;</span> );
<a name="l01181"></a>01181       <span class="keywordflow">if</span> ( end != 0 ) {                         <span class="comment">// if entry is not empty</span>
<a name="l01182"></a>01182         buf[ end ] = 0;
<a name="l01183"></a>01183         nd-&gt;set( buf );
<a name="l01184"></a>01184       }
<a name="l01185"></a>01185     }
<a name="l01186"></a>01186   }
<a name="l01187"></a>01187   fclose( f );
<a name="l01188"></a>01188   <span class="keywordflow">return</span> 0;
<a name="l01189"></a>01189 }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191 <span class="comment">// write the group tree and all entry leafs</span>
<a name="l01192"></a>01192 <span class="keywordtype">int</span> Fl_Preferences::RootNode::write() {
<a name="l01193"></a>01193   <span class="keywordflow">if</span> (!filename_)   <span class="comment">// RUNTIME preferences</span>
<a name="l01194"></a>01194     <span class="keywordflow">return</span> -1; 
<a name="l01195"></a>01195   <a class="code" href="group__fl__unicode.html#gaedd78a1155fa19f67153dda7538ce00d">fl_make_path_for_file</a>(filename_);
<a name="l01196"></a>01196   FILE *f = <a class="code" href="group__fl__unicode.html#ga8a457e9f251d83d565a62fb3c88cf32e">fl_fopen</a>( filename_, <span class="stringliteral">&quot;wb&quot;</span> );
<a name="l01197"></a>01197   <span class="keywordflow">if</span> ( !f )
<a name="l01198"></a>01198     <span class="keywordflow">return</span> -1; 
<a name="l01199"></a>01199   fprintf( f, <span class="stringliteral">&quot;; FLTK preferences file format 1.0\n&quot;</span> );
<a name="l01200"></a>01200   fprintf( f, <span class="stringliteral">&quot;; vendor: %s\n&quot;</span>, vendor_ );
<a name="l01201"></a>01201   fprintf( f, <span class="stringliteral">&quot;; application: %s\n&quot;</span>, application_ );
<a name="l01202"></a>01202   prefs_-&gt;node-&gt;write( f );
<a name="l01203"></a>01203   fclose( f );
<a name="l01204"></a>01204 <span class="preprocessor">#if !(defined(__APPLE__) || defined(WIN32))</span>
<a name="l01205"></a>01205 <span class="preprocessor"></span>  <span class="comment">// unix: make sure that system prefs are user-readable</span>
<a name="l01206"></a>01206   <span class="keywordflow">if</span> (strncmp(filename_, <span class="stringliteral">&quot;/etc/fltk/&quot;</span>, 10) == 0) {
<a name="l01207"></a>01207     <span class="keywordtype">char</span> *p;
<a name="l01208"></a>01208     p = filename_ + 9;
<a name="l01209"></a>01209     <span class="keywordflow">do</span> {                         <span class="comment">// for each directory to the pref file</span>
<a name="l01210"></a>01210       *p = 0;
<a name="l01211"></a>01211       <a class="code" href="group__fl__unicode.html#ga284e7ffcaa8920af917bcde2937290a0">fl_chmod</a>(filename_, 0755); <span class="comment">// rwxr-xr-x</span>
<a name="l01212"></a>01212       *p = <span class="charliteral">&#39;/&#39;</span>;
<a name="l01213"></a>01213       p = strchr(p+1, <span class="charliteral">&#39;/&#39;</span>);
<a name="l01214"></a>01214     } <span class="keywordflow">while</span> (p);
<a name="l01215"></a>01215     <a class="code" href="group__fl__unicode.html#ga284e7ffcaa8920af917bcde2937290a0">fl_chmod</a>(filename_, 0644);   <span class="comment">// rw-r--r--</span>
<a name="l01216"></a>01216   }
<a name="l01217"></a>01217 <span class="preprocessor">#endif</span>
<a name="l01218"></a>01218 <span class="preprocessor"></span>  <span class="keywordflow">return</span> 0;
<a name="l01219"></a>01219 }
<a name="l01220"></a>01220 
<a name="l01221"></a>01221 <span class="comment">// get the path to the preferences directory</span>
<a name="l01222"></a>01222 <span class="keywordtype">char</span> Fl_Preferences::RootNode::getPath( <span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> pathlen ) {
<a name="l01223"></a>01223   <span class="keywordflow">if</span> (!filename_)   <span class="comment">// RUNTIME preferences</span>
<a name="l01224"></a>01224     <span class="keywordflow">return</span> -1; 
<a name="l01225"></a>01225   <a class="code" href="flstring_8h.html#a61ae5a0c7536d81d0fb52661f75254cb">strlcpy</a>( path, filename_, pathlen); 
<a name="l01226"></a>01226 
<a name="l01227"></a>01227   <span class="keywordtype">char</span> *s;
<a name="l01228"></a>01228   <span class="keywordflow">for</span> ( s = path; *s; s++ ) <span class="keywordflow">if</span> ( *s == <span class="charliteral">&#39;\\&#39;</span> ) *s = <span class="charliteral">&#39;/&#39;</span>;
<a name="l01229"></a>01229   s = strrchr( path, <span class="charliteral">&#39;.&#39;</span> );
<a name="l01230"></a>01230   <span class="keywordflow">if</span> ( !s ) <span class="keywordflow">return</span> 0;
<a name="l01231"></a>01231   *s = 0;
<a name="l01232"></a>01232   <span class="keywordtype">char</span> ret = <a class="code" href="group__fl__unicode.html#ga8eaa1bb84d01ca3f6d102771ff296974">fl_make_path</a>( path );
<a name="l01233"></a>01233 <span class="preprocessor">#if !(defined(__APPLE__) || defined(WIN32))</span>
<a name="l01234"></a>01234 <span class="preprocessor"></span>  <span class="comment">// unix: make sure that system prefs dir. is user-readable</span>
<a name="l01235"></a>01235   <span class="keywordflow">if</span> (strncmp(path, <span class="stringliteral">&quot;/etc/fltk/&quot;</span>, 10) == 0) {
<a name="l01236"></a>01236     <a class="code" href="group__fl__unicode.html#ga284e7ffcaa8920af917bcde2937290a0">fl_chmod</a>(path, 0755); <span class="comment">// rwxr-xr-x</span>
<a name="l01237"></a>01237   }
<a name="l01238"></a>01238 <span class="preprocessor">#endif</span>
<a name="l01239"></a>01239 <span class="preprocessor"></span>  strcpy( s, <span class="stringliteral">&quot;/&quot;</span> );
<a name="l01240"></a>01240   <span class="keywordflow">return</span> ret;
<a name="l01241"></a>01241 }
<a name="l01242"></a>01242 
<a name="l01243"></a>01243 <span class="comment">// create a node that represents a group</span>
<a name="l01244"></a>01244 <span class="comment">// - path must be a single word, prferable alnum(), dot and underscore only. Space is ok.</span>
<a name="l01245"></a>01245 <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Fl_Preferences::Node::Node</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *path ) {
<a name="l01246"></a>01246   <span class="keywordflow">if</span> ( path ) path_ = strdup( path ); <span class="keywordflow">else</span> path_ = 0;
<a name="l01247"></a>01247   child_ = 0; next_ = 0; parent_ = 0;
<a name="l01248"></a>01248   entry_ = 0;
<a name="l01249"></a>01249   nEntry_ = NEntry_ = 0;
<a name="l01250"></a>01250   dirty_ = 0;
<a name="l01251"></a>01251   top_ = 0;
<a name="l01252"></a>01252   indexed_ = 0;
<a name="l01253"></a>01253   index_ = 0;
<a name="l01254"></a>01254   nIndex_ = NIndex_ = 0;
<a name="l01255"></a>01255 }
<a name="l01256"></a>01256 
<a name="l01257"></a>01257 <span class="keywordtype">void</span> Fl_Preferences::Node::deleteAllChildren() {
<a name="l01258"></a>01258   <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nx;
<a name="l01259"></a>01259   <span class="keywordflow">for</span> ( <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nd = child_; nd; nd = nx ) {
<a name="l01260"></a>01260     nx = nd-&gt;next_;
<a name="l01261"></a>01261     <span class="keyword">delete</span> nd;
<a name="l01262"></a>01262   }
<a name="l01263"></a>01263   child_ = 0L;
<a name="l01264"></a>01264   dirty_ = 1;
<a name="l01265"></a>01265   updateIndex();
<a name="l01266"></a>01266 }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268 <span class="keywordtype">void</span> <a class="code" href="classFl__Preferences.html#af73078b80334cc3f43542f4862de402b">Fl_Preferences::Node::deleteAllEntries</a>() {
<a name="l01269"></a>01269   <span class="keywordflow">if</span> ( entry_ ) {
<a name="l01270"></a>01270     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; nEntry_; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++ ) {
<a name="l01271"></a>01271       <span class="keywordflow">if</span> ( entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].<a class="code" href="classFl__Preferences.html#a6ff11b679bec179ebb211c31f8e46f2e">name</a> ) {
<a name="l01272"></a>01272         free( entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].name );
<a name="l01273"></a>01273         entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].name = 0L;
<a name="l01274"></a>01274       }
<a name="l01275"></a>01275       <span class="keywordflow">if</span> ( entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].<a class="code" href="png_8h.html#a58342413057d091672287c7522a6137f">value</a> ) {
<a name="l01276"></a>01276         free( entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].value );
<a name="l01277"></a>01277         entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].value = 0L;
<a name="l01278"></a>01278       }
<a name="l01279"></a>01279     }
<a name="l01280"></a>01280     free( entry_ );
<a name="l01281"></a>01281     entry_ = 0L;
<a name="l01282"></a>01282     nEntry_ = 0;
<a name="l01283"></a>01283     NEntry_ = 0;
<a name="l01284"></a>01284   }
<a name="l01285"></a>01285   dirty_ = 1;
<a name="l01286"></a>01286 }
<a name="l01287"></a>01287 
<a name="l01288"></a>01288 <span class="comment">// delete this and all depending nodes</span>
<a name="l01289"></a>01289 Fl_Preferences::Node::~Node() {
<a name="l01290"></a>01290   deleteAllChildren();
<a name="l01291"></a>01291   <a class="code" href="classFl__Preferences.html#af73078b80334cc3f43542f4862de402b">deleteAllEntries</a>();
<a name="l01292"></a>01292   deleteIndex();
<a name="l01293"></a>01293   <span class="keywordflow">if</span> ( path_ ) {
<a name="l01294"></a>01294     free( path_ );
<a name="l01295"></a>01295     path_ = 0L;
<a name="l01296"></a>01296   }
<a name="l01297"></a>01297   next_ = 0L;
<a name="l01298"></a>01298   parent_ = 0L;
<a name="l01299"></a>01299 }
<a name="l01300"></a>01300 
<a name="l01301"></a>01301 <span class="comment">// recursively check if any entry is dirty (was changed after loading a fresh prefs file)</span>
<a name="l01302"></a>01302 <span class="keywordtype">char</span> Fl_Preferences::Node::dirty() {
<a name="l01303"></a>01303   <span class="keywordflow">if</span> ( dirty_ ) <span class="keywordflow">return</span> 1;
<a name="l01304"></a>01304   <span class="keywordflow">if</span> ( next_ &amp;&amp; next_-&gt;dirty() ) <span class="keywordflow">return</span> 1;
<a name="l01305"></a>01305   <span class="keywordflow">if</span> ( child_ &amp;&amp; child_-&gt;dirty() ) <span class="keywordflow">return</span> 1;
<a name="l01306"></a>01306   <span class="keywordflow">return</span> 0;
<a name="l01307"></a>01307 }
<a name="l01308"></a>01308 
<a name="l01309"></a>01309 <span class="comment">// write this node (recursively from the last neighbor back to this)</span>
<a name="l01310"></a>01310 <span class="comment">// write all entries</span>
<a name="l01311"></a>01311 <span class="comment">// write all children</span>
<a name="l01312"></a>01312 <span class="keywordtype">int</span> Fl_Preferences::Node::write( FILE *f ) {
<a name="l01313"></a>01313   <span class="keywordflow">if</span> ( next_ ) next_-&gt;write( f );
<a name="l01314"></a>01314   fprintf( f, <span class="stringliteral">&quot;\n[%s]\n\n&quot;</span>, path_ );
<a name="l01315"></a>01315   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; nEntry_; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++ ) {
<a name="l01316"></a>01316     <span class="keywordtype">char</span> *src = entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].value;
<a name="l01317"></a>01317     <span class="keywordflow">if</span> ( src ) {                <span class="comment">// hack it into smaller pieces if needed</span>
<a name="l01318"></a>01318       fprintf( f, <span class="stringliteral">&quot;%s:&quot;</span>, entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].<a class="code" href="classFl__Preferences.html#a6ff11b679bec179ebb211c31f8e46f2e">name</a> );
<a name="l01319"></a>01319       <span class="keywordtype">int</span> cnt;
<a name="l01320"></a>01320       <span class="keywordflow">for</span> ( cnt = 0; cnt &lt; 60; cnt++ )
<a name="l01321"></a>01321         <span class="keywordflow">if</span> ( src[cnt]==0 ) <span class="keywordflow">break</span>;
<a name="l01322"></a>01322       fwrite( src, cnt, 1, f );
<a name="l01323"></a>01323       fprintf( f, <span class="stringliteral">&quot;\n&quot;</span> );
<a name="l01324"></a>01324       src += cnt;
<a name="l01325"></a>01325       <span class="keywordflow">for</span> (;*src;) {
<a name="l01326"></a>01326         <span class="keywordflow">for</span> ( cnt = 0; cnt &lt; 80; cnt++ )
<a name="l01327"></a>01327           <span class="keywordflow">if</span> ( src[cnt]==0 ) <span class="keywordflow">break</span>;
<a name="l01328"></a>01328         fputc( <span class="charliteral">&#39;+&#39;</span>, f );
<a name="l01329"></a>01329         fwrite( src, cnt, 1, f );
<a name="l01330"></a>01330         fputc( <span class="charliteral">&#39;\n&#39;</span>, f );
<a name="l01331"></a>01331         src += cnt;
<a name="l01332"></a>01332       }
<a name="l01333"></a>01333     }
<a name="l01334"></a>01334     <span class="keywordflow">else</span>
<a name="l01335"></a>01335       fprintf( f, <span class="stringliteral">&quot;%s\n&quot;</span>, entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].<a class="code" href="classFl__Preferences.html#a6ff11b679bec179ebb211c31f8e46f2e">name</a> );
<a name="l01336"></a>01336   }
<a name="l01337"></a>01337   <span class="keywordflow">if</span> ( child_ ) child_-&gt;write( f );
<a name="l01338"></a>01338   dirty_ = 0;
<a name="l01339"></a>01339   <span class="keywordflow">return</span> 0;
<a name="l01340"></a>01340 }
<a name="l01341"></a>01341 
<a name="l01342"></a>01342 <span class="comment">// set the parent node and create the full path</span>
<a name="l01343"></a>01343 <span class="keywordtype">void</span> Fl_Preferences::Node::setParent( <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *pn ) {
<a name="l01344"></a>01344   parent_ = pn;
<a name="l01345"></a>01345   next_ = pn-&gt;child_;
<a name="l01346"></a>01346   pn-&gt;child_ = <span class="keyword">this</span>;
<a name="l01347"></a>01347   sprintf( nameBuffer, <span class="stringliteral">&quot;%s/%s&quot;</span>, pn-&gt;path_, path_ );
<a name="l01348"></a>01348   free( path_ );
<a name="l01349"></a>01349   path_ = strdup( nameBuffer );
<a name="l01350"></a>01350 }
<a name="l01351"></a>01351 
<a name="l01352"></a>01352 <span class="comment">// find the corresponding root node</span>
<a name="l01353"></a>01353 <a class="code" href="classFl__Preferences.html#a3bb397989a4485545d4d65709ce3c863">Fl_Preferences::RootNode</a> *Fl_Preferences::Node::findRoot() {
<a name="l01354"></a>01354   <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *n = <span class="keyword">this</span>;
<a name="l01355"></a>01355   <span class="keywordflow">do</span> {
<a name="l01356"></a>01356     <span class="keywordflow">if</span> (n-&gt;top_)
<a name="l01357"></a>01357       <span class="keywordflow">return</span> n-&gt;root_;
<a name="l01358"></a>01358     n = n-&gt;parent();
<a name="l01359"></a>01359   } <span class="keywordflow">while</span> (n);
<a name="l01360"></a>01360   <span class="keywordflow">return</span> 0L;
<a name="l01361"></a>01361 }
<a name="l01362"></a>01362 
<a name="l01363"></a>01363 <span class="comment">// add a child to this node and set its path (try to find it first...)</span>
<a name="l01364"></a>01364 <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Fl_Preferences::Node</a> *Fl_Preferences::Node::addChild( <span class="keyword">const</span> <span class="keywordtype">char</span> *path ) {
<a name="l01365"></a>01365   sprintf( nameBuffer, <span class="stringliteral">&quot;%s/%s&quot;</span>, path_, path );
<a name="l01366"></a>01366   <span class="keywordtype">char</span> *<a class="code" href="classFl__Preferences.html#a6ff11b679bec179ebb211c31f8e46f2e">name</a> = strdup( nameBuffer );
<a name="l01367"></a>01367   <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nd = find( name );
<a name="l01368"></a>01368   free( name );
<a name="l01369"></a>01369   dirty_ = 1;
<a name="l01370"></a>01370   updateIndex();
<a name="l01371"></a>01371   <span class="keywordflow">return</span> nd;
<a name="l01372"></a>01372 }
<a name="l01373"></a>01373 
<a name="l01374"></a>01374 <span class="comment">// create and set, or change an entry within this node</span>
<a name="l01375"></a>01375 <span class="keywordtype">void</span> <a class="code" href="classFl__Preferences.html#a1928e8ca3f21f66304951b757f24d70a">Fl_Preferences::Node::set</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classFl__Preferences.html#a6ff11b679bec179ebb211c31f8e46f2e">name</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="png_8h.html#a58342413057d091672287c7522a6137f">value</a> )
<a name="l01376"></a>01376 {
<a name="l01377"></a>01377   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>=0; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>&lt;nEntry_; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++ ) {
<a name="l01378"></a>01378     <span class="keywordflow">if</span> ( strcmp( name, entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].name ) == 0 ) {
<a name="l01379"></a>01379       <span class="keywordflow">if</span> ( !value ) <span class="keywordflow">return</span>; <span class="comment">// annotation</span>
<a name="l01380"></a>01380       <span class="keywordflow">if</span> ( strcmp( value, entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].value ) != 0 ) {
<a name="l01381"></a>01381         <span class="keywordflow">if</span> ( entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].value )
<a name="l01382"></a>01382           free( entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].value );
<a name="l01383"></a>01383         entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].value = strdup( value );
<a name="l01384"></a>01384         dirty_ = 1;
<a name="l01385"></a>01385       }
<a name="l01386"></a>01386       lastEntrySet = <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;
<a name="l01387"></a>01387       <span class="keywordflow">return</span>;
<a name="l01388"></a>01388     }
<a name="l01389"></a>01389   }
<a name="l01390"></a>01390   <span class="keywordflow">if</span> ( NEntry_==nEntry_ ) {
<a name="l01391"></a>01391     NEntry_ = NEntry_ ? NEntry_*2 : 10;
<a name="l01392"></a>01392     entry_ = (Entry*)realloc( entry_, NEntry_ * <span class="keyword">sizeof</span>(Entry) );
<a name="l01393"></a>01393   }
<a name="l01394"></a>01394   entry_[ nEntry_ ].name = strdup( name );
<a name="l01395"></a>01395   entry_[ nEntry_ ].value = value?strdup( value ):0;
<a name="l01396"></a>01396   lastEntrySet = nEntry_;
<a name="l01397"></a>01397   nEntry_++;
<a name="l01398"></a>01398   dirty_ = 1;
<a name="l01399"></a>01399 }
<a name="l01400"></a>01400 
<a name="l01401"></a>01401 <span class="comment">// create or set a value (or annotation) from a single line in the file buffer</span>
<a name="l01402"></a>01402 <span class="keywordtype">void</span> <a class="code" href="classFl__Preferences.html#a1928e8ca3f21f66304951b757f24d70a">Fl_Preferences::Node::set</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *line ) {
<a name="l01403"></a>01403   <span class="comment">// hmm. If we assume that we always read this file in the beginning,</span>
<a name="l01404"></a>01404   <span class="comment">// we can handle the dirty flag &#39;quick and dirty&#39;</span>
<a name="l01405"></a>01405   <span class="keywordtype">char</span> dirt = dirty_;
<a name="l01406"></a>01406   <span class="keywordflow">if</span> ( line[0]==<span class="charliteral">&#39;;&#39;</span> || line[0]==0 || line[0]==<span class="charliteral">&#39;#&#39;</span> ) {
<a name="l01407"></a>01407     <span class="keyword">set</span>( line, 0 );
<a name="l01408"></a>01408   } <span class="keywordflow">else</span> {
<a name="l01409"></a>01409     <span class="keyword">const</span> <span class="keywordtype">char</span> *c = strchr( line, <span class="charliteral">&#39;:&#39;</span> );
<a name="l01410"></a>01410     <span class="keywordflow">if</span> ( c ) {
<a name="l01411"></a>01411       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len = c-line+1;
<a name="l01412"></a>01412       <span class="keywordflow">if</span> ( len &gt;= <span class="keyword">sizeof</span>( nameBuffer ) )
<a name="l01413"></a>01413         len = <span class="keyword">sizeof</span>( nameBuffer );
<a name="l01414"></a>01414       <a class="code" href="flstring_8h.html#a61ae5a0c7536d81d0fb52661f75254cb">strlcpy</a>( nameBuffer, line, len );
<a name="l01415"></a>01415       <span class="keyword">set</span>( nameBuffer, c+1 );
<a name="l01416"></a>01416     } <span class="keywordflow">else</span> {
<a name="l01417"></a>01417       <span class="keyword">set</span>( line, <span class="stringliteral">&quot;&quot;</span> );
<a name="l01418"></a>01418     }
<a name="l01419"></a>01419   }
<a name="l01420"></a>01420   dirty_ = dirt;
<a name="l01421"></a>01421 }
<a name="l01422"></a>01422 
<a name="l01423"></a>01423 <span class="comment">// add more data to an existing entry</span>
<a name="l01424"></a>01424 <span class="keywordtype">void</span> Fl_Preferences::Node::add( <span class="keyword">const</span> <span class="keywordtype">char</span> *line ) {
<a name="l01425"></a>01425   <span class="keywordflow">if</span> ( lastEntrySet&lt;0 || lastEntrySet&gt;=nEntry_ ) <span class="keywordflow">return</span>;
<a name="l01426"></a>01426   <span class="keywordtype">char</span> *&amp;dst = entry_[ lastEntrySet ].value;
<a name="l01427"></a>01427   <span class="keywordtype">int</span> a = strlen( dst );
<a name="l01428"></a>01428   <span class="keywordtype">int</span> b = strlen( line );
<a name="l01429"></a>01429   dst = (<span class="keywordtype">char</span>*)realloc( dst, a+b+1 );
<a name="l01430"></a>01430   memcpy( dst+a, line, b+1 );
<a name="l01431"></a>01431   dirty_ = 1;
<a name="l01432"></a>01432 }
<a name="l01433"></a>01433 
<a name="l01434"></a>01434 <span class="comment">// get the value for a name, returns 0 if no such name</span>
<a name="l01435"></a>01435 <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">Fl_Preferences::Node::get</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *name ) {
<a name="l01436"></a>01436   <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = getEntry( name );
<a name="l01437"></a>01437   <span class="keywordflow">return</span> i&gt;=0 ? entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].value : 0 ;
<a name="l01438"></a>01438 }
<a name="l01439"></a>01439 
<a name="l01440"></a>01440 <span class="comment">// find the index of an entry, returns -1 if no such entry</span>
<a name="l01441"></a>01441 <span class="keywordtype">int</span> Fl_Preferences::Node::getEntry( <span class="keyword">const</span> <span class="keywordtype">char</span> *name ) {
<a name="l01442"></a>01442   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>=0; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>&lt;nEntry_; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>++ ) {
<a name="l01443"></a>01443     <span class="keywordflow">if</span> ( strcmp( name, entry_[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>].name ) == 0 ) {
<a name="l01444"></a>01444       <span class="keywordflow">return</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;
<a name="l01445"></a>01445     }
<a name="l01446"></a>01446   }
<a name="l01447"></a>01447   <span class="keywordflow">return</span> -1;
<a name="l01448"></a>01448 }
<a name="l01449"></a>01449 
<a name="l01450"></a>01450 <span class="comment">// remove one entry form this group</span>
<a name="l01451"></a>01451 <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a3a1710633307e8e79ba8fd89a803042e">Fl_Preferences::Node::deleteEntry</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *name ) {
<a name="l01452"></a>01452   <span class="keywordtype">int</span> ix = getEntry( name );
<a name="l01453"></a>01453   <span class="keywordflow">if</span> ( ix == -1 ) <span class="keywordflow">return</span> 0;
<a name="l01454"></a>01454   memmove( entry_+ix, entry_+ix+1, (nEntry_-ix-1) * <span class="keyword">sizeof</span>(Entry) );
<a name="l01455"></a>01455   nEntry_--;
<a name="l01456"></a>01456   dirty_ = 1;
<a name="l01457"></a>01457   <span class="keywordflow">return</span> 1;
<a name="l01458"></a>01458 }
<a name="l01459"></a>01459 
<a name="l01460"></a>01460 <span class="comment">// find a group somewhere in the tree starting here</span>
<a name="l01461"></a>01461 <span class="comment">// - this method will always return a valid node (except for memory allocation problems)</span>
<a name="l01462"></a>01462 <span class="comment">// - if the node was not found, &#39;find&#39; will create the required branch</span>
<a name="l01463"></a>01463 <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Fl_Preferences::Node</a> *Fl_Preferences::Node::find( <span class="keyword">const</span> <span class="keywordtype">char</span> *path ) {
<a name="l01464"></a>01464   <span class="keywordtype">int</span> len = strlen( path_ );
<a name="l01465"></a>01465   <span class="keywordflow">if</span> ( strncmp( path, path_, len ) == 0 ) {
<a name="l01466"></a>01466     <span class="keywordflow">if</span> ( path[ len ] == 0 )
<a name="l01467"></a>01467       <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l01468"></a>01468     <span class="keywordflow">if</span> ( path[ len ] == <span class="charliteral">&#39;/&#39;</span> ) {
<a name="l01469"></a>01469       <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nd;
<a name="l01470"></a>01470       <span class="keywordflow">for</span> ( nd = child_; nd; nd = nd-&gt;next_ ) {
<a name="l01471"></a>01471         <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nn = nd-&gt;find( path );
<a name="l01472"></a>01472         <span class="keywordflow">if</span> ( nn ) <span class="keywordflow">return</span> nn;
<a name="l01473"></a>01473       }
<a name="l01474"></a>01474       <span class="keyword">const</span> <span class="keywordtype">char</span> *s = path+len+1;
<a name="l01475"></a>01475       <span class="keyword">const</span> <span class="keywordtype">char</span> *e = strchr( s, <span class="charliteral">&#39;/&#39;</span> );
<a name="l01476"></a>01476       <span class="keywordflow">if</span> (e) <a class="code" href="flstring_8h.html#a61ae5a0c7536d81d0fb52661f75254cb">strlcpy</a>( nameBuffer, s, e-s+1 );
<a name="l01477"></a>01477       <span class="keywordflow">else</span> <a class="code" href="flstring_8h.html#a61ae5a0c7536d81d0fb52661f75254cb">strlcpy</a>( nameBuffer, s, <span class="keyword">sizeof</span>(nameBuffer));
<a name="l01478"></a>01478       nd = <span class="keyword">new</span> <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a>( nameBuffer );
<a name="l01479"></a>01479       nd-&gt;setParent( <span class="keyword">this</span> );
<a name="l01480"></a>01480       <span class="keywordflow">return</span> nd-&gt;find( path );
<a name="l01481"></a>01481     }
<a name="l01482"></a>01482   }
<a name="l01483"></a>01483   <span class="keywordflow">return</span> 0;
<a name="l01484"></a>01484 }
<a name="l01485"></a>01485 
<a name="l01486"></a>01486 <span class="comment">// find a group somewhere in the tree starting here</span>
<a name="l01487"></a>01487 <span class="comment">// caller must not set &#39;offset&#39; argument</span>
<a name="l01488"></a>01488 <span class="comment">// - if the node does not exist, &#39;search&#39; returns NULL</span>
<a name="l01489"></a>01489 <span class="comment">// - if the pathname is &quot;.&quot; (current node) return this node</span>
<a name="l01490"></a>01490 <span class="comment">// - if the pathname is &quot;./&quot; (root node) return the topmost node</span>
<a name="l01491"></a>01491 <span class="comment">// - if the pathname starts with &quot;./&quot;, start the search at the root node instead</span>
<a name="l01492"></a>01492 <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Fl_Preferences::Node</a> *Fl_Preferences::Node::search( <span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> offset ) { 
<a name="l01493"></a>01493   <span class="keywordflow">if</span> ( offset == 0 ) {
<a name="l01494"></a>01494     <span class="keywordflow">if</span> ( path[0] == <span class="charliteral">&#39;.&#39;</span> ) {
<a name="l01495"></a>01495       <span class="keywordflow">if</span> ( path[1] == 0 ) {
<a name="l01496"></a>01496         <span class="keywordflow">return</span> <span class="keyword">this</span>; <span class="comment">// user was searching for current node</span>
<a name="l01497"></a>01497       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( path[1] == <span class="charliteral">&#39;/&#39;</span> ) {
<a name="l01498"></a>01498         <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nn = <span class="keyword">this</span>;
<a name="l01499"></a>01499         <span class="keywordflow">while</span> ( nn-&gt;parent() ) nn = nn-&gt;parent();
<a name="l01500"></a>01500         <span class="keywordflow">if</span> ( path[2]==0 ) {             <span class="comment">// user is searching for root ( &quot;./&quot; )</span>
<a name="l01501"></a>01501           <span class="keywordflow">return</span> nn;
<a name="l01502"></a>01502         }
<a name="l01503"></a>01503         <span class="keywordflow">return</span> nn-&gt;search( path+2, 2 ); <span class="comment">// do a relative search on the root node</span>
<a name="l01504"></a>01504       }
<a name="l01505"></a>01505     }
<a name="l01506"></a>01506     offset = strlen( path_ ) + 1;
<a name="l01507"></a>01507   }
<a name="l01508"></a>01508   <span class="keywordtype">int</span> len = strlen( path_ );
<a name="l01509"></a>01509   <span class="keywordflow">if</span> ( len &lt; offset-1 ) <span class="keywordflow">return</span> 0;
<a name="l01510"></a>01510   len -= offset;
<a name="l01511"></a>01511   <span class="keywordflow">if</span> ( ( len &lt;= 0 ) || ( strncmp( path, path_+offset, len ) == 0 ) ) {
<a name="l01512"></a>01512     <span class="keywordflow">if</span> ( len &gt; 0 &amp;&amp; path[ len ] == 0 )
<a name="l01513"></a>01513       <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l01514"></a>01514     <span class="keywordflow">if</span> ( len &lt;= 0 || path[ len ] == <span class="charliteral">&#39;/&#39;</span> ) {
<a name="l01515"></a>01515       <span class="keywordflow">for</span> ( <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nd = child_; nd; nd = nd-&gt;next_ ) {
<a name="l01516"></a>01516         <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nn = nd-&gt;search( path, offset );
<a name="l01517"></a>01517         <span class="keywordflow">if</span> ( nn ) <span class="keywordflow">return</span> nn;
<a name="l01518"></a>01518       }
<a name="l01519"></a>01519       <span class="keywordflow">return</span> 0;
<a name="l01520"></a>01520     }
<a name="l01521"></a>01521   }
<a name="l01522"></a>01522   <span class="keywordflow">return</span> 0;
<a name="l01523"></a>01523 }
<a name="l01524"></a>01524 
<a name="l01525"></a>01525 <span class="comment">// return the number of child nodes (groups)</span>
<a name="l01526"></a>01526 <span class="keywordtype">int</span> Fl_Preferences::Node::nChildren() {
<a name="l01527"></a>01527   <span class="keywordflow">if</span> (indexed_) {
<a name="l01528"></a>01528     <span class="keywordflow">return</span> nIndex_;
<a name="l01529"></a>01529   } <span class="keywordflow">else</span> {
<a name="l01530"></a>01530     <span class="keywordtype">int</span> cnt = 0;
<a name="l01531"></a>01531     <span class="keywordflow">for</span> ( <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nd = child_; nd; nd = nd-&gt;next_ )
<a name="l01532"></a>01532       cnt++;
<a name="l01533"></a>01533     <span class="keywordflow">return</span> cnt;
<a name="l01534"></a>01534   }
<a name="l01535"></a>01535 }
<a name="l01536"></a>01536 
<a name="l01537"></a>01537 <span class="comment">// return the node name</span>
<a name="l01538"></a>01538 <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="classFl__Preferences.html#a6ff11b679bec179ebb211c31f8e46f2e">Fl_Preferences::Node::name</a>() {
<a name="l01539"></a>01539   <span class="keywordflow">if</span> ( path_ ) {
<a name="l01540"></a>01540     <span class="keywordtype">char</span> *r = strrchr( path_, <span class="charliteral">&#39;/&#39;</span> );
<a name="l01541"></a>01541     <span class="keywordflow">return</span> r ? r+1 : path_ ;
<a name="l01542"></a>01542   } <span class="keywordflow">else</span> {
<a name="l01543"></a>01543     <span class="keywordflow">return</span> 0L ;
<a name="l01544"></a>01544   }
<a name="l01545"></a>01545 }
<a name="l01546"></a>01546 
<a name="l01547"></a>01547 <span class="comment">// return the n&#39;th child node&#39;s name</span>
<a name="l01548"></a>01548 <span class="keyword">const</span> <span class="keywordtype">char</span> *Fl_Preferences::Node::child( <span class="keywordtype">int</span> ix ) {
<a name="l01549"></a>01549   <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nd = childNode( ix );
<a name="l01550"></a>01550   <span class="keywordflow">if</span> ( nd )
<a name="l01551"></a>01551     <span class="keywordflow">return</span> nd-&gt;name();
<a name="l01552"></a>01552   <span class="keywordflow">else</span>
<a name="l01553"></a>01553     <span class="keywordflow">return</span> 0L ;
<a name="l01554"></a>01554 }
<a name="l01555"></a>01555 
<a name="l01556"></a>01556 <span class="comment">// return the n&#39;th child node</span>
<a name="l01557"></a>01557 <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Fl_Preferences::Node</a> *Fl_Preferences::Node::childNode( <span class="keywordtype">int</span> ix ) {
<a name="l01558"></a>01558   createIndex();
<a name="l01559"></a>01559   <span class="keywordflow">if</span> (indexed_) {
<a name="l01560"></a>01560     <span class="comment">// usually faster access in correct order, but needing more memory</span>
<a name="l01561"></a>01561     <span class="keywordflow">return</span> index_[ix];
<a name="l01562"></a>01562   } <span class="keywordflow">else</span> {
<a name="l01563"></a>01563     <span class="comment">// slow access and reverse order</span>
<a name="l01564"></a>01564     <span class="keywordtype">int</span> n = nChildren();
<a name="l01565"></a>01565     ix = n - ix -1;
<a name="l01566"></a>01566     <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nd;
<a name="l01567"></a>01567     <span class="keywordflow">for</span> ( nd = child_; nd; nd = nd-&gt;next_ ) {
<a name="l01568"></a>01568       <span class="keywordflow">if</span> ( !ix-- ) <span class="keywordflow">break</span>;
<a name="l01569"></a>01569       <span class="keywordflow">if</span> ( !nd ) <span class="keywordflow">break</span>;
<a name="l01570"></a>01570     }
<a name="l01571"></a>01571     <span class="keywordflow">return</span> nd;
<a name="l01572"></a>01572   }
<a name="l01573"></a>01573 }
<a name="l01574"></a>01574 
<a name="l01575"></a>01575 <span class="comment">// remove myself from the list and delete me (and all children)</span>
<a name="l01576"></a>01576 <span class="keywordtype">char</span> <a class="code" href="classFl__Preferences.html#a7b9960e5ac57a9a9af4cb3bfe422320f">Fl_Preferences::Node::remove</a>() {
<a name="l01577"></a>01577   <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nd = 0, *np;
<a name="l01578"></a>01578   <span class="keywordflow">if</span> ( parent() ) {
<a name="l01579"></a>01579     nd = parent()-&gt;child_; np = 0L;
<a name="l01580"></a>01580     <span class="keywordflow">for</span> ( ; nd; np = nd, nd = nd-&gt;next_ ) {
<a name="l01581"></a>01581       <span class="keywordflow">if</span> ( nd == <span class="keyword">this</span> ) {
<a name="l01582"></a>01582         <span class="keywordflow">if</span> ( np )
<a name="l01583"></a>01583           np-&gt;next_ = nd-&gt;next_;
<a name="l01584"></a>01584         <span class="keywordflow">else</span>
<a name="l01585"></a>01585           parent()-&gt;child_ = nd-&gt;next_;
<a name="l01586"></a>01586         <span class="keywordflow">break</span>;
<a name="l01587"></a>01587       }
<a name="l01588"></a>01588     }
<a name="l01589"></a>01589     parent()-&gt;dirty_ = 1;
<a name="l01590"></a>01590     parent()-&gt;updateIndex();
<a name="l01591"></a>01591   }
<a name="l01592"></a>01592   <span class="keyword">delete</span> <span class="keyword">this</span>;
<a name="l01593"></a>01593   <span class="keywordflow">return</span> ( nd != 0 );
<a name="l01594"></a>01594 }
<a name="l01595"></a>01595 
<a name="l01596"></a>01596 <span class="keywordtype">void</span> Fl_Preferences::Node::createIndex() {
<a name="l01597"></a>01597   <span class="keywordflow">if</span> (indexed_) <span class="keywordflow">return</span>;
<a name="l01598"></a>01598   <span class="keywordtype">int</span> n = nChildren();
<a name="l01599"></a>01599   <span class="keywordflow">if</span> (n&gt;NIndex_) {
<a name="l01600"></a>01600     NIndex_ = n + 16;
<a name="l01601"></a>01601     index_ = (<a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a>**)realloc(index_, NIndex_*<span class="keyword">sizeof</span>(<a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a>**));
<a name="l01602"></a>01602   }
<a name="l01603"></a>01603   <a class="code" href="classFl__Preferences.html#a6db9d28bd448a131448276ee03de1e6d">Node</a> *nd;
<a name="l01604"></a>01604   <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0;
<a name="l01605"></a>01605   <span class="keywordflow">for</span> (nd = child_; nd; nd = nd-&gt;next_, i++) {
<a name="l01606"></a>01606     index_[n-i-1] = nd;
<a name="l01607"></a>01607   }
<a name="l01608"></a>01608   nIndex_ = n;
<a name="l01609"></a>01609   indexed_ = 1;
<a name="l01610"></a>01610 }
<a name="l01611"></a>01611 
<a name="l01612"></a>01612 <span class="keywordtype">void</span> Fl_Preferences::Node::updateIndex() {
<a name="l01613"></a>01613   indexed_ = 0;
<a name="l01614"></a>01614 }
<a name="l01615"></a>01615 
<a name="l01616"></a>01616 <span class="keywordtype">void</span> Fl_Preferences::Node::deleteIndex() {
<a name="l01617"></a>01617   <span class="keywordflow">if</span> (index_) free(index_);
<a name="l01618"></a>01618   NIndex_ = nIndex_ = 0;
<a name="l01619"></a>01619   index_ = 0;
<a name="l01620"></a>01620   indexed_ = 0;
<a name="l01621"></a>01621 }
<a name="l01622"></a>01622 
<a name="l01629"></a><a class="code" href="classFl__Plugin.html#a968b52aedafd49c59efe074a45dbfdd5">01629</a> <a class="code" href="classFl__Plugin.html#a968b52aedafd49c59efe074a45dbfdd5" title="Create a plugin.">Fl_Plugin::Fl_Plugin</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *klass, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l01630"></a>01630 : <a class="code" href="structid.html">id</a>(0) {
<a name="l01631"></a>01631 <span class="preprocessor">#ifdef FL_PLUGIN_VERBOSE</span>
<a name="l01632"></a>01632 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;Fl_Plugin: creating a plugin, class \&quot;%s\&quot;, name \&quot;%s\&quot;\n&quot;</span>,
<a name="l01633"></a>01633          klass, name);
<a name="l01634"></a>01634 <span class="preprocessor">#endif</span>
<a name="l01635"></a>01635 <span class="preprocessor"></span>  <a class="code" href="classFl__Plugin__Manager.html" title="Fl_Plugin_Manager manages link-time and run-time plugin binaries.">Fl_Plugin_Manager</a> pm(klass);
<a name="l01636"></a>01636   <span class="keywordtype">id</span> = pm.<a class="code" href="classFl__Plugin__Manager.html#a8164ddc304b93f62a28c33c3da45af05" title="This function adds a new plugin to the database.">addPlugin</a>(name, <span class="keyword">this</span>);
<a name="l01637"></a>01637 }
<a name="l01638"></a>01638 
<a name="l01642"></a><a class="code" href="classFl__Plugin.html#aad6ac33a7ee6200c2ec14cc4b5a1de6e">01642</a> <a class="code" href="classFl__Plugin.html#aad6ac33a7ee6200c2ec14cc4b5a1de6e" title="Clear the plugin and remove it from the database.">Fl_Plugin::~Fl_Plugin</a>() {
<a name="l01643"></a>01643 <span class="preprocessor">#ifdef FL_PLUGIN_VERBOSE</span>
<a name="l01644"></a>01644 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;Fl_Plugin: deleting a plugin\n&quot;</span>);
<a name="l01645"></a>01645 <span class="preprocessor">#endif</span>
<a name="l01646"></a>01646 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<span class="keywordtype">id</span>)
<a name="l01647"></a>01647     <a class="code" href="classFl__Preferences.html#a7b9960e5ac57a9a9af4cb3bfe422320f">Fl_Plugin_Manager::remove</a>(<span class="keywordtype">id</span>);
<a name="l01648"></a>01648 }
<a name="l01649"></a>01649 
<a name="l01653"></a><a class="code" href="classFl__Plugin__Manager.html#a925e0caea1944ad56fded0c4d8f2e1fb">01653</a> <a class="code" href="classFl__Plugin__Manager.html#a925e0caea1944ad56fded0c4d8f2e1fb" title="Manage all plugins belonging to one class.">Fl_Plugin_Manager::Fl_Plugin_Manager</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *klass)
<a name="l01654"></a>01654 : <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a>(0, <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a>::<a class="code" href="classFl__Preferences_1_1Name.html">Name</a>(<span class="stringliteral">&quot;%s/%s&quot;</span>, <span class="stringliteral">&quot;plugins&quot;</span>, klass)) {
<a name="l01655"></a>01655 <span class="preprocessor">#ifdef FL_PLUGIN_VERBOSE</span>
<a name="l01656"></a>01656 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;Fl_Plugin: creating a plugin manager for class \&quot;%s\&quot;\n&quot;</span>, klass);
<a name="l01657"></a>01657 <span class="preprocessor">#endif</span>
<a name="l01658"></a>01658 <span class="preprocessor"></span>}
<a name="l01659"></a>01659 
<a name="l01666"></a><a class="code" href="classFl__Plugin__Manager.html#a1cad84738f8549ff1efa857ade308c77">01666</a> <a class="code" href="classFl__Plugin__Manager.html#a1cad84738f8549ff1efa857ade308c77" title="Remove the plugin manager.">Fl_Plugin_Manager::~Fl_Plugin_Manager</a>() {
<a name="l01667"></a>01667 <span class="preprocessor">#ifdef FL_PLUGIN_VERBOSE</span>
<a name="l01668"></a>01668 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;Fl_Plugin: deleting a plugin manager\n&quot;</span>);
<a name="l01669"></a>01669 <span class="preprocessor">#endif</span>
<a name="l01670"></a>01670 <span class="preprocessor"></span>}
<a name="l01671"></a>01671 
<a name="l01672"></a>01672 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> x2i(<span class="keywordtype">char</span> hi, <span class="keywordtype">char</span> lo) {
<a name="l01673"></a>01673   <span class="keywordflow">return</span> ((hi-<span class="charliteral">&#39;A&#39;</span>)&lt;&lt;4) | (lo-<span class="charliteral">&#39;A&#39;</span>);
<a name="l01674"></a>01674 }
<a name="l01675"></a>01675 
<a name="l01676"></a>01676 <span class="keyword">static</span> <span class="keywordtype">void</span> i2x(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> v, <span class="keywordtype">char</span> *d) {
<a name="l01677"></a>01677   d[0] = ((v&gt;&gt;4)&amp;0x0f)+<span class="charliteral">&#39;A&#39;</span>; d[1] = (v&amp;0x0f)+<span class="charliteral">&#39;A&#39;</span>;
<a name="l01678"></a>01678 }
<a name="l01679"></a>01679 
<a name="l01680"></a>01680 <span class="keyword">static</span> <span class="keywordtype">void</span> *a2p(<span class="keyword">const</span> <span class="keywordtype">char</span> *s) {
<a name="l01681"></a>01681   <span class="keyword">union </span>{ <span class="keywordtype">void</span> *ret; <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d[<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*)]; } v;
<a name="l01682"></a>01682   v.ret = 0L;
<a name="l01683"></a>01683   <span class="keywordtype">int</span> i=0, n=<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*);
<a name="l01684"></a>01684   <span class="keywordflow">for</span> (i=0; i&lt;n; i++) {
<a name="l01685"></a>01685     v.d[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = x2i(s[2*i], s[2*i+1]);
<a name="l01686"></a>01686   }
<a name="l01687"></a>01687   <span class="keywordflow">return</span> v.ret;
<a name="l01688"></a>01688 }
<a name="l01689"></a>01689 
<a name="l01690"></a>01690 <span class="keyword">static</span> <span class="keywordtype">void</span> p2a(<span class="keywordtype">void</span> *vp, <span class="keywordtype">char</span> *d) {
<a name="l01691"></a>01691   <span class="keyword">union </span>{ <span class="keywordtype">void</span> *vp; <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> s[<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*)]; } v;
<a name="l01692"></a>01692   v.vp = vp;
<a name="l01693"></a>01693   <span class="keywordtype">int</span> i=0, n=<span class="keyword">sizeof</span>(<span class="keywordtype">void</span>*);
<a name="l01694"></a>01694   <span class="keywordflow">for</span> (i=0; i&lt;n; i++) {
<a name="l01695"></a>01695     i2x(v.s[i], d+i*2);
<a name="l01696"></a>01696   }
<a name="l01697"></a>01697   d[2*<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = 0;
<a name="l01698"></a>01698 }
<a name="l01699"></a>01699 
<a name="l01703"></a><a class="code" href="classFl__Plugin__Manager.html#a011f00cd299954fd229fc0d3fbcffca5">01703</a> <a class="code" href="classFl__Plugin.html" title="Fl_Plugin allows link-time and run-time integration of binary modules.">Fl_Plugin</a> *<a class="code" href="classFl__Plugin__Manager.html#a011f00cd299954fd229fc0d3fbcffca5" title="Return the address of a plugin by index.">Fl_Plugin_Manager::plugin</a>(<span class="keywordtype">int</span> index) {
<a name="l01704"></a>01704   <span class="keywordtype">char</span> buf[34];
<a name="l01705"></a>01705   <a class="code" href="classFl__Plugin.html" title="Fl_Plugin allows link-time and run-time integration of binary modules.">Fl_Plugin</a> *ret = 0;
<a name="l01706"></a>01706   <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> pin(<span class="keyword">this</span>, index);
<a name="l01707"></a>01707   pin.<a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">get</a>(<span class="stringliteral">&quot;address&quot;</span>, buf, <span class="stringliteral">&quot;&quot;</span>, 34);
<a name="l01708"></a>01708   <span class="keywordflow">if</span> (buf[0]==<span class="charliteral">&#39;@&#39;</span>) ret = (<a class="code" href="classFl__Plugin.html" title="Fl_Plugin allows link-time and run-time integration of binary modules.">Fl_Plugin</a>*)a2p(buf+1);
<a name="l01709"></a>01709 <span class="preprocessor">#ifdef FL_PLUGIN_VERBOSE</span>
<a name="l01710"></a>01710 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;Fl_Plugin: returning plugin at index %d: (%s) %p\n&quot;</span>, index, buf, ret);
<a name="l01711"></a>01711 <span class="preprocessor">#endif</span>
<a name="l01712"></a>01712 <span class="preprocessor"></span>  <span class="keywordflow">return</span> ret;
<a name="l01713"></a>01713 }
<a name="l01714"></a>01714 
<a name="l01718"></a><a class="code" href="classFl__Plugin__Manager.html#a0b544ffc787a497bddc4f5f69ebd5e91">01718</a> <a class="code" href="classFl__Plugin.html" title="Fl_Plugin allows link-time and run-time integration of binary modules.">Fl_Plugin</a> *<a class="code" href="classFl__Plugin__Manager.html#a011f00cd299954fd229fc0d3fbcffca5" title="Return the address of a plugin by index.">Fl_Plugin_Manager::plugin</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name) {
<a name="l01719"></a>01719   <span class="keywordtype">char</span> buf[34];
<a name="l01720"></a>01720   <a class="code" href="classFl__Plugin.html" title="Fl_Plugin allows link-time and run-time integration of binary modules.">Fl_Plugin</a> *ret = 0;
<a name="l01721"></a>01721   <span class="keywordflow">if</span> (<a class="code" href="classFl__Preferences.html#a4009efec7d5505a8060ca7a95c1bee2e">groupExists</a>(name)) {
<a name="l01722"></a>01722     <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> pin(<span class="keyword">this</span>, name);
<a name="l01723"></a>01723     pin.<a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">get</a>(<span class="stringliteral">&quot;address&quot;</span>, buf, <span class="stringliteral">&quot;&quot;</span>, 34);
<a name="l01724"></a>01724     <span class="keywordflow">if</span> (buf[0]==<span class="charliteral">&#39;@&#39;</span>) ret = (<a class="code" href="classFl__Plugin.html" title="Fl_Plugin allows link-time and run-time integration of binary modules.">Fl_Plugin</a>*)a2p(buf+1);
<a name="l01725"></a>01725 <span class="preprocessor">#ifdef FL_PLUGIN_VERBOSE</span>
<a name="l01726"></a>01726 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;Fl_Plugin: returning plugin named \&quot;%s\&quot;: (%s) %p\n&quot;</span>, name, buf, ret);
<a name="l01727"></a>01727 <span class="preprocessor">#endif</span>
<a name="l01728"></a>01728 <span class="preprocessor"></span>    <span class="keywordflow">return</span> ret;
<a name="l01729"></a>01729   } <span class="keywordflow">else</span> {
<a name="l01730"></a>01730 <span class="preprocessor">#ifdef FL_PLUGIN_VERBOSE</span>
<a name="l01731"></a>01731 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;Fl_Plugin: no plugin found named \&quot;%s\&quot;\n&quot;</span>, name);
<a name="l01732"></a>01732 <span class="preprocessor">#endif</span>
<a name="l01733"></a>01733 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0L;
<a name="l01734"></a>01734   }
<a name="l01735"></a>01735 }
<a name="l01736"></a>01736 
<a name="l01743"></a><a class="code" href="classFl__Plugin__Manager.html#a8164ddc304b93f62a28c33c3da45af05">01743</a> <a class="code" href="classFl__Preferences.html#a7050f8b1c0cbb70693e61bcfbf4f5853">Fl_Preferences::ID</a> <a class="code" href="classFl__Plugin__Manager.html#a8164ddc304b93f62a28c33c3da45af05" title="This function adds a new plugin to the database.">Fl_Plugin_Manager::addPlugin</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <a class="code" href="classFl__Plugin.html" title="Fl_Plugin allows link-time and run-time integration of binary modules.">Fl_Plugin</a> *plugin) {
<a name="l01744"></a>01744   <span class="keywordtype">char</span> buf[34];
<a name="l01745"></a>01745 <span class="preprocessor">#ifdef FL_PLUGIN_VERBOSE</span>
<a name="l01746"></a>01746 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;Fl_Plugin: adding plugin named \&quot;%s\&quot; at 0x%p\n&quot;</span>, name, plugin);
<a name="l01747"></a>01747 <span class="preprocessor">#endif</span>
<a name="l01748"></a>01748 <span class="preprocessor"></span>  <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> pin(<span class="keyword">this</span>, name);
<a name="l01749"></a>01749   buf[0] = <span class="charliteral">&#39;@&#39;</span>; p2a(plugin, buf+1);
<a name="l01750"></a>01750   pin.<a class="code" href="classFl__Preferences.html#a1928e8ca3f21f66304951b757f24d70a">set</a>(<span class="stringliteral">&quot;address&quot;</span>, buf);
<a name="l01751"></a>01751   <span class="keywordflow">return</span> pin.<a class="code" href="classFl__Preferences.html#a1170302365aa48fbd04335ca52c20319">id</a>();
<a name="l01752"></a>01752 }
<a name="l01753"></a>01753 
<a name="l01760"></a><a class="code" href="classFl__Plugin__Manager.html#a53a3fb139add0eee42393852da946fa6">01760</a> <span class="keywordtype">void</span> <a class="code" href="classFl__Plugin__Manager.html#a53a3fb139add0eee42393852da946fa6" title="Remove any plugin.">Fl_Plugin_Manager::removePlugin</a>(<a class="code" href="classFl__Preferences.html#a7050f8b1c0cbb70693e61bcfbf4f5853">Fl_Preferences::ID</a> <span class="keywordtype">id</span>) {
<a name="l01761"></a>01761   <a class="code" href="classFl__Preferences.html#a7b9960e5ac57a9a9af4cb3bfe422320f">Fl_Preferences::remove</a>(<span class="keywordtype">id</span>);
<a name="l01762"></a>01762 }
<a name="l01763"></a>01763 
<a name="l01772"></a><a class="code" href="classFl__Plugin__Manager.html#a6f134930bfa28277a18ea63d501212bc">01772</a> <span class="keywordtype">int</span> <a class="code" href="classFl__Plugin__Manager.html#a6f134930bfa28277a18ea63d501212bc" title="Load a module from disk.">Fl_Plugin_Manager::load</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {
<a name="l01773"></a>01773   <span class="comment">// the functions below will autmaticaly load plugins that are defined:</span>
<a name="l01774"></a>01774   <span class="comment">// Fl_My_Plugin plugin();</span>
<a name="l01775"></a>01775 <span class="preprocessor">#if defined(WIN32) &amp;&amp; !defined(__CYGWIN__)</span>
<a name="l01776"></a>01776 <span class="preprocessor"></span>  HMODULE dl = LoadLibrary(filename);
<a name="l01777"></a>01777 <span class="preprocessor">#else</span>
<a name="l01778"></a>01778 <span class="preprocessor"></span>  <span class="keywordtype">void</span> * dl = dlopen(filename, RTLD_LAZY);
<a name="l01779"></a>01779 <span class="preprocessor">#endif</span>
<a name="l01780"></a>01780 <span class="preprocessor"></span>  <span class="comment">// There is no way of unloading a plugin!</span>
<a name="l01781"></a>01781   <span class="keywordflow">return</span> (dl!=0) ? 0 : -1;
<a name="l01782"></a>01782 }
<a name="l01783"></a>01783 
<a name="l01787"></a><a class="code" href="classFl__Plugin__Manager.html#a4389f498c28e40e5c17c4cfdee35d434">01787</a> <span class="keywordtype">int</span> <a class="code" href="classFl__Plugin__Manager.html#a4389f498c28e40e5c17c4cfdee35d434" title="Use this function to load a whole directory full of modules.">Fl_Plugin_Manager::loadAll</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filepath, <span class="keyword">const</span> <span class="keywordtype">char</span> *pattern) {
<a name="l01788"></a>01788   <span class="keyword">struct </span><a class="code" href="numericsort_8c.html#a89957e9be80ef12a50eb4eca72ecd888">dirent</a> **dir;
<a name="l01789"></a>01789   <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>, n = <a class="code" href="filename__list_8cxx.html#ac6ea07dc2da2945414da1a2f072366db">fl_filename_list</a>(filepath, &amp;dir);
<a name="l01790"></a>01790   <span class="keywordflow">for</span> (i=0; i&lt;n; i++) {
<a name="l01791"></a>01791     <span class="keyword">struct </span><a class="code" href="numericsort_8c.html#a89957e9be80ef12a50eb4eca72ecd888">dirent</a> *e = dir[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];
<a name="l01792"></a>01792     <span class="keywordflow">if</span> (pattern==0 || <a class="code" href="group__filenames.html#gac4b44c55216afb84a7a9e75bd8b65793">fl_filename_match</a>(e-&gt;d_name, pattern)) {
<a name="l01793"></a>01793       <a class="code" href="classFl__Plugin__Manager.html#a6f134930bfa28277a18ea63d501212bc" title="Load a module from disk.">load</a>(<a class="code" href="classFl__Preferences_1_1Name.html">Fl_Preferences::Name</a>(<span class="stringliteral">&quot;%s%s&quot;</span>, filepath, e-&gt;d_name));
<a name="l01794"></a>01794     }
<a name="l01795"></a>01795     free(e);
<a name="l01796"></a>01796   }
<a name="l01797"></a>01797   free(dir);
<a name="l01798"></a>01798   <span class="keywordflow">return</span> 0;
<a name="l01799"></a>01799 }
<a name="l01800"></a>01800 
<a name="l01801"></a>01801 <span class="comment">//</span>
<a name="l01802"></a>01802 <span class="comment">// End of &quot;$Id: Fl_Preferences.cxx 8173 2011-01-03 16:50:34Z manolo $&quot;.</span>
<a name="l01803"></a>01803 <span class="comment">//</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="Fl__Preferences_8cxx.html">Fl_Preferences.cxx</a>      </li>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="#" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3</small></address>
</body>

<!-- Mirrored from dox.sfr-fresh.com/fltk-1.3.0rc3-source/Fl__Preferences_8cxx_source.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 16 Feb 2011 23:42:01 GMT -->
</html>
