<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from dox.sfr-fresh.com/fltk-1.3.0rc3-source/Fl_8cxx_source.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 16 Feb 2011 23:40:32 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SfR Fresh Dox - fltk: fltk-1.3.0rc3/src/Fl.cxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">fltk&#160;<span id="projectnumber">1.3.0rc3</span></div>
   <div id="projectbrief">About: <A HREF= http://www.fltk.org/>FLTK</A> (Fast Light Tool Kit) is a cross-platform C++ GUI toolkit for UNIX/Linux (X11), Microsoft Windows, and MacOS X. Release candidate.<BR><IMG SRC="../warix/forest1.gif" ALT="">&nbsp;&nbsp;<A HREF="http://www.sfr-fresh.com/" TITLE="SfR Fresh Home">SfR Fresh</A> <A HREF="http://www.sfr-fresh.com/warix/features.html#doxygen" TITLE="SfR Fresh Doxygen Support Info">Dox</A>: <A HREF="../fresh/unix/misc/fltk-1.3.0rc3-source.tar.gz/index.html" TITLE="SfR Fresh: fltk-1.3.0rc3-source.tar.gz Contents &amp; Download Page">fltk-1.3.0rc3-source.tar.gz</A> ("inofficial" and yet experimental doxygen-generated source code documentation)&nbsp;&nbsp;<IMG SRC="../warix/forest2.gif" ALT=""><P></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index-2.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('Fl_8cxx.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>Fl.cxx</h1>  </div>
</div>
<div class="contents">
<a href="Fl_8cxx.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//</span>
<a name="l00002"></a>00002 <span class="comment">// &quot;$Id: Fl.cxx 8198 2011-01-06 10:24:58Z manolo $&quot;</span>
<a name="l00003"></a>00003 <span class="comment">//</span>
<a name="l00004"></a>00004 <span class="comment">// Main event handling code for the Fast Light Tool Kit (FLTK).</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// Copyright 1998-2010 by Bill Spitzak and others.</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// This library is free software; you can redistribute it and/or</span>
<a name="l00009"></a>00009 <span class="comment">// modify it under the terms of the GNU Library General Public</span>
<a name="l00010"></a>00010 <span class="comment">// License as published by the Free Software Foundation; either</span>
<a name="l00011"></a>00011 <span class="comment">// version 2 of the License, or (at your option) any later version.</span>
<a name="l00012"></a>00012 <span class="comment">//</span>
<a name="l00013"></a>00013 <span class="comment">// This library is distributed in the hope that it will be useful,</span>
<a name="l00014"></a>00014 <span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00015"></a>00015 <span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00016"></a>00016 <span class="comment">// Library General Public License for more details.</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00018"></a>00018 <span class="comment">// You should have received a copy of the GNU Library General Public</span>
<a name="l00019"></a>00019 <span class="comment">// License along with this library; if not, write to the Free Software</span>
<a name="l00020"></a>00020 <span class="comment">// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307</span>
<a name="l00021"></a>00021 <span class="comment">// USA.</span>
<a name="l00022"></a>00022 <span class="comment">//</span>
<a name="l00023"></a>00023 <span class="comment">// Please report all bugs and problems on the following page:</span>
<a name="l00024"></a>00024 <span class="comment">//</span>
<a name="l00025"></a>00025 <span class="comment">//     http://www.fltk.org/str.php</span>
<a name="l00026"></a>00026 <span class="comment">//</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="comment">// warning: the Apple Quartz version still uses some Quickdraw calls,</span>
<a name="l00030"></a>00030 <span class="comment">//          mostly to get around the single active context in QD and </span>
<a name="l00031"></a>00031 <span class="comment">//          to implement clipping. This should be changed into pure</span>
<a name="l00032"></a>00032 <span class="comment">//          Quartz calls in the near future.</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;config.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;FL/Fl.H&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;FL/Fl_Window.H&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;FL/Fl_Tooltip.H&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="comment">// recent versions of MinGW warn: &quot;Please include winsock2.h before windows.h&quot;,</span>
<a name="l00039"></a>00039 <span class="comment">// hence we must include winsock2.h before FL/x.H (A.S. Dec. 2010)</span>
<a name="l00040"></a>00040 <span class="preprocessor">#if defined(WIN32) &amp;&amp; !defined(__CYGWIN__)</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;winsock2.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#endif</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;FL/x.H&gt;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="flstring_8h.html">flstring.h</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#if defined(DEBUG) || defined(DEBUG_WATCH)</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;stdio.h&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#endif // DEBUG || DEBUG_WATCH</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span>
<a name="l00055"></a>00055 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;ole2.h&gt;</span>
<a name="l00057"></a>00057 <span class="keywordtype">void</span> <a class="code" href="Fl__win32_8cxx.html#af93c6a7b96d557718567d62e2c33c05a">fl_free_fonts</a>(<span class="keywordtype">void</span>);
<a name="l00058"></a>00058 HBRUSH <a class="code" href="win32_8H.html#a86c3730bc0b49d63db75571c722f2f67">fl_brush_action</a>(<span class="keywordtype">int</span> action);
<a name="l00059"></a>00059 <span class="keywordtype">void</span> <a class="code" href="fl__color__win32_8cxx.html#a5aa367277d0c86c403411b085e42f550">fl_cleanup_pens</a>(<span class="keywordtype">void</span>);
<a name="l00060"></a>00060 <span class="keywordtype">void</span> <a class="code" href="win32_8H.html#a178a72db0c8af24e0f10eb126976246b">fl_release_dc</a>(HWND,HDC);
<a name="l00061"></a>00061 <span class="keywordtype">void</span> <a class="code" href="Fl__win32_8cxx.html#ae711fe1835478d81c72cc6cef7498510">fl_cleanup_dc_list</a>(<span class="keywordtype">void</span>);
<a name="l00062"></a>00062 <span class="preprocessor">#elif defined(__APPLE__)</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">double</span> fl_mac_flush_and_wait(<span class="keywordtype">double</span> time_to_wait, <span class="keywordtype">char</span> in_idle);
<a name="l00064"></a>00064 <span class="preprocessor">#endif // WIN32</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>
<a name="l00066"></a>00066 <span class="comment">//</span>
<a name="l00067"></a>00067 <span class="comment">// Globals...</span>
<a name="l00068"></a>00068 <span class="comment">//</span>
<a name="l00069"></a>00069 <span class="preprocessor">#ifndef FL_DOXYGEN</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><a class="code" href="classFl__Widget.html">Fl_Widget</a>       *<a class="code" href="classFl.html#a284ce0fc77a485dd055c6ce388067214">Fl::belowmouse_</a>,
<a name="l00071"></a>00071                 *<a class="code" href="classFl.html#aaccca760735f25575860bab90cc114c6">Fl::pushed_</a>,
<a name="l00072"></a>00072                 *<a class="code" href="classFl.html#a4584dfe66b9d546e3a7641053d210146">Fl::focus_</a>,
<a name="l00073"></a>00073                 *<a class="code" href="classFl.html#a92c4cbba96971c359c569a11ea17cc5a">Fl::selection_owner_</a>;
<a name="l00074"></a>00074 <span class="keywordtype">int</span>             <a class="code" href="classFl.html#a8ef5178467ee84042b29dc170a5c5fa8">Fl::damage_</a>,
<a name="l00075"></a>00075                 <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">Fl::e_number</a>,
<a name="l00076"></a>00076                 <a class="code" href="classFl.html#a7b57f90db4afa2b1b1e2e163e9bdc1d3">Fl::e_x</a>,
<a name="l00077"></a>00077                 <a class="code" href="classFl.html#a0c047ee4ea16066dc9e70bc6a4035c20">Fl::e_y</a>,
<a name="l00078"></a>00078                 <a class="code" href="classFl.html#ac905dc5f6e4b4c919e405932413fce30">Fl::e_x_root</a>,
<a name="l00079"></a>00079                 <a class="code" href="classFl.html#af14bafd28cbd839ab2e4526eb4a5c73f">Fl::e_y_root</a>,
<a name="l00080"></a>00080                 <a class="code" href="classFl.html#a3ef9e966bd64bac1a31bf926e7b640a2">Fl::e_dx</a>,
<a name="l00081"></a>00081                 <a class="code" href="classFl.html#a1ed9dbb954ea9d4d5eaae06ad0778708">Fl::e_dy</a>,
<a name="l00082"></a>00082                 <a class="code" href="classFl.html#a2d93787aec60cb62a759b36267dd9d06">Fl::e_state</a>,
<a name="l00083"></a>00083                 <a class="code" href="classFl.html#a6f6c6f8bf78bb722178aa19e501ae60e">Fl::e_clicks</a>,
<a name="l00084"></a>00084                 <a class="code" href="classFl.html#ad08a92882f820adac97a6dd98313e9b9">Fl::e_is_click</a>,
<a name="l00085"></a>00085                 <a class="code" href="classFl.html#ad7e56c414916c270ba98e38e2cf41e57">Fl::e_keysym</a>,
<a name="l00086"></a>00086                 <a class="code" href="classFl.html#a2bf425ec2398cff4531b2b8c879fc14e">Fl::e_original_keysym</a>,
<a name="l00087"></a>00087                 <a class="code" href="classFl.html#a914e2f882a7b7b9d94386d3bc0e41ba1">Fl::scrollbar_size_</a> = 16;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="keywordtype">char</span>            *<a class="code" href="classFl.html#addcd49b68feff0a807f6564f3fdb8016">Fl::e_text</a> = (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;&quot;</span>;
<a name="l00090"></a>00090 <span class="keywordtype">int</span>             <a class="code" href="classFl.html#a336911cf63dade9bbb9707b942785133">Fl::e_length</a>;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   Fl::options_[] = { 0, 0 };
<a name="l00093"></a>00093 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   Fl::options_read_ = 0;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="Fl_8cxx.html#a46f39949b9b9dd23677adf6e3708f27d">00096</a> <a class="code" href="classFl__Window.html">Fl_Window</a> *<a class="code" href="Fl_8cxx.html#a46f39949b9b9dd23677adf6e3708f27d">fl_xfocus</a>;   <span class="comment">// which window X thinks has focus</span>
<a name="l00097"></a><a class="code" href="Fl_8cxx.html#aa4a35d324647e7c092666054a4e58596">00097</a> <a class="code" href="classFl__Window.html">Fl_Window</a> *<a class="code" href="Fl_8cxx.html#aa4a35d324647e7c092666054a4e58596">fl_xmousewin</a>;<span class="comment">// which window X thinks has FL_ENTER</span>
<a name="l00098"></a>00098 <a class="code" href="classFl__Window.html">Fl_Window</a> *<a class="code" href="classFl.html#a324b968af75bc202198a3de655c7fc7f">Fl::grab_</a>;   <span class="comment">// most recent Fl::grab()</span>
<a name="l00099"></a>00099 <a class="code" href="classFl__Window.html">Fl_Window</a> *<a class="code" href="classFl.html#ab9927ecc1f8f3077079c5fabe8ec516e">Fl::modal_</a>;  <span class="comment">// topmost modal() window</span>
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="preprocessor">#endif // FL_DOXYGEN</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>
<a name="l00103"></a>00103 <span class="comment">//</span>
<a name="l00104"></a>00104 <span class="comment">// &#39;Fl::version()&#39; - Return the API version number...</span>
<a name="l00105"></a>00105 <span class="comment">//</span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="keywordtype">double</span>
<a name="l00112"></a><a class="code" href="classFl.html#ad65803adc5e4936111bd31a52f1d61a7">00112</a> <a class="code" href="classFl.html#ad65803adc5e4936111bd31a52f1d61a7">Fl::version</a>() {
<a name="l00113"></a>00113   <span class="keywordflow">return</span> <a class="code" href="Enumerations_8H.html#a94499c96b5f3ca212d90a2c41f947a67">FL_VERSION</a>;
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00124"></a><a class="code" href="classFl.html#a82c225037f05d07a7797da5eddafb33a">00124</a> <span class="keywordtype">int</span> <a class="code" href="classFl.html#a82c225037f05d07a7797da5eddafb33a">Fl::scrollbar_size</a>() {
<a name="l00125"></a>00125   <span class="keywordflow">return</span> <a class="code" href="classFl.html#a914e2f882a7b7b9d94386d3bc0e41ba1">scrollbar_size_</a>;
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00136"></a><a class="code" href="classFl.html#aa6d2b6e0d640b81c6ec44d0164ec0f91">00136</a> <span class="keywordtype">void</span> <a class="code" href="classFl.html#a82c225037f05d07a7797da5eddafb33a">Fl::scrollbar_size</a>(<span class="keywordtype">int</span> W) {
<a name="l00137"></a>00137   <a class="code" href="classFl.html#a914e2f882a7b7b9d94386d3bc0e41ba1">scrollbar_size_</a> = W;
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 
<a name="l00148"></a><a class="code" href="group__fl__events.html#ga277f38696ffa53b63325b13ac51976bb">00148</a> <span class="keywordtype">int</span> <a class="code" href="group__fl__events.html#ga277f38696ffa53b63325b13ac51976bb">Fl::event_inside</a>(<span class="keywordtype">int</span> xx,<span class="keywordtype">int</span> yy,<span class="keywordtype">int</span> ww,<span class="keywordtype">int</span> hh) <span class="comment">/*const*/</span> {
<a name="l00149"></a>00149   <span class="keywordtype">int</span> mx = <a class="code" href="classFl.html#a7b57f90db4afa2b1b1e2e163e9bdc1d3">e_x</a> - xx;
<a name="l00150"></a>00150   <span class="keywordtype">int</span> my = <a class="code" href="classFl.html#a0c047ee4ea16066dc9e70bc6a4035c20">e_y</a> - yy;
<a name="l00151"></a>00151   <span class="keywordflow">return</span> (mx &gt;= 0 &amp;&amp; mx &lt; ww &amp;&amp; my &gt;= 0 &amp;&amp; my &lt; hh);
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00160"></a><a class="code" href="group__fl__events.html#ga143c28ca9e41cb919be1c4c72227a475">00160</a> <span class="keywordtype">int</span> <a class="code" href="group__fl__events.html#ga277f38696ffa53b63325b13ac51976bb">Fl::event_inside</a>(<span class="keyword">const</span> <a class="code" href="classFl__Widget.html">Fl_Widget</a> *o) <span class="comment">/*const*/</span> {
<a name="l00161"></a>00161   <span class="keywordtype">int</span> mx = <a class="code" href="classFl.html#a7b57f90db4afa2b1b1e2e163e9bdc1d3">e_x</a> - o-&gt;<a class="code" href="classFl__Widget.html#abea0b9ad493d58bf7fda8d3c81d477b7">x</a>();
<a name="l00162"></a>00162   <span class="keywordtype">int</span> my = <a class="code" href="classFl.html#a0c047ee4ea16066dc9e70bc6a4035c20">e_y</a> - o-&gt;<a class="code" href="classFl__Widget.html#aec1aded9efdf5f23dfac8cc725cefc4a">y</a>();
<a name="l00163"></a>00163   <span class="keywordflow">return</span> (mx &gt;= 0 &amp;&amp; mx &lt; o-&gt;<a class="code" href="group__fl__screen.html#ga7aba4252407f539aa6d821551aaba5ff">w</a>() &amp;&amp; my &gt;= 0 &amp;&amp; my &lt; o-&gt;<a class="code" href="group__fl__screen.html#ga7f42d75cf9b3e79bbe39e1041a657cdf">h</a>());
<a name="l00164"></a>00164 }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="comment">//</span>
<a name="l00167"></a>00167 <span class="comment">//</span>
<a name="l00168"></a>00168 <span class="comment">// timer support</span>
<a name="l00169"></a>00169 <span class="comment">//</span>
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="preprocessor">#elif defined(__APPLE__)</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span>
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 <span class="preprocessor">#else</span>
<a name="l00180"></a>00180 <span class="preprocessor"></span>
<a name="l00181"></a>00181 <span class="comment">//</span>
<a name="l00182"></a>00182 <span class="comment">// X11 timers</span>
<a name="l00183"></a>00183 <span class="comment">//</span>
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 
<a name="l00187"></a>00187 <span class="comment">// Timeouts are stored in a sorted list, so only the first one needs</span>
<a name="l00188"></a>00188 <span class="comment">// to be checked to see if any should be called.</span>
<a name="l00189"></a>00189   
<a name="l00190"></a><a class="code" href="structTimeout.html">00190</a> <span class="keyword">struct </span><a class="code" href="structTimeout.html">Timeout</a> {
<a name="l00191"></a><a class="code" href="structTimeout.html#ab419eedd78bdd28ddcefdfc7e4e29278">00191</a>   <span class="keywordtype">double</span> <a class="code" href="structTimeout.html#ab419eedd78bdd28ddcefdfc7e4e29278">time</a>;
<a name="l00192"></a><a class="code" href="structTimeout.html#adeab82a6f45fecff13c31a086481cfda">00192</a>   <a class="code" href="png_8h.html#a04364e387081209df3bd1a16e8abe3b9">void</a> (*<a class="code" href="structTimeout.html#adeab82a6f45fecff13c31a086481cfda">cb</a>)(<span class="keywordtype">void</span>*);
<a name="l00193"></a><a class="code" href="structTimeout.html#a6e90336b6faf330edf01d27a6405bb27">00193</a>   <span class="keywordtype">void</span>* <a class="code" href="structTimeout.html#a6e90336b6faf330edf01d27a6405bb27">arg</a>;
<a name="l00194"></a><a class="code" href="structTimeout.html#a785bad0da582108cdad2c3025cacec40">00194</a>   <a class="code" href="structTimeout.html">Timeout</a>* <a class="code" href="structTimeout.html#a785bad0da582108cdad2c3025cacec40">next</a>;
<a name="l00195"></a>00195 };
<a name="l00196"></a><a class="code" href="Fl_8cxx.html#a8c4db4be5bd25f31d08263a476ed1d9e">00196</a> <span class="keyword">static</span> <a class="code" href="structTimeout.html">Timeout</a>* first_timeout, *<a class="code" href="Fl_8cxx.html#a8c4db4be5bd25f31d08263a476ed1d9e">free_timeout</a>;
<a name="l00197"></a><a class="code" href="Fl_8cxx.html#ae09dff64127bcd89028d38e5d53e5b72">00197</a> <span class="keyword">static</span> <span class="keywordtype">int</span> first_timeout_count, <a class="code" href="Fl_8cxx.html#ae09dff64127bcd89028d38e5d53e5b72">free_timeout_count</a>;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="comment">// I avoid the overhead of getting the current time when we have no</span>
<a name="l00202"></a>00202 <span class="comment">// timeouts by setting this flag instead of getting the time.</span>
<a name="l00203"></a>00203 <span class="comment">// In this case calling elapse_timeouts() does nothing, but records</span>
<a name="l00204"></a>00204 <span class="comment">// the current time, and the next call will actualy elapse time.</span>
<a name="l00205"></a>00205 <span class="keyword">static</span> <span class="keywordtype">char</span> reset_clock = 1;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="keyword">static</span> <span class="keywordtype">void</span> elapse_timeouts() {
<a name="l00208"></a>00208   <span class="keyword">static</span> <span class="keyword">struct </span>timeval prevclock;
<a name="l00209"></a>00209   <span class="keyword">struct </span>timeval newclock;
<a name="l00210"></a>00210   gettimeofday(&amp;newclock, <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00211"></a>00211   <span class="keywordtype">double</span> elapsed = newclock.tv_sec - prevclock.tv_sec +
<a name="l00212"></a>00212     (newclock.tv_usec - prevclock.tv_usec)/1000000.0;
<a name="l00213"></a>00213   prevclock.tv_sec = newclock.tv_sec;
<a name="l00214"></a>00214   prevclock.tv_usec = newclock.tv_usec;
<a name="l00215"></a>00215   <span class="keywordflow">if</span> (reset_clock) {
<a name="l00216"></a>00216     reset_clock = 0;
<a name="l00217"></a>00217   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (elapsed &gt; 0) {
<a name="l00218"></a>00218     <span class="keywordflow">for</span> (<a class="code" href="structTimeout.html">Timeout</a>* t = first_timeout; t; t = t-&gt;<a class="code" href="structTimeout.html#a785bad0da582108cdad2c3025cacec40">next</a>) t-&gt;time -= elapsed;
<a name="l00219"></a>00219   }
<a name="l00220"></a>00220 }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="comment">// Continuously-adjusted error value, this is a number &lt;= 0 for how late</span>
<a name="l00223"></a>00223 <span class="comment">// we were at calling the last timeout. This appears to make repeat_timeout</span>
<a name="l00224"></a>00224 <span class="comment">// very accurate even when processing takes a significant portion of the</span>
<a name="l00225"></a>00225 <span class="comment">// time interval:</span>
<a name="l00226"></a>00226 <span class="keyword">static</span> <span class="keywordtype">double</span> missed_timeout_by;
<a name="l00227"></a>00227 
<a name="l00228"></a><a class="code" href="classFl.html#a23e63eb7cec3a27fa360e66c6e2b2e52">00228</a> <span class="keywordtype">void</span> <a class="code" href="classFl.html#a23e63eb7cec3a27fa360e66c6e2b2e52">Fl::add_timeout</a>(<span class="keywordtype">double</span> time, <a class="code" href="group__callback__functions.html#gaf00cf21170aa3231f6e869a30a036390">Fl_Timeout_Handler</a> cb, <span class="keywordtype">void</span> *argp) {
<a name="l00229"></a>00229   elapse_timeouts();
<a name="l00230"></a>00230   <a class="code" href="classFl.html#ae5373d1d50c2b0ba38280d78bb6d2628">repeat_timeout</a>(time, cb, argp);
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a><a class="code" href="classFl.html#ae5373d1d50c2b0ba38280d78bb6d2628">00233</a> <span class="keywordtype">void</span> <a class="code" href="classFl.html#ae5373d1d50c2b0ba38280d78bb6d2628">Fl::repeat_timeout</a>(<span class="keywordtype">double</span> time, <a class="code" href="group__callback__functions.html#gaf00cf21170aa3231f6e869a30a036390">Fl_Timeout_Handler</a> cb, <span class="keywordtype">void</span> *argp) {
<a name="l00234"></a>00234   time += missed_timeout_by; <span class="keywordflow">if</span> (time &lt; -.05) time = 0;
<a name="l00235"></a>00235   <a class="code" href="structTimeout.html">Timeout</a>* t = <a class="code" href="Fl_8cxx.html#a8c4db4be5bd25f31d08263a476ed1d9e">free_timeout</a>;
<a name="l00236"></a>00236   <span class="keywordflow">if</span> (t) {
<a name="l00237"></a>00237       free_timeout = t-&gt;<a class="code" href="structTimeout.html#a785bad0da582108cdad2c3025cacec40">next</a>;
<a name="l00238"></a>00238       --<a class="code" href="Fl_8cxx.html#ae09dff64127bcd89028d38e5d53e5b72">free_timeout_count</a>;
<a name="l00239"></a>00239   } <span class="keywordflow">else</span> {
<a name="l00240"></a>00240       t = <span class="keyword">new</span> <a class="code" href="structTimeout.html">Timeout</a>;
<a name="l00241"></a>00241   }
<a name="l00242"></a>00242   t-&gt;<a class="code" href="structTimeout.html#ab419eedd78bdd28ddcefdfc7e4e29278">time</a> = time;
<a name="l00243"></a>00243   t-&gt;<a class="code" href="structTimeout.html#adeab82a6f45fecff13c31a086481cfda">cb</a> = cb;
<a name="l00244"></a>00244   t-&gt;<a class="code" href="structTimeout.html#a6e90336b6faf330edf01d27a6405bb27">arg</a> = argp;
<a name="l00245"></a>00245   <span class="comment">// insert-sort the new timeout:</span>
<a name="l00246"></a>00246   <a class="code" href="structTimeout.html">Timeout</a>** p = &amp;first_timeout; 
<a name="l00247"></a>00247   <span class="keywordflow">while</span> (*p &amp;&amp; (*p)-&gt;<a class="code" href="structTimeout.html#ab419eedd78bdd28ddcefdfc7e4e29278">time</a> &lt;= time) p = &amp;((*p)-&gt;next);
<a name="l00248"></a>00248   t-&gt;<a class="code" href="structTimeout.html#a785bad0da582108cdad2c3025cacec40">next</a> = *p;
<a name="l00249"></a>00249   *p = t;
<a name="l00250"></a>00250 }
<a name="l00251"></a>00251 
<a name="l00255"></a><a class="code" href="classFl.html#ae3164768ec950db81396b81ef42f8ba2">00255</a> <span class="keywordtype">int</span> <a class="code" href="classFl.html#ae3164768ec950db81396b81ef42f8ba2">Fl::has_timeout</a>(<a class="code" href="group__callback__functions.html#gaf00cf21170aa3231f6e869a30a036390">Fl_Timeout_Handler</a> cb, <span class="keywordtype">void</span> *argp) {
<a name="l00256"></a>00256   <span class="keywordflow">for</span> (<a class="code" href="structTimeout.html">Timeout</a>* t = first_timeout; t; t = t-&gt;<a class="code" href="structTimeout.html#a785bad0da582108cdad2c3025cacec40">next</a>)
<a name="l00257"></a>00257     <span class="keywordflow">if</span> (t-&gt;cb == cb &amp;&amp; t-&gt;arg == argp) <span class="keywordflow">return</span> 1;
<a name="l00258"></a>00258   <span class="keywordflow">return</span> 0;
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00265"></a><a class="code" href="classFl.html#a9a950f0585de6416eb4fee2365a1578f">00265</a> <span class="keywordtype">void</span> <a class="code" href="classFl.html#a9a950f0585de6416eb4fee2365a1578f">Fl::remove_timeout</a>(<a class="code" href="group__callback__functions.html#gaf00cf21170aa3231f6e869a30a036390">Fl_Timeout_Handler</a> cb, <span class="keywordtype">void</span> *argp) {
<a name="l00266"></a>00266   <span class="comment">// This version removes all matching timeouts, not just the first one.</span>
<a name="l00267"></a>00267   <span class="comment">// This may change in the future.</span>
<a name="l00268"></a>00268   <span class="keywordflow">for</span> (<a class="code" href="structTimeout.html">Timeout</a>** p = &amp;first_timeout; *p;) {
<a name="l00269"></a>00269     <a class="code" href="structTimeout.html">Timeout</a>* t = *p;
<a name="l00270"></a>00270     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="structTimeout.html#adeab82a6f45fecff13c31a086481cfda">cb</a> == cb &amp;&amp; (t-&gt;<a class="code" href="structTimeout.html#a6e90336b6faf330edf01d27a6405bb27">arg</a> == argp || !argp)) {
<a name="l00271"></a>00271       *p = t-&gt;<a class="code" href="structTimeout.html#a785bad0da582108cdad2c3025cacec40">next</a>;
<a name="l00272"></a>00272       t-&gt;<a class="code" href="structTimeout.html#a785bad0da582108cdad2c3025cacec40">next</a> = <a class="code" href="Fl_8cxx.html#a8c4db4be5bd25f31d08263a476ed1d9e">free_timeout</a>;
<a name="l00273"></a>00273       free_timeout = t;
<a name="l00274"></a>00274     } <span class="keywordflow">else</span> {
<a name="l00275"></a>00275       p = &amp;(t-&gt;<a class="code" href="structTimeout.html#a785bad0da582108cdad2c3025cacec40">next</a>);
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277   }
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <span class="preprocessor">#endif</span>
<a name="l00281"></a>00281 <span class="preprocessor"></span>
<a name="l00283"></a>00283 <span class="comment">// Checks are just stored in a list. They are called in the reverse</span>
<a name="l00284"></a>00284 <span class="comment">// order that they were added (this may change in the future).</span>
<a name="l00285"></a>00285 <span class="comment">// This is a bit messy because I want to allow checks to be added,</span>
<a name="l00286"></a>00286 <span class="comment">// removed, and have wait() called from inside them, to do this</span>
<a name="l00287"></a>00287 <span class="comment">// next_check points at the next unprocessed one for the outermost</span>
<a name="l00288"></a>00288 <span class="comment">// call to Fl::wait().</span>
<a name="l00289"></a>00289 
<a name="l00290"></a><a class="code" href="structCheck.html">00290</a> <span class="keyword">struct </span><a class="code" href="structCheck.html">Check</a> {
<a name="l00291"></a><a class="code" href="structCheck.html#abe52f337404a63d1eea8d44fcc18462e">00291</a>   <a class="code" href="png_8h.html#a04364e387081209df3bd1a16e8abe3b9">void</a> (*<a class="code" href="structCheck.html#abe52f337404a63d1eea8d44fcc18462e">cb</a>)(<span class="keywordtype">void</span>*);
<a name="l00292"></a><a class="code" href="structCheck.html#ac0992260338a13ae2f42735fb8c751ae">00292</a>   <span class="keywordtype">void</span>* <a class="code" href="structCheck.html#ac0992260338a13ae2f42735fb8c751ae">arg</a>;
<a name="l00293"></a><a class="code" href="structCheck.html#a3a6c53bdff3215ddef9ecf4cd633a043">00293</a>   <a class="code" href="structCheck.html">Check</a>* <a class="code" href="structCheck.html#a3a6c53bdff3215ddef9ecf4cd633a043">next</a>;
<a name="l00294"></a>00294 };
<a name="l00295"></a><a class="code" href="Fl_8cxx.html#ac9f5f14aa5bee35da9120574b27688fc">00295</a> <span class="keyword">static</span> <a class="code" href="structCheck.html">Check</a> *first_check, *<a class="code" href="Fl_8cxx.html#ac9f5f14aa5bee35da9120574b27688fc">next_check</a>, *<a class="code" href="Fl_8cxx.html#af698b74b44a6909ac0d38c19e40eeebb">free_check</a>;
<a name="l00296"></a>00296 
<a name="l00328"></a><a class="code" href="classFl.html#a7b689a9e42582fe6e87f7c7eb1dce94f">00328</a> <span class="keywordtype">void</span> <a class="code" href="classFl.html#a7b689a9e42582fe6e87f7c7eb1dce94f">Fl::add_check</a>(<a class="code" href="group__callback__functions.html#gaf00cf21170aa3231f6e869a30a036390">Fl_Timeout_Handler</a> cb, <span class="keywordtype">void</span> *argp) {
<a name="l00329"></a>00329   <a class="code" href="structCheck.html">Check</a>* t = <a class="code" href="Fl_8cxx.html#af698b74b44a6909ac0d38c19e40eeebb">free_check</a>;
<a name="l00330"></a>00330   <span class="keywordflow">if</span> (t) free_check = t-&gt;<a class="code" href="structCheck.html#a3a6c53bdff3215ddef9ecf4cd633a043">next</a>;
<a name="l00331"></a>00331   <span class="keywordflow">else</span> t = <span class="keyword">new</span> <a class="code" href="structCheck.html">Check</a>;
<a name="l00332"></a>00332   t-&gt;<a class="code" href="structCheck.html#abe52f337404a63d1eea8d44fcc18462e">cb</a> = cb;
<a name="l00333"></a>00333   t-&gt;<a class="code" href="structCheck.html#ac0992260338a13ae2f42735fb8c751ae">arg</a> = argp;
<a name="l00334"></a>00334   t-&gt;<a class="code" href="structCheck.html#a3a6c53bdff3215ddef9ecf4cd633a043">next</a> = first_check;
<a name="l00335"></a>00335   <span class="keywordflow">if</span> (next_check == first_check) next_check = t;
<a name="l00336"></a>00336   first_check = t;
<a name="l00337"></a>00337 }
<a name="l00338"></a>00338 
<a name="l00343"></a><a class="code" href="classFl.html#a43ee3d6bb1c70f5202e7cc9cb87cd515">00343</a> <span class="keywordtype">void</span> <a class="code" href="classFl.html#a43ee3d6bb1c70f5202e7cc9cb87cd515">Fl::remove_check</a>(<a class="code" href="group__callback__functions.html#gaf00cf21170aa3231f6e869a30a036390">Fl_Timeout_Handler</a> cb, <span class="keywordtype">void</span> *argp) {
<a name="l00344"></a>00344   <span class="keywordflow">for</span> (<a class="code" href="structCheck.html">Check</a>** p = &amp;first_check; *p;) {
<a name="l00345"></a>00345     <a class="code" href="structCheck.html">Check</a>* t = *p;
<a name="l00346"></a>00346     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="structCheck.html#abe52f337404a63d1eea8d44fcc18462e">cb</a> == cb &amp;&amp; t-&gt;<a class="code" href="structCheck.html#ac0992260338a13ae2f42735fb8c751ae">arg</a> == argp) {
<a name="l00347"></a>00347       <span class="keywordflow">if</span> (next_check == t) next_check = t-&gt;<a class="code" href="structCheck.html#a3a6c53bdff3215ddef9ecf4cd633a043">next</a>;
<a name="l00348"></a>00348       *p = t-&gt;<a class="code" href="structCheck.html#a3a6c53bdff3215ddef9ecf4cd633a043">next</a>;
<a name="l00349"></a>00349       t-&gt;<a class="code" href="structCheck.html#a3a6c53bdff3215ddef9ecf4cd633a043">next</a> = <a class="code" href="Fl_8cxx.html#af698b74b44a6909ac0d38c19e40eeebb">free_check</a>;
<a name="l00350"></a>00350       free_check = t;
<a name="l00351"></a>00351     } <span class="keywordflow">else</span> {
<a name="l00352"></a>00352       p = &amp;(t-&gt;<a class="code" href="structCheck.html#a3a6c53bdff3215ddef9ecf4cd633a043">next</a>);
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354   }
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 
<a name="l00360"></a><a class="code" href="classFl.html#a3ab2ac86a4368147c075dd6750b03546">00360</a> <span class="keywordtype">int</span> <a class="code" href="classFl.html#a3ab2ac86a4368147c075dd6750b03546">Fl::has_check</a>(<a class="code" href="group__callback__functions.html#gaf00cf21170aa3231f6e869a30a036390">Fl_Timeout_Handler</a> cb, <span class="keywordtype">void</span> *argp) {
<a name="l00361"></a>00361   <span class="keywordflow">for</span> (<a class="code" href="structCheck.html">Check</a>** p = &amp;first_check; *p;) {
<a name="l00362"></a>00362     <a class="code" href="structCheck.html">Check</a>* t = *p;
<a name="l00363"></a>00363     <span class="keywordflow">if</span> (t-&gt;<a class="code" href="structCheck.html#abe52f337404a63d1eea8d44fcc18462e">cb</a> == cb &amp;&amp; t-&gt;<a class="code" href="structCheck.html#ac0992260338a13ae2f42735fb8c751ae">arg</a> == argp) {
<a name="l00364"></a>00364       <span class="keywordflow">return</span> 1;
<a name="l00365"></a>00365     } <span class="keywordflow">else</span> {
<a name="l00366"></a>00366       p = &amp;(t-&gt;<a class="code" href="structCheck.html#a3a6c53bdff3215ddef9ecf4cd633a043">next</a>);
<a name="l00367"></a>00367     }
<a name="l00368"></a>00368   }
<a name="l00369"></a>00369   <span class="keywordflow">return</span> 0;
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 <span class="keyword">static</span> <span class="keywordtype">void</span> run_checks()
<a name="l00373"></a>00373 {
<a name="l00374"></a>00374   <span class="comment">// checks are a bit messy so that add/remove and wait may be called</span>
<a name="l00375"></a>00375   <span class="comment">// from inside them without causing an infinite loop:</span>
<a name="l00376"></a>00376   <span class="keywordflow">if</span> (next_check == first_check) {
<a name="l00377"></a>00377     <span class="keywordflow">while</span> (next_check) {
<a name="l00378"></a>00378       <a class="code" href="structCheck.html">Check</a>* checkp = <a class="code" href="Fl_8cxx.html#ac9f5f14aa5bee35da9120574b27688fc">next_check</a>;
<a name="l00379"></a>00379       next_check = checkp-&gt;<a class="code" href="structCheck.html#a3a6c53bdff3215ddef9ecf4cd633a043">next</a>;
<a name="l00380"></a>00380       (checkp-&gt;<a class="code" href="structCheck.html#abe52f337404a63d1eea8d44fcc18462e">cb</a>)(checkp-&gt;<a class="code" href="structCheck.html#ac0992260338a13ae2f42735fb8c751ae">arg</a>);
<a name="l00381"></a>00381     }
<a name="l00382"></a>00382     next_check = first_check;
<a name="l00383"></a>00383   }
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 <span class="preprocessor">#ifndef WIN32</span>
<a name="l00387"></a>00387 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">char</span> in_idle;
<a name="l00388"></a>00388 <span class="preprocessor">#endif</span>
<a name="l00389"></a>00389 <span class="preprocessor"></span>
<a name="l00391"></a>00391 <span class="comment">// wait/run/check/ready:</span>
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 <a class="code" href="png_8h.html#a04364e387081209df3bd1a16e8abe3b9">void</a> (*<a class="code" href="classFl.html#a60fb2b446096dd4742511edb459653d3">Fl::idle</a>)(); <span class="comment">// see Fl_add_idle.cxx for the add/remove functions</span>
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="Fl_8cxx.html#af0705d69ac0f8c4c43d26d935c12044a">fl_ready</a>(); <span class="comment">// in Fl_&lt;platform&gt;.cxx</span>
<a name="l00396"></a>00396 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="Fl_8cxx.html#a55e2ddfbe9d4603198ae690c8e54e565">fl_wait</a>(<span class="keywordtype">double</span> time); <span class="comment">// in Fl_&lt;platform&gt;.cxx</span>
<a name="l00397"></a>00397 
<a name="l00401"></a><a class="code" href="classFl.html#af49654e35a0b636aa751dce5ff88a7f5">00401</a> <span class="keywordtype">double</span> <a class="code" href="classFl.html#a108a84216f0b3fa1cb0c46ab7449a312">Fl::wait</a>(<span class="keywordtype">double</span> time_to_wait) {
<a name="l00402"></a>00402   <span class="comment">// delete all widgets that were listed during callbacks</span>
<a name="l00403"></a>00403   <a class="code" href="group__fl__del__widget.html#ga838010444986ae57301d6e8289d2dfbb">do_widget_deletion</a>();
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00406"></a>00406 <span class="preprocessor"></span>
<a name="l00407"></a>00407   <span class="keywordflow">return</span> <a class="code" href="Fl_8cxx.html#a55e2ddfbe9d4603198ae690c8e54e565">fl_wait</a>(time_to_wait);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 <span class="preprocessor">#elif defined(__APPLE__)</span>
<a name="l00410"></a>00410 <span class="preprocessor"></span>
<a name="l00411"></a>00411   run_checks();
<a name="l00412"></a>00412   <span class="keywordflow">if</span> (<a class="code" href="classFl.html#a60fb2b446096dd4742511edb459653d3">idle</a>) {
<a name="l00413"></a>00413     <span class="keywordflow">if</span> (!in_idle) {
<a name="l00414"></a>00414       in_idle = 1;
<a name="l00415"></a>00415       <a class="code" href="classFl.html#a60fb2b446096dd4742511edb459653d3">idle</a>();
<a name="l00416"></a>00416       in_idle = 0;
<a name="l00417"></a>00417     }
<a name="l00418"></a>00418     <span class="comment">// the idle function may turn off idle, we can then wait:</span>
<a name="l00419"></a>00419     <span class="keywordflow">if</span> (<a class="code" href="classFl.html#a60fb2b446096dd4742511edb459653d3">idle</a>) time_to_wait = 0.0;
<a name="l00420"></a>00420   }
<a name="l00421"></a>00421   <span class="keywordflow">return</span> fl_mac_flush_and_wait(time_to_wait, in_idle);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423 <span class="preprocessor">#else</span>
<a name="l00424"></a>00424 <span class="preprocessor"></span>
<a name="l00425"></a>00425   <span class="keywordflow">if</span> (first_timeout) {
<a name="l00426"></a>00426     elapse_timeouts();
<a name="l00427"></a>00427     <a class="code" href="structTimeout.html">Timeout</a> *t;
<a name="l00428"></a>00428     <span class="keywordflow">while</span> ((t = first_timeout)) {
<a name="l00429"></a>00429       <span class="keywordflow">if</span> (t-&gt;<a class="code" href="structTimeout.html#ab419eedd78bdd28ddcefdfc7e4e29278">time</a> &gt; 0) <span class="keywordflow">break</span>;
<a name="l00430"></a>00430       <span class="comment">// The first timeout in the array has expired.</span>
<a name="l00431"></a>00431       missed_timeout_by = t-&gt;<a class="code" href="structTimeout.html#ab419eedd78bdd28ddcefdfc7e4e29278">time</a>;
<a name="l00432"></a>00432       <span class="comment">// We must remove timeout from array before doing the callback:</span>
<a name="l00433"></a>00433       <a class="code" href="png_8h.html#a04364e387081209df3bd1a16e8abe3b9">void</a> (*cb)(<span class="keywordtype">void</span>*) = t-&gt;<a class="code" href="structTimeout.html#adeab82a6f45fecff13c31a086481cfda">cb</a>;
<a name="l00434"></a>00434       <span class="keywordtype">void</span> *argp = t-&gt;<a class="code" href="structTimeout.html#a6e90336b6faf330edf01d27a6405bb27">arg</a>;
<a name="l00435"></a>00435       first_timeout = t-&gt;<a class="code" href="structTimeout.html#a785bad0da582108cdad2c3025cacec40">next</a>;
<a name="l00436"></a>00436       t-&gt;<a class="code" href="structTimeout.html#a785bad0da582108cdad2c3025cacec40">next</a> = free_timeout;
<a name="l00437"></a>00437       free_timeout = t;
<a name="l00438"></a>00438       ++<a class="code" href="Fl_8cxx.html#ae09dff64127bcd89028d38e5d53e5b72">free_timeout_count</a>;
<a name="l00439"></a>00439       --first_timeout_count;
<a name="l00440"></a>00440       <span class="comment">// Now it is safe for the callback to do add_timeout:</span>
<a name="l00441"></a>00441       cb(argp);
<a name="l00442"></a>00442     }
<a name="l00443"></a>00443   } <span class="keywordflow">else</span> {
<a name="l00444"></a>00444     reset_clock = 1; <span class="comment">// we are not going to check the clock</span>
<a name="l00445"></a>00445   }
<a name="l00446"></a>00446   run_checks();
<a name="l00447"></a>00447 <span class="comment">//  if (idle &amp;&amp; !fl_ready()) {</span>
<a name="l00448"></a>00448   <span class="keywordflow">if</span> (<a class="code" href="classFl.html#a60fb2b446096dd4742511edb459653d3">idle</a>) {
<a name="l00449"></a>00449     <span class="keywordflow">if</span> (!in_idle) {
<a name="l00450"></a>00450       in_idle = 1;
<a name="l00451"></a>00451       <a class="code" href="classFl.html#a60fb2b446096dd4742511edb459653d3">idle</a>();
<a name="l00452"></a>00452       in_idle = 0;
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454     <span class="comment">// the idle function may turn off idle, we can then wait:</span>
<a name="l00455"></a>00455     <span class="keywordflow">if</span> (<a class="code" href="classFl.html#a60fb2b446096dd4742511edb459653d3">idle</a>) time_to_wait = 0.0;
<a name="l00456"></a>00456   }
<a name="l00457"></a>00457   <span class="keywordflow">if</span> (first_timeout &amp;&amp; first_timeout-&gt;<a class="code" href="structTimeout.html#ab419eedd78bdd28ddcefdfc7e4e29278">time</a> &lt; time_to_wait)
<a name="l00458"></a>00458     time_to_wait = first_timeout-&gt;<a class="code" href="structTimeout.html#ab419eedd78bdd28ddcefdfc7e4e29278">time</a>;
<a name="l00459"></a>00459   <span class="keywordflow">if</span> (time_to_wait &lt;= 0.0) {
<a name="l00460"></a>00460     <span class="comment">// do flush second so that the results of events are visible:</span>
<a name="l00461"></a>00461     <span class="keywordtype">int</span> ret = <a class="code" href="Fl_8cxx.html#a55e2ddfbe9d4603198ae690c8e54e565">fl_wait</a>(0.0);
<a name="l00462"></a>00462     <a class="code" href="classFl.html#a08d29d807ea3874b8bb16f7457f64bdc">flush</a>();
<a name="l00463"></a>00463     <span class="keywordflow">return</span> ret;
<a name="l00464"></a>00464   } <span class="keywordflow">else</span> {
<a name="l00465"></a>00465     <span class="comment">// do flush first so that user sees the display:</span>
<a name="l00466"></a>00466     <a class="code" href="classFl.html#a08d29d807ea3874b8bb16f7457f64bdc">flush</a>();
<a name="l00467"></a>00467     <span class="keywordflow">if</span> (<a class="code" href="classFl.html#a60fb2b446096dd4742511edb459653d3">idle</a> &amp;&amp; !in_idle) <span class="comment">// &#39;idle&#39; may have been set within flush()</span>
<a name="l00468"></a>00468       time_to_wait = 0.0;
<a name="l00469"></a>00469     <span class="keywordflow">return</span> <a class="code" href="Fl_8cxx.html#a55e2ddfbe9d4603198ae690c8e54e565">fl_wait</a>(time_to_wait);
<a name="l00470"></a>00470   }
<a name="l00471"></a>00471 <span class="preprocessor">#endif</span>
<a name="l00472"></a>00472 <span class="preprocessor"></span>}
<a name="l00473"></a>00473 
<a name="l00474"></a><a class="code" href="Fl_8cxx.html#a75c828ed6c02fcd44084e67a032e422c">00474</a> <span class="preprocessor">#define FOREVER 1e20</span>
<a name="l00475"></a>00475 <span class="preprocessor"></span>
<a name="l00483"></a><a class="code" href="classFl.html#a7a3b1236b41800d24267288c564b187a">00483</a> <span class="keywordtype">int</span> <a class="code" href="classFl.html#a7a3b1236b41800d24267288c564b187a">Fl::run</a>() {
<a name="l00484"></a>00484   <span class="keywordflow">while</span> (<a class="code" href="classFl__X.html#a87bf8b5c35a402db76a2267f97db0b18">Fl_X::first</a>) <a class="code" href="classFl.html#a108a84216f0b3fa1cb0c46ab7449a312">wait</a>(<a class="code" href="Fl_8cxx.html#a75c828ed6c02fcd44084e67a032e422c">FOREVER</a>);
<a name="l00485"></a>00485   <span class="keywordflow">return</span> 0;
<a name="l00486"></a>00486 }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 <span class="preprocessor">#ifdef WIN32</span>
<a name="l00489"></a>00489 <span class="preprocessor"></span>
<a name="l00490"></a>00490 <span class="comment">// Function to initialize COM/OLE for usage. This must be done only once.</span>
<a name="l00491"></a>00491 <span class="comment">// We define a flag to register whether we called it:</span>
<a name="l00492"></a>00492 <span class="keyword">static</span> <span class="keywordtype">char</span> oleInitialized = 0;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 <span class="comment">// This calls the Windows function OleInitialize() exactly once.</span>
<a name="l00495"></a>00495 <span class="keywordtype">void</span> <a class="code" href="Fl__Native__File__Chooser__WIN32_8cxx.html#a8591daf97c473c897cf73058343d345f">fl_OleInitialize</a>() {
<a name="l00496"></a>00496   <span class="keywordflow">if</span> (!oleInitialized) {
<a name="l00497"></a>00497     OleInitialize(0L);
<a name="l00498"></a>00498     oleInitialized = 1;
<a name="l00499"></a>00499   }
<a name="l00500"></a>00500 }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 <span class="comment">// This calls the Windows function OleUninitialize() only, if</span>
<a name="l00503"></a>00503 <span class="comment">// OleInitialize has been called before.</span>
<a name="l00504"></a>00504 <span class="keywordtype">void</span> fl_OleUninitialize() {
<a name="l00505"></a>00505   <span class="keywordflow">if</span> (oleInitialized) {
<a name="l00506"></a>00506     OleUninitialize();
<a name="l00507"></a>00507     oleInitialized = 0;
<a name="l00508"></a>00508   }
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 <span class="keyword">class </span>Fl_Win32_At_Exit {
<a name="l00512"></a>00512 <span class="keyword">public</span>:
<a name="l00513"></a>00513   Fl_Win32_At_Exit() { }
<a name="l00514"></a>00514   ~Fl_Win32_At_Exit() {
<a name="l00515"></a>00515     <a class="code" href="Fl__win32_8cxx.html#af93c6a7b96d557718567d62e2c33c05a">fl_free_fonts</a>();        <span class="comment">// do some WIN32 cleanup</span>
<a name="l00516"></a>00516     <a class="code" href="fl__color__win32_8cxx.html#a5aa367277d0c86c403411b085e42f550">fl_cleanup_pens</a>();
<a name="l00517"></a>00517     fl_OleUninitialize();
<a name="l00518"></a>00518     <a class="code" href="win32_8H.html#a86c3730bc0b49d63db75571c722f2f67">fl_brush_action</a>(1);
<a name="l00519"></a>00519     <a class="code" href="Fl__win32_8cxx.html#ae711fe1835478d81c72cc6cef7498510">fl_cleanup_dc_list</a>();
<a name="l00520"></a>00520   }
<a name="l00521"></a>00521 };
<a name="l00522"></a>00522 <span class="keyword">static</span> Fl_Win32_At_Exit win32_at_exit;
<a name="l00523"></a>00523 <span class="preprocessor">#endif</span>
<a name="l00524"></a>00524 <span class="preprocessor"></span>
<a name="l00525"></a>00525 
<a name="l00526"></a>00526 
<a name="l00552"></a><a class="code" href="classFl.html#a108a84216f0b3fa1cb0c46ab7449a312">00552</a> <span class="keywordtype">int</span> <a class="code" href="classFl.html#a108a84216f0b3fa1cb0c46ab7449a312">Fl::wait</a>() {
<a name="l00553"></a>00553   <span class="keywordflow">if</span> (!<a class="code" href="classFl__X.html#a87bf8b5c35a402db76a2267f97db0b18">Fl_X::first</a>) <span class="keywordflow">return</span> 0;
<a name="l00554"></a>00554   <a class="code" href="classFl.html#a108a84216f0b3fa1cb0c46ab7449a312">wait</a>(<a class="code" href="Fl_8cxx.html#a75c828ed6c02fcd44084e67a032e422c">FOREVER</a>);
<a name="l00555"></a>00555   <span class="keywordflow">return</span> <a class="code" href="classFl__X.html#a87bf8b5c35a402db76a2267f97db0b18">Fl_X::first</a> != 0; <span class="comment">// return true if there is a window</span>
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00574"></a><a class="code" href="classFl.html#a1dbb83f1d52001c152ccf8415e3ee6f0">00574</a> <span class="keywordtype">int</span> <a class="code" href="classFl.html#a1dbb83f1d52001c152ccf8415e3ee6f0">Fl::check</a>() {
<a name="l00575"></a>00575   <a class="code" href="classFl.html#a108a84216f0b3fa1cb0c46ab7449a312">wait</a>(0.0);
<a name="l00576"></a>00576   <span class="keywordflow">return</span> <a class="code" href="classFl__X.html#a87bf8b5c35a402db76a2267f97db0b18">Fl_X::first</a> != 0; <span class="comment">// return true if there is a window</span>
<a name="l00577"></a>00577 }
<a name="l00578"></a>00578 
<a name="l00597"></a><a class="code" href="classFl.html#a41a0cf2dd925cc6c4074d32a36fcf98f">00597</a> <span class="keywordtype">int</span> <a class="code" href="classFl.html#a41a0cf2dd925cc6c4074d32a36fcf98f">Fl::ready</a>() {
<a name="l00598"></a>00598 <span class="preprocessor">#if ! defined( WIN32 )  &amp;&amp;  ! defined(__APPLE__)</span>
<a name="l00599"></a>00599 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (first_timeout) {
<a name="l00600"></a>00600     elapse_timeouts();
<a name="l00601"></a>00601     <span class="keywordflow">if</span> (first_timeout-&gt;<a class="code" href="structTimeout.html#ab419eedd78bdd28ddcefdfc7e4e29278">time</a> &lt;= 0) <span class="keywordflow">return</span> 1;
<a name="l00602"></a>00602   } <span class="keywordflow">else</span> {
<a name="l00603"></a>00603     reset_clock = 1;
<a name="l00604"></a>00604   }
<a name="l00605"></a>00605 <span class="preprocessor">#endif</span>
<a name="l00606"></a>00606 <span class="preprocessor"></span>  <span class="keywordflow">return</span> <a class="code" href="Fl_8cxx.html#af0705d69ac0f8c4c43d26d935c12044a">fl_ready</a>();
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00610"></a>00610 <span class="comment">// Window list management:</span>
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 <span class="preprocessor">#ifndef FL_DOXYGEN</span>
<a name="l00613"></a>00613 <span class="preprocessor"></span><a class="code" href="classFl__X.html">Fl_X</a>* <a class="code" href="classFl__X.html#a87bf8b5c35a402db76a2267f97db0b18">Fl_X::first</a>;
<a name="l00614"></a>00614 <span class="preprocessor">#endif</span>
<a name="l00615"></a>00615 <span class="preprocessor"></span>
<a name="l00616"></a><a class="code" href="Fl__mac_8cxx.html#afbc3d4aa41c4378da891d74e1cd3c9d7">00616</a> <a class="code" href="classFl__Window.html">Fl_Window</a>* <a class="code" href="win32_8H.html#a4f60f8f2a47f584ee83dd0118a058cfe">fl_find</a>(<a class="code" href="mac_8H.html#aad9fe48cacd960402308a6a7f9f5e584">Window</a> xid) {
<a name="l00617"></a>00617   <a class="code" href="classFl__X.html">Fl_X</a> *window;
<a name="l00618"></a>00618   <span class="keywordflow">for</span> (<a class="code" href="classFl__X.html">Fl_X</a> **pp = &amp;Fl_X::first; (window = *pp); pp = &amp;window-&gt;<a class="code" href="classFl__X.html#a41f6a721a953ea62021bb1dd9c4f2187">next</a>)
<a name="l00619"></a>00619 #<span class="keywordflow">if</span> defined(WIN32) || defined(USE_X11)
<a name="l00620"></a>00620    <span class="keywordflow">if</span> (window-&gt;<a class="code" href="classFl__X.html#a8885c9eeb5a7a9684ad147177bf9931a">xid</a> == xid) 
<a name="l00621"></a>00621 <span class="preprocessor">#elif defined(__APPLE_QUARTZ__)</span>
<a name="l00622"></a>00622 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (window-&gt;<a class="code" href="classFl__X.html#a8885c9eeb5a7a9684ad147177bf9931a">xid</a> == xid &amp;&amp; !window-&gt;<a class="code" href="classFl__X.html#ac5bc885e2984f98900553c538debabae">w</a>-&gt;<a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()) 
<a name="l00623"></a>00623 #<span class="keywordflow">else</span>
<a name="l00624"></a>00624 # error unsupported platform
<a name="l00625"></a>00625 #endif <span class="comment">// __APPLE__</span>
<a name="l00626"></a>00626         {
<a name="l00627"></a>00627       <span class="keywordflow">if</span> (window != Fl_X::first &amp;&amp; !<a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">Fl::modal</a>()) {
<a name="l00628"></a>00628         <span class="comment">// make this window be first to speed up searches</span>
<a name="l00629"></a>00629         <span class="comment">// this is not done if modal is true to avoid messing up modal stack</span>
<a name="l00630"></a>00630         *pp = window-&gt;<a class="code" href="classFl__X.html#a41f6a721a953ea62021bb1dd9c4f2187">next</a>;
<a name="l00631"></a>00631         window-&gt;<a class="code" href="classFl__X.html#a41f6a721a953ea62021bb1dd9c4f2187">next</a> = <a class="code" href="classFl__X.html#a87bf8b5c35a402db76a2267f97db0b18">Fl_X::first</a>;
<a name="l00632"></a>00632         Fl_X::first = window;
<a name="l00633"></a>00633       }
<a name="l00634"></a>00634       <span class="keywordflow">return</span> window-&gt;<a class="code" href="classFl__X.html#ac5bc885e2984f98900553c538debabae">w</a>;
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636   <span class="keywordflow">return</span> 0;
<a name="l00637"></a>00637 }
<a name="l00638"></a>00638 
<a name="l00651"></a><a class="code" href="group__fl__windows.html#ga3130407bc1c11f9b7f2a9c43a87a1599">00651</a> <a class="code" href="classFl__Window.html">Fl_Window</a>* <a class="code" href="group__fl__windows.html#ga3130407bc1c11f9b7f2a9c43a87a1599">Fl::first_window</a>() {
<a name="l00652"></a>00652   <a class="code" href="classFl__X.html">Fl_X</a>* <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = Fl_X::first;
<a name="l00653"></a>00653   <span class="keywordflow">return</span> i ? i-&gt;<a class="code" href="classFl__X.html#ac5bc885e2984f98900553c538debabae">w</a> : 0;
<a name="l00654"></a>00654 }
<a name="l00655"></a>00655 
<a name="l00660"></a><a class="code" href="group__fl__windows.html#ga46df67455d96ee45e51f59263c6bf0ea">00660</a> <a class="code" href="classFl__Window.html">Fl_Window</a>* <a class="code" href="group__fl__windows.html#ga46df67455d96ee45e51f59263c6bf0ea">Fl::next_window</a>(<span class="keyword">const</span> <a class="code" href="classFl__Window.html">Fl_Window</a>* window) {
<a name="l00661"></a>00661   <a class="code" href="classFl__X.html">Fl_X</a>* <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">Fl_X::i</a>(window)-&gt;next;
<a name="l00662"></a>00662   <span class="keywordflow">return</span> i ? i-&gt;<a class="code" href="classFl__X.html#ac5bc885e2984f98900553c538debabae">w</a> : 0;
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 
<a name="l00668"></a><a class="code" href="group__fl__windows.html#gabac1e48dd4e0fa7431776c1e754e273e">00668</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__windows.html#ga3130407bc1c11f9b7f2a9c43a87a1599">Fl::first_window</a>(<a class="code" href="classFl__Window.html">Fl_Window</a>* window) {
<a name="l00669"></a>00669   <span class="keywordflow">if</span> (!window || !window-&gt;<a class="code" href="classFl__Window.html#aa09300542b2d8b49fc69a037bdd3b742">shown</a>()) <span class="keywordflow">return</span>;
<a name="l00670"></a>00670   <a class="code" href="win32_8H.html#a4f60f8f2a47f584ee83dd0118a058cfe">fl_find</a>( <a class="code" href="classFl__X.html#ae4c6997d92cf8ad3a75a962d7ae77c34">Fl_X::i</a>(window)-&gt;xid );
<a name="l00671"></a>00671 }
<a name="l00672"></a>00672 
<a name="l00676"></a><a class="code" href="classFl.html#aeec5e7939d214882da2d31c894a5bad7">00676</a> <span class="keywordtype">void</span> <a class="code" href="classFl.html#aeec5e7939d214882da2d31c894a5bad7">Fl::redraw</a>() {
<a name="l00677"></a>00677   <span class="keywordflow">for</span> (<a class="code" href="classFl__X.html">Fl_X</a>* <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = Fl_X::first; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>-&gt;next) <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>-&gt;w-&gt;redraw();
<a name="l00678"></a>00678 }
<a name="l00679"></a>00679 
<a name="l00691"></a><a class="code" href="classFl.html#a08d29d807ea3874b8bb16f7457f64bdc">00691</a> <span class="keywordtype">void</span> <a class="code" href="classFl.html#a08d29d807ea3874b8bb16f7457f64bdc">Fl::flush</a>() {
<a name="l00692"></a>00692   <span class="keywordflow">if</span> (<a class="code" href="classFl.html#ac5e4de1119ebb169c8a8de4c81a4cb59">damage</a>()) {
<a name="l00693"></a>00693     <a class="code" href="classFl.html#a8ef5178467ee84042b29dc170a5c5fa8">damage_</a> = 0;
<a name="l00694"></a>00694     <span class="keywordflow">for</span> (<a class="code" href="classFl__X.html">Fl_X</a>* <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = Fl_X::first; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>-&gt;next) {
<a name="l00695"></a>00695       <span class="keywordflow">if</span> (<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>-&gt;wait_for_expose) {<a class="code" href="classFl.html#a8ef5178467ee84042b29dc170a5c5fa8">damage_</a> = 1; <span class="keywordflow">continue</span>;}
<a name="l00696"></a>00696       <a class="code" href="classFl__Window.html">Fl_Window</a>* wi = <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>-&gt;w;
<a name="l00697"></a>00697       <span class="keywordflow">if</span> (!wi-&gt;<a class="code" href="classFl__Widget.html#a8e786561b8670afd0b4a582de5087905">visible_r</a>()) <span class="keywordflow">continue</span>;
<a name="l00698"></a>00698       <span class="keywordflow">if</span> (wi-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>()) {<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>-&gt;flush(); wi-&gt;<a class="code" href="classFl__Widget.html#af9942c4d795ec12c7c1ec1ce5e665a01">clear_damage</a>();}
<a name="l00699"></a>00699       <span class="comment">// destroy damage regions for windows that don&#39;t use them:</span>
<a name="l00700"></a>00700       <span class="keywordflow">if</span> (<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>-&gt;region) {<a class="code" href="win32_8H.html#aa9ab8e4893ef97f9bf92e66e2c51778b">XDestroyRegion</a>(<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>-&gt;region); <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>-&gt;region = 0;}
<a name="l00701"></a>00701     }
<a name="l00702"></a>00702   }
<a name="l00703"></a>00703 <span class="preprocessor">#if defined(USE_X11)</span>
<a name="l00704"></a>00704 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="win32_8H.html#a6c6726f30a7b613184e2b315e167ddb2" title="END TIMERS //////////////////////////////////////////////////////////////////////////.">fl_display</a>) XFlush(<a class="code" href="win32_8H.html#a6c6726f30a7b613184e2b315e167ddb2" title="END TIMERS //////////////////////////////////////////////////////////////////////////.">fl_display</a>);
<a name="l00705"></a>00705 <span class="preprocessor">#elif defined(WIN32)</span>
<a name="l00706"></a>00706 <span class="preprocessor"></span>  GdiFlush();
<a name="l00707"></a>00707 <span class="preprocessor">#elif defined (__APPLE_QUARTZ__)</span>
<a name="l00708"></a>00708 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="mac_8H.html#a9b2af459c0a223b6274f508339c783a6">fl_gc</a>)
<a name="l00709"></a>00709     <a class="code" href="cgdebug_8h.html#afaf7a6c13b9872c0eb253ee26883ceb7">CGContextFlush</a>(<a class="code" href="mac_8H.html#a9b2af459c0a223b6274f508339c783a6">fl_gc</a>);
<a name="l00710"></a>00710 <span class="preprocessor">#else</span>
<a name="l00711"></a>00711 <span class="preprocessor"></span><span class="preprocessor"># error unsupported platform</span>
<a name="l00712"></a>00712 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00713"></a>00713 <span class="preprocessor"></span>}
<a name="l00714"></a>00714 
<a name="l00716"></a>00716 <span class="comment">// Event handlers:</span>
<a name="l00717"></a>00717 
<a name="l00718"></a><a class="code" href="structhandler__link.html">00718</a> <span class="keyword">struct </span><a class="code" href="structhandler__link.html">handler_link</a> {
<a name="l00719"></a><a class="code" href="structhandler__link.html#a28c2257ff91633b9f907edd7a47cb71f">00719</a>   <a class="code" href="png_8h.html#ab832c174e145540d491b0830fc05dbb1">int</a> (*<a class="code" href="structhandler__link.html#a28c2257ff91633b9f907edd7a47cb71f">handle</a>)(<a class="code" href="png_8h.html#ab832c174e145540d491b0830fc05dbb1">int</a>);
<a name="l00720"></a><a class="code" href="structhandler__link.html#ab9e4a73b57fab5474a9084c0192cac4d">00720</a>   <a class="code" href="structhandler__link.html">handler_link</a> *<a class="code" href="structhandler__link.html#ab9e4a73b57fab5474a9084c0192cac4d">next</a>;
<a name="l00721"></a>00721 };
<a name="l00722"></a>00722 
<a name="l00723"></a>00723 <span class="keyword">static</span> <a class="code" href="structhandler__link.html">handler_link</a> *handlers = 0;
<a name="l00724"></a>00724 
<a name="l00739"></a><a class="code" href="group__fl__events.html#gae2d39bda7362e444afa41166c478b904">00739</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__events.html#gae2d39bda7362e444afa41166c478b904">Fl::add_handler</a>(<a class="code" href="group__callback__functions.html#ga04194d0b454ba4013ff79ba688b594b5">Fl_Event_Handler</a> ha) {
<a name="l00740"></a>00740   <a class="code" href="structhandler__link.html">handler_link</a> *l = <span class="keyword">new</span> <a class="code" href="structhandler__link.html">handler_link</a>;
<a name="l00741"></a>00741   l-&gt;<a class="code" href="structhandler__link.html#a28c2257ff91633b9f907edd7a47cb71f">handle</a> = ha;
<a name="l00742"></a>00742   l-&gt;<a class="code" href="structhandler__link.html#ab9e4a73b57fab5474a9084c0192cac4d">next</a> = handlers;
<a name="l00743"></a>00743   handlers = l;
<a name="l00744"></a>00744 }
<a name="l00745"></a>00745 
<a name="l00749"></a><a class="code" href="group__fl__events.html#ga057451b4da1df58193521d8206f29edf">00749</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__events.html#ga057451b4da1df58193521d8206f29edf">Fl::remove_handler</a>(<a class="code" href="group__callback__functions.html#ga04194d0b454ba4013ff79ba688b594b5">Fl_Event_Handler</a> ha) {
<a name="l00750"></a>00750   <a class="code" href="structhandler__link.html">handler_link</a> *l, *p;
<a name="l00751"></a>00751 
<a name="l00752"></a>00752   <span class="comment">// Search for the handler in the list...</span>
<a name="l00753"></a>00753   <span class="keywordflow">for</span> (l = handlers, p = 0; l &amp;&amp; l-&gt;<a class="code" href="structhandler__link.html#a28c2257ff91633b9f907edd7a47cb71f">handle</a> != ha; p = l, l = l-&gt;<a class="code" href="structhandler__link.html#ab9e4a73b57fab5474a9084c0192cac4d">next</a>);
<a name="l00754"></a>00754 
<a name="l00755"></a>00755   <span class="keywordflow">if</span> (l) {
<a name="l00756"></a>00756     <span class="comment">// Found it, so remove it from the list...</span>
<a name="l00757"></a>00757     <span class="keywordflow">if</span> (p) p-&gt;<a class="code" href="structhandler__link.html#ab9e4a73b57fab5474a9084c0192cac4d">next</a> = l-&gt;<a class="code" href="structhandler__link.html#ab9e4a73b57fab5474a9084c0192cac4d">next</a>;
<a name="l00758"></a>00758     <span class="keywordflow">else</span> handlers = l-&gt;<a class="code" href="structhandler__link.html#ab9e4a73b57fab5474a9084c0192cac4d">next</a>;
<a name="l00759"></a>00759 
<a name="l00760"></a>00760     <span class="comment">// And free the record...</span>
<a name="l00761"></a>00761     <span class="keyword">delete</span> l;
<a name="l00762"></a>00762   }
<a name="l00763"></a>00763 }
<a name="l00764"></a>00764 
<a name="l00765"></a><a class="code" href="fl__dnd__x_8cxx.html#abcd352ffa1cbcb79d200a17e4c78151a">00765</a> <a class="code" href="png_8h.html#ab832c174e145540d491b0830fc05dbb1">int</a> (*<a class="code" href="Fl_8cxx.html#abcd352ffa1cbcb79d200a17e4c78151a">fl_local_grab</a>)(<a class="code" href="png_8h.html#ab832c174e145540d491b0830fc05dbb1">int</a>); <span class="comment">// used by fl_dnd.cxx</span>
<a name="l00766"></a>00766 
<a name="l00767"></a>00767 <span class="keyword">static</span> <span class="keywordtype">int</span> send_handlers(<span class="keywordtype">int</span> e) {
<a name="l00768"></a>00768   <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="structhandler__link.html">handler_link</a> *hl = handlers; hl; hl = hl-&gt;<a class="code" href="structhandler__link.html#ab9e4a73b57fab5474a9084c0192cac4d">next</a>)
<a name="l00769"></a>00769     <span class="keywordflow">if</span> (hl-&gt;handle(e)) <span class="keywordflow">return</span> 1;
<a name="l00770"></a>00770   <span class="keywordflow">return</span> 0;
<a name="l00771"></a>00771 }
<a name="l00772"></a>00772 
<a name="l00774"></a>00774 
<a name="l00775"></a><a class="code" href="Fl__Group_8cxx.html#a85cb0dd9a89782400373827278c88d8b">00775</a> <a class="code" href="classFl__Widget.html">Fl_Widget</a>* <a class="code" href="Fl_8cxx.html#a85cb0dd9a89782400373827278c88d8b">fl_oldfocus</a>; <span class="comment">// kludge for Fl_Group...</span>
<a name="l00776"></a>00776 
<a name="l00789"></a><a class="code" href="group__fl__events.html#ga1f6eb61b05d03838978c6a1a8016ce7a">00789</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__events.html#ga7f0e9836db43268979e0b3a999583b7f">Fl::focus</a>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *o) {
<a name="l00790"></a>00790   <span class="keywordflow">if</span> (o &amp;&amp; !o-&gt;<a class="code" href="classFl__Widget.html#a6a2a0769c73831e6ef0076d9efa98d72">visible_focus</a>()) <span class="keywordflow">return</span>;
<a name="l00791"></a>00791   <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>()) <span class="keywordflow">return</span>; <span class="comment">// don&#39;t do anything while grab is on</span>
<a name="l00792"></a>00792   <a class="code" href="classFl__Widget.html">Fl_Widget</a> *p = <a class="code" href="classFl.html#a4584dfe66b9d546e3a7641053d210146">focus_</a>;
<a name="l00793"></a>00793   <span class="keywordflow">if</span> (o != p) {
<a name="l00794"></a>00794     <a class="code" href="group__fl__events.html#ga1d787045e08159645b063889d2f2414a">Fl::compose_reset</a>();
<a name="l00795"></a>00795     <a class="code" href="classFl.html#a4584dfe66b9d546e3a7641053d210146">focus_</a> = o;
<a name="l00796"></a>00796     <span class="comment">// make sure that fl_xfocus is set to the top level window</span>
<a name="l00797"></a>00797     <span class="comment">// of this widget, or fl_fix_focus will clear our focus again</span>
<a name="l00798"></a>00798     <span class="keywordflow">if</span> (o) {
<a name="l00799"></a>00799       <a class="code" href="classFl__Window.html">Fl_Window</a> *win = 0, *w1 = o-&gt;<a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>();
<a name="l00800"></a>00800       <span class="keywordflow">while</span> (w1) { win=w1; w1=win-&gt;<a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>(); }
<a name="l00801"></a>00801       <span class="keywordflow">if</span> (win) fl_xfocus = win;
<a name="l00802"></a>00802     }
<a name="l00803"></a>00803     <span class="comment">// take focus from the old focused window</span>
<a name="l00804"></a>00804     fl_oldfocus = 0;
<a name="l00805"></a>00805     <span class="keywordtype">int</span> old_event = <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">e_number</a>;
<a name="l00806"></a>00806     <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">e_number</a> = <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a7d2e5eb9247b1927ba5cc26dc82acaf3">FL_UNFOCUS</a>;
<a name="l00807"></a>00807     <span class="keywordflow">for</span> (; p; p = p-&gt;<a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>()) {
<a name="l00808"></a>00808       p-&gt;<a class="code" href="classFl__Widget.html#a9cb17cc092697dfd05a3fab55856d218">handle</a>(<a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a7d2e5eb9247b1927ba5cc26dc82acaf3">FL_UNFOCUS</a>);
<a name="l00809"></a>00809       fl_oldfocus = p;
<a name="l00810"></a>00810     }
<a name="l00811"></a>00811     <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">e_number</a> = old_event;
<a name="l00812"></a>00812   }
<a name="l00813"></a>00813 }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 <span class="keyword">static</span> <span class="keywordtype">char</span> dnd_flag = 0; <span class="comment">// make &#39;belowmouse&#39; send DND_LEAVE instead of LEAVE</span>
<a name="l00816"></a>00816 
<a name="l00831"></a><a class="code" href="group__fl__events.html#ga5a5c497679a904863019edf5375293bf">00831</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">Fl::belowmouse</a>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *o) {
<a name="l00832"></a>00832   <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>()) <span class="keywordflow">return</span>; <span class="comment">// don&#39;t do anything while grab is on</span>
<a name="l00833"></a>00833   <a class="code" href="classFl__Widget.html">Fl_Widget</a> *p = <a class="code" href="classFl.html#a284ce0fc77a485dd055c6ce388067214">belowmouse_</a>;
<a name="l00834"></a>00834   <span class="keywordflow">if</span> (o != p) {
<a name="l00835"></a>00835     <a class="code" href="classFl.html#a284ce0fc77a485dd055c6ce388067214">belowmouse_</a> = o;
<a name="l00836"></a>00836     <span class="keywordtype">int</span> old_event = <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">e_number</a>;
<a name="l00837"></a>00837     <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">e_number</a> = dnd_flag ? <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a03bdb8df3578915e1d0829cc048d855e">FL_DND_LEAVE</a> : <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3aa776cf3129e97140c88a062881a2d29a">FL_LEAVE</a>;
<a name="l00838"></a>00838     <span class="keywordflow">for</span> (; p &amp;&amp; !p-&gt;<a class="code" href="classFl__Widget.html#ae2fbf2e7056a07cd0e1e23ece102ce87">contains</a>(o); p = p-&gt;<a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>()) {
<a name="l00839"></a>00839       p-&gt;<a class="code" href="classFl__Widget.html#a9cb17cc092697dfd05a3fab55856d218">handle</a>(<a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">e_number</a>);
<a name="l00840"></a>00840     }
<a name="l00841"></a>00841     <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">e_number</a> = old_event;
<a name="l00842"></a>00842   }
<a name="l00843"></a>00843 }
<a name="l00844"></a>00844 
<a name="l00857"></a><a class="code" href="group__fl__events.html#ga83b269dff4e6b30a876ec46b6f911fac">00857</a>  <span class="keywordtype">void</span> <a class="code" href="group__fl__events.html#gadcd24382935bf08b56b1532dfe80da25">Fl::pushed</a>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *o) {
<a name="l00858"></a>00858   <a class="code" href="classFl.html#aaccca760735f25575860bab90cc114c6">pushed_</a> = o;
<a name="l00859"></a>00859 }
<a name="l00860"></a>00860 
<a name="l00861"></a>00861 <span class="keyword">static</span> <span class="keywordtype">void</span> nothing(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *) {}
<a name="l00862"></a>00862 <a class="code" href="png_8h.html#a04364e387081209df3bd1a16e8abe3b9">void</a> (*<a class="code" href="classFl__Tooltip.html#a80ef6ebc30fab1c398ae4dd137c88ddc">Fl_Tooltip::enter</a>)(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *) = nothing;
<a name="l00863"></a>00863 <a class="code" href="png_8h.html#a04364e387081209df3bd1a16e8abe3b9">void</a> (*<a class="code" href="classFl__Tooltip.html#af68420923dbbb7f9381b0852ad885d90">Fl_Tooltip::exit</a>)(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *) = nothing;
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 <span class="comment">// Update modal(), focus() and other state according to system state,</span>
<a name="l00866"></a>00866 <span class="comment">// and send FL_ENTER, FL_LEAVE, FL_FOCUS, and/or FL_UNFOCUS events.</span>
<a name="l00867"></a>00867 <span class="comment">// This is the only function that produces these events in response</span>
<a name="l00868"></a>00868 <span class="comment">// to system activity.</span>
<a name="l00869"></a>00869 <span class="comment">// This is called whenever a window is added or hidden, and whenever</span>
<a name="l00870"></a>00870 <span class="comment">// X says the focus or mouse window have changed.</span>
<a name="l00871"></a>00871 
<a name="l00872"></a><a class="code" href="Fl__x_8cxx.html#afe3a0306383e206c9b1e04accc9a28e7">00872</a> <span class="keywordtype">void</span> <a class="code" href="Fl_8cxx.html#afe3a0306383e206c9b1e04accc9a28e7">fl_fix_focus</a>() {
<a name="l00873"></a>00873 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00874"></a>00874 <span class="preprocessor"></span>  puts(<span class="stringliteral">&quot;fl_fix_focus();&quot;</span>);
<a name="l00875"></a>00875 <span class="preprocessor">#endif // DEBUG</span>
<a name="l00876"></a>00876 <span class="preprocessor"></span>
<a name="l00877"></a>00877   <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">Fl::grab</a>()) <span class="keywordflow">return</span>; <span class="comment">// don&#39;t do anything while grab is on.</span>
<a name="l00878"></a>00878 
<a name="l00879"></a>00879   <span class="comment">// set focus based on Fl::modal() and fl_xfocus</span>
<a name="l00880"></a>00880   <a class="code" href="classFl__Widget.html">Fl_Widget</a>* <a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a> = <a class="code" href="Fl_8cxx.html#a46f39949b9b9dd23677adf6e3708f27d">fl_xfocus</a>;
<a name="l00881"></a>00881   <span class="keywordflow">if</span> (w) {
<a name="l00882"></a>00882     <span class="keywordtype">int</span> saved = <a class="code" href="classFl.html#ad7e56c414916c270ba98e38e2cf41e57">Fl::e_keysym</a>;
<a name="l00883"></a>00883     <span class="keywordflow">if</span> (<a class="code" href="classFl.html#ad7e56c414916c270ba98e38e2cf41e57">Fl::e_keysym</a> &lt; (<a class="code" href="Enumerations_8H.html#a1df1e46a5113628156ed7b7f995217d0" title="A mouse button; use Fl_Button + n for mouse button n.">FL_Button</a> + <a class="code" href="Enumerations_8H.html#a33b6ebe3faf691660603b03bf4bbeeb8" title="The left mouse button.">FL_LEFT_MOUSE</a>) ||
<a name="l00884"></a>00884         <a class="code" href="classFl.html#ad7e56c414916c270ba98e38e2cf41e57">Fl::e_keysym</a> &gt; (<a class="code" href="Enumerations_8H.html#a1df1e46a5113628156ed7b7f995217d0" title="A mouse button; use Fl_Button + n for mouse button n.">FL_Button</a> + <a class="code" href="Enumerations_8H.html#ace3b88a65f6aabab96b0bcc411470c77" title="The right mouse button.">FL_RIGHT_MOUSE</a>))
<a name="l00885"></a>00885       <a class="code" href="classFl.html#ad7e56c414916c270ba98e38e2cf41e57">Fl::e_keysym</a> = 0; <span class="comment">// make sure widgets don&#39;t think a keystroke moved focus</span>
<a name="l00886"></a>00886     <span class="keywordflow">while</span> (w-&gt;<a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>()) w = w-&gt;<a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>();
<a name="l00887"></a>00887     <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">Fl::modal</a>()) w = <a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">Fl::modal</a>();
<a name="l00888"></a>00888     <span class="keywordflow">if</span> (!w-&gt;<a class="code" href="classFl__Widget.html#ae2fbf2e7056a07cd0e1e23ece102ce87">contains</a>(<a class="code" href="group__fl__events.html#ga7f0e9836db43268979e0b3a999583b7f">Fl::focus</a>()))
<a name="l00889"></a>00889       <span class="keywordflow">if</span> (!w-&gt;<a class="code" href="classFl__Widget.html#ab1fe36207b4a59cae3796b0e6d3b7df8">take_focus</a>()) <a class="code" href="group__fl__events.html#ga7f0e9836db43268979e0b3a999583b7f">Fl::focus</a>(w);
<a name="l00890"></a>00890     <a class="code" href="classFl.html#ad7e56c414916c270ba98e38e2cf41e57">Fl::e_keysym</a> = saved;
<a name="l00891"></a>00891   } <span class="keywordflow">else</span>
<a name="l00892"></a>00892     <a class="code" href="group__fl__events.html#ga7f0e9836db43268979e0b3a999583b7f">Fl::focus</a>(0);
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 <span class="comment">// MRS: Originally we checked the button state, but a user reported that it</span>
<a name="l00895"></a>00895 <span class="comment">//      broke click-to-focus in FLWM?!?</span>
<a name="l00896"></a>00896 <span class="comment">//  if (!(Fl::event_state() &amp; 0x7f00000 /*FL_BUTTONS*/)) {</span>
<a name="l00897"></a>00897   <span class="keywordflow">if</span> (!<a class="code" href="group__fl__events.html#gadcd24382935bf08b56b1532dfe80da25">Fl::pushed</a>()) {
<a name="l00898"></a>00898     <span class="comment">// set belowmouse based on Fl::modal() and fl_xmousewin:</span>
<a name="l00899"></a>00899     w = <a class="code" href="Fl_8cxx.html#aa4a35d324647e7c092666054a4e58596">fl_xmousewin</a>;
<a name="l00900"></a>00900     <span class="keywordflow">if</span> (w) {
<a name="l00901"></a>00901       <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">Fl::modal</a>()) w = <a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">Fl::modal</a>();
<a name="l00902"></a>00902       <span class="keywordflow">if</span> (!w-&gt;<a class="code" href="classFl__Widget.html#ae2fbf2e7056a07cd0e1e23ece102ce87">contains</a>(<a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">Fl::belowmouse</a>())) {
<a name="l00903"></a>00903         <span class="keywordtype">int</span> old_event = <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">Fl::e_number</a>;
<a name="l00904"></a>00904         w-&gt;<a class="code" href="classFl__Widget.html#a9cb17cc092697dfd05a3fab55856d218">handle</a>(<a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">Fl::e_number</a> = <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a29b256ac93d443dd33a8c610c24e7af5">FL_ENTER</a>);
<a name="l00905"></a>00905         <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">Fl::e_number</a> = old_event;
<a name="l00906"></a>00906         <span class="keywordflow">if</span> (!w-&gt;<a class="code" href="classFl__Widget.html#ae2fbf2e7056a07cd0e1e23ece102ce87">contains</a>(<a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">Fl::belowmouse</a>())) <a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">Fl::belowmouse</a>(w);
<a name="l00907"></a>00907       } <span class="keywordflow">else</span> {
<a name="l00908"></a>00908         <span class="comment">// send a FL_MOVE event so the enter/leave state is up to date</span>
<a name="l00909"></a>00909         <a class="code" href="classFl.html#a7b57f90db4afa2b1b1e2e163e9bdc1d3">Fl::e_x</a> = <a class="code" href="classFl.html#ac905dc5f6e4b4c919e405932413fce30">Fl::e_x_root</a>-fl_xmousewin-&gt;<a class="code" href="classFl__Widget.html#abea0b9ad493d58bf7fda8d3c81d477b7">x</a>();
<a name="l00910"></a>00910         <a class="code" href="classFl.html#a0c047ee4ea16066dc9e70bc6a4035c20">Fl::e_y</a> = <a class="code" href="classFl.html#af14bafd28cbd839ab2e4526eb4a5c73f">Fl::e_y_root</a>-fl_xmousewin-&gt;<a class="code" href="classFl__Widget.html#aec1aded9efdf5f23dfac8cc725cefc4a">y</a>();
<a name="l00911"></a>00911         <span class="keywordtype">int</span> old_event = <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">Fl::e_number</a>;
<a name="l00912"></a>00912         w-&gt;<a class="code" href="classFl__Widget.html#a9cb17cc092697dfd05a3fab55856d218">handle</a>(<a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">Fl::e_number</a> = <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3acd57cae091eb27c9a52c446bdd0c164d">FL_MOVE</a>);
<a name="l00913"></a>00913         <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">Fl::e_number</a> = old_event;
<a name="l00914"></a>00914       }
<a name="l00915"></a>00915     } <span class="keywordflow">else</span> {
<a name="l00916"></a>00916       <a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">Fl::belowmouse</a>(0);
<a name="l00917"></a>00917       <a class="code" href="classFl__Tooltip.html#a80ef6ebc30fab1c398ae4dd137c88ddc">Fl_Tooltip::enter</a>(0);
<a name="l00918"></a>00918     }
<a name="l00919"></a>00919   }
<a name="l00920"></a>00920 }
<a name="l00921"></a>00921 
<a name="l00922"></a>00922 <span class="preprocessor">#if !(defined(WIN32) || defined(__APPLE__))</span>
<a name="l00923"></a>00923 <span class="preprocessor"></span><span class="keyword">extern</span> <a class="code" href="classFl__Widget.html">Fl_Widget</a> *<a class="code" href="Fl_8cxx.html#ab0f3888aed9e28e4a7741a25f96d3b39">fl_selection_requestor</a>; <span class="comment">// from Fl_x.cxx</span>
<a name="l00924"></a>00924 <span class="preprocessor">#endif</span>
<a name="l00925"></a>00925 <span class="preprocessor"></span>
<a name="l00926"></a>00926 <span class="comment">// This function is called by ~Fl_Widget() and by Fl_Widget::deactivate</span>
<a name="l00927"></a>00927 <span class="comment">// and by Fl_Widget::hide().  It indicates that the widget does not want</span>
<a name="l00928"></a>00928 <span class="comment">// to receive any more events, and also removes all global variables that</span>
<a name="l00929"></a>00929 <span class="comment">// point at the widget.</span>
<a name="l00930"></a>00930 <span class="comment">// I changed this from the 1.0.1 behavior, the older version could send</span>
<a name="l00931"></a>00931 <span class="comment">// FL_LEAVE or FL_UNFOCUS events to the widget.  This appears to not be</span>
<a name="l00932"></a>00932 <span class="comment">// desirable behavior and caused flwm to crash.</span>
<a name="l00933"></a>00933 
<a name="l00934"></a><a class="code" href="Fl__Widget_8cxx.html#a8eead1622d828ddae413c7f2c18d8f34">00934</a> <span class="keywordtype">void</span> <a class="code" href="Fl_8cxx.html#a99123165069583d3efd9dcd5988aa561">fl_throw_focus</a>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *o) {
<a name="l00935"></a>00935 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l00936"></a>00936 <span class="preprocessor"></span>  printf(<span class="stringliteral">&quot;fl_throw_focus(o=%p)\n&quot;</span>, o);
<a name="l00937"></a>00937 <span class="preprocessor">#endif // DEBUG</span>
<a name="l00938"></a>00938 <span class="preprocessor"></span>
<a name="l00939"></a>00939   <span class="keywordflow">if</span> (o-&gt;<a class="code" href="classFl__Widget.html#ae2fbf2e7056a07cd0e1e23ece102ce87">contains</a>(<a class="code" href="group__fl__events.html#gadcd24382935bf08b56b1532dfe80da25">Fl::pushed</a>())) Fl::pushed_ = 0;
<a name="l00940"></a>00940 <span class="preprocessor">#if !(defined(WIN32) || defined(__APPLE__))</span>
<a name="l00941"></a>00941 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (o-&gt;<a class="code" href="classFl__Widget.html#ae2fbf2e7056a07cd0e1e23ece102ce87">contains</a>(fl_selection_requestor)) fl_selection_requestor = 0;
<a name="l00942"></a>00942 <span class="preprocessor">#endif</span>
<a name="l00943"></a>00943 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (o-&gt;<a class="code" href="classFl__Widget.html#ae2fbf2e7056a07cd0e1e23ece102ce87">contains</a>(<a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">Fl::belowmouse</a>())) Fl::belowmouse_ = 0;
<a name="l00944"></a>00944   <span class="keywordflow">if</span> (o-&gt;<a class="code" href="classFl__Widget.html#ae2fbf2e7056a07cd0e1e23ece102ce87">contains</a>(<a class="code" href="group__fl__events.html#ga7f0e9836db43268979e0b3a999583b7f">Fl::focus</a>())) Fl::focus_ = 0;
<a name="l00945"></a>00945   <span class="keywordflow">if</span> (o == fl_xfocus) fl_xfocus = 0;
<a name="l00946"></a>00946   <span class="keywordflow">if</span> (o == <a class="code" href="classFl__Tooltip.html#a836c5e9c21a5277f27dd2e8feab75788">Fl_Tooltip::current</a>()) <a class="code" href="classFl__Tooltip.html#a836c5e9c21a5277f27dd2e8feab75788">Fl_Tooltip::current</a>(0);
<a name="l00947"></a>00947   <span class="keywordflow">if</span> (o == fl_xmousewin) fl_xmousewin = 0;
<a name="l00948"></a>00948   <a class="code" href="classFl__Tooltip.html#af68420923dbbb7f9381b0852ad885d90">Fl_Tooltip::exit</a>(o);
<a name="l00949"></a>00949   <a class="code" href="Fl_8cxx.html#afe3a0306383e206c9b1e04accc9a28e7">fl_fix_focus</a>();
<a name="l00950"></a>00950 }
<a name="l00951"></a>00951 
<a name="l00953"></a>00953 
<a name="l00954"></a>00954 <span class="comment">// Call to-&gt;handle but first replace the mouse x/y with the correct</span>
<a name="l00955"></a>00955 <span class="comment">// values to account for nested X windows. &#39;window&#39; is the outermost</span>
<a name="l00956"></a>00956 <span class="comment">// window the event was posted to by X:</span>
<a name="l00957"></a>00957 <span class="keyword">static</span> <span class="keywordtype">int</span> send(<span class="keywordtype">int</span> event, <a class="code" href="classFl__Widget.html">Fl_Widget</a>* to, <a class="code" href="classFl__Window.html">Fl_Window</a>* window) {
<a name="l00958"></a>00958   <span class="keywordtype">int</span> <a class="code" href="fl__boxtype_8cxx.html#acafd1211381c8640d68a685ac2eea5d2">dx</a>, <a class="code" href="fl__boxtype_8cxx.html#a4cffdba1345d329bb97e76579d57fa21">dy</a>;
<a name="l00959"></a>00959   <span class="keywordtype">int</span> old_event = <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">Fl::e_number</a>;
<a name="l00960"></a>00960   <span class="keywordflow">if</span> (window) {
<a name="l00961"></a>00961     dx = window-&gt;<a class="code" href="classFl__Widget.html#abea0b9ad493d58bf7fda8d3c81d477b7">x</a>();
<a name="l00962"></a>00962     dy = window-&gt;<a class="code" href="classFl__Widget.html#aec1aded9efdf5f23dfac8cc725cefc4a">y</a>();
<a name="l00963"></a>00963   } <span class="keywordflow">else</span> {
<a name="l00964"></a>00964     dx = dy = 0;
<a name="l00965"></a>00965   }
<a name="l00966"></a>00966   <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classFl__Widget.html">Fl_Widget</a>* <a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a> = to; <a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a>; <a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a> = <a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a>-&gt;parent())
<a name="l00967"></a>00967     <span class="keywordflow">if</span> (<a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a>-&gt;type()&gt;=<a class="code" href="Fl__Window_8H.html#ade2152acce2e38a691be590e8ed68a3c" title="window type id all subclasses have type() &amp;gt;= this">FL_WINDOW</a>) {dx -= <a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a>-&gt;x(); dy -= <a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a>-&gt;y();}
<a name="l00968"></a>00968   <span class="keywordtype">int</span> save_x = <a class="code" href="classFl.html#a7b57f90db4afa2b1b1e2e163e9bdc1d3">Fl::e_x</a>; <a class="code" href="classFl.html#a7b57f90db4afa2b1b1e2e163e9bdc1d3">Fl::e_x</a> += <a class="code" href="fl__boxtype_8cxx.html#acafd1211381c8640d68a685ac2eea5d2">dx</a>;
<a name="l00969"></a>00969   <span class="keywordtype">int</span> save_y = <a class="code" href="classFl.html#a0c047ee4ea16066dc9e70bc6a4035c20">Fl::e_y</a>; <a class="code" href="classFl.html#a0c047ee4ea16066dc9e70bc6a4035c20">Fl::e_y</a> += <a class="code" href="fl__boxtype_8cxx.html#a4cffdba1345d329bb97e76579d57fa21">dy</a>;
<a name="l00970"></a>00970   <span class="keywordtype">int</span> ret = to-&gt;<a class="code" href="classFl__Widget.html#a9cb17cc092697dfd05a3fab55856d218">handle</a>(<a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">Fl::e_number</a> = event);
<a name="l00971"></a>00971   <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">Fl::e_number</a> = old_event;
<a name="l00972"></a>00972   <a class="code" href="classFl.html#a0c047ee4ea16066dc9e70bc6a4035c20">Fl::e_y</a> = save_y;
<a name="l00973"></a>00973   <a class="code" href="classFl.html#a7b57f90db4afa2b1b1e2e163e9bdc1d3">Fl::e_x</a> = save_x;
<a name="l00974"></a>00974   <span class="keywordflow">return</span> ret;
<a name="l00975"></a>00975 }
<a name="l00976"></a>00976 
<a name="l00977"></a><a class="code" href="group__fl__events.html#ga064a4028b27d7da1238a6e5280582abf">00977</a> <span class="keywordtype">int</span> <a class="code" href="group__fl__events.html#ga064a4028b27d7da1238a6e5280582abf">Fl::handle</a>(<span class="keywordtype">int</span> e, <a class="code" href="classFl__Window.html">Fl_Window</a>* window)
<a name="l00982"></a>00982 {
<a name="l00983"></a>00983   <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">e_number</a> = e;
<a name="l00984"></a>00984   <span class="keywordflow">if</span> (<a class="code" href="Fl_8cxx.html#abcd352ffa1cbcb79d200a17e4c78151a">fl_local_grab</a>) <span class="keywordflow">return</span> <a class="code" href="Fl_8cxx.html#abcd352ffa1cbcb79d200a17e4c78151a">fl_local_grab</a>(e);
<a name="l00985"></a>00985 
<a name="l00986"></a>00986   <a class="code" href="classFl__Widget.html">Fl_Widget</a>* wi = window;
<a name="l00987"></a>00987 
<a name="l00988"></a>00988   <span class="keywordflow">switch</span> (e) {
<a name="l00989"></a>00989 
<a name="l00990"></a>00990   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a42828f08af2b2191bbc60e113ec08f01">FL_CLOSE</a>:
<a name="l00991"></a>00991     <span class="keywordflow">if</span> ( <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>() || (<a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>() &amp;&amp; window != <a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>()) ) <span class="keywordflow">return</span> 0;
<a name="l00992"></a>00992     wi-&gt;<a class="code" href="classFl__Widget.html#a37aa870315e37ddc1246caa6421322f4">do_callback</a>();
<a name="l00993"></a>00993     <span class="keywordflow">return</span> 1;
<a name="l00994"></a>00994 
<a name="l00995"></a>00995   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a9edbfd236c9ea348dcaae935a76bd885">FL_SHOW</a>:
<a name="l00996"></a>00996     wi-&gt;Fl_Widget::show(); <span class="comment">// this calls Fl_Widget::show(), not Fl_Window::show()</span>
<a name="l00997"></a>00997     <span class="keywordflow">return</span> 1;
<a name="l00998"></a>00998 
<a name="l00999"></a>00999   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3aed9d7c8fbb9dac1e16f762195f00d5d6">FL_HIDE</a>:
<a name="l01000"></a>01000     wi-&gt;Fl_Widget::hide(); <span class="comment">// this calls Fl_Widget::hide(), not Fl_Window::hide()</span>
<a name="l01001"></a>01001     <span class="keywordflow">return</span> 1;
<a name="l01002"></a>01002 
<a name="l01003"></a>01003   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a44972d76423f3e380ae12c36827944e3">FL_PUSH</a>:
<a name="l01004"></a>01004 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l01005"></a>01005 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;Fl::handle(e=%d, window=%p);\n&quot;</span>, e, window);
<a name="l01006"></a>01006 <span class="preprocessor">#endif // DEBUG</span>
<a name="l01007"></a>01007 <span class="preprocessor"></span>
<a name="l01008"></a>01008     <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>()) wi = <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>();
<a name="l01009"></a>01009     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>() &amp;&amp; wi != <a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>()) <span class="keywordflow">return</span> 0;
<a name="l01010"></a>01010     <a class="code" href="classFl.html#aaccca760735f25575860bab90cc114c6">pushed_</a> = wi;
<a name="l01011"></a>01011     <a class="code" href="classFl__Tooltip.html#a836c5e9c21a5277f27dd2e8feab75788">Fl_Tooltip::current</a>(wi);
<a name="l01012"></a>01012     <span class="keywordflow">if</span> (send(e, wi, window)) <span class="keywordflow">return</span> 1;
<a name="l01013"></a>01013     <span class="comment">// raise windows that are clicked on:</span>
<a name="l01014"></a>01014     window-&gt;<a class="code" href="classFl__Window.html#afc4d3796226dfd4620b4d7cf29c287c9">show</a>();
<a name="l01015"></a>01015     <span class="keywordflow">return</span> 1;
<a name="l01016"></a>01016 
<a name="l01017"></a>01017   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3af4f28b5ef9ec051e4a4d9e19a16370b8">FL_DND_ENTER</a>:
<a name="l01018"></a>01018   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3aadfedcde7415286c752ba427f0e8626f">FL_DND_DRAG</a>:
<a name="l01019"></a>01019     dnd_flag = 1;
<a name="l01020"></a>01020     <span class="keywordflow">break</span>;
<a name="l01021"></a>01021 
<a name="l01022"></a>01022   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a03bdb8df3578915e1d0829cc048d855e">FL_DND_LEAVE</a>:
<a name="l01023"></a>01023     dnd_flag = 1;
<a name="l01024"></a>01024     <a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">belowmouse</a>(0);
<a name="l01025"></a>01025     dnd_flag = 0;
<a name="l01026"></a>01026     <span class="keywordflow">return</span> 1;
<a name="l01027"></a>01027 
<a name="l01028"></a>01028   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a80deb55dbc048b83dc154c11c658b7d6">FL_DND_RELEASE</a>:
<a name="l01029"></a>01029     wi = <a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">belowmouse</a>();
<a name="l01030"></a>01030     <span class="keywordflow">break</span>;
<a name="l01031"></a>01031 
<a name="l01032"></a>01032   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3acd57cae091eb27c9a52c446bdd0c164d">FL_MOVE</a>:
<a name="l01033"></a>01033   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3aaad5c7b2302d7bfe6c6d37b50b4c70f0">FL_DRAG</a>:
<a name="l01034"></a>01034     fl_xmousewin = window; <span class="comment">// this should already be set, but just in case.</span>
<a name="l01035"></a>01035     <span class="keywordflow">if</span> (<a class="code" href="group__fl__events.html#gadcd24382935bf08b56b1532dfe80da25">pushed</a>()) {
<a name="l01036"></a>01036       wi = <a class="code" href="group__fl__events.html#gadcd24382935bf08b56b1532dfe80da25">pushed</a>();
<a name="l01037"></a>01037       <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>()) wi = <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>();
<a name="l01038"></a>01038       <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">e_number</a> = e = <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3aaad5c7b2302d7bfe6c6d37b50b4c70f0">FL_DRAG</a>;
<a name="l01039"></a>01039       <span class="keywordflow">break</span>;
<a name="l01040"></a>01040     }
<a name="l01041"></a>01041     <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>() &amp;&amp; wi != <a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>()) wi = 0;
<a name="l01042"></a>01042     <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>()) wi = <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>();
<a name="l01043"></a>01043     { <span class="keywordtype">int</span> ret;
<a name="l01044"></a>01044       <a class="code" href="classFl__Widget.html">Fl_Widget</a>* pbm = <a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">belowmouse</a>();
<a name="l01045"></a>01045 <span class="preprocessor">#ifdef __APPLE__</span>
<a name="l01046"></a>01046 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="group__group__macosx.html#ga2c7db6b2ea9a6ae37a26bea810d2056c" title="The version number of the running Mac OS X (e.g., 0x1064 for 10.6.4)">fl_mac_os_version</a> &lt; 0x1050) {
<a name="l01047"></a>01047         <span class="comment">// before 10.5, mouse moved events aren&#39;t sent to borderless windows such as tooltips</span>
<a name="l01048"></a>01048         <a class="code" href="classFl__Window.html">Fl_Window</a> *tooltip = Fl_Tooltip::current_window();
<a name="l01049"></a>01049         <span class="keywordtype">int</span> inside = 0;
<a name="l01050"></a>01050         <span class="keywordflow">if</span> (tooltip &amp;&amp; tooltip-&gt;<a class="code" href="classFl__Window.html#aa09300542b2d8b49fc69a037bdd3b742">shown</a>() ) { <span class="comment">// check if a tooltip window is currently opened</span>
<a name="l01051"></a>01051           <span class="comment">// check if mouse is inside the tooltip</span>
<a name="l01052"></a>01052           inside = (<a class="code" href="group__fl__events.html#ga4c40bd0d2960354c9778fdb65a2b720d">Fl::event_x_root</a>() &gt;= tooltip-&gt;<a class="code" href="classFl__Widget.html#abea0b9ad493d58bf7fda8d3c81d477b7">x</a>() &amp;&amp; <a class="code" href="group__fl__events.html#ga4c40bd0d2960354c9778fdb65a2b720d">Fl::event_x_root</a>() &lt; tooltip-&gt;<a class="code" href="classFl__Widget.html#abea0b9ad493d58bf7fda8d3c81d477b7">x</a>() + tooltip-&gt;<a class="code" href="classFl__Widget.html#ad59ece778aaf15acc4dd01a8bf5f8012">w</a>() &amp;&amp;
<a name="l01053"></a>01053           <a class="code" href="group__fl__events.html#ga9801003f911eae0e49bf52b875dcaaa5">Fl::event_y_root</a>() &gt;= tooltip-&gt;<a class="code" href="classFl__Widget.html#aec1aded9efdf5f23dfac8cc725cefc4a">y</a>() &amp;&amp; <a class="code" href="group__fl__events.html#ga9801003f911eae0e49bf52b875dcaaa5">Fl::event_y_root</a>() &lt; tooltip-&gt;<a class="code" href="classFl__Widget.html#aec1aded9efdf5f23dfac8cc725cefc4a">y</a>() + tooltip-&gt;<a class="code" href="classFl__Widget.html#aeeabd61e2d10c76cd6600dbbfe951f71">h</a>() );
<a name="l01054"></a>01054         }
<a name="l01055"></a>01055         <span class="comment">// if inside, send event to tooltip window instead of background window</span>
<a name="l01056"></a>01056         <span class="keywordflow">if</span> (inside) ret = send(e, tooltip, window);
<a name="l01057"></a>01057         <span class="keywordflow">else</span> ret = (wi &amp;&amp; send(e, wi, window));
<a name="l01058"></a>01058       } <span class="keywordflow">else</span>
<a name="l01059"></a>01059 <span class="preprocessor">#endif</span>
<a name="l01060"></a>01060 <span class="preprocessor"></span>      ret = (wi &amp;&amp; send(e, wi, window));
<a name="l01061"></a>01061    <span class="keywordflow">if</span> (pbm != <a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">belowmouse</a>()) {
<a name="l01062"></a>01062 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l01063"></a>01063 <span class="preprocessor"></span>      printf(<span class="stringliteral">&quot;Fl::handle(e=%d, window=%p);\n&quot;</span>, e, window);
<a name="l01064"></a>01064 <span class="preprocessor">#endif // DEBUG</span>
<a name="l01065"></a>01065 <span class="preprocessor"></span>      <a class="code" href="classFl__Tooltip.html#a80ef6ebc30fab1c398ae4dd137c88ddc">Fl_Tooltip::enter</a>(<a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">belowmouse</a>());
<a name="l01066"></a>01066     }
<a name="l01067"></a>01067     <span class="keywordflow">return</span> ret;}
<a name="l01068"></a>01068 
<a name="l01069"></a>01069   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a5949b5ff170a8236d2745eddb1e9fd9a">FL_RELEASE</a>: {
<a name="l01070"></a>01070 <span class="comment">//    printf(&quot;FL_RELEASE: window=%p, pushed() = %p, grab() = %p, modal() = %p\n&quot;,</span>
<a name="l01071"></a>01071 <span class="comment">//           window, pushed(), grab(), modal());</span>
<a name="l01072"></a>01072 
<a name="l01073"></a>01073     <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>()) {
<a name="l01074"></a>01074       wi = <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>();
<a name="l01075"></a>01075       <a class="code" href="classFl.html#aaccca760735f25575860bab90cc114c6">pushed_</a> = 0; <span class="comment">// must be zero before callback is done!</span>
<a name="l01076"></a>01076     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__fl__events.html#gadcd24382935bf08b56b1532dfe80da25">pushed</a>()) {
<a name="l01077"></a>01077       wi = <a class="code" href="group__fl__events.html#gadcd24382935bf08b56b1532dfe80da25">pushed</a>();
<a name="l01078"></a>01078       <a class="code" href="classFl.html#aaccca760735f25575860bab90cc114c6">pushed_</a> = 0; <span class="comment">// must be zero before callback is done!</span>
<a name="l01079"></a>01079     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>() &amp;&amp; wi != <a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>()) <span class="keywordflow">return</span> 0;
<a name="l01080"></a>01080     <span class="keywordtype">int</span> r = send(e, wi, window);
<a name="l01081"></a>01081     <a class="code" href="Fl_8cxx.html#afe3a0306383e206c9b1e04accc9a28e7">fl_fix_focus</a>();
<a name="l01082"></a>01082     <span class="keywordflow">return</span> r;}
<a name="l01083"></a>01083 
<a name="l01084"></a>01084   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a7d2e5eb9247b1927ba5cc26dc82acaf3">FL_UNFOCUS</a>:
<a name="l01085"></a>01085     window = 0;
<a name="l01086"></a>01086   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3adaac2a187beb309443d668a20a59986b">FL_FOCUS</a>:
<a name="l01087"></a>01087     fl_xfocus = window;
<a name="l01088"></a>01088     <a class="code" href="Fl_8cxx.html#afe3a0306383e206c9b1e04accc9a28e7">fl_fix_focus</a>();
<a name="l01089"></a>01089     <span class="keywordflow">return</span> 1;
<a name="l01090"></a>01090 
<a name="l01091"></a>01091   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3ab0e1a75a36767b878915e59e5f9e3be8">FL_KEYUP</a>:
<a name="l01092"></a>01092     <span class="comment">// Send the key-up to the current focus. This is not </span>
<a name="l01093"></a>01093     <span class="comment">// always the same widget that received the corresponding</span>
<a name="l01094"></a>01094     <span class="comment">// FL_KEYBOARD event because focus may have changed.</span>
<a name="l01095"></a>01095     <span class="comment">// Sending the KEYUP to the right KEYDOWN is possible, but</span>
<a name="l01096"></a>01096     <span class="comment">// would require that we track the KEYDOWN for every possible </span>
<a name="l01097"></a>01097     <span class="comment">// key stroke (users may hold down multiple keys!) and then </span>
<a name="l01098"></a>01098     <span class="comment">// make sure that the widget still exists before sending</span>
<a name="l01099"></a>01099     <span class="comment">// a KEYUP there. I believe that the current solution is</span>
<a name="l01100"></a>01100     <span class="comment">// &quot;close enough&quot;.</span>
<a name="l01101"></a>01101     <span class="keywordflow">for</span> (wi = <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>() ? <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>() : <a class="code" href="group__fl__events.html#ga7f0e9836db43268979e0b3a999583b7f">focus</a>(); wi; wi = wi-&gt;<a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>())
<a name="l01102"></a>01102       <span class="keywordflow">if</span> (send(<a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3ab0e1a75a36767b878915e59e5f9e3be8">FL_KEYUP</a>, wi, window)) <span class="keywordflow">return</span> 1;
<a name="l01103"></a>01103     <span class="keywordflow">return</span> 0;
<a name="l01104"></a>01104 
<a name="l01105"></a>01105   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a1387c0430ec873aa44704954a369143b">FL_KEYBOARD</a>:
<a name="l01106"></a>01106 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l01107"></a>01107 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;Fl::handle(e=%d, window=%p);\n&quot;</span>, e, window);
<a name="l01108"></a>01108 <span class="preprocessor">#endif // DEBUG</span>
<a name="l01109"></a>01109 <span class="preprocessor"></span>
<a name="l01110"></a>01110     <a class="code" href="classFl__Tooltip.html#a80ef6ebc30fab1c398ae4dd137c88ddc">Fl_Tooltip::enter</a>((<a class="code" href="classFl__Widget.html">Fl_Widget</a>*)0);
<a name="l01111"></a>01111 
<a name="l01112"></a>01112     fl_xfocus = window; <span class="comment">// this should not happen!  But maybe it does:</span>
<a name="l01113"></a>01113 
<a name="l01114"></a>01114     <span class="comment">// Try it as keystroke, sending it to focus and all parents:</span>
<a name="l01115"></a>01115     <span class="keywordflow">for</span> (wi = <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>() ? <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>() : <a class="code" href="group__fl__events.html#ga7f0e9836db43268979e0b3a999583b7f">focus</a>(); wi; wi = wi-&gt;<a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>())
<a name="l01116"></a>01116       <span class="keywordflow">if</span> (send(<a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a1387c0430ec873aa44704954a369143b">FL_KEYBOARD</a>, wi, window)) <span class="keywordflow">return</span> 1;
<a name="l01117"></a>01117 
<a name="l01118"></a>01118     <span class="comment">// recursive call to try shortcut:</span>
<a name="l01119"></a>01119     <span class="keywordflow">if</span> (<a class="code" href="group__fl__events.html#ga064a4028b27d7da1238a6e5280582abf">handle</a>(<a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a6161f0e91cc6b2947200323e3bda8156">FL_SHORTCUT</a>, window)) <span class="keywordflow">return</span> 1;
<a name="l01120"></a>01120 
<a name="l01121"></a>01121     <span class="comment">// and then try a shortcut with the case of the text swapped, by</span>
<a name="l01122"></a>01122     <span class="comment">// changing the text and falling through to FL_SHORTCUT case:</span>
<a name="l01123"></a>01123     {<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* c = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<a class="code" href="group__fl__events.html#ga6647c55948fe1d8be9367267529e9c54">event_text</a>(); <span class="comment">// cast away const</span>
<a name="l01124"></a>01124     <span class="keywordflow">if</span> (!isalpha(*c)) <span class="keywordflow">return</span> 0;
<a name="l01125"></a>01125     *c = isupper(*c) ? tolower(*c) : toupper(*c);}
<a name="l01126"></a>01126     <a class="code" href="classFl.html#a8e526e1b9e8824587ff9a641f191667a">e_number</a> = e = <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a6161f0e91cc6b2947200323e3bda8156">FL_SHORTCUT</a>;
<a name="l01127"></a>01127 
<a name="l01128"></a>01128   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a6161f0e91cc6b2947200323e3bda8156">FL_SHORTCUT</a>:
<a name="l01129"></a>01129     <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>()) {wi = <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>(); <span class="keywordflow">break</span>;} <span class="comment">// send it to grab window</span>
<a name="l01130"></a>01130 
<a name="l01131"></a>01131     <span class="comment">// Try it as shortcut, sending to mouse widget and all parents:</span>
<a name="l01132"></a>01132     wi = <a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">belowmouse</a>();
<a name="l01133"></a>01133     <span class="keywordflow">if</span> (!wi) {
<a name="l01134"></a>01134       wi = <a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>();
<a name="l01135"></a>01135       <span class="keywordflow">if</span> (!wi) wi = window;
<a name="l01136"></a>01136     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wi-&gt;<a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>() != <a class="code" href="group__fl__windows.html#ga3130407bc1c11f9b7f2a9c43a87a1599">first_window</a>()) {
<a name="l01137"></a>01137       <span class="keywordflow">if</span> (send(<a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a6161f0e91cc6b2947200323e3bda8156">FL_SHORTCUT</a>, <a class="code" href="group__fl__windows.html#ga3130407bc1c11f9b7f2a9c43a87a1599">first_window</a>(), <a class="code" href="group__fl__windows.html#ga3130407bc1c11f9b7f2a9c43a87a1599">first_window</a>())) <span class="keywordflow">return</span> 1;
<a name="l01138"></a>01138     }
<a name="l01139"></a>01139 
<a name="l01140"></a>01140     <span class="keywordflow">for</span> (; wi; wi = wi-&gt;<a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>()) {
<a name="l01141"></a>01141       <span class="keywordflow">if</span> (send(<a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a6161f0e91cc6b2947200323e3bda8156">FL_SHORTCUT</a>, wi, wi-&gt;<a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>())) <span class="keywordflow">return</span> 1;
<a name="l01142"></a>01142     }
<a name="l01143"></a>01143 
<a name="l01144"></a>01144     <span class="comment">// try using add_handle() functions:</span>
<a name="l01145"></a>01145     <span class="keywordflow">if</span> (send_handlers(<a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a6161f0e91cc6b2947200323e3bda8156">FL_SHORTCUT</a>)) <span class="keywordflow">return</span> 1;
<a name="l01146"></a>01146 
<a name="l01147"></a>01147     <span class="comment">// make Escape key close windows:</span>
<a name="l01148"></a>01148     <span class="keywordflow">if</span> (<a class="code" href="group__fl__events.html#ga1ac131e3cd5ca674cc022b1f77233449">event_key</a>()==<a class="code" href="Enumerations_8H.html#a91b983ebe4cd86393e2addb8ab40a326" title="The escape key.">FL_Escape</a>) {
<a name="l01149"></a>01149       wi = <a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>(); <span class="keywordflow">if</span> (!wi) wi = window;
<a name="l01150"></a>01150       wi-&gt;<a class="code" href="classFl__Widget.html#a37aa870315e37ddc1246caa6421322f4">do_callback</a>();
<a name="l01151"></a>01151       <span class="keywordflow">return</span> 1;
<a name="l01152"></a>01152     }
<a name="l01153"></a>01153 
<a name="l01154"></a>01154     <span class="keywordflow">return</span> 0;
<a name="l01155"></a>01155 
<a name="l01156"></a>01156   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a29b256ac93d443dd33a8c610c24e7af5">FL_ENTER</a>:
<a name="l01157"></a>01157 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l01158"></a>01158 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;Fl::handle(e=%d, window=%p);\n&quot;</span>, e, window);
<a name="l01159"></a>01159 <span class="preprocessor">#endif // DEBUG</span>
<a name="l01160"></a>01160 <span class="preprocessor"></span>
<a name="l01161"></a>01161     fl_xmousewin = window;
<a name="l01162"></a>01162     <a class="code" href="Fl_8cxx.html#afe3a0306383e206c9b1e04accc9a28e7">fl_fix_focus</a>();
<a name="l01163"></a>01163     <a class="code" href="classFl__Tooltip.html#a80ef6ebc30fab1c398ae4dd137c88ddc">Fl_Tooltip::enter</a>(<a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">belowmouse</a>());
<a name="l01164"></a>01164     <span class="keywordflow">return</span> 1;
<a name="l01165"></a>01165 
<a name="l01166"></a>01166   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3aa776cf3129e97140c88a062881a2d29a">FL_LEAVE</a>:
<a name="l01167"></a>01167 <span class="preprocessor">#ifdef DEBUG</span>
<a name="l01168"></a>01168 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;Fl::handle(e=%d, window=%p);\n&quot;</span>, e, window);
<a name="l01169"></a>01169 <span class="preprocessor">#endif // DEBUG</span>
<a name="l01170"></a>01170 <span class="preprocessor"></span>
<a name="l01171"></a>01171     <span class="keywordflow">if</span> (!<a class="code" href="classFl.html#aaccca760735f25575860bab90cc114c6">pushed_</a>) {
<a name="l01172"></a>01172       <a class="code" href="group__fl__events.html#ga5b55ce634002a2743c24c4c4db7cbdd4">belowmouse</a>(0);
<a name="l01173"></a>01173       <a class="code" href="classFl__Tooltip.html#a80ef6ebc30fab1c398ae4dd137c88ddc">Fl_Tooltip::enter</a>(0);
<a name="l01174"></a>01174     }
<a name="l01175"></a>01175     <span class="keywordflow">if</span> (window == fl_xmousewin) {fl_xmousewin = 0; <a class="code" href="Fl_8cxx.html#afe3a0306383e206c9b1e04accc9a28e7">fl_fix_focus</a>();}
<a name="l01176"></a>01176     <span class="keywordflow">return</span> 1;
<a name="l01177"></a>01177 
<a name="l01178"></a>01178   <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3ad5f7dd40377c51d5795cd53ded3d4bef">FL_MOUSEWHEEL</a>:
<a name="l01179"></a>01179     fl_xfocus = window; <span class="comment">// this should not happen!  But maybe it does:</span>
<a name="l01180"></a>01180 
<a name="l01181"></a>01181     <span class="comment">// Try sending it to the &quot;grab&quot; first</span>
<a name="l01182"></a>01182     <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>() &amp;&amp; <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>()!=<a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>() &amp;&amp; <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>()!=window) {
<a name="l01183"></a>01183       <span class="keywordflow">if</span> (send(<a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3ad5f7dd40377c51d5795cd53ded3d4bef">FL_MOUSEWHEEL</a>, <a class="code" href="group__fl__windows.html#ga100705a8107397cfde7318aa34019739">grab</a>(), window)) <span class="keywordflow">return</span> 1;
<a name="l01184"></a>01184     }
<a name="l01185"></a>01185     <span class="comment">// Now try sending it to the &quot;modal&quot; window</span>
<a name="l01186"></a>01186     <span class="keywordflow">if</span> (<a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>()) {
<a name="l01187"></a>01187       send(<a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3ad5f7dd40377c51d5795cd53ded3d4bef">FL_MOUSEWHEEL</a>, <a class="code" href="group__fl__windows.html#gaf0938156f04e1babebaa8eb75a8d0fce">modal</a>(), window);
<a name="l01188"></a>01188       <span class="keywordflow">return</span> 1;
<a name="l01189"></a>01189     }
<a name="l01190"></a>01190     <span class="comment">// Finally try sending it to the window, the event occured in</span>
<a name="l01191"></a>01191     <span class="keywordflow">if</span> (send(<a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3ad5f7dd40377c51d5795cd53ded3d4bef">FL_MOUSEWHEEL</a>, window, window)) <span class="keywordflow">return</span> 1;
<a name="l01192"></a>01192   <span class="keywordflow">default</span>:
<a name="l01193"></a>01193     <span class="keywordflow">break</span>;
<a name="l01194"></a>01194   }
<a name="l01195"></a>01195   <span class="keywordflow">if</span> (wi &amp;&amp; send(e, wi, window)) {
<a name="l01196"></a>01196     dnd_flag = 0;
<a name="l01197"></a>01197     <span class="keywordflow">return</span> 1;
<a name="l01198"></a>01198   }
<a name="l01199"></a>01199   dnd_flag = 0;
<a name="l01200"></a>01200   <span class="keywordflow">return</span> send_handlers(e);
<a name="l01201"></a>01201 }
<a name="l01202"></a>01202 
<a name="l01204"></a>01204 <span class="comment">// hide() destroys the X window, it does not do unmap!</span>
<a name="l01205"></a>01205 
<a name="l01206"></a>01206 <span class="preprocessor">#if !defined(WIN32) &amp;&amp; USE_XFT</span>
<a name="l01207"></a>01207 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="fl__font__xft_8cxx.html#a33937259c5c716e149797643e77db7df">fl_destroy_xft_draw</a>(<a class="code" href="mac_8H.html#aad9fe48cacd960402308a6a7f9f5e584">Window</a>);
<a name="l01208"></a>01208 <span class="preprocessor">#endif</span>
<a name="l01209"></a>01209 <span class="preprocessor"></span>
<a name="l01210"></a><a class="code" href="classFl__Window.html#acd69a335bdc69f5624301f267ca7f94e">01210</a> <span class="keywordtype">void</span> <a class="code" href="classFl__Window.html#acd69a335bdc69f5624301f267ca7f94e">Fl_Window::hide</a>() {
<a name="l01211"></a>01211   <a class="code" href="classFl__Widget.html#a19e89bf3b3d2e418b772739ffa6e24d7">clear_visible</a>();
<a name="l01212"></a>01212 
<a name="l01213"></a>01213   <span class="keywordflow">if</span> (!<a class="code" href="classFl__Window.html#aa09300542b2d8b49fc69a037bdd3b742">shown</a>()) <span class="keywordflow">return</span>;
<a name="l01214"></a>01214 
<a name="l01215"></a>01215   <span class="comment">// remove from the list of windows:</span>
<a name="l01216"></a>01216   <a class="code" href="classFl__X.html">Fl_X</a>* ip = i;
<a name="l01217"></a>01217   <a class="code" href="classFl__X.html">Fl_X</a>** pp = &amp;Fl_X::first;
<a name="l01218"></a>01218   <span class="keywordflow">for</span> (; *pp != ip; pp = &amp;(*pp)-&gt;<a class="code" href="classFl__X.html#a41f6a721a953ea62021bb1dd9c4f2187">next</a>) <span class="keywordflow">if</span> (!*pp) <span class="keywordflow">return</span>;
<a name="l01219"></a>01219   *pp = ip-&gt;<a class="code" href="classFl__X.html#a41f6a721a953ea62021bb1dd9c4f2187">next</a>;
<a name="l01220"></a>01220 <span class="preprocessor">#ifdef __APPLE__</span>
<a name="l01221"></a>01221 <span class="preprocessor"></span>  ip-&gt;unlink();
<a name="l01222"></a>01222   <span class="comment">// MacOS X manages a single pointer per application. Make sure that hiding</span>
<a name="l01223"></a>01223   <span class="comment">// a toplevel window will not leave us with some random pointer shape, or</span>
<a name="l01224"></a>01224   <span class="comment">// worst case, an invisible pointer</span>
<a name="l01225"></a>01225   <span class="keywordflow">if</span> (!<a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>()) <a class="code" href="classFl__Window.html#a3a762c544af59bd69458e2d635a2e160">cursor</a>(<a class="code" href="Enumerations_8H.html#a72bde974edc7926b1217dd51b8c7e8e0a045f091aae5108f94e912bf5163344dd">FL_CURSOR_DEFAULT</a>);
<a name="l01226"></a>01226 <span class="preprocessor">#endif</span>
<a name="l01227"></a>01227 <span class="preprocessor"></span>  i = 0;
<a name="l01228"></a>01228 
<a name="l01229"></a>01229   <span class="comment">// recursively remove any subwindows:</span>
<a name="l01230"></a>01230   <span class="keywordflow">for</span> (<a class="code" href="classFl__X.html">Fl_X</a> *wi = Fl_X::first; wi;) {
<a name="l01231"></a>01231     <a class="code" href="classFl__Window.html">Fl_Window</a>* W = wi-&gt;<a class="code" href="classFl__Widget.html#ad59ece778aaf15acc4dd01a8bf5f8012">w</a>;
<a name="l01232"></a>01232     <span class="keywordflow">if</span> (W-&gt;<a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>() == <span class="keyword">this</span>) {
<a name="l01233"></a>01233       W-&gt;<a class="code" href="classFl__Window.html#acd69a335bdc69f5624301f267ca7f94e">hide</a>();
<a name="l01234"></a>01234       W-&gt;<a class="code" href="classFl__Widget.html#a85981546c4927bd5e6d43d6e3df3416a">set_visible</a>();
<a name="l01235"></a>01235       wi = Fl_X::first;
<a name="l01236"></a>01236     } <span class="keywordflow">else</span> wi = wi-&gt;<a class="code" href="classFl__X.html#a41f6a721a953ea62021bb1dd9c4f2187">next</a>;
<a name="l01237"></a>01237   }
<a name="l01238"></a>01238 
<a name="l01239"></a>01239   <span class="keywordflow">if</span> (<span class="keyword">this</span> == Fl::modal_) { <span class="comment">// we are closing the modal window, find next one:</span>
<a name="l01240"></a>01240     <a class="code" href="classFl__Window.html">Fl_Window</a>* W;
<a name="l01241"></a>01241     <span class="keywordflow">for</span> (W = <a class="code" href="group__fl__windows.html#ga3130407bc1c11f9b7f2a9c43a87a1599">Fl::first_window</a>(); W; W = <a class="code" href="group__fl__windows.html#ga46df67455d96ee45e51f59263c6bf0ea">Fl::next_window</a>(W))
<a name="l01242"></a>01242       <span class="keywordflow">if</span> (W-&gt;<a class="code" href="classFl__Window.html#a6cc843ffcc711300613e44c678ad682f">modal</a>()) <span class="keywordflow">break</span>;
<a name="l01243"></a>01243     Fl::modal_ = W;
<a name="l01244"></a>01244   }
<a name="l01245"></a>01245 
<a name="l01246"></a>01246   <span class="comment">// Make sure no events are sent to this window:</span>
<a name="l01247"></a>01247   <a class="code" href="Fl_8cxx.html#a99123165069583d3efd9dcd5988aa561">fl_throw_focus</a>(<span class="keyword">this</span>);
<a name="l01248"></a>01248   <a class="code" href="classFl__Window.html#a9c0eb1c55a1a62ef3d3d87676f936187">handle</a>(<a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3aed9d7c8fbb9dac1e16f762195f00d5d6">FL_HIDE</a>);
<a name="l01249"></a>01249 
<a name="l01250"></a>01250 <span class="preprocessor">#if defined(WIN32)</span>
<a name="l01251"></a>01251 <span class="preprocessor"></span>  <span class="comment">// this little trick keeps the current clipboard alive, even if we are about</span>
<a name="l01252"></a>01252   <span class="comment">// to destroy the window that owns the selection.</span>
<a name="l01253"></a>01253   <span class="keywordflow">if</span> (GetClipboardOwner()==ip-&gt;<a class="code" href="classFl__X.html#a8885c9eeb5a7a9684ad147177bf9931a">xid</a>) {
<a name="l01254"></a>01254     <a class="code" href="classFl__Window.html">Fl_Window</a> *w1 = <a class="code" href="group__fl__windows.html#ga3130407bc1c11f9b7f2a9c43a87a1599">Fl::first_window</a>();
<a name="l01255"></a>01255     <span class="keywordflow">if</span> (w1 &amp;&amp; OpenClipboard(<a class="code" href="mac_8H.html#a87152d2ed84f9d97c6bf3150c7688261">fl_xid</a>(w1))) {
<a name="l01256"></a>01256       EmptyClipboard();
<a name="l01257"></a>01257       SetClipboardData(CF_TEXT, <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01258"></a>01258       CloseClipboard();
<a name="l01259"></a>01259     }
<a name="l01260"></a>01260   }
<a name="l01261"></a>01261   <span class="comment">// Send a message to myself so that I&#39;ll get out of the event loop...</span>
<a name="l01262"></a>01262   PostMessage(ip-&gt;<a class="code" href="classFl__X.html#a8885c9eeb5a7a9684ad147177bf9931a">xid</a>, WM_APP, 0, 0);
<a name="l01263"></a>01263   <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="classFl__X.html#af4760c7a727017843f72d272498d640d">private_dc</a>) <a class="code" href="win32_8H.html#a178a72db0c8af24e0f10eb126976246b">fl_release_dc</a>(ip-&gt;<a class="code" href="classFl__X.html#a8885c9eeb5a7a9684ad147177bf9931a">xid</a>, ip-&gt;<a class="code" href="classFl__X.html#af4760c7a727017843f72d272498d640d">private_dc</a>);
<a name="l01264"></a>01264     <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="classFl__X.html#a8885c9eeb5a7a9684ad147177bf9931a">xid</a> == <a class="code" href="win32_8H.html#afdab6664143864c36ba6b51782b32500">fl_window</a> &amp;&amp; <a class="code" href="mac_8H.html#a9b2af459c0a223b6274f508339c783a6">fl_gc</a>) {
<a name="l01265"></a>01265       <a class="code" href="win32_8H.html#a178a72db0c8af24e0f10eb126976246b">fl_release_dc</a>(<a class="code" href="win32_8H.html#afdab6664143864c36ba6b51782b32500">fl_window</a>, <a class="code" href="mac_8H.html#a9b2af459c0a223b6274f508339c783a6">fl_gc</a>);
<a name="l01266"></a>01266       <a class="code" href="win32_8H.html#afdab6664143864c36ba6b51782b32500">fl_window</a> = (HWND)-1;
<a name="l01267"></a>01267       <a class="code" href="mac_8H.html#a9b2af459c0a223b6274f508339c783a6">fl_gc</a> = 0;
<a name="l01268"></a>01268 <span class="preprocessor"># ifdef FLTK_USE_CAIRO</span>
<a name="l01269"></a>01269 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (Fl::cairo_autolink_context()) Fl::cairo_make_current((<a class="code" href="classFl__Window.html">Fl_Window</a>*) 0);
<a name="l01270"></a>01270 <span class="preprocessor"># endif</span>
<a name="l01271"></a>01271 <span class="preprocessor"></span>    }
<a name="l01272"></a>01272 <span class="preprocessor">#elif defined(__APPLE_QUARTZ__)</span>
<a name="l01273"></a>01273 <span class="preprocessor"></span>  Fl_X::q_release_context(ip);
<a name="l01274"></a>01274   <span class="keywordflow">if</span> ( ip-&gt;<a class="code" href="classFl__X.html#a8885c9eeb5a7a9684ad147177bf9931a">xid</a> == <a class="code" href="win32_8H.html#afdab6664143864c36ba6b51782b32500">fl_window</a> &amp;&amp; !<a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>() )
<a name="l01275"></a>01275     <a class="code" href="win32_8H.html#afdab6664143864c36ba6b51782b32500">fl_window</a> = 0;
<a name="l01276"></a>01276 <span class="preprocessor">#endif</span>
<a name="l01277"></a>01277 <span class="preprocessor"></span>
<a name="l01278"></a>01278   <span class="keywordflow">if</span> (ip-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>) <a class="code" href="win32_8H.html#aa9ab8e4893ef97f9bf92e66e2c51778b">XDestroyRegion</a>(ip-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>);
<a name="l01279"></a>01279 
<a name="l01280"></a>01280 <span class="preprocessor">#if defined(USE_X11)</span>
<a name="l01281"></a>01281 <span class="preprocessor"></span><span class="preprocessor"># if USE_XFT</span>
<a name="l01282"></a>01282 <span class="preprocessor"></span>  <a class="code" href="fl__font__xft_8cxx.html#a33937259c5c716e149797643e77db7df">fl_destroy_xft_draw</a>(ip-&gt;<a class="code" href="classFl__X.html#a8885c9eeb5a7a9684ad147177bf9931a">xid</a>);
<a name="l01283"></a>01283 <span class="preprocessor"># endif</span>
<a name="l01284"></a>01284 <span class="preprocessor"></span>  <a class="code" href="win32_8H.html#a039851f5086dae082ec8671cc2805449">XDestroyWindow</a>(<a class="code" href="win32_8H.html#a6c6726f30a7b613184e2b315e167ddb2" title="END TIMERS //////////////////////////////////////////////////////////////////////////.">fl_display</a>, ip-&gt;<a class="code" href="classFl__X.html#a8885c9eeb5a7a9684ad147177bf9931a">xid</a>);
<a name="l01285"></a>01285 <span class="preprocessor">#elif defined(WIN32)</span>
<a name="l01286"></a>01286 <span class="preprocessor"></span>  <span class="comment">// this little trickery seems to avoid the popup window stacking problem</span>
<a name="l01287"></a>01287   HWND p = GetForegroundWindow();
<a name="l01288"></a>01288   <span class="keywordflow">if</span> (p==GetParent(ip-&gt;<a class="code" href="classFl__X.html#a8885c9eeb5a7a9684ad147177bf9931a">xid</a>)) {
<a name="l01289"></a>01289     ShowWindow(ip-&gt;<a class="code" href="classFl__X.html#a8885c9eeb5a7a9684ad147177bf9931a">xid</a>, SW_HIDE);
<a name="l01290"></a>01290     ShowWindow(p, SW_SHOWNA);
<a name="l01291"></a>01291   }
<a name="l01292"></a>01292   <a class="code" href="win32_8H.html#a039851f5086dae082ec8671cc2805449">XDestroyWindow</a>(<a class="code" href="win32_8H.html#a6c6726f30a7b613184e2b315e167ddb2" title="END TIMERS //////////////////////////////////////////////////////////////////////////.">fl_display</a>, ip-&gt;<a class="code" href="classFl__X.html#a8885c9eeb5a7a9684ad147177bf9931a">xid</a>);
<a name="l01293"></a>01293 <span class="preprocessor">#elif defined(__APPLE_QUARTZ__)</span>
<a name="l01294"></a>01294 <span class="preprocessor"></span>  ip-&gt;destroy();
<a name="l01295"></a>01295 <span class="preprocessor">#else</span>
<a name="l01296"></a>01296 <span class="preprocessor"></span><span class="preprocessor"># error unsupported platform</span>
<a name="l01297"></a>01297 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01298"></a>01298 <span class="preprocessor"></span>  
<a name="l01299"></a>01299 <span class="preprocessor">#ifdef WIN32</span>
<a name="l01300"></a>01300 <span class="preprocessor"></span>  <span class="comment">// Try to stop the annoying &quot;raise another program&quot; behavior</span>
<a name="l01301"></a>01301   <span class="keywordflow">if</span> (<a class="code" href="classFl__Window.html#a663df072d1d68c5733a1c5f2f88fd819">non_modal</a>() &amp;&amp; <a class="code" href="group__fl__windows.html#ga3130407bc1c11f9b7f2a9c43a87a1599">Fl::first_window</a>() &amp;&amp; <a class="code" href="group__fl__windows.html#ga3130407bc1c11f9b7f2a9c43a87a1599">Fl::first_window</a>()-&gt;<a class="code" href="classFl__Window.html#aa09300542b2d8b49fc69a037bdd3b742">shown</a>())
<a name="l01302"></a>01302     <a class="code" href="group__fl__windows.html#ga3130407bc1c11f9b7f2a9c43a87a1599">Fl::first_window</a>()-&gt;<a class="code" href="classFl__Window.html#afc4d3796226dfd4620b4d7cf29c287c9">show</a>();
<a name="l01303"></a>01303 <span class="preprocessor">#endif</span>
<a name="l01304"></a>01304 <span class="preprocessor"></span>  <span class="keyword">delete</span> ip;
<a name="l01305"></a>01305 }
<a name="l01306"></a>01306 
<a name="l01307"></a><a class="code" href="classFl__Window.html#a75b94c3386351a44a0ef97b8e435eecb">01307</a> <a class="code" href="classFl__Window.html#a75b94c3386351a44a0ef97b8e435eecb">Fl_Window::~Fl_Window</a>() {
<a name="l01308"></a>01308   <a class="code" href="classFl__Window.html#acd69a335bdc69f5624301f267ca7f94e">hide</a>();
<a name="l01309"></a>01309   <span class="keywordflow">if</span> (xclass_) {
<a name="l01310"></a>01310     free(xclass_);
<a name="l01311"></a>01311   }
<a name="l01312"></a>01312 }
<a name="l01313"></a>01313 
<a name="l01314"></a>01314 <span class="comment">// FL_SHOW and FL_HIDE are called whenever the visibility of this widget</span>
<a name="l01315"></a>01315 <span class="comment">// or any parent changes.  We must correctly map/unmap the system&#39;s window.</span>
<a name="l01316"></a>01316 
<a name="l01317"></a>01317 <span class="comment">// For top-level windows it is assumed the window has already been</span>
<a name="l01318"></a>01318 <span class="comment">// mapped or unmapped!!!  This is because this should only happen when</span>
<a name="l01319"></a>01319 <span class="comment">// Fl_Window::show() or Fl_Window::hide() is called, or in response to</span>
<a name="l01320"></a>01320 <span class="comment">// iconize/deiconize events from the system.</span>
<a name="l01321"></a>01321 
<a name="l01322"></a><a class="code" href="classFl__Window.html#a9c0eb1c55a1a62ef3d3d87676f936187">01322</a> <span class="keywordtype">int</span> <a class="code" href="classFl__Window.html#a9c0eb1c55a1a62ef3d3d87676f936187">Fl_Window::handle</a>(<span class="keywordtype">int</span> ev)
<a name="l01323"></a>01323 {
<a name="l01324"></a>01324   <span class="keywordflow">if</span> (<a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>()) {
<a name="l01325"></a>01325     <span class="keywordflow">switch</span> (ev) {
<a name="l01326"></a>01326     <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3a9edbfd236c9ea348dcaae935a76bd885">FL_SHOW</a>:
<a name="l01327"></a>01327       <span class="keywordflow">if</span> (!<a class="code" href="classFl__Window.html#aa09300542b2d8b49fc69a037bdd3b742">shown</a>()) <a class="code" href="classFl__Window.html#afc4d3796226dfd4620b4d7cf29c287c9">show</a>();
<a name="l01328"></a>01328       <span class="keywordflow">else</span> {
<a name="l01329"></a>01329 <span class="preprocessor">#if defined(USE_X11) || defined(WIN32)</span>
<a name="l01330"></a>01330 <span class="preprocessor"></span>        <a class="code" href="win32_8H.html#aa036a6169aa9a2c19190c4bff3ffc444">XMapWindow</a>(<a class="code" href="win32_8H.html#a6c6726f30a7b613184e2b315e167ddb2" title="END TIMERS //////////////////////////////////////////////////////////////////////////.">fl_display</a>, <a class="code" href="mac_8H.html#a87152d2ed84f9d97c6bf3150c7688261">fl_xid</a>(<span class="keyword">this</span>)); <span class="comment">// extra map calls are harmless</span>
<a name="l01331"></a>01331 <span class="preprocessor">#elif defined(__APPLE_QUARTZ__)</span>
<a name="l01332"></a>01332 <span class="preprocessor"></span>        i-&gt;map();
<a name="l01333"></a>01333 <span class="preprocessor">#else</span>
<a name="l01334"></a>01334 <span class="preprocessor"></span><span class="preprocessor"># error unsupported platform</span>
<a name="l01335"></a>01335 <span class="preprocessor"></span><span class="preprocessor">#endif // __APPLE__</span>
<a name="l01336"></a>01336 <span class="preprocessor"></span>      }
<a name="l01337"></a>01337       <span class="keywordflow">break</span>;
<a name="l01338"></a>01338     <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad16daf120d9a0501cccaee563af0b9a3aed9d7c8fbb9dac1e16f762195f00d5d6">FL_HIDE</a>:
<a name="l01339"></a>01339       <span class="keywordflow">if</span> (<a class="code" href="classFl__Window.html#aa09300542b2d8b49fc69a037bdd3b742">shown</a>()) {
<a name="l01340"></a>01340         <span class="comment">// Find what really turned invisible, if is was a parent window</span>
<a name="l01341"></a>01341         <span class="comment">// we do nothing.  We need to avoid unnecessary unmap calls</span>
<a name="l01342"></a>01342         <span class="comment">// because they cause the display to blink when the parent is</span>
<a name="l01343"></a>01343         <span class="comment">// remapped.  However if this or any intermediate non-window</span>
<a name="l01344"></a>01344         <span class="comment">// widget has really had hide() called directly on it, we must</span>
<a name="l01345"></a>01345         <span class="comment">// unmap because when the parent window is remapped we don&#39;t</span>
<a name="l01346"></a>01346         <span class="comment">// want to reappear.</span>
<a name="l01347"></a>01347         <span class="keywordflow">if</span> (<a class="code" href="classFl__Widget.html#ac0b2f353f8d142156ffb27b76a2e9628">visible</a>()) {
<a name="l01348"></a>01348          <a class="code" href="classFl__Widget.html">Fl_Widget</a>* p = <a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>(); <span class="keywordflow">for</span> (;p-&gt;<a class="code" href="classFl__Widget.html#ac0b2f353f8d142156ffb27b76a2e9628">visible</a>();p = p-&gt;<a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>()) {}
<a name="l01349"></a>01349          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="classFl__Widget.html#ac3050e16d7ed8dccbbf3468ea8c64ab8">type</a>() &gt;= <a class="code" href="Fl__Window_8H.html#ade2152acce2e38a691be590e8ed68a3c" title="window type id all subclasses have type() &amp;gt;= this">FL_WINDOW</a>) <span class="keywordflow">break</span>; <span class="comment">// don&#39;t do the unmap</span>
<a name="l01350"></a>01350         }
<a name="l01351"></a>01351 <span class="preprocessor">#if defined(USE_X11) || defined(WIN32)</span>
<a name="l01352"></a>01352 <span class="preprocessor"></span>        <a class="code" href="win32_8H.html#ab8f20a9b1d1041cd8064d88ec2f0c660">XUnmapWindow</a>(<a class="code" href="win32_8H.html#a6c6726f30a7b613184e2b315e167ddb2" title="END TIMERS //////////////////////////////////////////////////////////////////////////.">fl_display</a>, <a class="code" href="mac_8H.html#a87152d2ed84f9d97c6bf3150c7688261">fl_xid</a>(<span class="keyword">this</span>));
<a name="l01353"></a>01353 <span class="preprocessor">#elif defined(__APPLE_QUARTZ__)</span>
<a name="l01354"></a>01354 <span class="preprocessor"></span>        i-&gt;unmap();
<a name="l01355"></a>01355 <span class="preprocessor">#else</span>
<a name="l01356"></a>01356 <span class="preprocessor"></span><span class="preprocessor"># error platform unsupported</span>
<a name="l01357"></a>01357 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01358"></a>01358 <span class="preprocessor"></span>      }
<a name="l01359"></a>01359       <span class="keywordflow">break</span>;
<a name="l01360"></a>01360     }
<a name="l01361"></a>01361 <span class="comment">//  } else if (ev == FL_FOCUS || ev == FL_UNFOCUS) {</span>
<a name="l01362"></a>01362 <span class="comment">//    Fl_Tooltip::exit(Fl_Tooltip::current());</span>
<a name="l01363"></a>01363   }
<a name="l01364"></a>01364 
<a name="l01365"></a>01365   <span class="keywordflow">return</span> <a class="code" href="classFl__Window.html#a9c0eb1c55a1a62ef3d3d87676f936187">Fl_Group::handle</a>(ev);
<a name="l01366"></a>01366 }
<a name="l01367"></a>01367 
<a name="l01369"></a>01369 <span class="comment">// Back compatibility cut &amp; paste functions for fltk 1.1 only:</span>
<a name="l01370"></a>01370 
<a name="l01383"></a><a class="code" href="group__fl__clipboard.html#gaec21e41f0909a27c9906e1a12aee319b">01383</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__clipboard.html#gab237801bd5deece817c5001e9a72fdef">Fl::selection_owner</a>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *owner) {<a class="code" href="classFl.html#a92c4cbba96971c359c569a11ea17cc5a">selection_owner_</a> = owner;}
<a name="l01384"></a>01384 
<a name="l01392"></a><a class="code" href="group__fl__clipboard.html#gac2993c9b0292c636357b1268fb63e827">01392</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__clipboard.html#gac2993c9b0292c636357b1268fb63e827">Fl::selection</a>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> &amp;owner, <span class="keyword">const</span> <span class="keywordtype">char</span>* text, <span class="keywordtype">int</span> len) {
<a name="l01393"></a>01393   <a class="code" href="classFl.html#a92c4cbba96971c359c569a11ea17cc5a">selection_owner_</a> = &amp;owner;
<a name="l01394"></a>01394   <a class="code" href="group__fl__clipboard.html#gaa219ad0a09d4ff6f7d8feddcc7e96b90">Fl::copy</a>(text, len, 0);
<a name="l01395"></a>01395 }
<a name="l01396"></a>01396 
<a name="l01400"></a><a class="code" href="group__fl__clipboard.html#ga9d5cf78a03d0d619052dea890d97c71e">01400</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__clipboard.html#ga2d0fc8fedc6bfc23f378b3f100660d80">Fl::paste</a>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> &amp;receiver) {
<a name="l01401"></a>01401   <a class="code" href="group__fl__clipboard.html#ga2d0fc8fedc6bfc23f378b3f100660d80">Fl::paste</a>(receiver, 0);
<a name="l01402"></a>01402 }
<a name="l01403"></a>01403 
<a name="l01405"></a>01405 
<a name="l01406"></a>01406 <span class="preprocessor">#include &lt;FL/fl_draw.H&gt;</span>
<a name="l01407"></a>01407 
<a name="l01408"></a><a class="code" href="classFl__Widget.html#aa63ce68cbf4620cf8750b868368ea02b">01408</a> <span class="keywordtype">void</span> <a class="code" href="classFl__Widget.html#aa63ce68cbf4620cf8750b868368ea02b">Fl_Widget::redraw</a>() {
<a name="l01409"></a>01409   <a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146dae2ea13879a0e90540108be65c5bc8e4b">FL_DAMAGE_ALL</a>);
<a name="l01410"></a>01410 }
<a name="l01411"></a>01411 
<a name="l01412"></a><a class="code" href="classFl__Widget.html#a22b6faff91b6056e55ba4270723734b7">01412</a> <span class="keywordtype">void</span> <a class="code" href="classFl__Widget.html#a22b6faff91b6056e55ba4270723734b7">Fl_Widget::redraw_label</a>() {
<a name="l01413"></a>01413   <span class="keywordflow">if</span> (<a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()) {
<a name="l01414"></a>01414     <span class="keywordflow">if</span> (<a class="code" href="classFl__Widget.html#a991d448d9a42fb926819defc9de90999">box</a>() == <a class="code" href="Enumerations_8H.html#ae48bf9070f8541de17829f54ccacc6bca48e3b4ff6e390359376e79a8a6bc05c1" title="nothing is drawn at all, this box is invisible">FL_NO_BOX</a>) {
<a name="l01415"></a>01415       <span class="comment">// Widgets with the FL_NO_BOX boxtype need a parent to</span>
<a name="l01416"></a>01416       <span class="comment">// redraw, since it is responsible for redrawing the</span>
<a name="l01417"></a>01417       <span class="comment">// background...</span>
<a name="l01418"></a>01418       <span class="keywordtype">int</span> X = <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>() &gt; 0 ? <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>() - 1 : 0;
<a name="l01419"></a>01419       <span class="keywordtype">int</span> Y = <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>() &gt; 0 ? <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>() - 1 : 0;
<a name="l01420"></a>01420       <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146dae2ea13879a0e90540108be65c5bc8e4b">FL_DAMAGE_ALL</a>, X, Y, <a class="code" href="classFl__Widget.html#aec9e0a6f77d93e6f8caffc1b0f6abbda">w</a>() + 2, <a class="code" href="classFl__Widget.html#a994f71abd8b39c87cef909713d3347f0">h</a>() + 2);
<a name="l01421"></a>01421     }
<a name="l01422"></a>01422 
<a name="l01423"></a>01423     <span class="keywordflow">if</span> (<a class="code" href="classFl__Widget.html#aad980d813b8a47d777bde7cfa6b85eae">align</a>() &amp;&amp; !(<a class="code" href="classFl__Widget.html#aad980d813b8a47d777bde7cfa6b85eae">align</a>() &amp; <a class="code" href="Enumerations_8H.html#ade440c90fc9c2495fdf04c9cb34fba34">FL_ALIGN_INSIDE</a>) &amp;&amp; <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;shown()) {
<a name="l01424"></a>01424       <span class="comment">// If the label is not inside the widget, compute the location of</span>
<a name="l01425"></a>01425       <span class="comment">// the label and redraw the window within that bounding box...</span>
<a name="l01426"></a>01426       <span class="keywordtype">int</span> W = 0, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a> = 0;
<a name="l01427"></a>01427       label_.<a class="code" href="structFl__Label.html#a8b1c6199bffef222db7f82f44f710052">measure</a>(W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>);
<a name="l01428"></a>01428       W += 5; <span class="comment">// Add a little to the size of the label to cover overflow</span>
<a name="l01429"></a>01429       <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a> += 5;
<a name="l01430"></a>01430 
<a name="l01431"></a>01431       <span class="comment">// FIXME:</span>
<a name="l01432"></a>01432       <span class="comment">// This assumes the measure() returns the correct outline, which it does </span>
<a name="l01433"></a>01433       <span class="comment">// not in all possible cases of alignment combinedwith image and symbols.</span>
<a name="l01434"></a>01434       <span class="keywordflow">switch</span> (<a class="code" href="classFl__Widget.html#aad980d813b8a47d777bde7cfa6b85eae">align</a>() &amp; 0x0f) {
<a name="l01435"></a>01435         <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#aa8fc090c53e2f726bd4817189313a0da">FL_ALIGN_TOP_LEFT</a>:
<a name="l01436"></a>01436           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146da1d579fbc483892ba72a416d3ff14a942">FL_DAMAGE_EXPOSE</a>, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>(), <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>()-<a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>, W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>); <span class="keywordflow">break</span>;
<a name="l01437"></a>01437         <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#a62b22e4022b39d90a2d3962ae144f2e8">FL_ALIGN_TOP</a>:
<a name="l01438"></a>01438           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146da1d579fbc483892ba72a416d3ff14a942">FL_DAMAGE_EXPOSE</a>, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>()+(<a class="code" href="classFl__Widget.html#aec9e0a6f77d93e6f8caffc1b0f6abbda">w</a>()-W)/2, <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>()-<a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>, W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>); <span class="keywordflow">break</span>;
<a name="l01439"></a>01439         <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#a2994f88481b359b5bbcce9de598150fd">FL_ALIGN_TOP_RIGHT</a>:
<a name="l01440"></a>01440           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146da1d579fbc483892ba72a416d3ff14a942">FL_DAMAGE_EXPOSE</a>, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>()+<a class="code" href="classFl__Widget.html#aec9e0a6f77d93e6f8caffc1b0f6abbda">w</a>()-W, <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>()-<a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>, W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>); <span class="keywordflow">break</span>;
<a name="l01441"></a>01441         <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad4b4d82940cf211c16057ab7424a1f15">FL_ALIGN_LEFT_TOP</a>:
<a name="l01442"></a>01442           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146da1d579fbc483892ba72a416d3ff14a942">FL_DAMAGE_EXPOSE</a>, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>()-W, <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>(), W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>); <span class="keywordflow">break</span>;
<a name="l01443"></a>01443         <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#aab3b54d51a61ad3964e483c838bb78fc">FL_ALIGN_RIGHT_TOP</a>:
<a name="l01444"></a>01444           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146da1d579fbc483892ba72a416d3ff14a942">FL_DAMAGE_EXPOSE</a>, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>()+<a class="code" href="classFl__Widget.html#aec9e0a6f77d93e6f8caffc1b0f6abbda">w</a>(), <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>(), W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>); <span class="keywordflow">break</span>;
<a name="l01445"></a>01445         <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#aee67f09771b16bc5da1f1ee860681be5">FL_ALIGN_LEFT</a>:
<a name="l01446"></a>01446           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146da1d579fbc483892ba72a416d3ff14a942">FL_DAMAGE_EXPOSE</a>, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>()-W, <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>()+(<a class="code" href="classFl__Widget.html#a994f71abd8b39c87cef909713d3347f0">h</a>()-<a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>)/2, W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>); <span class="keywordflow">break</span>;
<a name="l01447"></a>01447         <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#a16646615fa4863fae6f7975b36c3987e">FL_ALIGN_RIGHT</a>:
<a name="l01448"></a>01448           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146da1d579fbc483892ba72a416d3ff14a942">FL_DAMAGE_EXPOSE</a>, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>()+<a class="code" href="classFl__Widget.html#aec9e0a6f77d93e6f8caffc1b0f6abbda">w</a>(), <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>()+(<a class="code" href="classFl__Widget.html#a994f71abd8b39c87cef909713d3347f0">h</a>()-<a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>)/2, W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>); <span class="keywordflow">break</span>;
<a name="l01449"></a>01449         <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#a1ec807dbbb67f9967f6c28170e1d76d8">FL_ALIGN_LEFT_BOTTOM</a>:
<a name="l01450"></a>01450           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146da1d579fbc483892ba72a416d3ff14a942">FL_DAMAGE_EXPOSE</a>, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>()-W, <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>()+<a class="code" href="classFl__Widget.html#a994f71abd8b39c87cef909713d3347f0">h</a>()-<a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>, W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>); <span class="keywordflow">break</span>;
<a name="l01451"></a>01451         <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#a2da73b94e785bf9b0306ea5156f8fd04">FL_ALIGN_RIGHT_BOTTOM</a>:
<a name="l01452"></a>01452           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146da1d579fbc483892ba72a416d3ff14a942">FL_DAMAGE_EXPOSE</a>, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>()+<a class="code" href="classFl__Widget.html#aec9e0a6f77d93e6f8caffc1b0f6abbda">w</a>(), <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>()+<a class="code" href="classFl__Widget.html#a994f71abd8b39c87cef909713d3347f0">h</a>()-<a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>, W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>); <span class="keywordflow">break</span>;
<a name="l01453"></a>01453         <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ac99f378b578558c16fa41c7023b53d55">FL_ALIGN_BOTTOM_LEFT</a>:
<a name="l01454"></a>01454           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146da1d579fbc483892ba72a416d3ff14a942">FL_DAMAGE_EXPOSE</a>, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>(), <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>()+<a class="code" href="classFl__Widget.html#a994f71abd8b39c87cef909713d3347f0">h</a>(), W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>); <span class="keywordflow">break</span>;
<a name="l01455"></a>01455         <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#a1ea3fa817f07b80dced581f58de842ae">FL_ALIGN_BOTTOM</a>:
<a name="l01456"></a>01456           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146da1d579fbc483892ba72a416d3ff14a942">FL_DAMAGE_EXPOSE</a>, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>()+(<a class="code" href="classFl__Widget.html#aec9e0a6f77d93e6f8caffc1b0f6abbda">w</a>()-W)/2, <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>()+<a class="code" href="classFl__Widget.html#a994f71abd8b39c87cef909713d3347f0">h</a>(), W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>); <span class="keywordflow">break</span>;
<a name="l01457"></a>01457         <span class="keywordflow">case</span> <a class="code" href="Enumerations_8H.html#ad5c91c4f8b87d48ba1a1120d726bca87">FL_ALIGN_BOTTOM_RIGHT</a>:
<a name="l01458"></a>01458           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146da1d579fbc483892ba72a416d3ff14a942">FL_DAMAGE_EXPOSE</a>, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>()+<a class="code" href="classFl__Widget.html#aec9e0a6f77d93e6f8caffc1b0f6abbda">w</a>()-W, <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>()+<a class="code" href="classFl__Widget.html#a994f71abd8b39c87cef909713d3347f0">h</a>(), W, <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>); <span class="keywordflow">break</span>;
<a name="l01459"></a>01459         <span class="keywordflow">default</span>:
<a name="l01460"></a>01460           <a class="code" href="classFl__Widget.html#af8834d376878616c66a094cad6fec9d2">window</a>()-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146dae2ea13879a0e90540108be65c5bc8e4b">FL_DAMAGE_ALL</a>); <span class="keywordflow">break</span>;
<a name="l01461"></a>01461       }
<a name="l01462"></a>01462     } <span class="keywordflow">else</span> {
<a name="l01463"></a>01463       <span class="comment">// The label is inside the widget, so just redraw the widget itself...</span>
<a name="l01464"></a>01464       <a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146dae2ea13879a0e90540108be65c5bc8e4b">FL_DAMAGE_ALL</a>);
<a name="l01465"></a>01465     }
<a name="l01466"></a>01466   }
<a name="l01467"></a>01467 }
<a name="l01468"></a>01468 
<a name="l01469"></a><a class="code" href="classFl__Widget.html#ace94ae2916d23e563bf30fb5bdab9aad">01469</a> <span class="keywordtype">void</span> <a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">Fl_Widget::damage</a>(<a class="code" href="fl__types_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> fl) {
<a name="l01470"></a>01470   <span class="keywordflow">if</span> (<a class="code" href="classFl__Widget.html#ac3050e16d7ed8dccbbf3468ea8c64ab8">type</a>() &lt; <a class="code" href="Fl__Window_8H.html#ade2152acce2e38a691be590e8ed68a3c" title="window type id all subclasses have type() &amp;gt;= this">FL_WINDOW</a>) {
<a name="l01471"></a>01471     <span class="comment">// damage only the rectangle covered by a child widget:</span>
<a name="l01472"></a>01472     <a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(fl, <a class="code" href="classFl__Widget.html#ad09bc10de43482a671f834a653211e9f">x</a>(), <a class="code" href="classFl__Widget.html#a54fbdc7be9ae81c6b34abc73a93908f1">y</a>(), <a class="code" href="classFl__Widget.html#aec9e0a6f77d93e6f8caffc1b0f6abbda">w</a>(), <a class="code" href="classFl__Widget.html#a994f71abd8b39c87cef909713d3347f0">h</a>());
<a name="l01473"></a>01473   } <span class="keywordflow">else</span> {
<a name="l01474"></a>01474     <span class="comment">// damage entire window by deleting the region:</span>
<a name="l01475"></a>01475     <a class="code" href="classFl__X.html">Fl_X</a>* <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">Fl_X::i</a>((<a class="code" href="classFl__Window.html">Fl_Window</a>*)<span class="keyword">this</span>);
<a name="l01476"></a>01476     <span class="keywordflow">if</span> (!i) <span class="keywordflow">return</span>; <span class="comment">// window not mapped, so ignore it</span>
<a name="l01477"></a>01477     <span class="keywordflow">if</span> (i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>) {<a class="code" href="win32_8H.html#aa9ab8e4893ef97f9bf92e66e2c51778b">XDestroyRegion</a>(i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>); i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a> = 0;}
<a name="l01478"></a>01478     damage_ |= fl;
<a name="l01479"></a>01479     <a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">Fl::damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146dad0cb406be09a7f40cbeadc398f63ce1e">FL_DAMAGE_CHILD</a>);
<a name="l01480"></a>01480   }
<a name="l01481"></a>01481 }
<a name="l01482"></a>01482 
<a name="l01483"></a><a class="code" href="classFl__Widget.html#ac92191cba5d17ae34bfc346d2126c9f2">01483</a> <span class="keywordtype">void</span> <a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">Fl_Widget::damage</a>(<a class="code" href="fl__types_8h.html#a65f85814a8290f9797005d3b28e7e5fc">uchar</a> fl, <span class="keywordtype">int</span> X, <span class="keywordtype">int</span> Y, <span class="keywordtype">int</span> W, <span class="keywordtype">int</span> <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>) {
<a name="l01484"></a>01484   <a class="code" href="classFl__Widget.html">Fl_Widget</a>* wi = <span class="keyword">this</span>;
<a name="l01485"></a>01485   <span class="comment">// mark all parent widgets between this and window with FL_DAMAGE_CHILD:</span>
<a name="l01486"></a>01486   <span class="keywordflow">while</span> (wi-&gt;<a class="code" href="classFl__Widget.html#ac3050e16d7ed8dccbbf3468ea8c64ab8">type</a>() &lt; <a class="code" href="Fl__Window_8H.html#ade2152acce2e38a691be590e8ed68a3c" title="window type id all subclasses have type() &amp;gt;= this">FL_WINDOW</a>) {
<a name="l01487"></a>01487     wi-&gt;damage_ |= fl;
<a name="l01488"></a>01488     wi = wi-&gt;<a class="code" href="classFl__Widget.html#a77af13bd8284ed43dc8c402a7224bd99">parent</a>();
<a name="l01489"></a>01489     <span class="keywordflow">if</span> (!wi) <span class="keywordflow">return</span>;
<a name="l01490"></a>01490     fl = <a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146dad0cb406be09a7f40cbeadc398f63ce1e">FL_DAMAGE_CHILD</a>;
<a name="l01491"></a>01491   }
<a name="l01492"></a>01492   <a class="code" href="classFl__X.html">Fl_X</a>* <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">Fl_X::i</a>((<a class="code" href="classFl__Window.html">Fl_Window</a>*)wi);
<a name="l01493"></a>01493   <span class="keywordflow">if</span> (!i) <span class="keywordflow">return</span>; <span class="comment">// window not mapped, so ignore it</span>
<a name="l01494"></a>01494 
<a name="l01495"></a>01495   <span class="comment">// clip the damage to the window and quit if none:</span>
<a name="l01496"></a>01496   <span class="keywordflow">if</span> (X &lt; 0) {W += X; X = 0;}
<a name="l01497"></a>01497   <span class="keywordflow">if</span> (Y &lt; 0) {H += Y; Y = 0;}
<a name="l01498"></a>01498   <span class="keywordflow">if</span> (W &gt; wi-&gt;<a class="code" href="classFl__Widget.html#ad59ece778aaf15acc4dd01a8bf5f8012">w</a>()-X) W = wi-&gt;<a class="code" href="classFl__Widget.html#ad59ece778aaf15acc4dd01a8bf5f8012">w</a>()-X;
<a name="l01499"></a>01499   <span class="keywordflow">if</span> (H &gt; wi-&gt;<a class="code" href="classFl__Widget.html#aeeabd61e2d10c76cd6600dbbfe951f71">h</a>()-Y) H = wi-&gt;<a class="code" href="classFl__Widget.html#aeeabd61e2d10c76cd6600dbbfe951f71">h</a>()-Y;
<a name="l01500"></a>01500   <span class="keywordflow">if</span> (W &lt;= 0 || H &lt;= 0) <span class="keywordflow">return</span>;
<a name="l01501"></a>01501 
<a name="l01502"></a>01502   <span class="keywordflow">if</span> (!X &amp;&amp; !Y &amp;&amp; W==wi-&gt;<a class="code" href="classFl__Widget.html#ad59ece778aaf15acc4dd01a8bf5f8012">w</a>() &amp;&amp; H==wi-&gt;<a class="code" href="classFl__Widget.html#aeeabd61e2d10c76cd6600dbbfe951f71">h</a>()) {
<a name="l01503"></a>01503     <span class="comment">// if damage covers entire window delete region:</span>
<a name="l01504"></a>01504     wi-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>(fl);
<a name="l01505"></a>01505     <span class="keywordflow">return</span>;
<a name="l01506"></a>01506   }
<a name="l01507"></a>01507 
<a name="l01508"></a>01508   <span class="keywordflow">if</span> (wi-&gt;<a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">damage</a>()) {
<a name="l01509"></a>01509     <span class="comment">// if we already have damage we must merge with existing region:</span>
<a name="l01510"></a>01510     <span class="keywordflow">if</span> (i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>) {
<a name="l01511"></a>01511 <span class="preprocessor">#if defined(USE_X11)</span>
<a name="l01512"></a>01512 <span class="preprocessor"></span>      <a class="code" href="structXRectangle.html">XRectangle</a> R;
<a name="l01513"></a>01513       R.<a class="code" href="structXRectangle.html#ad8e3fc4eef045bff66cfa7414bf9d961">x</a> = X; R.<a class="code" href="structXRectangle.html#a868d20ae8a5b46cc03e1128b0467b1f3">y</a> = Y; R.<a class="code" href="structXRectangle.html#a9221b0fe551ac4d4a3324b62f3f5e2e1">width</a> = W; R.<a class="code" href="structXRectangle.html#a3ad204f8adec7b624292499ca5cdadb5">height</a> = <a class="code" href="Fl__Tooltip_8cxx.html#affa487e8e3cc48473cfc05c0ce0165e9">H</a>;
<a name="l01514"></a>01514       XUnionRectWithRegion(&amp;R, i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>, i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>);
<a name="l01515"></a>01515 <span class="preprocessor">#elif defined(WIN32)</span>
<a name="l01516"></a>01516 <span class="preprocessor"></span>      <a class="code" href="mac_8H.html#aa3f54ef9dd28ee61ae42bd36291a31f2">Fl_Region</a> R = <a class="code" href="win32_8H.html#a2381eb7ab4ad62c68c478d6d70f85b09">XRectangleRegion</a>(X, Y, W, H);
<a name="l01517"></a>01517       CombineRgn(i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>, i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>, R, RGN_OR);
<a name="l01518"></a>01518       <a class="code" href="win32_8H.html#aa9ab8e4893ef97f9bf92e66e2c51778b">XDestroyRegion</a>(R);
<a name="l01519"></a>01519 <span class="preprocessor">#elif defined(__APPLE_QUARTZ__)</span>
<a name="l01520"></a>01520 <span class="preprocessor"></span>      CGRect arg = fl_cgrectmake_cocoa(X, Y, W, H);
<a name="l01521"></a>01521       <span class="keywordtype">int</span> j; <span class="comment">// don&#39;t add a rectangle totally inside the Fl_Region</span>
<a name="l01522"></a>01522       <span class="keywordflow">for</span>(j = 0; j &lt; i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>-&gt;count; j++) {
<a name="l01523"></a>01523         <span class="keywordflow">if</span>(CGRectContainsRect(i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>-&gt;rects[j], arg)) <span class="keywordflow">break</span>;
<a name="l01524"></a>01524       }
<a name="l01525"></a>01525       <span class="keywordflow">if</span>( j &gt;= i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>-&gt;count) {
<a name="l01526"></a>01526         i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>-&gt;rects = (CGRect*)realloc(i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>-&gt;rects, (++(i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>-&gt;count)) * <span class="keyword">sizeof</span>(CGRect));
<a name="l01527"></a>01527         i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>-&gt;rects[i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>-&gt;count - 1] = arg;
<a name="l01528"></a>01528       }
<a name="l01529"></a>01529 <span class="preprocessor">#else</span>
<a name="l01530"></a>01530 <span class="preprocessor"></span><span class="preprocessor"># error unsupported platform</span>
<a name="l01531"></a>01531 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01532"></a>01532 <span class="preprocessor"></span>    }
<a name="l01533"></a>01533     wi-&gt;damage_ |= fl;
<a name="l01534"></a>01534   } <span class="keywordflow">else</span> {
<a name="l01535"></a>01535     <span class="comment">// create a new region:</span>
<a name="l01536"></a>01536     <span class="keywordflow">if</span> (i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>) <a class="code" href="win32_8H.html#aa9ab8e4893ef97f9bf92e66e2c51778b">XDestroyRegion</a>(i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>);
<a name="l01537"></a>01537     i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a> = <a class="code" href="win32_8H.html#a2381eb7ab4ad62c68c478d6d70f85b09">XRectangleRegion</a>(X,Y,W,H);
<a name="l01538"></a>01538     wi-&gt;damage_ = fl;
<a name="l01539"></a>01539   }
<a name="l01540"></a>01540   <a class="code" href="classFl__Widget.html#a24aaceb4034489133926f53eb57aad23">Fl::damage</a>(<a class="code" href="Enumerations_8H.html#a9a20351f841109b3d861e0c1248d146dad0cb406be09a7f40cbeadc398f63ce1e">FL_DAMAGE_CHILD</a>);
<a name="l01541"></a>01541 }
<a name="l01542"></a><a class="code" href="classFl__Window.html#a418cef08cf54f1dd794538501f15f08b">01542</a> <span class="keywordtype">void</span> <a class="code" href="classFl__Window.html#a418cef08cf54f1dd794538501f15f08b">Fl_Window::flush</a>() {
<a name="l01543"></a>01543   <a class="code" href="classFl__Window.html#a65a2499309b3fdd1bed463cefa0cd1e2">make_current</a>();
<a name="l01544"></a>01544 <span class="comment">//if (damage() == FL_DAMAGE_EXPOSE &amp;&amp; can_boxcheat(box())) fl_boxcheat = this;</span>
<a name="l01545"></a>01545   <a class="code" href="group__fl__drawings.html#gaa9cb59129942d660fb7472c653d3589e">fl_clip_region</a>(i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a>); i-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a> = 0;
<a name="l01546"></a>01546   <a class="code" href="classFl__Window.html#a097d8258fa43a4fc3aa9409daeb97b44">draw</a>();
<a name="l01547"></a>01547 }
<a name="l01548"></a>01548 
<a name="l01549"></a>01549 <span class="preprocessor">#ifdef WIN32</span>
<a name="l01550"></a>01550 <span class="preprocessor"></span><span class="preprocessor">#  include &quot;<a class="code" href="Fl__win32_8cxx.html">Fl_win32.cxx</a>&quot;</span>
<a name="l01551"></a>01551 <span class="comment">//#elif defined(__APPLE__)</span>
<a name="l01552"></a>01552 <span class="preprocessor">#endif</span>
<a name="l01553"></a>01553 <span class="preprocessor"></span>
<a name="l01554"></a>01554 <span class="comment">//</span>
<a name="l01555"></a>01555 <span class="comment">// The following methods allow callbacks to schedule the deletion of</span>
<a name="l01556"></a>01556 <span class="comment">// widgets at &quot;safe&quot; times.</span>
<a name="l01557"></a>01557 <span class="comment">//</span>
<a name="l01558"></a>01558 
<a name="l01559"></a><a class="code" href="Fl_8cxx.html#a7fe720bcc47d3e7d40bf15d96ed6b21c">01559</a> <span class="keyword">static</span> <span class="keywordtype">int</span>              num_dwidgets = 0, <a class="code" href="Fl_8cxx.html#a7fe720bcc47d3e7d40bf15d96ed6b21c">alloc_dwidgets</a> = 0;
<a name="l01560"></a>01560 <span class="keyword">static</span> <a class="code" href="classFl__Widget.html">Fl_Widget</a>        **dwidgets = 0;
<a name="l01561"></a>01561 
<a name="l01582"></a><a class="code" href="group__fl__del__widget.html#ga609413ac47ba433d1e7da8678a27164f">01582</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__del__widget.html#ga609413ac47ba433d1e7da8678a27164f">Fl::delete_widget</a>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *wi) {
<a name="l01583"></a>01583   <span class="keywordflow">if</span> (!wi) <span class="keywordflow">return</span>;
<a name="l01584"></a>01584 
<a name="l01585"></a>01585   <span class="keywordflow">if</span> (num_dwidgets &gt;= <a class="code" href="Fl_8cxx.html#a7fe720bcc47d3e7d40bf15d96ed6b21c">alloc_dwidgets</a>) {
<a name="l01586"></a>01586     <a class="code" href="classFl__Widget.html">Fl_Widget</a>   **temp;
<a name="l01587"></a>01587 
<a name="l01588"></a>01588     temp = <span class="keyword">new</span> <a class="code" href="classFl__Widget.html">Fl_Widget</a> *[<a class="code" href="Fl_8cxx.html#a7fe720bcc47d3e7d40bf15d96ed6b21c">alloc_dwidgets</a> + 10];
<a name="l01589"></a>01589     <span class="keywordflow">if</span> (<a class="code" href="Fl_8cxx.html#a7fe720bcc47d3e7d40bf15d96ed6b21c">alloc_dwidgets</a>) {
<a name="l01590"></a>01590       memcpy(temp, dwidgets, <a class="code" href="Fl_8cxx.html#a7fe720bcc47d3e7d40bf15d96ed6b21c">alloc_dwidgets</a> * <span class="keyword">sizeof</span>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *));
<a name="l01591"></a>01591       <span class="keyword">delete</span>[] dwidgets;
<a name="l01592"></a>01592     }
<a name="l01593"></a>01593 
<a name="l01594"></a>01594     dwidgets = temp;
<a name="l01595"></a>01595     <a class="code" href="Fl_8cxx.html#a7fe720bcc47d3e7d40bf15d96ed6b21c">alloc_dwidgets</a> += 10;
<a name="l01596"></a>01596   }
<a name="l01597"></a>01597 
<a name="l01598"></a>01598   dwidgets[num_dwidgets] = wi;
<a name="l01599"></a>01599   num_dwidgets ++;
<a name="l01600"></a>01600 }
<a name="l01601"></a>01601 
<a name="l01613"></a><a class="code" href="group__fl__del__widget.html#ga838010444986ae57301d6e8289d2dfbb">01613</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__del__widget.html#ga838010444986ae57301d6e8289d2dfbb">Fl::do_widget_deletion</a>() {
<a name="l01614"></a>01614   <span class="keywordflow">if</span> (!num_dwidgets) <span class="keywordflow">return</span>;
<a name="l01615"></a>01615 
<a name="l01616"></a>01616   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> = 0; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> &lt; num_dwidgets; <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a> ++)
<a name="l01617"></a>01617     <span class="keyword">delete</span> dwidgets[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>];
<a name="l01618"></a>01618 
<a name="l01619"></a>01619   num_dwidgets = 0;
<a name="l01620"></a>01620 }
<a name="l01621"></a>01621 
<a name="l01622"></a>01622 <span class="keyword">static</span> <a class="code" href="classFl__Widget.html">Fl_Widget</a> ***widget_watch = 0;
<a name="l01623"></a>01623 <span class="keyword">static</span> <span class="keywordtype">int</span> num_widget_watch = 0;
<a name="l01624"></a>01624 <span class="keyword">static</span> <span class="keywordtype">int</span> max_widget_watch = 0;
<a name="l01625"></a>01625 
<a name="l01671"></a><a class="code" href="group__fl__del__widget.html#ga16ecd6d20b793fd0f3081eaab369caa9">01671</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__del__widget.html#ga16ecd6d20b793fd0f3081eaab369caa9">Fl::watch_widget_pointer</a>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *&amp;<a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a>) 
<a name="l01672"></a>01672 {
<a name="l01673"></a>01673   <a class="code" href="classFl__Widget.html">Fl_Widget</a> **wp = &amp;<a class="code" href="group__fl__screen.html#ga7aba4252407f539aa6d821551aaba5ff">w</a>;
<a name="l01674"></a>01674   <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;
<a name="l01675"></a>01675   <span class="keywordflow">for</span> (i=0; i&lt;num_widget_watch; ++<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>) {
<a name="l01676"></a>01676     <span class="keywordflow">if</span> (widget_watch[i]==wp) <span class="keywordflow">return</span>;
<a name="l01677"></a>01677   }
<a name="l01678"></a>01678   <span class="keywordflow">if</span> (num_widget_watch==max_widget_watch) {
<a name="l01679"></a>01679     max_widget_watch += 8;
<a name="l01680"></a>01680     widget_watch = (<a class="code" href="classFl__Widget.html">Fl_Widget</a>***)realloc(widget_watch, <span class="keyword">sizeof</span>(<a class="code" href="classFl__Widget.html">Fl_Widget</a>**)*max_widget_watch);
<a name="l01681"></a>01681   }
<a name="l01682"></a>01682   widget_watch[num_widget_watch++] = wp;
<a name="l01683"></a>01683 <span class="preprocessor">#ifdef DEBUG_WATCH</span>
<a name="l01684"></a>01684 <span class="preprocessor"></span>  printf (<span class="stringliteral">&quot;\nwatch_widget_pointer:   (%d/%d) %8p =&gt; %8p\n&quot;</span>,
<a name="l01685"></a>01685     num_widget_watch,num_widget_watch,wp,*wp);
<a name="l01686"></a>01686   fflush(stdout);
<a name="l01687"></a>01687 <span class="preprocessor">#endif // DEBUG_WATCH</span>
<a name="l01688"></a>01688 <span class="preprocessor"></span>}
<a name="l01689"></a>01689 
<a name="l01700"></a><a class="code" href="group__fl__del__widget.html#ga1426329d09de561319d4555018d9d1a2">01700</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__del__widget.html#ga1426329d09de561319d4555018d9d1a2">Fl::release_widget_pointer</a>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *&amp;<a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a>)
<a name="l01701"></a>01701 {
<a name="l01702"></a>01702   <a class="code" href="classFl__Widget.html">Fl_Widget</a> **wp = &amp;<a class="code" href="group__fl__screen.html#ga7aba4252407f539aa6d821551aaba5ff">w</a>;
<a name="l01703"></a>01703   <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>,j=0;
<a name="l01704"></a>01704   <span class="keywordflow">for</span> (i=0; i&lt;num_widget_watch; ++<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>) {
<a name="l01705"></a>01705     <span class="keywordflow">if</span> (widget_watch[i]!=wp) {
<a name="l01706"></a>01706       <span class="keywordflow">if</span> (j&lt;i) widget_watch[j] = widget_watch[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>]; <span class="comment">// fill gap</span>
<a name="l01707"></a>01707       j++;
<a name="l01708"></a>01708     }
<a name="l01709"></a>01709 <span class="preprocessor">#ifdef DEBUG_WATCH</span>
<a name="l01710"></a>01710 <span class="preprocessor"></span>    <span class="keywordflow">else</span> { <span class="comment">// found widget pointer</span>
<a name="l01711"></a>01711       printf (<span class="stringliteral">&quot;release_widget_pointer: (%d/%d) %8p =&gt; %8p\n&quot;</span>,
<a name="l01712"></a>01712         i+1,num_widget_watch,wp,*wp);
<a name="l01713"></a>01713     }
<a name="l01714"></a>01714 <span class="preprocessor">#endif //DEBUG_WATCH</span>
<a name="l01715"></a>01715 <span class="preprocessor"></span>  }
<a name="l01716"></a>01716   num_widget_watch = j;
<a name="l01717"></a>01717 <span class="preprocessor">#ifdef DEBUG_WATCH</span>
<a name="l01718"></a>01718 <span class="preprocessor"></span>  printf (<span class="stringliteral">&quot;                        num_widget_watch = %d\n\n&quot;</span>,num_widget_watch);
<a name="l01719"></a>01719   fflush(stdout);
<a name="l01720"></a>01720 <span class="preprocessor">#endif // DEBUG_WATCH</span>
<a name="l01721"></a>01721 <span class="preprocessor"></span>  <span class="keywordflow">return</span>;
<a name="l01722"></a>01722 }
<a name="l01739"></a><a class="code" href="group__fl__del__widget.html#gad3cbd31083b47836cbe00ffb7006a4d4">01739</a> <span class="keywordtype">void</span> <a class="code" href="group__fl__del__widget.html#gad3cbd31083b47836cbe00ffb7006a4d4">Fl::clear_widget_pointer</a>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> <span class="keyword">const</span> *<a class="code" href="forms_8H-2.html#aac374e320caaadeca4874add33b62af2">w</a>) 
<a name="l01740"></a>01740 {
<a name="l01741"></a>01741   <span class="keywordflow">if</span> (w==0L) <span class="keywordflow">return</span>;
<a name="l01742"></a>01742   <span class="keywordtype">int</span> <a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>;
<a name="l01743"></a>01743   <span class="keywordflow">for</span> (i=0; i&lt;num_widget_watch; ++<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>) {
<a name="l01744"></a>01744     <span class="keywordflow">if</span> (widget_watch[i] &amp;&amp; *widget_watch[i]==w) {
<a name="l01745"></a>01745       *widget_watch[<a class="code" href="png_8h.html#ac8936188af0c1d2f8b9d0cd25fde43b2">i</a>] = 0L;
<a name="l01746"></a>01746     }
<a name="l01747"></a>01747   }
<a name="l01748"></a>01748 }
<a name="l01749"></a>01749 
<a name="l01750"></a>01750 
<a name="l01768"></a><a class="code" href="classFl.html#abc49722be45fb56cad89c7c067eda5e3">01768</a> <span class="keywordtype">bool</span> <a class="code" href="classFl.html#abc49722be45fb56cad89c7c067eda5e3" title="FLTK library options management.">Fl::option</a>(<a class="code" href="classFl.html#a43e6e0bbbc03cad134d928d4edd48d1d">Fl_Option</a> opt)
<a name="l01769"></a>01769 {
<a name="l01770"></a>01770   <span class="keywordflow">if</span> (!options_read_) {
<a name="l01771"></a>01771     <span class="keywordtype">int</span> tmp;
<a name="l01772"></a>01772     { <span class="comment">// first, read the system wide preferences</span>
<a name="l01773"></a>01773       <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> prefs(<a class="code" href="classFl__Preferences.html#a0947b73d778ca66b9fbb97b75bbbd7cba057fd9ac75376136f30efb0d700e8db4" title="Preferences are used system-wide.">Fl_Preferences::SYSTEM</a>, <span class="stringliteral">&quot;fltk.org&quot;</span>, <span class="stringliteral">&quot;fltk&quot;</span>);
<a name="l01774"></a>01774       <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> opt_prefs(prefs, <span class="stringliteral">&quot;options&quot;</span>);
<a name="l01775"></a>01775       opt_prefs.<a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">get</a>(<span class="stringliteral">&quot;ArrowFocus&quot;</span>, tmp, 0);                      <span class="comment">// default: off</span>
<a name="l01776"></a>01776       options_[<a class="code" href="classFl.html#a43e6e0bbbc03cad134d928d4edd48d1da0d10867528510b82613c085e6240ebf6">OPTION_ARROW_FOCUS</a>] = tmp;
<a name="l01777"></a>01777       <span class="comment">//opt_prefs.get(&quot;NativeFilechooser&quot;, tmp, 1);             // default: on</span>
<a name="l01778"></a>01778       <span class="comment">//options_[OPTION_NATIVE_FILECHOOSER] = tmp;</span>
<a name="l01779"></a>01779       <span class="comment">//opt_prefs.get(&quot;FilechooserPreview&quot;, tmp, 1);            // default: on</span>
<a name="l01780"></a>01780       <span class="comment">//options_[OPTION_FILECHOOSER_PREVIEW] = tmp;</span>
<a name="l01781"></a>01781       opt_prefs.<a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">get</a>(<span class="stringliteral">&quot;VisibleFocus&quot;</span>, tmp, 1);                    <span class="comment">// default: on</span>
<a name="l01782"></a>01782       options_[<a class="code" href="classFl.html#a43e6e0bbbc03cad134d928d4edd48d1dade29f22fc8066222d99ea3ccebc5e655">OPTION_VISIBLE_FOCUS</a>] = tmp;
<a name="l01783"></a>01783       opt_prefs.<a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">get</a>(<span class="stringliteral">&quot;DNDText&quot;</span>, tmp, 1);                         <span class="comment">// default: on</span>
<a name="l01784"></a>01784       options_[<a class="code" href="classFl.html#a43e6e0bbbc03cad134d928d4edd48d1da2344bf14f80ecf5971e8aa4493a3858a">OPTION_DND_TEXT</a>] = tmp;
<a name="l01785"></a>01785       opt_prefs.<a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">get</a>(<span class="stringliteral">&quot;ShowTooltips&quot;</span>, tmp, 1);                    <span class="comment">// default: on</span>
<a name="l01786"></a>01786       options_[<a class="code" href="classFl.html#a43e6e0bbbc03cad134d928d4edd48d1dae8214e42f77fe157297d61fdb818be2f">OPTION_SHOW_TOOLTIPS</a>] = tmp;
<a name="l01787"></a>01787     }
<a name="l01788"></a>01788     { <span class="comment">// next, check the user preferences</span>
<a name="l01789"></a>01789       <span class="comment">// override system options only, if the option is set ( &gt;= 0 )</span>
<a name="l01790"></a>01790       <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> prefs(<a class="code" href="classFl__Preferences.html#a0947b73d778ca66b9fbb97b75bbbd7cbaaf4354ca5ac4df110c2fd1fc36c61053" title="Preferences apply only to the current user.">Fl_Preferences::USER</a>, <span class="stringliteral">&quot;fltk.org&quot;</span>, <span class="stringliteral">&quot;fltk&quot;</span>);
<a name="l01791"></a>01791       <a class="code" href="classFl__Preferences.html" title="Fl_Preferences provides methods to store user settings between application starts.">Fl_Preferences</a> opt_prefs(prefs, <span class="stringliteral">&quot;options&quot;</span>);
<a name="l01792"></a>01792       opt_prefs.<a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">get</a>(<span class="stringliteral">&quot;ArrowFocus&quot;</span>, tmp, -1); 
<a name="l01793"></a>01793       <span class="keywordflow">if</span> (tmp &gt;= 0) options_[<a class="code" href="classFl.html#a43e6e0bbbc03cad134d928d4edd48d1da0d10867528510b82613c085e6240ebf6">OPTION_ARROW_FOCUS</a>] = tmp;
<a name="l01794"></a>01794       <span class="comment">//opt_prefs.get(&quot;NativeFilechooser&quot;, tmp, -1); </span>
<a name="l01795"></a>01795       <span class="comment">//if (tmp &gt;= 0) options_[OPTION_NATIVE_FILECHOOSER] = tmp;</span>
<a name="l01796"></a>01796       <span class="comment">//opt_prefs.get(&quot;FilechooserPreview&quot;, tmp, -1);</span>
<a name="l01797"></a>01797       <span class="comment">//if (tmp &gt;= 0) options_[OPTION_FILECHOOSER_PREVIEW] = tmp;</span>
<a name="l01798"></a>01798       opt_prefs.<a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">get</a>(<span class="stringliteral">&quot;VisibleFocus&quot;</span>, tmp, -1); 
<a name="l01799"></a>01799       <span class="keywordflow">if</span> (tmp &gt;= 0) options_[<a class="code" href="classFl.html#a43e6e0bbbc03cad134d928d4edd48d1dade29f22fc8066222d99ea3ccebc5e655">OPTION_VISIBLE_FOCUS</a>] = tmp;
<a name="l01800"></a>01800       opt_prefs.<a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">get</a>(<span class="stringliteral">&quot;DNDText&quot;</span>, tmp, -1); 
<a name="l01801"></a>01801       <span class="keywordflow">if</span> (tmp &gt;= 0) options_[<a class="code" href="classFl.html#a43e6e0bbbc03cad134d928d4edd48d1da2344bf14f80ecf5971e8aa4493a3858a">OPTION_DND_TEXT</a>] = tmp;
<a name="l01802"></a>01802       opt_prefs.<a class="code" href="classFl__Preferences.html#a0991a0bea2800ce5cd362ff6a778c0d3">get</a>(<span class="stringliteral">&quot;ShowTooltips&quot;</span>, tmp, -1); 
<a name="l01803"></a>01803       <span class="keywordflow">if</span> (tmp &gt;= 0) options_[<a class="code" href="classFl.html#a43e6e0bbbc03cad134d928d4edd48d1dae8214e42f77fe157297d61fdb818be2f">OPTION_SHOW_TOOLTIPS</a>] = tmp;
<a name="l01804"></a>01804     }
<a name="l01805"></a>01805     { <span class="comment">// now, if the developer has registered this app, we could as for per-application preferences</span>
<a name="l01806"></a>01806     }
<a name="l01807"></a>01807     options_read_ = 1;
<a name="l01808"></a>01808   }
<a name="l01809"></a>01809   <span class="keywordflow">if</span> (opt&lt;0 || opt&gt;=<a class="code" href="classFl.html#a43e6e0bbbc03cad134d928d4edd48d1da220ebf62255fc47e5b5f213b410e2bc5">OPTION_LAST</a>) 
<a name="l01810"></a>01810     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01811"></a>01811   <span class="keywordflow">return</span> (<span class="keywordtype">bool</span>)options_[opt];
<a name="l01812"></a>01812 }
<a name="l01813"></a>01813 
<a name="l01823"></a><a class="code" href="classFl.html#a9b040cad5d6fc04bb139877015091c16">01823</a> <span class="keywordtype">void</span> <a class="code" href="classFl.html#abc49722be45fb56cad89c7c067eda5e3" title="FLTK library options management.">Fl::option</a>(<a class="code" href="classFl.html#a43e6e0bbbc03cad134d928d4edd48d1d">Fl_Option</a> opt, <span class="keywordtype">bool</span> <a class="code" href="jpeglib_8h.html#aa0ccb5ee6d882ee3605ff47745c6467b">val</a>)
<a name="l01824"></a>01824 {
<a name="l01825"></a>01825   <span class="keywordflow">if</span> (opt&lt;0 || opt&gt;=<a class="code" href="classFl.html#a43e6e0bbbc03cad134d928d4edd48d1da220ebf62255fc47e5b5f213b410e2bc5">OPTION_LAST</a>) 
<a name="l01826"></a>01826     <span class="keywordflow">return</span>;
<a name="l01827"></a>01827   <span class="keywordflow">if</span> (!options_read_) {
<a name="l01828"></a>01828     <span class="comment">// first read this option, so we don&#39;t override our setting later</span>
<a name="l01829"></a>01829     <a class="code" href="classFl.html#abc49722be45fb56cad89c7c067eda5e3" title="FLTK library options management.">option</a>(opt);
<a name="l01830"></a>01830   }
<a name="l01831"></a>01831   options_[opt] = <a class="code" href="jpeglib_8h.html#aa0ccb5ee6d882ee3605ff47745c6467b">val</a>;
<a name="l01832"></a>01832 }
<a name="l01833"></a>01833 
<a name="l01834"></a>01834 
<a name="l01835"></a>01835 <span class="comment">// Helper class Fl_Widget_Tracker</span>
<a name="l01836"></a>01836 
<a name="l01840"></a><a class="code" href="classFl__Widget__Tracker.html#af56fbd8246a36a9f81af4b33a51bdbbf">01840</a> <a class="code" href="classFl__Widget__Tracker.html#af56fbd8246a36a9f81af4b33a51bdbbf">Fl_Widget_Tracker::Fl_Widget_Tracker</a>(<a class="code" href="classFl__Widget.html">Fl_Widget</a> *wi) 
<a name="l01841"></a>01841 {
<a name="l01842"></a>01842   wp_ = wi;
<a name="l01843"></a>01843   <a class="code" href="group__fl__del__widget.html#ga16ecd6d20b793fd0f3081eaab369caa9">Fl::watch_widget_pointer</a>(wp_); <span class="comment">// add pointer to watch list</span>
<a name="l01844"></a>01844 }
<a name="l01845"></a>01845 
<a name="l01849"></a><a class="code" href="classFl__Widget__Tracker.html#ad8b10b224a41cbe76566b57742190834">01849</a> <a class="code" href="classFl__Widget__Tracker.html#ad8b10b224a41cbe76566b57742190834">Fl_Widget_Tracker::~Fl_Widget_Tracker</a>() 
<a name="l01850"></a>01850 {
<a name="l01851"></a>01851   <a class="code" href="group__fl__del__widget.html#ga1426329d09de561319d4555018d9d1a2">Fl::release_widget_pointer</a>(wp_); <span class="comment">// remove pointer from watch list</span>
<a name="l01852"></a>01852 }
<a name="l01853"></a>01853 
<a name="l01854"></a>01854 
<a name="l01855"></a>01855 <span class="comment">//</span>
<a name="l01856"></a>01856 <span class="comment">// End of &quot;$Id: Fl.cxx 8198 2011-01-06 10:24:58Z manolo $&quot;.</span>
<a name="l01857"></a>01857 <span class="comment">//</span>
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="Fl_8cxx.html">Fl.cxx</a>      </li>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="#" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3</small></address>
</body>

<!-- Mirrored from dox.sfr-fresh.com/fltk-1.3.0rc3-source/Fl_8cxx_source.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 16 Feb 2011 23:40:32 GMT -->
</html>
