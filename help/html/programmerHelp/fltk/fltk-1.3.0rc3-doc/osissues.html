<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from dox.sfr-fresh.com/fltk-1.3.0rc3-source/osissues.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 16 Feb 2011 23:23:54 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SfR Fresh Dox - fltk: Operating System Issues</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">fltk&#160;<span id="projectnumber">1.3.0rc3</span></div>
   <div id="projectbrief">About: <A HREF= http://www.fltk.org/>FLTK</A> (Fast Light Tool Kit) is a cross-platform C++ GUI toolkit for UNIX/Linux (X11), Microsoft Windows, and MacOS X. Release candidate.<BR><IMG SRC="../warix/forest1.gif" ALT="">&nbsp;&nbsp;<A HREF="http://www.sfr-fresh.com/" TITLE="SfR Fresh Home">SfR Fresh</A> <A HREF="http://www.sfr-fresh.com/warix/features.html#doxygen" TITLE="SfR Fresh Doxygen Support Info">Dox</A>: <A HREF="../fresh/unix/misc/fltk-1.3.0rc3-source.tar.gz/index.html" TITLE="SfR Fresh: fltk-1.3.0rc3-source.tar.gz Contents &amp; Download Page">fltk-1.3.0rc3-source.tar.gz</A> ("inofficial" and yet experimental doxygen-generated source code documentation)&nbsp;&nbsp;<IMG SRC="../warix/forest2.gif" ALT=""><P></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index-2.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('osissues.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>Operating System Issues </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><p>This appendix describes the operating system specific interfaces in FLTK.</p>
<h2><a class="anchor" id="osissues_accessing"></a>
Accessing the OS Interfaces</h2>
<p>All programs that need to access the operating system specific interfaces must include the following header <a href="file:">file:</a></p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="x_8H.html">FL/x.H</a>&gt;</span>
</pre></div><p>Despite the name, this header file will define the appropriate interface for your environment. The pages that follow describe the functionality that is provided for each operating system.</p>
<center> <table  width="90%" border="1" cellpadding="5" cellspacing="0" bgcolor="#cccccc">
<tr>
<td><p class="starttd"><b>WARNING:</b></p>
<p>The interfaces provided by this header file may change radically in new FLTK releases. Use them only when an existing generic FLTK interface is not sufficient.</p>
<p class="endtd"></p>
</td></tr>
</table>
</center><h2><a class="anchor" id="osissues_unit"></a>
The UNIX (X11) Interface</h2>
<p>The UNIX interface provides access to the X Window System state information and data structures.</p>
<h3><a class="anchor" id="osissues_x_events"></a>
Handling Other X Events</h3>
<p>void Fl::add_handler(int (*f)(int))</p>
<dl class="user"><dt><b></b></dt><dd>Installs a function to parse unrecognized events. If FLTK cannot figure out what to do with an event, it calls each of these functions (most recent first) until one of them returns non-zero. If none of them returns non-zero then the event is ignored.</dd></dl>
<dl class="user"><dt><b></b></dt><dd>FLTK calls this for any X events it does not recognize, or X events with a window ID that FLTK does not recognize. You can look at the X event in the <code>fl_xevent</code> variable.</dd></dl>
<dl class="user"><dt><b></b></dt><dd>The argument is the FLTK event type that was not handled, or zero for unrecognized X events. These handlers are also called for global shortcuts and some other events that the widget they were passed to did not handle, for example <code>FL_SHORTCUT</code>.</dd></dl>
<p>extern XEvent *fl_xevent</p>
<dl class="user"><dt><b></b></dt><dd>This variable contains the most recent X event.</dd></dl>
<p>extern ulong fl_event_time</p>
<dl class="user"><dt><b></b></dt><dd>This variable contains the time stamp from the most recent X event that reported it; not all events do. Many X calls like cut and paste need this value.</dd></dl>
<p>Window <a class="el" href="x_8H.html#aa5809b3b26210f3de4945b243420eda9">fl_xid(const Fl_Window *)</a></p>
<dl class="user"><dt><b></b></dt><dd>Returns the XID for a window, or zero if not <code>shown()</code>.</dd></dl>
<p><a class="el" href="classFl__Window.html">Fl_Window</a> *fl_find(ulong xid)</p>
<dl class="user"><dt><b></b></dt><dd>Returns the <a class="el" href="classFl__Window.html">Fl_Window</a> that corresponds to the given XID, or <code>NULL</code> if not found. This function uses a cache so it is slightly faster than iterating through the windows yourself.</dd></dl>
<p>int <a class="el" href="Fl__x_8cxx.html#a3c910c8ee7543f207166ce32b1bb8638">fl_handle(const XEvent &amp;)</a></p>
<dl class="user"><dt><b></b></dt><dd>This call allows you to supply the X events to FLTK, which may allow FLTK to cooperate with another toolkit or library. The return value is non-zero if FLTK understood the event. If the window does not belong to FLTK and the <code>add_handler()</code> functions all return 0, this function will return false.</dd></dl>
<dl class="user"><dt><b></b></dt><dd>Besides feeding events your code should call <a class="el" href="classFl.html#a08d29d807ea3874b8bb16f7457f64bdc">Fl::flush()</a> periodically so that FLTK redraws its windows.</dd></dl>
<dl class="user"><dt><b></b></dt><dd>This function will call the callback functions. It will not return until they complete. In particular, if a callback pops up a modal window by calling <a class="el" href="fl__ask_8H.html#a55f3def771c667e8c8f05c617bc410a2">fl_ask()</a>, for instance, it will not return until the modal function returns.</dd></dl>
<h3><a class="anchor" id="osissues_drawing_xlib"></a>
Drawing using Xlib</h3>
<p>The following global variables are set before <a class="el" href="classFl__Widget.html#a1acb38c6b3cb40452ad02ccfeedbac8a">Fl_Widget::draw()</a> is called, or by <a class="el" href="classFl__Window.html#a65a2499309b3fdd1bed463cefa0cd1e2">Fl_Window::make_current()</a>:</p>
<div class="fragment"><pre class="fragment"><span class="keyword">extern</span> Display *<a class="code" href="win32_8H.html#a6c6726f30a7b613184e2b315e167ddb2" title="END TIMERS //////////////////////////////////////////////////////////////////////////.">fl_display</a>;
<span class="keyword">extern</span> <a class="code" href="mac_8H.html#aad9fe48cacd960402308a6a7f9f5e584">Window</a> <a class="code" href="win32_8H.html#afdab6664143864c36ba6b51782b32500">fl_window</a>;
<span class="keyword">extern</span> GC <a class="code" href="mac_8H.html#a9b2af459c0a223b6274f508339c783a6">fl_gc</a>;
<span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="x_8H.html#a42a55d8c59138d9f0fa899491c25560c">fl_screen</a>;
<span class="keyword">extern</span> XVisualInfo *<a class="code" href="x_8H.html#abe861b6ba1d71b2f73e3883c10ac5c27">fl_visual</a>;
<span class="keyword">extern</span> Colormap <a class="code" href="x_8H.html#afcd48cb4e62b0bfee6102e98c7d0cb38">fl_colormap</a>;
</pre></div><p>You must use them to produce Xlib calls. Don't attempt to change them. A typical X drawing call is written like this:</p>
<div class="fragment"><pre class="fragment">XDrawSomething(fl_display, fl_window, fl_gc, ...);
</pre></div><p>Other information such as the position or size of the X window can be found by looking at <a class="el" href="classFl__Window.html#af5e20a946ba316850cff08c09ed8e9e2">Fl_Window::current()</a>, which returns a pointer to the <a class="el" href="classFl__Window.html">Fl_Window</a> being drawn.</p>
<p>unsigned long <a class="el" href="group__fl__attributes.html#ga5c8dfa051e445cff49726b256b9f1ca0">fl_xpixel(Fl_Color i)</a> <br/>
 unsigned long <a class="el" href="group__fl__attributes.html#gabd4509f352a8ddc8b413acc244f6bb4a">fl_xpixel(uchar r, uchar g, uchar b)</a></p>
<dl class="user"><dt><b></b></dt><dd>Returns the X pixel number used to draw the given FLTK color index or RGB color. This is the X pixel that <a class="el" href="drawing.html#drawing_colors">fl_color()</a> would use.</dd></dl>
<p>int <a class="el" href="Fl__get__system__colors_8cxx.html#aa5133e4cd5219d5f79ea60727c205a22">fl_parse_color(const char* p, uchar&amp; r, uchar&amp; g, uchar&amp; b)</a></p>
<dl class="user"><dt><b></b></dt><dd>Convert a name into the red, green, and blue values of a color by parsing the X11 color names. On other systems, <code><a class="el" href="mac_8H.html#a0a5c5c56a06c3e23e509e6c0125e95e7">fl_parse_color()</a></code> can only convert names in hexadecimal encoding, for example <code>#ff8083</code>.</dd></dl>
<p>extern XFontStruct *fl_xfont</p>
<dl class="user"><dt><b></b></dt><dd>Points to the font selected by the most recent <a class="el" href="drawing.html#ssect_Fonts">fl_font()</a>. This is not necessarily the current font of <code>fl_gc</code>, which is not set until <a class="el" href="drawing.html#ssect_Text">fl_draw()</a> is called. If FLTK was compiled with Xft support, <code>fl_xfont</code> will usually be 0 and <code>fl_xftfont</code> will contain a pointer to the <code>XftFont</code> structure instead.</dd></dl>
<p>extern void *fl_xftfont</p>
<dl class="user"><dt><b></b></dt><dd>If FLTK was compiled with Xft support enabled, <code>fl_xftfont</code> points to the xft font selected by the most recent <a class="el" href="drawing.html#ssect_Fonts">fl_font()</a>. Otherwise it will be 0. <code>fl_xftfont</code> should be cast to <code>XftFont*</code>.</dd></dl>
<h3><a class="anchor" id="osissues_xvisual"></a>
Changing the Display, Screen, or X Visual</h3>
<p>FLTK uses only a single display, screen, X visual, and X colormap. This greatly simplifies its internal structure and makes it much smaller and faster. You can change which it uses by setting global variables <em> before the first <a class="el" href="classFl__Window.html#afc4d3796226dfd4620b4d7cf29c287c9">Fl_Window::show()</a> is called. </em> You may also want to call <a class="el" href="classFl.html#a6d6deb3d4f76b538d508b36700dfb6b0">Fl::visual()</a>, which is a portable interface to get a full color and/or double buffered visual.</p>
<p>int <a class="el" href="classFl.html#a7c6847e1b7dd9628821656933ca8e79d">Fl::display(const char *)</a></p>
<dl class="user"><dt><b></b></dt><dd>Set which X display to use. This actually does <code>putenv("DISPLAY=...")</code> so that child programs will display on the same screen if called with <code>exec()</code>. This must be done before the display is opened. This call is provided under MacOS and WIN32 but it has no effect.</dd></dl>
<p>extern Display *fl_display</p>
<dl class="user"><dt><b></b></dt><dd>The open X display. This is needed as an argument to most Xlib calls. Don't attempt to change it! This is <code>NULL</code> before the display is opened.</dd></dl>
<p>void <a class="el" href="mac_8H.html#a94ee21d83137569a6730e3e2e7305cbc">fl_open_display()</a></p>
<dl class="user"><dt><b></b></dt><dd>Opens the display. Does nothing if it is already open. This will make sure <code>fl_display</code> is non-zero. You should call this if you wish to do X calls and there is a chance that your code will be called before the first <code>show()</code> of a window.</dd></dl>
<dl class="user"><dt><b></b></dt><dd>This may call Fl::abort() if there is an error opening the display.</dd></dl>
<p>void <a class="el" href="x_8H.html#ade3ae56765e00bc95627ff95c63cd2d7">fl_close_display()</a></p>
<dl class="user"><dt><b></b></dt><dd>This closes the X connection. You do <em>not</em> need to call this to exit, and in fact it is faster to not do so! It may be useful to call this if you want your program to continue without the X connection. You cannot open the display again, and probably cannot call any FLTK functions.</dd></dl>
<p>extern int fl_screen</p>
<dl class="user"><dt><b></b></dt><dd>Which screen number to use. This is set by <code><a class="el" href="mac_8H.html#a94ee21d83137569a6730e3e2e7305cbc">fl_open_display()</a></code> to the default screen. You can change it by setting this to a different value immediately afterwards. It can also be set by changing the last number in the <a class="el" href="classFl.html#a7c6847e1b7dd9628821656933ca8e79d">Fl::display()</a> string to "host:0.#".</dd></dl>
<p>extern XVisualInfo *fl_visual <br/>
 extern Colormap fl_colormap</p>
<dl class="user"><dt><b></b></dt><dd>The visual and colormap that FLTK will use for all windows. These are set by <code><a class="el" href="mac_8H.html#a94ee21d83137569a6730e3e2e7305cbc">fl_open_display()</a></code> to the default visual and colormap. You can change them before calling <code>show()</code> on the first window. Typical code for changing the default visual is: <div class="fragment"><pre class="fragment"><a class="code" href="classFl.html#a115903daf3593748cdd36a5e78e74534">Fl::args</a>(argc, argv); <span class="comment">// do this first so $DISPLAY is set</span>
<a class="code" href="mac_8H.html#a94ee21d83137569a6730e3e2e7305cbc">fl_open_display</a>();
fl_visual = find_a_good_visual(fl_display, fl_screen);
<span class="keywordflow">if</span> (!fl_visual) Fl::abort(<span class="stringliteral">&quot;No good visual&quot;</span>);
fl_colormap = make_a_colormap(fl_display, fl_visual-&gt;visual, fl_visual-&gt;depth);
<span class="comment">// it is now ok to show() windows:</span>
window-&gt;<a class="code" href="classFl__Window.html#afc4d3796226dfd4620b4d7cf29c287c9">show</a>(argc, argv);
</pre></div></dd></dl>
<h3><a class="anchor" id="osissues_specialx"></a>
Using a Subclass of Fl_Window for Special X Stuff</h3>
<p>FLTK can manage an X window on a different screen, visual and/or colormap, you just can't use FLTK's drawing routines to draw into it. But you can write your own <code>draw()</code> method that uses Xlib (and/or OpenGL) calls only.</p>
<p>FLTK can also manage XID's provided by other libraries or programs, and call those libraries when the window needs to be redrawn.</p>
<p>To do this, you need to make a subclass of <a class="el" href="classFl__Window.html">Fl_Window</a> and override some of these virtual functions:</p>
<p>virtual void <a class="el" href="classFl__Window.html#afc4d3796226dfd4620b4d7cf29c287c9">Fl_Window::show()</a></p>
<dl class="user"><dt><b></b></dt><dd>If the window is already <code>shown()</code> this must cause it to be raised, this can usually be done by calling <a class="el" href="classFl__Window.html#afc4d3796226dfd4620b4d7cf29c287c9">Fl_Window::show()</a>. If not <code>shown()</code> your implementation must call either <a class="el" href="classFl__X.html#ad6183cbf420d42e005454e911758c1b9">Fl_X::set_xid()</a> or <a class="el" href="classFl__X.html#a83450726de77c27a143900563f16268d">Fl_X::make_xid()</a>.</dd></dl>
<dl class="user"><dt><b></b></dt><dd>An example: <div class="fragment"><pre class="fragment"><span class="keywordtype">void</span> <a class="code" href="classFl__Gl__Window.html#a05f9c5395325f1f5a905207f0ccb994a">MyWindow::show</a>() {
  <span class="keywordflow">if</span> (shown()) {<a class="code" href="classFl__Window.html#afc4d3796226dfd4620b4d7cf29c287c9">Fl_Window::show</a>(); <span class="keywordflow">return</span>;}  <span class="comment">// you must do this!</span>
  <a class="code" href="mac_8H.html#a94ee21d83137569a6730e3e2e7305cbc">fl_open_display</a>();    <span class="comment">// necessary if this is first window</span>
  <span class="comment">// we only calculate the necessary visual colormap once:</span>
  <span class="keyword">static</span> XVisualInfo *visual;
  <span class="keyword">static</span> Colormap colormap;
  <span class="keywordflow">if</span> (!visual) {
    visual = figure_out_visual();
    colormap = XCreateColormap(fl_display, RootWindow(fl_display,fl_screen),
                               vis-&gt;visual, AllocNone);
  }
  <a class="code" href="classFl__X.html#a83450726de77c27a143900563f16268d">Fl_X::make_xid</a>(<span class="keyword">this</span>, visual, colormap);
}
</pre></div></dd></dl>
<div class="fragment"><pre class="fragment">
Fl_X *Fl_X::set_xid(Fl_Window*, Window xid)
</pre></div><dl class="user"><dt><b></b></dt><dd>Allocate a hidden structure called an <a class="el" href="classFl__X.html">Fl_X</a>, put the XID into it, and set a pointer to it from the <a class="el" href="classFl__Window.html">Fl_Window</a>. This causes <a class="el" href="classFl__Window.html#aa09300542b2d8b49fc69a037bdd3b742">Fl_Window::shown()</a> to return true.</dd></dl>
<p>void <a class="el" href="classFl__X.html#a83450726de77c27a143900563f16268d">Fl_X::make_xid</a>(Fl_Window*, XVisualInfo* = fl_visual, Colormap = fl_colormap)</p>
<dl class="user"><dt><b></b></dt><dd>This static method does the most onerous parts of creating an X window, including setting the label, resize limitations, etc. It then does <a class="el" href="classFl__X.html#ad6183cbf420d42e005454e911758c1b9">Fl_X::set_xid()</a> with this new window and maps the window.</dd></dl>
<p>virtual void <a class="el" href="classFl__Window.html#a418cef08cf54f1dd794538501f15f08b">Fl_Window::flush()</a></p>
<dl class="user"><dt><b></b></dt><dd>This virtual function is called by <a class="el" href="classFl.html#a08d29d807ea3874b8bb16f7457f64bdc">Fl::flush()</a> to update the window. For FLTK's own windows it does this by setting the global variables <code>fl_window</code> and <code>fl_gc</code> and then calling the <code>draw()</code> method. For your own windows you might just want to put all the drawing code in here.</dd></dl>
<dl class="user"><dt><b></b></dt><dd>The X region that is a combination of all <code>damage()</code> calls done so far is in <code>Fl_X::i(this)-&gt;region</code>. If <code>NULL</code> then you should redraw the entire window. The undocumented function <code>fl_clip_region(XRegion)</code> will initialize the FLTK clip stack with a region or <code>NULL</code> for no clipping. You must set region to <code>NULL</code> afterwards as <code><a class="el" href="group__fl__drawings.html#gaa9cb59129942d660fb7472c653d3589e">fl_clip_region()</a></code> will own and delete it when done.</dd></dl>
<dl class="user"><dt><b></b></dt><dd>If <code>damage() &amp; FL_DAMAGE_EXPOSE</code> then only X expose events have happened. This may be useful if you have an undamaged image (such as a backing buffer) around.</dd></dl>
<dl class="user"><dt><b></b></dt><dd>Here is a sample where an undamaged image is kept somewhere: <div class="fragment"><pre class="fragment"><span class="keywordtype">void</span> <a class="code" href="classFl__Gl__Window.html#afc1f3b65a2d872fd21049749179a8f2f">MyWindow::flush</a>() {
  <a class="code" href="group__fl__drawings.html#gaa9cb59129942d660fb7472c653d3589e">fl_clip_region</a>(<a class="code" href="classFl__X.html#ae4c6997d92cf8ad3a75a962d7ae77c34">Fl_X::i</a>(<span class="keyword">this</span>)-&gt;region);
  <a class="code" href="classFl__X.html#ae4c6997d92cf8ad3a75a962d7ae77c34">Fl_X::i</a>(<span class="keyword">this</span>)-&gt;<a class="code" href="classFl__X.html#a2d6b59b7362a486d48b6ae5df0bd0b41">region</a> = 0;
  <span class="keywordflow">if</span> (damage() != 2) {... draw things into backing store ...}
  ... copy backing store to window ...
}
</pre></div></dd></dl>
<p>virtual void <a class="el" href="classFl__Window.html#acd69a335bdc69f5624301f267ca7f94e">Fl_Window::hide()</a></p>
<dl class="user"><dt><b></b></dt><dd>Destroy the window server copy of the window. Usually you will destroy contexts, pixmaps, or other resources used by the window, and then call <a class="el" href="classFl__Window.html#acd69a335bdc69f5624301f267ca7f94e">Fl_Window::hide()</a> to get rid of the main window identified by <code>xid()</code>. If you override this, you must also override the destructor as shown: <div class="fragment"><pre class="fragment"><span class="keywordtype">void</span> <a class="code" href="classFl__Gl__Window.html#ad1fb7b91338789fe4d09c22b1ba3dd42">MyWindow::hide</a>() {
  <span class="keywordflow">if</span> (mypixmap) {
    XFreePixmap(fl_display,mypixmap);
    mypixmap = 0;
  }
  <a class="code" href="classFl__Window.html#acd69a335bdc69f5624301f267ca7f94e">Fl_Window::hide</a>(); <span class="comment">// you must call this</span>
}
</pre></div></dd></dl>
<p>virtual void <a class="el" href="classFl__Window.html#a75b94c3386351a44a0ef97b8e435eecb">Fl_Window::~Fl_Window()</a></p>
<dl class="user"><dt><b></b></dt><dd>Because of the way C++ works, if you override <code>hide()</code> you <em>must</em> override the destructor as well (otherwise only the base class <code>hide()</code> is called): <div class="fragment"><pre class="fragment">MyWindow::~MyWindow() {
  hide();
}
</pre></div></dd></dl>
<h3><a class="anchor" id="osissues_x_icon"></a>
Setting the Icon of a Window</h3>
<p>FLTK currently supports setting a window's icon <b>before</b> it is shown using the <a class="el" href="classFl__Window.html#a26d72fc2749dce26680d686ae6841a29">Fl_Window::icon()</a> method.</p>
<p>void <a class="el" href="classFl__Window.html#aebe49571396c9d9e88e6006e0d4899a1">Fl_Window::icon(const void *)</a></p>
<dl class="user"><dt><b></b></dt><dd>Sets the icon for the window to the passed pointer. You will need to cast the icon <code>Pixmap</code> to a <code>char*</code> when calling this method. To set a monochrome icon using a bitmap compiled with your application use: <div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;icon.xbm&quot;</span>

<a class="code" href="mac_8H.html#a94ee21d83137569a6730e3e2e7305cbc">fl_open_display</a>(); <span class="comment">// needed if display has not been previously opened</span>

Pixmap p = XCreateBitmapFromData(fl_display, DefaultRootWindow(fl_display),
                                 icon_bits, icon_width, icon_height);

window-&gt;<a class="code" href="classFl__Window.html#a26d72fc2749dce26680d686ae6841a29">icon</a>((<span class="keyword">const</span> <span class="keywordtype">void</span>*)p);
</pre></div></dd></dl>
<dl class="user"><dt><b></b></dt><dd>To use a multi-colored icon, the XPM format and library should be used as follows: <div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;X11/xpm.h&gt;</span>
<span class="preprocessor">#include &quot;icon.xpm&quot;</span>

<a class="code" href="mac_8H.html#a94ee21d83137569a6730e3e2e7305cbc">fl_open_display</a>();                <span class="comment">// needed if display has not been previously opened</span>

Pixmap p, <a class="code" href="png_8h.html#aa61e47f2cb0ad7631948cd857c77164f">mask</a>;

XpmCreatePixmapFromData(fl_display, DefaultRootWindow(fl_display),
                                 icon_xpm, &amp;p, &amp;mask, <a class="code" href="forms_8H-2.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);

window-&gt;<a class="code" href="classFl__Window.html#a26d72fc2749dce26680d686ae6841a29">icon</a>((<span class="keyword">const</span> <span class="keywordtype">void</span> *)p);
</pre></div></dd></dl>
<dl class="user"><dt><b></b></dt><dd>When using the Xpm library, be sure to include it in the list of libraries that are used to link the application (usually "-lXpm").</dd></dl>
<center> <table  width="90%" border="1" cellpadding="5" cellspacing="0" bgcolor="#cccccc">
<tr>
<td><p class="starttd"><b>NOTE:</b></p>
<p>You must call <a class="el" href="classFl__Window.html#a0d75dfcdc8fb797f9247482da1e0152b">Fl_Window::show(int argc, char** argv)</a> for the icon to be used. The <a class="el" href="classFl__Window.html#afc4d3796226dfd4620b4d7cf29c287c9">Fl_Window::show()</a> method does not bind the icon to the window.</p>
<p class="endtd"></p>
</td></tr>
</table>
</center><h3><a class="anchor" id="osissues_xresources"></a>
X Resources</h3>
<p>When the <a class="el" href="classFl__Window.html#a0d75dfcdc8fb797f9247482da1e0152b">Fl_Window::show(int argc, char** argv)</a> method is called, FLTK looks for the following X resources:</p>
<ul>
<li><code>background</code> - The default background color for widgets (color).</li>
</ul>
<ul>
<li><code>dndTextOps</code> - The default setting for drag and drop text operations (boolean).</li>
</ul>
<ul>
<li><code>foreground</code> - The default foreground (label) color for widgets (color).</li>
</ul>
<ul>
<li><code>scheme</code> - The default scheme to use (string).</li>
</ul>
<ul>
<li><code>selectBackground</code> - The default selection color for menus, etc. (color).</li>
</ul>
<ul>
<li><code>Text.background</code> - The default background color for text fields (color).</li>
</ul>
<ul>
<li><code>tooltips</code> - The default setting for tooltips (boolean).</li>
</ul>
<ul>
<li><code>visibleFocus</code> - The default setting for visible keyboard focus on non-text widgets (boolean).</li>
</ul>
<p>Resources associated with the first window's <a class="el" href="classFl__Window.html#aa72d16b01745c1b396a654527012a6db">Fl_Window::xclass()</a> string are queried first, or if no class has been specified then the class "fltk" is used (e.g. <code>fltk.background</code>). If no match is found, a global search is done (e.g. <code>*background</code>).</p>
<h2><a class="anchor" id="osissues_win32"></a>
The Windows (WIN32) Interface</h2>
<p>The Windows interface provides access to the WIN32 GDI state information and data structures.</p>
<h3><a class="anchor" id="osissues_win32_messages"></a>
Handling Other WIN32 Messages</h3>
<p>By default a single WNDCLASSEX called "FLTK" is created. All <a class="el" href="classFl__Window.html">Fl_Window</a> 's are of this class unless you use <a class="el" href="classFl__Window.html#aa72d16b01745c1b396a654527012a6db">Fl_Window::xclass()</a>. The window class is created the first time <a class="el" href="classFl__Window.html#afc4d3796226dfd4620b4d7cf29c287c9">Fl_Window::show()</a> is called.</p>
<p>You can probably combine FLTK with other libraries that make their own WIN32 window classes. The easiest way is to call <a class="el" href="classFl.html#a108a84216f0b3fa1cb0c46ab7449a312">Fl::wait()</a>, as it will call <code>DispatchMessage()</code> for all messages to the other windows. If necessary you can let the other library take over as long as it calls <code>DispatchMessage()</code>, but you will have to arrange for the function <a class="el" href="classFl.html#a08d29d807ea3874b8bb16f7457f64bdc">Fl::flush()</a> to be called regularly so that widgets are updated, timeouts are handled, and the idle functions are called.</p>
<p>extern MSG fl_msg</p>
<dl class="user"><dt><b></b></dt><dd>This variable contains the most recent message read by <code>GetMessage()</code>, which is called by <a class="el" href="classFl.html#a108a84216f0b3fa1cb0c46ab7449a312">Fl::wait()</a>. This may not be the most recent message sent to an FLTK window, because silly WIN32 calls the handle procedures directly for some events (sigh).</dd></dl>
<p>void Fl::add_handler(int (*f)(int))</p>
<dl class="user"><dt><b></b></dt><dd>Installs a function to parse unrecognized messages sent to FLTK windows. If FLTK cannot figure out what to do with a message, it calls each of these functions (most recent first) until one of them returns non-zero. The argument passed to the functions is the FLTK event that was not handled or zero for unknown messages. If all the handlers return zero then FLTK calls <code>DefWindowProc()</code>.</dd></dl>
<p>HWND <a class="el" href="x_8H.html#aa5809b3b26210f3de4945b243420eda9">fl_xid(const Fl_Window *)</a></p>
<dl class="user"><dt><b></b></dt><dd>Returns the window handle for a <a class="el" href="classFl__Window.html">Fl_Window</a>, or zero if not <code>shown()</code>.</dd></dl>
<p><a class="el" href="classFl__Window.html">Fl_Window</a> *fl_find(HWND xid)</p>
<dl class="user"><dt><b></b></dt><dd>Returns the <a class="el" href="classFl__Window.html">Fl_Window</a> that corresponds to the given window handle, or <code>NULL</code> if not found. This function uses a cache so it is slightly faster than iterating through the windows yourself.</dd></dl>
<h3><a class="anchor" id="osissues_win32_gdi"></a>
Drawing Things Using the WIN32 GDI</h3>
<p>When the virtual function <a class="el" href="classFl__Widget.html#a1acb38c6b3cb40452ad02ccfeedbac8a">Fl_Widget::draw()</a> is called, FLTK stores all the extra arguments you need to make a proper GDI call in some global variables:</p>
<div class="fragment"><pre class="fragment"><span class="keyword">extern</span> HINSTANCE <a class="code" href="win32_8H.html#a6c6726f30a7b613184e2b315e167ddb2" title="END TIMERS //////////////////////////////////////////////////////////////////////////.">fl_display</a>;
<span class="keyword">extern</span> HWND <a class="code" href="win32_8H.html#afdab6664143864c36ba6b51782b32500">fl_window</a>;
<span class="keyword">extern</span> HDC <a class="code" href="mac_8H.html#a9b2af459c0a223b6274f508339c783a6">fl_gc</a>;
COLORREF <a class="code" href="win32_8H.html#a09678d1ea1cab7c57430d2e1ea115b25">fl_RGB</a>();
HPEN <a class="code" href="win32_8H.html#af4de604eda82469481e5ee68b6bbb5d1">fl_pen</a>();
HBRUSH <a class="code" href="win32_8H.html#a0d55d3bd507a98fdf06f23c106ba803c">fl_brush</a>();
</pre></div><p>These global variables are set before <a class="el" href="classFl__Widget.html#a1acb38c6b3cb40452ad02ccfeedbac8a">Fl_Widget::draw()</a> is called, or by <a class="el" href="classFl__Window.html#a65a2499309b3fdd1bed463cefa0cd1e2">Fl_Window::make_current()</a>. You can refer to them when needed to produce GDI calls, but don't attempt to change them. The functions return GDI objects for the current color set by <a class="el" href="drawing.html#drawing_colors">fl_color()</a> and are created as needed and cached. A typical GDI drawing call is written like this:</p>
<div class="fragment"><pre class="fragment">DrawSomething(fl_gc, ..., <a class="code" href="win32_8H.html#a0d55d3bd507a98fdf06f23c106ba803c">fl_brush</a>());
</pre></div><p>It may also be useful to refer to <a class="el" href="classFl__Window.html#af5e20a946ba316850cff08c09ed8e9e2">Fl_Window::current()</a> to get the window's size or position.</p>
<h3><a class="anchor" id="osissues_icon_windows"></a>
Setting the Icon of a Window</h3>
<p>FLTK currently supports setting a window's icon *before* it is shown using the <a class="el" href="classFl__Window.html#a26d72fc2749dce26680d686ae6841a29">Fl_Window::icon()</a> method.</p>
<p>void <a class="el" href="classFl__Window.html#aebe49571396c9d9e88e6006e0d4899a1">Fl_Window::icon(const void *)</a></p>
<dl class="user"><dt><b></b></dt><dd>Sets the icon for the window to the passed pointer. You will need to cast the <code>HICON</code> handle to a <code>char*</code> when calling this method. To set the icon using an icon resource compiled with your application use: <div class="fragment"><pre class="fragment">window-&gt;<a class="code" href="classFl__Window.html#a26d72fc2749dce26680d686ae6841a29">icon</a>((<span class="keyword">const</span> <span class="keywordtype">void</span> *)LoadIcon(fl_display, MAKEINTRESOURCE(IDI_ICON)));
</pre></div></dd></dl>
<dl class="user"><dt><b></b></dt><dd>You can also use the <code>LoadImage()</code> and related functions to load specific resolutions or create the icon from bitmap data.</dd></dl>
<center> <table  width="90%" border="1" cellpadding="5" cellspacing="0" bgcolor="#cccccc">
<tr>
<td><p class="starttd"><b>NOTE:</b></p>
<p>You must call <a class="el" href="classFl__Window.html#a0d75dfcdc8fb797f9247482da1e0152b">Fl_Window::show(int argc, char** argv)</a> for the icon to be used. The <a class="el" href="classFl__Window.html#afc4d3796226dfd4620b4d7cf29c287c9">Fl_Window::show()</a> method does not bind the icon to the window.</p>
<p class="endtd"></p>
</td></tr>
</table>
</center><h3><a class="anchor" id="osissues_msdos_console"></a>
How to Not Get a MSDOS Console Window</h3>
<p>WIN32 has a really stupid mode switch stored in the executables that controls whether or not to make a console window.</p>
<p>To always get a console window you simply create a console application (the "/SUBSYSTEM:CONSOLE" option for the linker). For a GUI-only application create a WIN32 application (the "/SUBSYSTEM:WINDOWS" option for the linker).</p>
<p>FLTK includes a <code>WinMain()</code> function that calls the ANSI standard <code><a class="el" href="posixScandir_8cxx.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a></code> entry point for you. <em> This function creates a console window when you use the debug version of the library. </em></p>
<p>WIN32 applications without a console cannot write to <code>stdout</code> or <code>stderr</code>, even if they are run from a console window. Any output is silently thrown away. Additionally, WIN32 applications are run in the background by the console, although you can use "start /wait program" to run them in the foreground.</p>
<h3><a class="anchor" id="osissues_win32_problems"></a>
Known WIN32 Bugs and Problems</h3>
<p>The following is a list of known bugs and problems in the WIN32 version of FLTK:</p>
<ul>
<li>If a program is deactivated, <code><a class="el" href="classFl.html#a108a84216f0b3fa1cb0c46ab7449a312">Fl::wait()</a></code> does not return until it is activated again, even though many events are delivered to the program. This can cause idle background processes to stop unexpectedly. This also happens while the user is dragging or resizing windows or otherwise holding the mouse down. We were forced to remove most of the efficiency FLTK uses for redrawing in order to get windows to update while being moved. This is a design error in WIN32 and probably impossible to get around.</li>
</ul>
<ul>
<li><code><a class="el" href="classFl__Gl__Window.html#a01a3a32a3c3a58d86c747732b2771c8b">Fl_Gl_Window::can_do_overlay()</a></code> returns true until the first time it attempts to draw an overlay, and then correctly returns whether or not there is overlay hardware.</li>
</ul>
<ul>
<li><code>SetCapture</code> (used by <code>Fl::grab()</code>) doesn't work, and the main window title bar turns gray while menus are popped up.</li>
</ul>
<ul>
<li>Compilation with <code>gcc 3.4.4</code> and <code>-Os</code> exposes an optimisation bug in gcc. The symptom is that when drawing filled circles only the perimeter is drawn. This can for instance be seen in the symbols demo. Other optimisation options such as -O2 and -O3 seem to work OK. More details can be found in STR#1656</li>
</ul>
<h2><a class="anchor" id="osissues_macos"></a>
The Apple OS X Interface</h2>
<p>FLTK supports Apple OS X using the Apple Cocoa library. Older versions of MacOS are no longer supported.</p>
<p>Control, Option, and Command Modifier Keys</p>
<dl class="user"><dt><b></b></dt><dd>FLTK maps the Mac 'control' key to <code>FL_CTRL</code>, the 'option' key to <code>FL_ALT</code> and the 'Apple' key to <code>FL_META</code>. Furthermore, <code>FL_COMMAND</code> designates the 'Apple' key on Mac OS X and the 'control' key on other platforms. Keyboard events return the key name in Fl::event_key() and the keystroke translation in Fl::event_text(). For example, typing Option-Y on a Mac US keyboard will set <code>FL_ALT</code> in Fl::event_state(), set Fl::event_key() to 'y' and return the Yen symbol in Fl::event_text().</dd></dl>
<p>Apple "Quit" Event</p>
<dl class="user"><dt><b></b></dt><dd>When the user presses Cmd-Q or requests a termination of the application, OS X will send a "Quit" Apple Event. FLTK handles this event by sending an <code>FL_CLOSE</code> event to all open windows. If all windows close, the application will terminate.</dd></dl>
<p>Apple "Open" Event</p>
<dl class="user"><dt><b></b></dt><dd>Whenever the user drops a file onto an application icon, OS X generates an Apple Event of the type "Open". You can have FLTK notify you of an Open event by setting the <code>fl_open_callback</code> </dd></dl>
<p>void <a class="el" href="mac_8H.html#a94ee21d83137569a6730e3e2e7305cbc">fl_open_display()</a></p>
<dl class="user"><dt><b></b></dt><dd>Opens the display. Does nothing if it is already open. You should call this if you wish to do Cocoa or Quartz calls and there is a chance that your code will be called before the first <code>show()</code> of a window.</dd></dl>
<p>Window <a class="el" href="x_8H.html#aa5809b3b26210f3de4945b243420eda9">fl_xid(const Fl_Window *)</a></p>
<dl class="user"><dt><b></b></dt><dd>Returns the window reference for an <a class="el" href="classFl__Window.html">Fl_Window</a>, or <code>NULL</code> if the window has not been shown. This reference is a pointer to an instance of the subclass FLWindow of Cocoa's NSWindow class.</dd></dl>
<p><a class="el" href="classFl__Window.html">Fl_Window</a> *fl_find(Window xid)</p>
<dl class="user"><dt><b></b></dt><dd>Returns the <a class="el" href="classFl__Window.html">Fl_Window</a> that corresponds to the given window reference, or <code>NULL</code> if not found. FLTK windows that are children of top-level windows share the <code>Window</code> of the top-level window.</dd></dl>
<p>void <a class="el" href="group__group__macosx.html#ga0702a54934d10f5b72157137cf291296">fl_open_callback</a>(void (*cb)(const char *))</p>
<dl class="user"><dt><b></b></dt><dd><code>cb</code> will be called with a single Unix-style file name and path. If multiple files were dropped, <code><a class="el" href="group__group__macosx.html#ga0702a54934d10f5b72157137cf291296" title="Register a function called for each file dropped onto an application icon.">fl_open_callback()</a></code> will be called multiple times.</dd></dl>
<p>void <a class="el" href="group__group__macosx.html#gac2ba4bfc66f7bc9792dffa2aeb53064e" title="Attaches a callback to the &quot;About myprog&quot; item of the system application menu...">fl_mac_set_about( Fl_Callback *cb, void *user_data, int shortcut)</a></p>
<dl class="user"><dt><b></b></dt><dd>Attaches the callback <code>cb</code> to the "About myprog" item of the system application menu. <code>cb</code> will be called with NULL first argument and <code>user_data</code> second argument.</dd></dl>
<p>Fl_Sys_Menu_Bar class</p>
<dl class="user"><dt><b></b></dt><dd>The Fl_Sys_Menu_Bar class allows to build menu bars that, on Mac OS X, are placed in the system menu bar (at top-left of display), and, on other platforms, at a user-chosen location of a user-chosen window.</dd></dl>
<h3><a class="anchor" id="osissues_quartz"></a>
Drawing Things Using Quartz</h3>
<p>All code inside <a class="el" href="classFl__Widget.html#a1acb38c6b3cb40452ad02ccfeedbac8a">Fl_Widget::draw()</a> is expected to call Quartz drawing functions. The Quartz coordinate system is flipped to match FLTK's coordinate system. The origin for all drawing is in the top left corner of the enclosing <a class="el" href="classFl__Window.html">Fl_Window</a>. The global variable <code>fl_gc</code> is the appropriate Quartz 2D drawing environment. Include FL/x.H to declare the <code>fl_gc</code> variable.</p>
<p><a class="el" href="classFl__Double__Window.html">Fl_Double_Window</a></p>
<p>OS X double-buffers all windows automatically. On OS X, <a class="el" href="classFl__Window.html">Fl_Window</a> and <a class="el" href="classFl__Double__Window.html">Fl_Double_Window</a> are handled internally in the same way.</p>
<h3><a class="anchor" id="osissues_mac_files"></a>
Mac File System Specifics</h3>
<dl class="user"><dt><b>Resource Forks</b></dt><dd></dd></dl>
<p>FLTK does not access the resource fork of an application. However, a minimal resource fork must be created for OS X applications. Starting with OS X 10.6, resource forks are no longer needed.</p>
<center> <table  width="80%" border="1" bgcolor="#cccccc" cellpadding="5">
<tr>
<td><p class="starttd"><b>Caution (OS X 10.2 and older):</b></p>
<p class="endtd">When using UNIX commands to copy or move executables, OS X will NOT copy any resource forks! For copying and moving use CpMac and MvMac respectively. For creating a tar archive, all executables need to be stripped from their Resource Fork before packing, e.g. "DeRez fluid &gt; fluid.r". After unpacking the Resource Fork needs to be reattached, e.g. "Rez fluid.r -o
fluid". </p>
</td></tr>
</table>
</center><p>It is advisable to use the Finder for moving and copying and Mac archiving tools like Sit for distribution as they will handle the Resource Fork correctly.</p>
<dl class="user"><dt><b>Mac File Paths</b></dt><dd></dd></dl>
<p>FLTK uses UTF-8-encoded UNIX-style filenames and paths.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__group__macosx.html">Mac OS X-specific functions</a></dd></dl>
 
<hr>
<table summary="navigation bar" width="100%" border="0">
<tr>
  <td width="45%" align="LEFT">
    <a class="el" href="forms.html">
    [Prev]
    Forms Compatibility
    </a>
  </td>
  <td width="10%" align="CENTER">
    <a class="el" href="main.html">[Index]</a>
  </td>
  <td width="45%" align="RIGHT">
    <a class="el" href="migration_1_1.html">
    Migrating Code from FLTK 1.0 to 1.1
    [Next]
    </a>
  </td>
</tr>
</table>
 </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="main.html">FLTK Programming Manual</a>      </li>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="#" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3</small></address>
</body>

<!-- Mirrored from dox.sfr-fresh.com/fltk-1.3.0rc3-source/osissues.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 16 Feb 2011 23:23:54 GMT -->
</html>
