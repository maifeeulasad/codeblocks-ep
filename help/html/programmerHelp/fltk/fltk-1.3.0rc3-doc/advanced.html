<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from dox.sfr-fresh.com/fltk-1.3.0rc3-source/advanced.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 16 Feb 2011 23:23:54 GMT -->
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SfR Fresh Dox - fltk: Advanced FLTK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">fltk&#160;<span id="projectnumber">1.3.0rc3</span></div>
   <div id="projectbrief">About: <A HREF= http://www.fltk.org/>FLTK</A> (Fast Light Tool Kit) is a cross-platform C++ GUI toolkit for UNIX/Linux (X11), Microsoft Windows, and MacOS X. Release candidate.<BR><IMG SRC="../warix/forest1.gif" ALT="">&nbsp;&nbsp;<A HREF="http://www.sfr-fresh.com/" TITLE="SfR Fresh Home">SfR Fresh</A> <A HREF="http://www.sfr-fresh.com/warix/features.html#doxygen" TITLE="SfR Fresh Doxygen Support Info">Dox</A>: <A HREF="../fresh/unix/misc/fltk-1.3.0rc3-source.tar.gz/index.html" TITLE="SfR Fresh: fltk-1.3.0rc3-source.tar.gz Contents &amp; Download Page">fltk-1.3.0rc3-source.tar.gz</A> ("inofficial" and yet experimental doxygen-generated source code documentation)&nbsp;&nbsp;<IMG SRC="../warix/forest2.gif" ALT=""><P></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index-2.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('advanced.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>Advanced FLTK </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><p>This chapter explains advanced programming and design topics that will help you to get the most out of FLTK.</p>
<h2><a class="anchor" id="advanced_multithreading"></a>
Multithreading</h2>
<p>FLTK supports multithreaded applications using a locking mechanism based on "pthreads". We do not provide a threading interface as part of the library. However a simple example how threads can be implemented for all supported platforms can be found in <code>test/threads.h</code> and <code>test/threads.cxx</code>.</p>
<p>To use the locking mechanism, FLTK must be compiled with <code>--enable-threads</code> set during the <code>configure</code> process. IDE-based versions of FLTK are automatically compiled with locking enabled if possible.</p>
<p>In <code><a class="el" href="posixScandir_8cxx.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main()</a></code>, call Fl::lock() before <a class="el" href="classFl.html#a7a3b1236b41800d24267288c564b187a">Fl::run()</a> or <a class="el" href="classFl.html#a108a84216f0b3fa1cb0c46ab7449a312">Fl::wait()</a> to start the runtime multithreading support for your program. All callbacks and derived functions like <code>handle()</code> and <code>draw()</code> will now be properly locked:</p>
<div class="fragment"><pre class="fragment">    <span class="keywordtype">int</span> <a class="code" href="posixScandir_8cxx.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {
      <a class="code" href="group__fl__multithread.html#ga9a485ef2641adb0b026224ce41e8dabd">Fl::lock</a>();
      <span class="comment">/* run thread */</span>
      <span class="keywordflow">while</span> (<a class="code" href="classFl.html#a108a84216f0b3fa1cb0c46ab7449a312">Fl::wait</a>() &gt; 0) {
        <span class="keywordflow">if</span> (<a class="code" href="group__fl__multithread.html#ga82258694ec1baf11c3756c965b2c501e">Fl::thread_message</a>()) {
          <span class="comment">/* process your data */</span>
        }
      }
    }
</pre></div><p>You can now start as many threads as you like. From within a thread (other than the main thread) FLTK calls must be wrapped with calls to Fl::lock() and Fl::unlock():</p>
<div class="fragment"><pre class="fragment">    <a class="code" href="group__fl__multithread.html#ga9a485ef2641adb0b026224ce41e8dabd">Fl::lock</a>();      <span class="comment">// avoid conflicting calls</span>
    ...              <span class="comment">// your code here</span>
    <a class="code" href="group__fl__multithread.html#ga2b9375cc078d9d39161e2cba520829fd">Fl::unlock</a>();    <span class="comment">// allow other threads to access FLTK again</span>
</pre></div><p>You can send messages from child threads to the main thread using Fl::awake(void* message):</p>
<div class="fragment"><pre class="fragment">    <span class="keywordtype">void</span> *msg;       <span class="comment">// &quot;msg&quot; is a pointer to your message</span>
    <a class="code" href="group__fl__multithread.html#gae9e8f440ce2ca05b047c620f75af13cb">Fl::awake</a>(msg);  <span class="comment">// send &quot;msg&quot; to main thread</span>
</pre></div><p>A message can be anything you like. The main thread can retrieve the message by calling Fl::thread_message(). See example above.</p>
<p>You can also tell the main thread to call a function for you as soon as possible by using Fl::awake(Fl_Awake_Handler cb, void* userdata):</p>
<div class="fragment"><pre class="fragment">    <span class="keywordtype">void</span> do_something(<span class="keywordtype">void</span> *userdata) {
      <span class="comment">// running with the main thread</span>
    }

    <span class="comment">// running in another thread</span>
    <span class="keywordtype">void</span> *<a class="code" href="jpeglib_8h.html#ae5784a8f4db42de0ffacd0cbd08dc6ad">data</a>;       <span class="comment">// &quot;data&quot; is a pointer to your user data</span>
    <a class="code" href="group__fl__multithread.html#gae9e8f440ce2ca05b047c620f75af13cb">Fl::awake</a>(do_something, data);  <span class="comment">// call something in main thread</span>
</pre></div><p>FLTK supports multiple platforms, some of which allow only the main thread to handle system events and open or close windows. The safe thing to do is to adhere to the following rules for threads on all operating systems:</p>
<ul>
<li>Don't <code>show()</code> or <code>hide()</code> anything that contains widgets derived from <a class="el" href="classFl__Window.html">Fl_Window</a>, including dialogs, file choosers, subwindows or those using <a class="el" href="classFl__Gl__Window.html">Fl_Gl_Window</a>.</li>
</ul>
<ul>
<li>Don't call <a class="el" href="classFl.html#a108a84216f0b3fa1cb0c46ab7449a312">Fl::wait()</a>, <a class="el" href="classFl.html#a08d29d807ea3874b8bb16f7457f64bdc">Fl::flush()</a> or any related methods that will handle system messages</li>
</ul>
<ul>
<li>Don't start or cancel timers</li>
</ul>
<ul>
<li>Don't change window decorations or titles</li>
</ul>
<ul>
<li>The <code>make_current()</code> method may or may not work well for regular windows, but should always work for a <a class="el" href="classFl__Gl__Window.html">Fl_Gl_Window</a> to allow for high speed rendering on graphics cards with multiple pipelines</li>
</ul>
<p>See also: Fl::awake(void* message), Fl::lock(), Fl::thread_message(), Fl::unlock().</p>
 
<hr>
<table summary="navigation bar" width="100%" border="0">
<tr>
  <td width="45%" align="LEFT">
    <a class="el" href="fluid.html">
    [Prev]
    Programming with FLUID
    </a>
  </td>
  <td width="10%" align="CENTER">
    <a class="el" href="main.html">[Index]</a>
  </td>
  <td width="45%" align="RIGHT">
    <a class="el" href="unicode.html">
    Unicode and utf-8 Support
    [Next]
    </a>
  </td>
</tr>
</table>
 </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="main.html">FLTK Programming Manual</a>      </li>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="#" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3</small></address>
</body>

<!-- Mirrored from dox.sfr-fresh.com/fltk-1.3.0rc3-source/advanced.html by HTTrack Website Copier/3.x [XR&CO'2010], Wed, 16 Feb 2011 23:23:54 GMT -->
</html>
